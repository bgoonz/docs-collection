<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="dcterms.date" content="2020-02-04" />
    <title>Implementation guide</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Implementation guide</h1>
      <p class="date">2020-02-04</p>
    </header>
    <p>
      A complete example is available on
      <a
        href="https://github.com/GoogleChrome/android-browser-helper/tree/master/demos/custom-tabs-example-app"
        >the GitHub sample application</a
      >. It contains re-usable classes to customize the UI, connect to the
      background service, and handle the lifecycle of both the application and
      the custom tab activity.
    </p>
    <p>
      If you follow the guidance from this page, you will be able to create a
      great integration.
    </p>
    <p>
      The first step for a Custom Tabs integration is adding the
      <a
        href="https://developer.android.com/jetpack/androidx/releases/browser#declaring_dependencies"
        >AndroidX Browser Library</a
      >
      to your project. Open the <code>app/build.gradle</code> file and add the
      browser library to the dependencies section.
    </p>
    <pre class="groovy"><code>dependencies {
    ...
    implementation &quot;androidx.browser:browser:1.3.0&quot;
}</code></pre>
    <p>
      Once the Browser Library is added to your project there are two sets of
      possible customizations:
    </p>
    <ul>
      <li>Customizing the UI and interaction with the custom tabs.</li>
      <li>Making the page load faster, and keeping the application alive.</li>
    </ul>
    <p>
      The UI Customizations are done by using the
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent"
        ><code>CustomTabsIntent</code></a
      >
      and the
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent.Builder"
        ><code>CustomTabsIntent.Builder</code></a
      >
      classes; the performance improvements are achieved by using the
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient"
        ><code>CustomTabsClient</code></a
      >
      to connect to the Custom Tabs service, warm-up the browser and let it know
      which urls will be opened.
    </p>
    <h2 id="opening-a-custom-tab">Opening a Custom Tab</h2>
    <p>
      A
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent.Builder"
        ><code>CustomTabsIntent.Builder</code></a
      >
      can be used to configure a Custom Tab. Once ready, call
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent.Builder#build()"
        ><code>CustomTabsIntent.Builder.build</code></a
      >
      to create a
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent"
        ><code>CustomTabsIntent</code></a
      >
      and launch the desired Url with
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent#launchUrl(android.content.Context,%20android.net.Uri)"
        ><code>CustomTabsIntent.launchUrl</code></a
      >.
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb2-1" title="1"><span class="bu">String</span> url = ¨https:<span class="co">//paul.kinlan.me/¨;</span></a>
<a class="sourceLine" id="cb2-2" title="2">CustomTabsIntent.<span class="fu">Builder</span> builder = <span class="kw">new</span> CustomTabsIntent.<span class="fu">Builder</span>();</a>
<a class="sourceLine" id="cb2-3" title="3">CustomTabsIntent customTabsIntent = builder.<span class="fu">build</span>();</a>
<a class="sourceLine" id="cb2-4" title="4">customTabsIntent.<span class="fu">launchUrl</span>(<span class="kw">this</span>, Uri.<span class="fu">parse</span>(url));</a></code></pre>
    </div>
    <h2 id="configure-the-color-of-the-address-bar">
      Configure the color of the address bar
    </h2>
    <p>
      One of the most important (and simplest to implement) aspects of Custom
      Tabs is the ability for you to change the color of the address bar to be
      consistent with your app’s theme.
    </p>
    <p>
      The snippet below changes the background color for the address bar.
      colorInt is an int that specifies a
      <a href="https://developer.android.com/reference/android/graphics/Color"
        ><code>Color</code></a
      >.
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb3-1" title="1"><span class="dt">int</span> colorInt = <span class="bu">Color</span>.<span class="fu">parseColor</span>(<span class="st">&quot;#FF0000&quot;</span>); <span class="co">//red</span></a>
<a class="sourceLine" id="cb3-2" title="2">CustomTabColorSchemeParams defaultColors = <span class="kw">new</span> CustomTabColorSchemeParams.<span class="fu">Builder</span>()</a>
<a class="sourceLine" id="cb3-3" title="3">    .<span class="fu">setToolbarColor</span>(colorInt)</a>
<a class="sourceLine" id="cb3-4" title="4">    .<span class="fu">build</span>();</a>
<a class="sourceLine" id="cb3-5" title="5">intentBuilder.<span class="fu">setDefaultColorSchemeParams</span>(defaultColors);</a></code></pre>
    </div>
    <h2 id="configure-a-custom-action-button">
      Configure a custom action button
    </h2>
    <div class="sourceCode" id="cb4">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb4-1" title="1">builder.<span class="fu">setActionButton</span>(icon, description, pendingIntent, tint);</a></code></pre>
    </div>
    <p>
      {% Img src=“image/Vww75TFpThOgTNuASFM6UYfBAp53/wBbdC6mX8P6moJRJekjL.png”,
      alt=“Screenshot of the Action Button in the Tumblr app”, width=“800”,
      height=“1422” %}
    </p>
    <p>
      As the developer of your app, you have full control over the Action Button
      that is presented to your users inside the browser tab.
    </p>
    <p>
      In most cases, this will be a primary action such as Share, or another
      common activity that your users will perform.
    </p>
    <p>
      The Action Button is represented as a Bundle with an icon of the action
      button and a
      <a
        href="https://developer.android.com/reference/android/app/PendingIntent"
        ><code>PendingIntent</code></a
      >
      that will be called by the browser when your user hits the action button.
      The icon is currenlty 24dp in height and 24-48 dp in width.
    </p>
    <p>
      It can be customized by calling
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent.Builder#setActionButton(android.graphics.Bitmap,%20java.lang.String,%20android.app.PendingIntent,%20boolean)"
        ><code>CustomTabsIntentBuilder#setActionButton</code></a
      >:
    </p>
    <ul>
      <li>
        <code>icon</code> is a
        <a
          href="https://developer.android.com/reference/android/graphics/Bitmap"
          ><code>Bitmap</code></a
        >
        to be used as the
        <a
          href="https://developer.android.com/reference/android/widget/ImageView#setImageDrawable(android.graphics.drawable.Drawable)"
          >image source</a
        >
        for the action button.
      </li>
      <li>
        <code>description</code> is a
        <a href="https://developer.android.com/reference/java/lang/String"
          ><code>String</code></a
        >
        be used as an accessible description for the button.
      </li>
      <li>
        <code>pendingIntent</code> is a
        <a
          href="https://developer.android.com/reference/android/app/PendingIntent"
          ><code>PendingIntent</code></a
        >
        to launch when the action button or menu item was tapped. The browser
        will be calling
        <a
          href="https://developer.android.com/reference/android/app/PendingIntent#send(android.content.Context,%20int,%20android.content.Intent)"
          ><code>PendingIntent#send</code></a
        >
        on taps after adding the url as data. The client app can call
        <a
          href="https://developer.android.com/reference/android/content/Intent#getDataString()"
          ><code>Intent#getDataString</code></a
        >
        to get the url.
      </li>
      <li>
        <code>tint</code> is a
        <a href="https://developer.android.com/reference/java/lang/Boolean"
          >boolean</a
        >
        that defines if the Action Button should be tinted.
      </li>
    </ul>
    <h2 id="configure-a-custom-menu">Configure a custom menu</h2>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb5-1" title="1">builder.<span class="fu">addMenuItem</span>(menuItemTitle, menuItemPendingIntent);</a></code></pre>
    </div>
    <p>
      {% Img src=“image/Vww75TFpThOgTNuASFM6UYfBAp53/7vKsCO6qBKcuOeYk1tnv.png”,
      alt=“Screenshot of the menu on the Twitter app”, width=“800”,
      height=“1422” %}
    </p>
    <p>
      The browser has a comprehensive menu of actions that users will perform
      frequently inside a browser, however they may not be relevant to your
      application context.
    </p>
    <p>
      Custom Tabs will have a set of default actions provided by the browser.
      Those actions can include items like “Forward”, “Page Info”, “Refresh”,
      “Find in Page” or “Open in Browser”.
    </p>
    <p>
      As the developer, you can add and customize up to five menu items that
      will appear between the icon row and foot items.
    </p>
    <p>
      A menu item is added by calling
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent.Builder#addMenuItem(java.lang.String,%20android.app.PendingIntent)"
        ><code>CustomTabsIntent.Builder#addMenuItem</code></a
      >
      with title and a
      <a
        href="https://developer.android.com/reference/android/app/PendingIntent"
        ><code>PendingIntent</code></a
      >
      that browser will call on your behalf when the user taps the item are
      passed as parameters.
    </p>
    <h2 id="configure-custom-enter-and-exit-animations">
      Configure custom enter and exit animations
    </h2>
    <p>
      Many Android applications use custom View Entrance and Exit animations
      when transitioning between Activities on Android. Custom Tabs is no
      different, you can change the entrance and exit (when the user presses
      Back) animations to keep them consistent with the rest of your
      application.
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb6-1" title="1">builder.<span class="fu">setStartAnimations</span>(<span class="kw">this</span>, R.<span class="fu">anim</span>.<span class="fu">slide_in_right</span>, R.<span class="fu">anim</span>.<span class="fu">slide_out_left</span>);</a>
<a class="sourceLine" id="cb6-2" title="2">builder.<span class="fu">setExitAnimations</span>(<span class="kw">this</span>, R.<span class="fu">anim</span>.<span class="fu">slide_in_left</span>, R.<span class="fu">anim</span>.<span class="fu">slide_out_right</span>);</a></code></pre>
    </div>
    <h2 id="warm-up-the-browser-to-make-pages-load-faster">
      Warm up the browser to make pages load faster
    </h2>
    <p>
      By default, when
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent#launchUrl(android.content.Context,%20android.net.Uri)"
        ><code>CustomTabsIntent#launchUrl</code></a
      >
      is called, it will spin up the browser and launch the URL. This can take
      up precious time and impact on the perception of smoothness.
    </p>
    <p>
      We believe that users demand a near instantaneous experience, so we have
      provided a Service that your app can connect to and tell the browser and
      its native components to warm up. Custom Tabs also provide the ability for
      you, the developer to tell the browser the likely set of web pages the
      user will visit. Browsers will then be able to perform:
    </p>
    <ul>
      <li>DNS pre-resolution of the main domain</li>
      <li>DNS pre-resolution of the most likely sub-resources</li>
      <li>
        Pre-connection to the destination including HTTPS/TLS negotiation.
      </li>
    </ul>
    <p>The process for warming up the browser is as follows:</p>
    <ul>
      <li>
        Use
        <a
          href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient#bindCustomTabsService(android.content.Context,%20java.lang.String,%20androidx.browser.customtabs.CustomTabsServiceConnection)"
          ><code>CustomTabsClient#bindCustomTabsService</code></a
        >
        to connect to the service.
      </li>
      <li>
        Once the service is connected, call
        <a
          href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient#warmup(long)"
          ><code>CustomTabsClient#warmup</code></a
        >
        to start the browser behind the scenes.
      </li>
      <li>
        Call
        <a
          href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient#newSession(androidx.browser.customtabs.CustomTabsCallback)"
          ><code>CustomTabsClient#newSession</code></a
        >
        to create a new session. This session is used for all requests to the
        API.
      </li>
      <li>
        Optionally, attach a
        <a
          href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsCallback"
          ><code>CustomTabsCallback</code></a
        >
        as a parameter when creating a new session, so that you know a page was
        loaded.
      </li>
      <li>
        Tell the browser which pages the user is likely to load with
        <a
          href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsSession"
          ><code>CustomTabsSession#mayLaunchUrl</code></a
        >
      </li>
      <li>
        Call the
        <a
          href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsIntent.Builder"
          ><code>CustomTabsIntent.Builder</code></a
        >
        constructor passing the created
        <a
          href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsSession"
          ><code>CustomTabsSession</code></a
        >
        as a parameter.
      </li>
    </ul>
    <h2 id="connect-to-the-custom-tabs-service">
      Connect to the Custom Tabs Service
    </h2>
    <p>
      The
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient#bindCustomTabsService(android.content.Context,%20java.lang.String,%20androidx.browser.customtabs.CustomTabsServiceConnection)"
        ><code>CustomTabsClient#bindCustomTabsService</code></a
      >
      method takes away the complexity of connecting to the Custom Tabs service.
    </p>
    <p>
      Create a class that extends
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsServiceConnection"
        ><code>CustomTabsServiceConnection</code></a
      >
      and use
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsServiceConnection#onCustomTabsServiceConnected(android.content.ComponentName,%20androidx.browser.customtabs.CustomTabsClient)"
        ><code>onCustomTabsServiceConnected</code></a
      >
      to get an instance of the
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient"
        ><code>CustomTabsClient</code></a
      >. This instance will be needed on the next steps.
    </p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// Package name for the Chrome channel the client wants to connect to. This</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">// depends on the channel name.</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">// Stable = com.android.chrome</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">// Beta = com.chrome.beta</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">// Dev = com.chrome.dev</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> CUSTOM_TAB_PACKAGE_NAME = <span class="st">&quot;com.android.chrome&quot;</span>;  <span class="co">// Change when in stable</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8">CustomTabsServiceConnection connection = <span class="kw">new</span> <span class="fu">CustomTabsServiceConnection</span>() {</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="at">@Override</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onCustomTabsServiceConnected</span>(ComponentName name, CustomTabsClient client) {</a>
<a class="sourceLine" id="cb7-11" title="11">        mCustomTabsClient = client;</a>
<a class="sourceLine" id="cb7-12" title="12">    }</a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="at">@Override</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onServiceDisconnected</span>(ComponentName name) {</a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">    }</a>
<a class="sourceLine" id="cb7-18" title="18">};</a>
<a class="sourceLine" id="cb7-19" title="19"><span class="dt">boolean</span> ok = CustomTabsClient.<span class="fu">bindCustomTabsService</span>(<span class="kw">this</span>, mPackageNameToBind, connection);</a></code></pre>
    </div>
    <h2 id="warm-up-the-browser-process">Warm up the Browser Process</h2>
    <p>
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient#warmup(long)"
        ><code>boolean warmup(long flags)</code></a
      >
    </p>
    <p>
      Warms up the browser process and loads the native libraries. Warmup is
      asynchronous, the return value indicates whether the request has been
      accepted. Multiple successful calls will also return true.
    </p>
    <p>Returns <code>true</code> if successful.</p>
    <h2 id="create-a-new-tab-session">Create a new tab session</h2>
    <p>
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient#newSession(androidx.browser.customtabs.CustomTabsCallback)"
        ><code>boolean newSession(CustomTabsCallback callback)</code></a
      >
    </p>
    <p>
      Session is used in subsequent calls to link mayLaunchUrl call, the
      CustomTabsIntent and the tab generated to each other. The callback
      provided here is associated with the created session. Any updates for the
      created session (see Custom Tabs Callback below) is also received through
      this callback. Returns whether a session was created successfully.
      Multiple calls with the same CustomTabsCallback or a null value will
      return false.
    </p>
    <h2 id="tell-the-browser-what-urls-the-user-is-likely-to-open">
      Tell the browser what URLs the user is likely to open
    </h2>
    <p>
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsSession"
        ><code
          >boolean mayLaunchUrl(Uri url, Bundle extras, List&lt;Bundle&gt;
          otherLikelyBundles)</code
        ></a
      >
    </p>
    <p>
      This CustomTabsSession method tells the browser of a likely future
      navigation to a URL. The method
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsClient#warmup(long)"
        ><code>warmup()</code></a
      >
      should be called first as a best practice. The most likely URL has to be
      specified first. Optionally, a list of other likely URLs can be provided.
      They are treated as less likely than the first one, and have to be sorted
      in decreasing priority order. These additional URLs may be ignored. All
      previous calls to this method will be deprioritized. Returns whether the
      operation completed successfully.
    </p>
    <h2 id="custom-tabs-connection-callback">
      Custom Tabs Connection Callback
    </h2>
    <p>
      <a
        href="https://developer.android.com/reference/androidx/browser/customtabs/CustomTabsCallback#onNavigationEvent(int,%20android.os.Bundle)"
        ><code
          >void onNavigationEvent(int navigationEvent, Bundle extras)</code
        ></a
      >
    </p>
    <p>
      Will be called when a navigation event happens in the custom tab. The
      <code>navigationEvent int</code> is one of 6 values that defines the state
      of the page is in. See below for more information.
    </p>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb8-1" title="1"><span class="co">/**</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">*</span> Sent when the tab has started loading a page<span class="co">.</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">*/</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> NAVIGATION_STARTED = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">/**</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">*</span> Sent when the tab has finished loading a page<span class="co">.</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">*/</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> NAVIGATION_FINISHED = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb8-10" title="10"></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">/**</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">*</span> Sent when the tab couldn<span class="co">&#39;</span>t finish loading due to a failure<span class="co">.</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">*/</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> NAVIGATION_FAILED = <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb8-15" title="15"></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co">/**</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="co">*</span> Sent when loading was aborted by a user action before it finishes like clicking on a link</a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">*</span> or refreshing the page<span class="co">.</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co">*/</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> NAVIGATION_ABORTED = <span class="dv">4</span>;</a>
<a class="sourceLine" id="cb8-21" title="21"></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="co">/**</span></a>
<a class="sourceLine" id="cb8-23" title="23"><span class="co">*</span> Sent when the tab becomes visible<span class="co">.</span></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="co">*/</span></a>
<a class="sourceLine" id="cb8-25" title="25"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> TAB_SHOWN = <span class="dv">5</span>;</a>
<a class="sourceLine" id="cb8-26" title="26"></a>
<a class="sourceLine" id="cb8-27" title="27"><span class="co">/**</span></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="co">*</span> Sent when the tab becomes hidden<span class="co">.</span></a>
<a class="sourceLine" id="cb8-29" title="29"><span class="co">*/</span></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> TAB_HIDDEN = <span class="dv">6</span>;</a></code></pre>
    </div>
    <h2
      id="what-happens-if-the-user-doesnt-have-a-browser-that-supports-custom-tabs-installed"
    >
      What happens if the user doesn’t have a browser that supports Custom Tabs
      installed?
    </h2>
    <p>
      Custom Tabs is supported by most Android browsers. Nevertheless, since it
      uses an <code>ACTION_VIEW</code> Intent with key Extras to customize the
      UI it will open in the system browser, or the user’s default browser if
      Custom Tabs is not supported.
    </p>
    <p>
      If the user has a browser that supports Custom Tab installed and it is the
      default browser, it will automatically pick up the EXTRAS and present a
      customized UI.
    </p>
    <h2
      id="how-can-i-check-whether-the-android-device-has-a-browser-that-supports-custom-tab"
    >
      How can I check whether the Android device has a browser that supports
      Custom Tab?
    </h2>
    <p>
      It is possible to use the
      <a
        href="https://developer.android.com/reference/android/content/pm/PackageManager"
        ><code>PackageManager</code></a
      >
      to query the Android device for applications that can handle Custom Tabs.
      We query for applications that are able to handle
      <code>http</code> Intents, then check if those applications also declare
      support for the Custom Tabs Service:
    </p>
    <div class="sourceCode" id="cb9">
      <pre
        class="sourceCode java"
      ><code class="sourceCode java"><a class="sourceLine" id="cb9-1" title="1"><span class="co">/**</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">*</span> Returns a list of packages that support Custom Tabs<span class="co">.</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">*/</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">public</span> <span class="dt">static</span> <span class="bu">ArrayList</span>&lt;ResolveInfo&gt; <span class="fu">getCustomTabsPackages</span>(<span class="bu">Context</span> context) {</a>
<a class="sourceLine" id="cb9-5" title="5">    PackageManager pm = context.<span class="fu">getPackageManager</span>();</a>
<a class="sourceLine" id="cb9-6" title="6">    <span class="co">// Get default VIEW intent handler.</span></a>
<a class="sourceLine" id="cb9-7" title="7">    Intent activityIntent = <span class="kw">new</span> <span class="fu">Intent</span>()</a>
<a class="sourceLine" id="cb9-8" title="8">        .<span class="fu">setAction</span>(Intent.<span class="fu">ACTION_VIEW</span>)</a>
<a class="sourceLine" id="cb9-9" title="9">        .<span class="fu">addCategory</span>(Intent.<span class="fu">CATEGORY_BROWSABLE</span>)</a>
<a class="sourceLine" id="cb9-10" title="10">        .<span class="fu">setData</span>(Uri.<span class="fu">fromParts</span>(<span class="st">&quot;http&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">null</span>));</a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12">    <span class="co">// Get all apps that can handle VIEW intents.</span></a>
<a class="sourceLine" id="cb9-13" title="13">    <span class="bu">List</span>&lt;ResolveInfo&gt; resolvedActivityList = pm.<span class="fu">queryIntentActivities</span>(activityIntent, <span class="dv">0</span>);</a>
<a class="sourceLine" id="cb9-14" title="14">    <span class="bu">ArrayList</span>&lt;ResolveInfo&gt; packagesSupportingCustomTabs = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();</a>
<a class="sourceLine" id="cb9-15" title="15">    <span class="kw">for</span> (ResolveInfo info : resolvedActivityList) {</a>
<a class="sourceLine" id="cb9-16" title="16">        Intent serviceIntent = <span class="kw">new</span> <span class="fu">Intent</span>();</a>
<a class="sourceLine" id="cb9-17" title="17">        serviceIntent.<span class="fu">setAction</span>(ACTION_CUSTOM_TABS_CONNECTION);</a>
<a class="sourceLine" id="cb9-18" title="18">        serviceIntent.<span class="fu">setPackage</span>(info.<span class="fu">activityInfo</span>.<span class="fu">packageName</span>);</a>
<a class="sourceLine" id="cb9-19" title="19">        <span class="co">// Check if this package also resolves the Custom Tabs service.</span></a>
<a class="sourceLine" id="cb9-20" title="20">        <span class="kw">if</span> (pm.<span class="fu">resolveService</span>(serviceIntent, <span class="dv">0</span>) != <span class="kw">null</span>) {</a>
<a class="sourceLine" id="cb9-21" title="21">            packagesSupportingCustomTabs.<span class="fu">add</span>(info);</a>
<a class="sourceLine" id="cb9-22" title="22">        }</a>
<a class="sourceLine" id="cb9-23" title="23">    }</a>
<a class="sourceLine" id="cb9-24" title="24">    <span class="kw">return</span> packagesSupportingCustomTabs;</a>
<a class="sourceLine" id="cb9-25" title="25">}</a></code></pre>
    </div>
    <p>
      Android 11 has introduced
      <a href="https://developer.android.com/preview/privacy/package-visibility"
        >package visiblity changes</a
      >. If your Android app is targeting API level 30 or above, adding a
      <code>queries</code> section to <code>AndroidManifest.xml</code> is
      needed, otherwise the code snippet above won’t return results:
    </p>
    <div class="sourceCode" id="cb10">
      <pre
        class="sourceCode xml"
      ><code class="sourceCode xml"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">&lt;queries&gt;</span></a>
<a class="sourceLine" id="cb10-2" title="2">    <span class="kw">&lt;intent&gt;</span></a>
<a class="sourceLine" id="cb10-3" title="3">        <span class="kw">&lt;action</span><span class="ot"> android:name=</span></a>
<a class="sourceLine" id="cb10-4" title="4">            <span class="st">&quot;android.support.customtabs.action.CustomTabsService&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="kw">&lt;/intent&gt;</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">&lt;/queries&gt;</span></a></code></pre>
    </div>
  </body>
</html>
