<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2014-02-28" />
  <title>Tutorial: Migrate to Manifest V2</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Tutorial: Migrate to Manifest V2</h1>
<p class="date">2014-02-28</p>
</header>
<p>{% include ‘partials/extensions/mv2-legacy-page.md’ %}</p>
<p>Manifest version 1 was deprecated in Chrome 18, and support will be phased out according to the <a href="/docs/extensions/mv2/manifestVersion#manifest-v1-support-schedule">manifest version 1 support schedule</a>. The changes from version 1 to version 2 fall under two broad categories: API changes and Security changes.</p>
<p>This document provides checklists for migrating your Chrome extensions from manifest version 1 to version 2, followed by more detailed summaries of what these changes mean and why they were made.</p>
<h2 id="api-changes-checklist-api-checklist">API changes checklist {: #api-checklist }</h2>
<ul>
<li><p>Are you using the <code>browser_actions</code> property or the <code>chrome.browserActions</code> API?</p></li>
<li>Replace <code>browser_actions</code> with the singular <code>browser_action</code> property.</li>
<li>Replace <code>chrome.browserActions</code> with <code>chrome.browserAction</code>.</li>
<li>Replace the <code>icons</code> property with <code>default_icon</code>.</li>
<li>Replace the <code>name</code> property with <code>default_title</code>.</li>
<li><p>Replace the <code>popup</code> property with <code>default_popup</code> (and it now must be a string).</p></li>
<li><p>Are you using the <code>page_actions</code> property or the <code>chrome.pageActions</code> API?</p></li>
<li>Replace <code>page_actions</code> with <code>page_action</code>.</li>
<li>Replace <code>chrome.pageActions</code> with <code>chrome.pageAction</code>.</li>
<li>Replace the <code>icons</code> property with <code>default_icon</code>.</li>
<li>Replace the <code>name</code> property with <code>default_title</code>.</li>
<li><p>Replace the <code>popup</code> property with <code>default_popup</code> (and it now must be a string).</p></li>
<li><p>Are you using the <code>chrome.self</code> property?</p></li>
<li><p>Replace with <code>chrome.extension</code>.</p></li>
<li><p>Are you using the <code>Port.tab</code> property?</p></li>
<li><p>Replace with <code>Port.sender</code>.</p></li>
<li><p>Are you using the <code>chrome.extension.getTabContentses()</code> or the <code>chrome.extension.getExtensionTabs()</code> APIs?</p></li>
<li><p>Replace with <code>chrome.extension.getViews( { "type" : "tab" } )</code>.</p></li>
<li><p>Does your extension use a background page?</p></li>
<li>Replace the <code>background_page</code> property with a <code>background</code> property.</li>
<li>Add a <code>scripts</code> or <code>page</code> property that contains the code for the page.</li>
<li><p>Add a <code>persistent</code> property and set it to <code>false</code> to convert your background page to an <a href="/docs/extensions/mv2/event_pages">event page</a></p></li>
</ul>
<h2 id="security-changes-checklist-security-checklist">Security changes checklist {: #security-checklist }</h2>
<ul>
<li><p>Are you using inline script blocks in HTML pages?</p></li>
<li><p>Remove JS code contained within <code>&lt;script&gt;</code> tags and place it within an external JS file.</p></li>
<li><p>Are you using inline event handlers (like onclick, etc)?</p></li>
<li><p>Remove them from the HTML code, move them into an external JS file and use <code>addEventListener()</code> instead.</p></li>
<li><p>Does your extension inject content scripts into Web pages that need to access resources (like images and scripts) that are contained in the extension’s package?</p></li>
<li><p>Define the <a href="/docs/extensions/mv2/manifest/web_accessible_resources">web_accessible_resources</a> property and list the resources (and optionally a separate Content Security Policy for those resources).</p></li>
<li><p>Does your extension embed external Web pages?</p></li>
<li><p>Define the <a href="/docs/extensions/mv2/manifest/sandbox">sandbox</a> property.</p></li>
<li><p>Is your code or library using <code>eval()</code>, new <code>Function()</code>, <code>innerHTML</code>, <code>setTimeout()</code>, or otherwise passing strings of JS code that are dynamically evaluated?</p></li>
<li>Use <code>JSON.parse()</code> if you’re parsing JSON code into an object.</li>
<li>Use a CSP-friendly library, for example, <a href="http://angularjs.org/">AngularJS</a>.</li>
<li><p>Create a sandbox entry in your manifest and run the affected code in the sandbox, using <code>postMessage()</code> to communicate with the sandboxed page.</p></li>
<li><p>Are you loading external code, such as jQuery or Google Analytics?</p></li>
<li>Consider downloading the library and packaging it in your extension, then loading it from the local package.</li>
<li><p>Allowlist the HTTPS domain that serves the resource in the “content_security_policy” part of your manifest.</p></li>
</ul>
<h2 id="summary-of-api-changes-api-summary">Summary of API changes {: #api-summary }</h2>
<p>Manifest version 2 introduces a few changes to the browser action and page action APIs, and replaces a few old APIs with newer ones.</p>
<h3 id="changes-to-browser-actions-browser_actions">Changes to browser actions {: #browser_actions }</h3>
<p>The browser actions API introduces some naming changes:</p>
<ul>
<li>The <code>browser_actions</code> and <code>chrome.browserActions</code> properties have been replaced with their singular counterparts <code>browser_action</code> and <code>chrome.browserAction</code>.</li>
<li><p>Under the old <code>browser_actions</code> property, there were <code>icons</code>, <code>name</code>, and <code>popup</code> properties. These have been replaced with:</p></li>
<li><code>default_icon</code> for the browser action badge icon</li>
<li><code>default_name</code> for the text that appears in the tooltip when you hover over the badge</li>
<li><p><code>default_popup</code> for the HTML page that represents the UI for the browser action (and this must now be a string, it cannot be an object)</p></li>
</ul>
<h3 id="changes-to-page-actions-page_actions">Changes to page actions {: #page_actions }</h3>
<p>Similar to the changes for browser actions, the page actions API has also changed:</p>
<ul>
<li>The <code>page_actions</code> and <code>chrome.pageActions</code> properties have been replaced with their singular counterparts <code>page_action</code> and <code>chrome.pageAction</code>.</li>
<li><p>Under the old <code>page_actions</code> property, there were <code>icons</code>, <code>name</code>, and <code>popup</code> properties. These have been replaced with:</p></li>
<li><code>default_icon</code> for the page action badge icon</li>
<li><code>default_name</code> for the text that appears in the tooltip when you hover over the badge</li>
<li><p><code>default_popup</code> for the HTML page that represents the UI for the page action (and this must now be a string, it cannot be an object)</p></li>
</ul>
<h3 id="removed-and-changed-apis-removed_and_changed">Removed and changed APIs {: #removed_and_changed }</h3>
<p>A few extension APIs have been removed and replaced with new counterparts:</p>
<ul>
<li>The <code>background_page</code> property has been replaced by <a href="/docs/extensions/mv2/background_pages">background</a>.</li>
<li>The <code>chrome.self</code> property has been removed, use <code>chrome.extension</code>.</li>
<li>The <code>Port.tab</code> property has been replaced with <code>Port.sender</code>.</li>
<li>The <code>chrome.extension.getTabContentses()</code> and the <code>chrome.extension.getExtensionTabs()</code> APIs have been replaced by <code>chrome.extension.getViews( { "type" : "tab" } )</code>.</li>
</ul>
<h2 id="summary-of-security-changes-security-summary">Summary of security changes {: #security-summary }</h2>
<p>There are a number of security-related changes that accompany the move from manifest version 1 to version 2. Many of these changes stem from Chrome’s adoption of <a href="/docs/extensions/mv2/contentSecurityPolicy">Content Security Policy</a>; you should read more about this policy to understand its implications.</p>
<h3 id="inline-scripts-and-event-handlers-disallowed-inline_scripts">Inline scripts and event handlers disallowed {: #inline_scripts }</h3>
<p>Due to the use of <a href="/docs/extensions/mv2/contentSecurityPolicy">Content Security Policy</a>, you can no longer use <code>&lt;script&gt;</code> tags that are inline with the HTML content. These must be moved to external JS files. In addition, inline event handlers are also not supported. For example, suppose you had the following code in your extension:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="kw">function</span> <span class="at">myFunc</span>() <span class="op">{</span> ... <span class="op">}</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="kw">&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>This code would cause an error at runtime. To fix this, move <code>&lt;script&gt;</code> tag contents to external files and reference them with a <code>src='path_to_file.js'</code> attribute.</p>
<p>Similarly, inline event handlers, which are a common occurrence and convenience feature used by many Web developers, will not execute. For example, consider common instances such as:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;body</span><span class="ot"> onload=</span><span class="st">&quot;initialize()&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">&lt;button</span><span class="ot"> onclick=</span><span class="st">&quot;handleClick()&quot;</span><span class="ot"> id=</span><span class="st">&quot;button1&quot;</span><span class="kw">&gt;</span></a></code></pre></div>
<p>These will not work in manifest V2 extensions. Remove the inline event handlers, place them in your external JS file and use <code>addEventListener()</code> to register event handlers for them instead. For example, in your JS code, use:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb3-1" title="1">window.addEventListener(&quot;load&quot;, initialize);</a>
<a class="sourceLine" id="cb3-2" title="2">...</a>
<a class="sourceLine" id="cb3-3" title="3">document.getElementById(&quot;button1&quot;).addEventListener(&quot;click&quot;,handleClick);</a></code></pre></div>
<p>This is a much cleaner way of separating your extension’s behavior from its user interface markup.</p>
<h3 id="embedding-content-embedding">Embedding content {: #embedding }</h3>
<p>There are some scenarios where your extension might embed content that can be used externally or come from an external source.</p>
<p><strong>Extension content in web pages:</strong> If your extension embeds resources (like images, script, CSS styles, etc) that are used in content scripts that are injected into web pages, you need to use the <a href="/docs/extensions/mv2/manifest/web_accessible_resources">web_accessible_resources</a> property to allowlist these resources so that external Web pages can use them:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb4-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="er">...</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="dt">&quot;web_accessible_resources&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="st">&quot;images/image1.png&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="st">&quot;script/myscript.js&quot;</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="er">...</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="fu">}</span></a></code></pre></div>
<p><strong>Embedding external content:</strong> The Content Security Policy only allows local script and objects to loaded from your package, which prevents external attackers from introducing unknown code to your extension. However, there are times when you want to load externally served resources, such as jQuery or Google Analytics code. There are two ways to do this:</p>
<ol type="1">
<li>Download the relevant library locally (like jQuery) and package it with your extension.</li>
<li><p>You can relax the CSP in a limited way by allowlisting HTTPS origins in the “content_security_policy” section of your manifest. To include a library like Google Analytics, this is the approach to take:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb5-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="er">...</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">&quot;content_security_policy&quot;</span><span class="fu">:</span> <span class="st">&quot;script-src &#39;self&#39;</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  https://ssl.google-analytics.com; object-src &#39;self&#39;&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="er">...</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="fu">}</span></a></code></pre></div></li>
</ol>
<h3 id="using-dynamic-script-evaluation-using">Using dynamic script evaluation {: #using }</h3>
<p>Perhaps one of the biggest changes in the new manifest v2 scheme is that extensions can no longer use dynamic script evaluation techniques like <code>eval()</code> or new <code>Function()</code>, or pass strings of JS code to functions that will cause an <code>eval()</code> to be used, like <code>setTimeout()</code>. In addition, certain commonly used JavaScript libraries, such as Google Maps and certain templating libraries, are known to use some of these techniques.</p>
<p>Chrome provides a sandbox for pages to run in their own origin, which are denied access to chrome.* APIs. In order to use <code>eval()</code> and the like under the new Content Security Policy:</p>
<ol type="1">
<li>Create a sandbox entry in your manifest file.</li>
<li>In the sandbox entry, list the pages you want to run in the sandbox.</li>
<li>Use message passing via <code>postMessage()</code> to communicate with the sandboxed page.</li>
</ol>
<p>For more details on how to do this, see the <a href="/docs/extensions/mv2/sandboxingEval">Sandboxing Eval</a> documentation.</p>
<h2 id="further-reading-further-reading">Further reading {: #further-reading }</h2>
<p>The changes in manifest version 2 are designed to guide developers toward building more secure and robustly-architected extensions and apps. To see a complete list of changes from manifest version 1 to version 2, see the <a href="/docs/extensions/mv2/manifestVersion">manifest file</a> documentation. For more information about using sandboxing to isolate unsafe code, read the <a href="/docs/extensions/mv2/sandboxingEval">sandboxing eval</a> article. You can learn more about Content Security Policy by visiting our extensions-related tutorial and a <a href="http://www.html5rocks.com/en/tutorials/security/content-security-policy/">good introduction on HTML5Rocks</a>.</p>
</body>
</html>
