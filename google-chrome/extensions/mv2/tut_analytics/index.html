<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2012-09-18" />
  <title>Tutorial: Google analytics</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Tutorial: Google analytics</h1>
<p class="date">2012-09-18</p>
</header>
<p>{% include ‘partials/extensions/mv2-legacy-page.md’ %}</p>
<p>This tutorial demonstrates using Google Analytics to track the usage of your extension. If you are developing a platform app, see <a href="/apps/analytics">Analytics for Apps</a> since apps have different restrictions from extensions.</p>
<h2 id="requirements-toc-requirements">Requirements {: #toc-requirements }</h2>
<p>This tutorial expects that you have some familiarity writing extensions for Google Chrome. If you need information on how to write an extension, please read the <a href="/docs/extensions/mv2/getstarted">Getting Started tutorial</a>.</p>
<p>You will also need a <a href="http://www.google.com/analytics">Google Analytics account</a> set up to track your extension. Note that when setting up the account, you can use any value in the Website’s URL field, as your extension will not have an URL of its own.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/0X6Knat4ozKRyF15shTn.png”, alt=“The analytics setup with info for a chrome extension filled out”, height=“82”, width=“400” %}</p>
<h2 id="installing-the-tracking-code-toc-installing">Installing the tracking code {: #toc-installing }</h2>
<p>The standard Google Analytics tracking code snippet fetches a file named <code>ga.js</code> from an SSL protected URL if the current page was loaded using the <code>https://</code> protocol. <strong>Chrome extensions and applications may <em>only</em> use the SSL-protected version of <code>ga.js</code></strong>. Loading <code>ga.js</code> over insecure HTTP is disallowed by Chrome’s default <a href="/docs/extensions/mv2/contentSecurityPolicy">Content Security Policy</a>. This, plus the fact that Chrome extensions are hosted under the <code>chrome-extension://</code> schema, requires a slight modification to the usual tracking snippet to pull <code>ga.js</code> directly from <code>https://ssl.google-analytics.com/ga.js</code> instead of the default location.</p>
<p>Below is a modified snippet for the <a href="http://code.google.com/apis/analytics/docs/tracking/asyncTracking.html">asynchronous tracking API</a> (the modified line is bolded):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1">(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">var</span> ga <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;script&#39;</span>)<span class="op">;</span> <span class="va">ga</span>.<span class="at">type</span> <span class="op">=</span> <span class="st">&#39;text/javascript&#39;</span><span class="op">;</span> <span class="va">ga</span>.<span class="at">async</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="va">ga</span>.<span class="at">src</span> <span class="op">=</span> <span class="st">&#39;https://ssl.google-analytics.com/ga.js&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="kw">var</span> s <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementsByTagName</span>(<span class="st">&#39;script&#39;</span>)[<span class="dv">0</span>]<span class="op">;</span> <span class="va">s</span>.<span class="va">parentNode</span>.<span class="at">insertBefore</span>(ga<span class="op">,</span> s)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="op">}</span>)()<span class="op">;</span></a></code></pre></div>
<p>You’ll also need to ensure that your extension has access to load the resource by relaxing the default content security policy. The policy definition in your <a href="/docs/extensions/mv2/tabs"><code>manifest.json</code></a> might look like:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="er">...</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">&quot;content_security_policy&quot;</span><span class="fu">:</span> <span class="st">&quot;script-src &#39;self&#39; https://ssl.google-analytics.com; object-src &#39;self&#39;&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="er">...</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="fu">}</span></a></code></pre></div>
<p>Here is a popup page (<code>popup.html</code>) which loads the asynchronous tracking code via an external JavaScript file (<code>popup.js</code>) and tracks a single page view:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb3-1" title="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb3-3" title="3"> <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb3-4" title="4">   ...</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;popup.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb3-6" title="6"> <span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb3-7" title="7"> <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb3-8" title="8">   ...</a>
<a class="sourceLine" id="cb3-9" title="9"> <span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> _gaq <span class="op">=</span> _gaq <span class="op">||</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="va">_gaq</span>.<span class="at">push</span>([<span class="st">&#39;_setAccount&#39;</span><span class="op">,</span> <span class="st">&#39;UA-XXXXXXXX-X&#39;</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="va">_gaq</span>.<span class="at">push</span>([<span class="st">&#39;_trackPageview&#39;</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5">(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="kw">var</span> ga <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;script&#39;</span>)<span class="op">;</span> <span class="va">ga</span>.<span class="at">type</span> <span class="op">=</span> <span class="st">&#39;text/javascript&#39;</span><span class="op">;</span> <span class="va">ga</span>.<span class="at">async</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="va">ga</span>.<span class="at">src</span> <span class="op">=</span> <span class="st">&#39;https://ssl.google-analytics.com/ga.js&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="kw">var</span> s <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementsByTagName</span>(<span class="st">&#39;script&#39;</span>)[<span class="dv">0</span>]<span class="op">;</span> <span class="va">s</span>.<span class="va">parentNode</span>.<span class="at">insertBefore</span>(ga<span class="op">,</span> s)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="op">}</span>)()<span class="op">;</span></a></code></pre></div>
<p>Keep in mind that the string <code>UA-XXXXXXXX-X</code> should be replaced with your own Google Analytics account number.</p>
<h2 id="tracking-page-views-toc-tracking-pageviews">Tracking page views {: #toc-tracking-pageviews }</h2>
<p>The <code>_gaq.push(['_trackPageview']);</code> code will track a single page view. This code may be used on any page in your extension. When placed on a background page, it will register a view once per browser session. When placed on a popup, it will register a view once every time the popup is opened.</p>
<p>By looking at the page view data for each page in your extension, you can get an idea of how many times your users interact with your extension per browser session:</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/3AR714uoz3NIMkuFLmIC.png”, alt=“Analytics view of the top content for a site”, height=“119”, width=“300” %}</p>
<h2 id="monitoring-analytics-requests-toc-debugging">Monitoring analytics requests {: #toc-debugging }</h2>
<p>To ensure that tracking data from your extension is being sent to Google Analytics, you can inspect the pages of your extension in the Developer Tools window (see the <a href="/docs/extensions/mv2/tut_debugging">debugging tutorial</a> for more information). As the following figure shows, you should see requests for a file named <strong>__utm.gif</strong> if everything is set up correctly.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/lPW0DjyEMWYnhPc336QN.png”, alt="Developer Tools window showing the __utm.gif request“, height=”418“, width=”683" %}</p>
<h2 id="tracking-events-toc-tracking-events">Tracking events {: #toc-tracking-events }</h2>
<p>By configuring event tracking, you can determine which parts of your extension your users interact with the most. For example, if you have three buttons users may click:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&#39;button1&#39;</span><span class="kw">&gt;</span>Button 1<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&#39;button2&#39;</span><span class="kw">&gt;</span>Button 2<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&#39;button3&#39;</span><span class="kw">&gt;</span>Button 3<span class="kw">&lt;/button&gt;</span></a></code></pre></div>
<p>Write a function that sends click events to Google Analytics:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">function</span> <span class="at">trackButton</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="va">_gaq</span>.<span class="at">push</span>([<span class="st">&#39;_trackEvent&#39;</span><span class="op">,</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">id</span><span class="op">,</span> <span class="st">&#39;clicked&#39;</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="op">};</span></a></code></pre></div>
<p>And use it as an event handler for each button’s click:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> buttons <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelectorAll</span>(<span class="st">&#39;button&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">buttons</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-3" title="3">  buttons[i].<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> trackButtonClick)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>The Google Analytics event tracking overview page will give you metrics regarding how many times each individual button is clicked:</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/qhlPcW6Wh0oQC8csWwrO.png”, alt=“Analytics view of the event tracking data for a site”, height=“482”, width=“300” %}</p>
<p>By using this approach, you can see which parts of your extension are under-or-overutilized. This information can help guide decisions about UI redesigns or additional functionality to implement.</p>
<p>For more information about using event tracking, see the Google Analytics <a href="https://developers.google.com/analytics/devguides/collection/gajs/eventTrackerGuide">developer documentation</a>.</p>
<h2 id="sample-code-toc-samplecode">Sample code {: #toc-samplecode }</h2>
<p>An example extension that uses these techniques is available in the <a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/master/mv2-archive/tutorials/analytics/">samples repository</a>.</p>
</body>
</html>
