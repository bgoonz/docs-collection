<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2012-09-18" />
  <title>Debugging extensions</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Debugging extensions</h1>
<p class="date">2012-09-18</p>
</header>
<p>{% include ‘partials/extensions/mv2-legacy-page.md’ %}</p>
<p>Extensions are able to leverage the same debugging benefits <a href="https://developers.google.com/web/tools/chrome-devtools/">Chrome DevTools</a> provides for web pages, but they carry unique behavior properties. Becoming a master extension debugger requires an understanding of these behaviors, how extension components work with each other, and where to corner bugs. This tutorial gives developers a basic understanding of debugging extensions.</p>
<h2 id="locate-the-logs-locate_logs">Locate the logs {: #locate_logs }</h2>
<p>Extensions are made of many different components, and these components have individual responsibilities. Download a broken extension <a href="https://storage.googleapis.com/web-dev-uploads/file/WlD8wC6g8khYWPJUsQceQkhXSlv1/KZdyzIighjOsDUPaibEn.zip" title="broken_background_color.zip">here</a> to begin locating error logs for different extension components.</p>
<h3 id="background-script-debug_bg">Background script {: #debug_bg }</h3>
<p>Navigate to the chrome extensions management page at <code>chrome://extensions</code> and ensure developer mode is on. Click the <strong>Load Unpacked</strong> button and select the broken extension directory. After the extension is loaded, it should have three buttons: <strong>Details</strong>, <strong>Remove</strong> and <strong>Errors</strong> in red letters.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/NPUXnZrLSG6T6zTCmbxj.png”, alt=“Image displaying error button on extension management page”, height=“220”, width=“412” %}</p>
<p>Click the <strong>Errors</strong> button to view the error log. The extensions system has found an issue in the background script.</p>
<p><code>Uncaught TypeError: Cannot read property 'addListener' of undefined</code></p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/5UNQ4gp40qQZIwOLTzxA.png”, alt=“Extensions Management Page displaying background script error”, height=“556”, width=“646” %}</p>
<p>Additionally, the Chrome DevTools panel can be opened for the background script by selecting the blue link next to <strong>Inspect views</strong>.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/GvIXA3o7JvOxUg9BV12z.png”, alt=“DevTools displaying background script error”, height=“222”, width=“743” %}</p>
<p>Return to the code.</p>
<pre class="js/0"><code>chrome.runtime.oninstalled.addListener(function() {
  chrome.storage.sync.set({color: &#39;#3aa757&#39;}, function() {
    console.log(&#39;The color is green.&#39;);
  });
  chrome.declarativeContent.onPageChanged.removeRules(undefined, function() {
    chrome.declarativeContent.onPageChanged.addRules([{
      conditions: [new chrome.declarativeContent.PageStateMatcher({
        pageUrl: {hostEquals: &#39;developer.chrome.com&#39;},
      })],
      actions: [new chrome.declarativeContent.ShowPageAction()]
    }]);
  });
});</code></pre>
<p>The background script is attempting to listen for the <a href="/docs/extensions/reference/runtime#event-onInstalled"><code>onInstalled</code></a> event, but the property name requires an upper case “I”. Update the code to reflect the correct call, click the <strong>Clear all</strong> button in the upper right hand corner, then reload the extension.</p>
<h3 id="popup-debug_popup">Popup {: #debug_popup }</h3>
<p>Now that the extension initializes correctly, other components can be tested. Refresh this page, or open a new tab and navigate to any page on developer.chrome.com, open the popup and click the green square. And… nothing happens.</p>
<p>Navigate back to the Extensions Management Page, the <strong>Errors</strong> button has reappeared. Click it to view the new log.</p>
<p><code>Uncaught ReferenceError: tabs is not defined</code></p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/ygCnLz4Dst4mktOQhj4S.png”, alt=“Extensions Management Page displaying popup error”, height=“559”, width=“642” %}</p>
<p>Popup errors can also be viewed by inspecting the popup.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/PTfS6FEsE6vkbtDVMcsM.png”, alt=“DevTools displaying popup error”, height=“189”, width=“499” %}</p>
<p>The error, <code>tabs is undefined</code>, says the extension doesn’t know where to inject the content script. This can be corrected by calling the <a href="/docs/extensions/reference/tabs#method-query"><code>tabs.query()</code></a> method, then selecting the active tab.</p>
<pre class="js/9-13"><code>  let changeColor = document.getElementById(&#39;changeColor&#39;);

  chrome.storage.sync.get(&#39;color&#39;, function(data) {
    changeColor.style.backgroundColor = data.color;
    changeColor.setAttribute(&#39;value&#39;, data.color);
  });

  changeColor.onclick = function(element) {
    let color = element.target.value;
    chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
      chrome.tabs.executeScript(
          tabs[0].id,
          {code: &#39;document.body.style.backgroundColor = color;&#39;});
    });
  };</code></pre>
<p>Update the code, click the <strong>Clear all</strong> button in the upper right hand corner, and then reload the extension.</p>
<h3 id="content-script-debug_cs">Content script {: #debug_cs }</h3>
<p>Refresh the page, open the popup and click the green box. And… nope, the background still hasn’t changed colors! Navigate back to the Extensions Management Page and… there is no <strong>Errors</strong> button. The likely culprit is the content script, which runs inside the web page.</p>
<p>Open the DevTools panel of the web page the extension is trying to alter.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/q6cdFK0h7JEfaQKUMDg0.png”, alt=“Extension error displayed in web page console”, height=“292”, width=“515” %}</p>
<p>Only runtime errors, <code>console.warning</code> and <code>console.error</code> will be recorded on the Extensions Management Page.</p>
<p>To use DevTools from within the content script, click the dropdown arrow next to <strong>top</strong> and select the extension.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/uo8osbvVkG5HcJS00bAR.png”, alt=“Uncaught ReferenceError: tabs is not defined”, height=“129”, width=“521” %}</p>
<p>The error says <code>color</code> is not defined. The extension must not be passing the variable correctly. Correct the injected script to pass the color variable into the code.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1">  <span class="op">{</span><span class="dt">code</span><span class="op">:</span> <span class="st">&#39;document.body.style.backgroundColor = &quot;&#39;</span> <span class="op">+</span> color <span class="op">+</span> <span class="st">&#39;&quot;;&#39;</span><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="extension-tabs-extension_tabs">Extension tabs {: #extension_tabs }</h3>
<p>Logs for extension pages displayed as a tab, such as <a href="/docs/extensions/mv2/override">override pages</a> and <a href="/docs/extensions/mv2/options#full_page">full-page options</a>, can be found in the web page console and on the extensions management page.</p>
<h2 id="monitor-network-requests-network_requests">Monitor network requests {: #network_requests }</h2>
<p>The popup will often make all of the required network requests before even the speediest of developers can open DevTools. To view these requests, refresh from inside the network panel. It will reload the popup without closing the DevTools panel.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/x8knWvTA11f4j1wVoNY8.gif”, alt=“Refresh inside the network panel to view popup network requests”, height=“520”, width=“566” %}</p>
<h2 id="declare-permissions-declare_permission">Declare permissions {: #declare_permission }</h2>
<p>While extensions have similar capabilities as web pages they often need permission to use certain features, such as <a href="/docs/extensions/reference/cookies">cookies</a>, <a href="/docs/extensions/reference/storage">storage</a> and <a href="/docs/extensions/mv2/xhr">Cross-Origin XMLHttpRequsts</a>. Refer to the <a href="/docs/extensions/mv2/permission_warnings">permissions article</a> and the available <a href="/docs/extensions/reference">Chrome APIs</a> to ensure an extension is requesting the correct permissions in its <a href="/docs/extensions/reference/tabs">manifest</a>.</p>
<pre class="json/4-8"><code>  {
    &quot;name&quot;: &quot;Broken Background Color&quot;,
    &quot;version&quot;: &quot;1.0&quot;,
    &quot;description&quot;: &quot;Fix an Extension!&quot;,
    &quot;permissions&quot;: [
      &quot;activeTab&quot;,
      &quot;declarativeContent&quot;,
      &quot;storage&quot;
    ],
    &quot;options_page&quot;: &quot;options.html&quot;,
    &quot;background&quot;: {
      &quot;scripts&quot;: [&quot;background.js&quot;],
      &quot;persistent&quot;: false
    },
    &quot;page_action&quot;: {
      &quot;default_popup&quot;: &quot;popup.html&quot;,
      &quot;default_icon&quot;: {
        &quot;16&quot;: &quot;images/get_started16.png&quot;,
        &quot;32&quot;: &quot;images/get_started32.png&quot;,
        &quot;48&quot;: &quot;images/get_started48.png&quot;,
        &quot;128&quot;: &quot;images/get_started128.png&quot;
      }
    },
    &quot;icons&quot;: {
      &quot;16&quot;: &quot;images/get_started16.png&quot;,
      &quot;32&quot;: &quot;images/get_started32.png&quot;,
      &quot;48&quot;: &quot;images/get_started48.png&quot;,
      &quot;128&quot;: &quot;images/get_started128.png&quot;
    },
    &quot;manifest_version&quot;: 2
  }</code></pre>
<h2 id="next-steps-next">Next steps {: #next }</h2>
<p>For further information on debugging extensions, watch <a href="http://www.youtube.com/watch?v=IP0nMv_NI1s&amp;feature=PlayList&amp;p=CA101D6A85FE9D4B&amp;index=5">Developing and Debugging</a>. Learn more about <a href="https://developers.google.com/web/tools/chrome-devtools/">Chrome Devtools</a> by reading the documentation.</p>
</body>
</html>
