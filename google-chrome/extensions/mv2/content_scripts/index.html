<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="dcterms.date" content="2012-09-17" />
    <title>Content scripts</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Content scripts</h1>
      <p class="date">2012-09-17</p>
    </header>
    <p>{% include ‘partials/extensions/mv2-legacy-page.md’ %}</p>
    <p>
      Content scripts are files that run in the context of web pages. By using
      the standard
      <a href="http://www.w3.org/TR/DOM-Level-2-HTML/">Document Object Model</a>
      (DOM), they are able to read details of the web pages the browser visits,
      make changes to them and pass information to their parent extension.
    </p>
    <h2 id="understand-content-script-capabilities-capabilities">
      Understand content script capabilities {: #capabilities }
    </h2>
    <p>
      Content scripts can access Chrome APIs used by their parent extension by
      exchanging <a href="/docs/extensions/mv2/messaging">messages</a> with the
      extension. They can also access the URL of an extension’s file with
      <code>chrome.runtime.getURL()</code> and use the result the same as other
      URLs.
    </p>
    <pre
      class="js/1"
    ><code>//Code for displaying &lt;extensionDir&gt;/images/myimage.png:
var imgURL = chrome.runtime.getURL(&quot;images/myimage.png&quot;);
document.getElementById(&quot;someImage&quot;).src = imgURL;</code></pre>
    <p>
      Additionally, content script can access the following chrome APIs
      directly:
    </p>
    <ul>
      <li><a href="/docs/extensions/reference/i18n">i18n</a></li>
      <li><a href="/docs/extensions/reference/storage">storage</a></li>
      <li>
        <a href="/docs/extensions/reference/runtime">runtime</a>:
        <ul>
          <li>
            <a href="/docs/extensions/reference/runtime#method-connect"
              >connect</a
            >
          </li>
          <li>
            <a href="/docs/extensions/reference/runtime#method-getManifest"
              >getManifest</a
            >
          </li>
          <li>
            <a href="/docs/extensions/reference/runtime#method-getURL"
              >getURL</a
            >
          </li>
          <li>
            <a href="/docs/extensions/reference/runtime#property-id">id</a>
          </li>
          <li>
            <a href="/docs/extensions/reference/runtime#event-onConnect"
              >onConnect</a
            >
          </li>
          <li>
            <a href="/docs/extensions/reference/runtime#event-onMessage"
              >onMessage</a
            >
          </li>
          <li>
            <a href="/docs/extensions/reference/runtime#method-sendMessage"
              >sendMessage</a
            >
          </li>
        </ul>
      </li>
    </ul>
    <p>Content scripts are unable to access other APIs directly.</p>
    <h2 id="work-in-isolated-worlds-isolated_world">
      Work in isolated worlds {: #isolated_world }
    </h2>
    <p>
      Content scripts live in an isolated world, allowing a content script to
      makes changes to its JavaScript environment without conflicting with the
      page or additional content scripts.
    </p>
    <p>
      An extension may run in a web page with code similar to the example below.
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode html"
      ><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;mybutton&quot;</span><span class="kw">&gt;</span>click me<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw">var</span> greeting <span class="op">=</span> <span class="st">&quot;hello, &quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="kw">var</span> button <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;mybutton&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="va">button</span>.<span class="at">person_name</span> <span class="op">=</span> <span class="st">&quot;Bob&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="va">button</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-8" title="8">      <span class="at">alert</span>(greeting <span class="op">+</span> <span class="va">button</span>.<span class="at">person_name</span> <span class="op">+</span> <span class="st">&quot;.&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="kw">&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="kw">&lt;/html&gt;</span></a></code></pre>
    </div>
    <p>That extension could inject the following content script.</p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> greeting <span class="op">=</span> <span class="st">&quot;hola, &quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">var</span> button <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;mybutton&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="va">button</span>.<span class="at">person_name</span> <span class="op">=</span> <span class="st">&quot;Roberto&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">button</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="at">alert</span>(greeting <span class="op">+</span> <span class="va">button</span>.<span class="at">person_name</span> <span class="op">+</span> <span class="st">&quot;.&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre>
    </div>
    <p>Both alerts would appear if the button was pressed.</p>
    <p>
      Isolated worlds do not allow for content scripts, the extension, and the
      web page to access any variables or functions created by the others. This
      also gives content scripts the ability to enable functionality that should
      not be accessible to the web page.
    </p>
    <p>{% YouTube id=“laLudeUmXHM” %}</p>
    <h2 id="inject-scripts-functionality">
      Inject scripts {: #functionality }
    </h2>
    <p>
      Content Scripts can be <a href="#programmatic">programmatically</a> or
      <a href="#declaratively">declaratively</a> injected.
    </p>
    <h3 id="inject-programmatically-programmatic">
      Inject programmatically {: #programmatic }
    </h3>
    <p>
      Use programmatic injection for content scripts that need to run on
      specific occasions.
    </p>
    <p>
      To inject a programmatic content script, provide the
      <a href="/docs/extensions/mv2/manifest/activeTab">activeTab</a> permission
      in the manifest. This grants secure access to the active site’s host and
      temporary access to the
      <a href="/docs/extensions/reference/tabs/#manifest">tabs</a> permission,
      enabling the content script to run on the current active tab without
      specifying
      <a href="/docs/extensions/mv2/xhr#requesting-permission"
        >cross-origin permissions</a
      >.
    </p>
    <pre class="json/3-5"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;permissions&quot;: [
    &quot;activeTab&quot;
  ],
  ...
}</code></pre>
    <p>Content scripts can be injected as code.</p>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">onMessage</span>.<span class="at">addListener</span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="kw">function</span>(message<span class="op">,</span> callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="cf">if</span> (message <span class="op">==</span> <span class="st">&quot;changeColor&quot;</span>)<span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">      <span class="va">chrome</span>.<span class="va">tabs</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb5-5" title="5">        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;document.body.style.backgroundColor=&quot;orange&quot;&#39;</span></a>
<a class="sourceLine" id="cb5-6" title="6">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="op">}</span>)<span class="op">;</span></a></code></pre>
    </div>
    <p>Or an entire file can be injected.</p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">onMessage</span>.<span class="at">addListener</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="kw">function</span>(message<span class="op">,</span> callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="cf">if</span> (message <span class="op">==</span> <span class="st">&quot;runContentScript&quot;</span>)<span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">      <span class="va">chrome</span>.<span class="va">tabs</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="dt">file</span><span class="op">:</span> <span class="st">&#39;contentScript.js&#39;</span></a>
<a class="sourceLine" id="cb6-6" title="6">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="op">}</span>)<span class="op">;</span></a></code></pre>
    </div>
    <h3 id="inject-declaratively-declaratively">
      Inject declaratively {: #declaratively }
    </h3>
    <p>
      Use declarative injection for content scripts that should be automatically
      run on specified pages.
    </p>
    <p>
      Declaratively injected scripts are registered in the manifest under the
      <code>"content_scripts"</code> field. They can include JavaScript files,
      CSS files or both. All auto-run content scripts must specify
      <a href="/docs/extensions/mv2/match_patterns">match patterns</a>.
    </p>
    <pre class="json/3-9"><code>{
 &quot;name&quot;: &quot;My extension&quot;,
 ...
 &quot;content_scripts&quot;: [
   {
     &quot;matches&quot;: [&quot;http://*.nytimes.com/*&quot;],
     &quot;css&quot;: [&quot;myStyles.css&quot;],
     &quot;js&quot;: [&quot;contentScript.js&quot;]
   }
 ],
 ...
}</code></pre>
    <table>
      <colgroup>
        <col style="width: 33%" />
        <col style="width: 33%" />
        <col style="width: 33%" />
      </colgroup>
      <thead>
        <tr class="header">
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td><code>matches</code> {: #matches }</td>
          <td><nobr>array of strings</nobr></td>
          <td>
            <em>Required.</em> Specifies which pages this content script will be
            injected into. See
            <a href="/docs/extensions/mv2/match_patterns">Match Patterns</a> for
            more details on the syntax of these strings and
            <a href="#matchAndGlob">Match patterns and globs</a> for information
            on how to exclude URLs.
          </td>
        </tr>
        <tr class="even">
          <td><code>css</code> {: #css }</td>
          <td><nobr>array of strings</nobr></td>
          <td>
            <em>Optional.</em> The list of CSS files to be injected into
            matching pages. These are injected in the order they appear in this
            array, before any DOM is constructed or displayed for the page.
          </td>
        </tr>
        <tr class="odd">
          <td><code>js</code> {: #js }</td>
          <td><nobr>array of strings</nobr></td>
          <td>
            <em>Optional.</em> The list of JavaScript files to be injected into
            matching pages. These are injected in the order they appear in this
            array.
          </td>
        </tr>
        <tr class="even">
          <td><code>match_about_blank</code> {: #match_about_blank }</td>
          <td>boolean</td>
          <td>
            <em>Optional.</em> Whether the script should inject into an
            <code>about:blank</code> frame where the parent or opener frame
            matches one of the patterns declared in <code>matches</code>.
            Defaults to <code>false</code>.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="exclude-matches-and-globs-matchandglob">
      Exclude matches and globs {: #matchAndGlob }
    </h4>
    <p>
      Specified page matching is customizable by including the following fields
      in the manifest registration.
    </p>
    <table>
      <colgroup>
        <col style="width: 33%" />
        <col style="width: 33%" />
        <col style="width: 33%" />
      </colgroup>
      <thead>
        <tr class="header">
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td><code>exclude_matches</code> {: #exclude_matches }</td>
          <td><nobr>array of strings</nobr></td>
          <td>
            <em>Optional.</em> Excludes pages that this content script would
            otherwise be injected into. See
            <a href="/docs/extensions/mv2/match_patterns">Match Patterns</a> for
            more details on the syntax of these strings.
          </td>
        </tr>
        <tr class="even">
          <td><code>include_globs</code> {: #include_globs }</td>
          <td><nobr>array of strings</nobr></td>
          <td>
            <em>Optional.</em> Applied after <code>matches</code> to include
            only those URLs that also match this glob. Intended to emulate the
            <a href="http://wiki.greasespot.net/Metadata_Block#.40include"
              ><code>@include</code></a
            >
            Greasemonkey keyword.
          </td>
        </tr>
        <tr class="odd">
          <td><code>exclude_globs</code> {: #exclude_globs }</td>
          <td><nobr>array of string</nobr></td>
          <td>
            <em>Optional.</em> Applied after <code>matches</code> to exclude
            URLs that match this glob. Intended to emulate the
            <a href="http://wiki.greasespot.net/Metadata_Block#.40include"
              ><code>@exclude</code></a
            >Greasemonkey keyword.
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      The content script will be injected into a page if its URL matches any
      <code>matches</code> pattern and any <code>include_globs</code> pattern,
      as long as the URL doesn’t also match an <code>exclude_matches</code> or
      <code>exclude_globs</code> pattern.
    </p>
    <p>
      Because the <code>matches</code> property is required,
      <code>exclude_matches</code>, <code>include_globs</code>, and
      <code>exclude_globs</code> can only be used to limit which pages will be
      affected.
    </p>
    <p>
      The following extension would injected the content script into
      <strong>http://www.nytimes.com/ health</strong> but not into
      <strong>http://www.nytimes.com/ business</strong> .
    </p>
    <pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;http://*.nytimes.com/*&quot;],
      &quot;exclude_matches&quot;: [&quot;*://*/*business*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
    <p>
      Glob properties follow a different, more flexible syntax than
      <a href="/docs/extensions/mv2/match_patterns">match patterns</a>.
      Acceptable glob strings are URLs that may contain “wildcard” asterisks and
      question marks. The asterisk <strong>*</strong> matches any string of any
      length, including the empty string, while the question mark
      <strong>?</strong> matches any single character.
    </p>
    <p>
      For example, the glob
      <strong>http:// ??? .example.com/foo/ *</strong> matches any of the
      following:
    </p>
    <ul>
      <li><strong>http:// www .example.com/foo /bar</strong></li>
      <li><strong>http:// the .example.com/foo /</strong></li>
    </ul>
    <p>However, it does <em>not</em> match the following:</p>
    <ul>
      <li><strong>http:// my .example.com/foo/bar</strong></li>
      <li><strong>http:// example .com/foo/</strong></li>
      <li><strong>http://www.example.com/foo</strong></li>
    </ul>
    <p>
      This extension would inject the content script into
      <strong>http:/www.nytimes.com/ arts /index.html</strong> and
      <strong>http://www.nytimes.com/ jobs /index.html</strong> but not into
      <strong>http://www.nytimes.com/ sports /index.html</strong>.
    </p>
    <pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;http://*.nytimes.com/*&quot;],
      &quot;include_globs&quot;: [&quot;*nytimes.com/???s/*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
    <p>
      This extension would inject the content script into
      <strong>http:// history .nytimes.com</strong> and
      <strong>http://.nytimes.com/ history</strong> but not into
      <strong>http:// science .nytimes.com</strong> or
      <strong>http://www.nytimes.com/ science</strong> .
    </p>
    <pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;http://*.nytimes.com/*&quot;],
      &quot;exclude_globs&quot;: [&quot;*science*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
    <p>
      One, all, or some of these can be included to achieve the correct scope.
    </p>
    <pre class="json/6-8"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;http://*.nytimes.com/*&quot;],
      &quot;exclude_matches&quot;: [&quot;*://*/*business*&quot;],
      &quot;include_globs&quot;: [&quot;*nytimes.com/???s/*&quot;],
      &quot;exclude_globs&quot;: [&quot;*science*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
    <h4 id="run-time-run_time">Run time {: #run_time }</h4>
    <p>
      When JavaScript files are injected into the web page is controlled by the
      <code>run_at</code> field. The preffered and default field is
      <code>"document_idle"</code>, but can also be specified as
      <code>"document_start"</code> or <code>"document_end"</code> if needed.
    </p>
    <pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;http://*.nytimes.com/*&quot;],
      &quot;run_at&quot;: &quot;document_idle&quot;,
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
    <table>
      <colgroup>
        <col style="width: 33%" />
        <col style="width: 33%" />
        <col style="width: 33%" />
      </colgroup>
      <thead>
        <tr class="header">
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td><code>document_idle</code> {: #document_idle }</td>
          <td>string</td>
          <td>
            <em>Preferred.</em> Use <code>"document_idle"</code> whenever
            possible.<br /><br />The browser chooses a time to inject scripts
            between <code>"document_end"</code> and immediately after the
            <a
              href="http://www.whatwg.org/specs/web-apps/current-work/#handler-onload"
              ><code>windowonload</code></a
            >
            event fires. The exact moment of injection depends on how complex
            the document is and how long it is taking to load, and is optimized
            for page load speed.<br /><br />Content scripts running at
            <code>"document_idle"</code> do not need to listen for the
            <code>window.onload</code> event, they are guaranteed to run after
            the DOM is complete. If a script definitely needs to run after
            <code>window.onload</code>, the extension can check if
            <code>onload</code> has already fired by using the
            <a
              href="http://www.whatwg.org/specs/web-apps/current-work/#dom-document-readystate"
              ><code>document.readyState</code></a
            >
            property.
          </td>
        </tr>
        <tr class="even">
          <td><code>document_start</code> {: #document_start }</td>
          <td>string</td>
          <td>
            Scripts are injected after any files from <code>css</code>, but
            before any other DOM is constructed or any other script is run.
          </td>
        </tr>
        <tr class="odd">
          <td><code>document_end</code> {: #document_end }</td>
          <td>string</td>
          <td>
            Scripts are injected immediately after the DOM is complete, but
            before subresources like images and frames have loaded.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="specify-frames-frames">Specify frames {: #frames }</h4>
    <p>
      The <code>"all_frames"</code> field allows the extension to specify if
      JavaScript and CSS files should be injected into all frames matching the
      specified URL requirements or only into the topmost frame in a tab.
    </p>
    <pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;http://*.nytimes.com/*&quot;],
      &quot;all_frames&quot;: true,
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
    <table>
      <colgroup>
        <col style="width: 33%" />
        <col style="width: 33%" />
        <col style="width: 33%" />
      </colgroup>
      <thead>
        <tr class="header">
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td><code>all_frames</code> {: #all_frames }</td>
          <td>boolean</td>
          <td>
            <em>Optional.</em> Defaults to <code>false</code>, meaning that only
            the top frame is matched.<br /><br />If specified <code>true</code>,
            it will inject into all frames, even if the frame is not the topmost
            frame in the tab. Each frame is checked independently for URL
            requirements, it will not inject into child frames if the URL
            requirements are not met.
          </td>
        </tr>
      </tbody>
    </table>
    <h2 id="communication-with-the-embedding-page-host-page-communication">
      Communication with the embedding page {: #host-page-communication }
    </h2>
    <p>
      Although the execution environments of content scripts and the pages that
      host them are isolated from each other, they share access to the page’s
      DOM. If the page wishes to communicate with the content script, or with
      the extension via the content script, it must do so through the shared
      DOM.
    </p>
    <p>
      An example can be accomplished using
      <a
        href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage"
        ><code>window.postMessage</code></a
      >:
    </p>
    <div class="sourceCode" id="cb14">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">var</span> port <span class="op">=</span> <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">connect</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&quot;message&quot;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="co">// We only accept messages from ourselves</span></a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="cf">if</span> (<span class="va">event</span>.<span class="at">source</span> <span class="op">!=</span> window)</a>
<a class="sourceLine" id="cb14-6" title="6">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="cf">if</span> (<span class="va">event</span>.<span class="va">data</span>.<span class="at">type</span> <span class="op">&amp;&amp;</span> (<span class="va">event</span>.<span class="va">data</span>.<span class="at">type</span> <span class="op">==</span> <span class="st">&quot;FROM_PAGE&quot;</span>)) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-9" title="9">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Content script received: &quot;</span> <span class="op">+</span> <span class="va">event</span>.<span class="va">data</span>.<span class="at">text</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-10" title="10">    <span class="va">port</span>.<span class="at">postMessage</span>(<span class="va">event</span>.<span class="va">data</span>.<span class="at">text</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre>
    </div>
    <div class="sourceCode" id="cb15">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;theButton&quot;</span>).<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb15-2" title="2">    <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="va">window</span>.<span class="at">postMessage</span>(<span class="op">{</span> <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;FROM_PAGE&quot;</span><span class="op">,</span> <span class="dt">text</span><span class="op">:</span> <span class="st">&quot;Hello from the webpage!&quot;</span> <span class="op">},</span> <span class="st">&quot;*&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      The non-extension page, example.html, posts messages to itself. This
      message is intercepted and inspected by the content script and then posted
      to the extension process. In this way, the page establishes a line of
      communication to the extension process. The reverse is possible through
      similar means.
    </p>
    <h2 id="stay-secure-security">Stay secure {: #security }</h2>
    <p>
      While isolated worlds provide a layer of protection, using content scripts
      can create vulnerabilities in an extension and the web page. If the
      content script receives content from a separate website, such as making an
      <a href="/docs/extensions/mv2/xhr">XMLHttpRequest</a>, be careful to
      filter content
      <a href="http://en.wikipedia.org/wiki/Cross-site_scripting"
        >cross-site scripting</a
      >
      attacks before injecting it. Only communicate over HTTPS in order to avoid
      <a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack"
        >“man-in-the-middle”</a
      >
      attacks.
    </p>
    <p>
      Be sure to filter for malicious web pages. For example, the following
      patterns are dangerous:
    </p>
    <div class="sourceCode" id="cb16">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">var</span> data <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;json-data&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co">// </span><span class="al">WARNING</span><span class="co">! Might be evaluating an evil script!</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">var</span> parsed <span class="op">=</span> <span class="at">eval</span>(<span class="st">&quot;(&quot;</span> <span class="op">+</span> data <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</a></code></pre>
    </div>
    <div class="sourceCode" id="cb17">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">var</span> elmt_id <span class="op">=</span> ...</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="co">// </span><span class="al">WARNING</span><span class="co">! elmt_id might be &quot;); ... evil script ... //&quot;!</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="va">window</span>.<span class="at">setTimeout</span>(<span class="st">&quot;animate(&quot;</span> <span class="op">+</span> elmt_id <span class="op">+</span> <span class="st">&quot;)&quot;</span><span class="op">,</span> <span class="dv">200</span>)<span class="op">;</span></a></code></pre>
    </div>
    <p>Instead, prefer safer APIs that do not run scripts:</p>
    <div class="sourceCode" id="cb18">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">var</span> data <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;json-data&quot;</span>)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co">// JSON.parse does not evaluate the attacker&#39;s scripts.</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="kw">var</span> parsed <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(data)<span class="op">;</span></a></code></pre>
    </div>
    <div class="sourceCode" id="cb19">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">var</span> elmt_id <span class="op">=</span> ...</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co">// The closure form of setTimeout does not evaluate scripts.</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="va">window</span>.<span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb19-4" title="4">  <span class="at">animate</span>(elmt_id)<span class="op">;</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="op">},</span> <span class="dv">200</span>)<span class="op">;</span></a></code></pre>
    </div>
  </body>
</html>
