<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2020-11-09" />
  <title>Migrating to Manifest V3</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Migrating to Manifest V3</h1>
<p class="date">2020-11-09</p>
</header>
<p>This guide provides developers with the information they need to begin migrating an extension from Manifest V2 to Manifest V3 (MV3). Some extensions will require very little change to make them MV3 compliant, while others will need to be redesigned to some degree. Developers experienced with MV2, and who are creating new MV3 extensions, may also find this helpful. For a quick reference guide see the <a href="/docs/extensions/mv3/mv3-migration-checklist">migration checklist</a>.</p>
<p>Manifest V3 offers a number of improvements reflecting the aims of our <a href="/docs/extensions/mv3/intro/platform-vision">platform vision</a>.</p>
<h2 id="feature-summary-feature-summary">Feature summary {: #feature-summary }</h2>
<p>There are a number of new features and functional changes for extensions using MV3:</p>
<ul>
<li><a href="/docs/extensions/mv3/intro/mv3-overview#service-workers">Service workers</a> replace background pages.</li>
<li><a href="/docs/extensions/mv3/intro/mv3-overview#network-request-modification">Network request modification</a> is now handled with the new <a href="/docs/extensions/reference/declarativeNetRequest">declarativeNetRequest</a> API.</li>
<li><a href="/docs/extensions/mv3/intro/mv3-overview#remotely-hosted-code">Remotely hosted code</a> is no longer allowed; an extension can only execute JavaScript that is included within its package.</li>
<li><a href="/docs/extensions/mv3/intro/mv3-overview#promises">Promise</a> support has been added to many methods, though callbacks are still supported as an alternative. (We will eventually support promises on all appropriate methods.)</li>
<li>A number of other, relatively <a href="/docs/extensions/mv3/intro/mv3-overview#other-features">minor feature changes</a> are also introduced in MV3.</li>
</ul>
<p>For a fuller description of these changes, see the <a href="/docs/extensions/mv3/intro/mv3-overview">MV3 Overview</a>.</p>
<h2 id="updating-the-manifest.json-file-updating-manifest-dot-json">Updating the manifest.json file {: #updating-manifest-dot-json }</h2>
<p>To use the features of MV3, you need to first update your <a href="/docs/extensions/mv3/manifest">manifest file</a>. Naturally, you’ll change the manifest version to “3”, but there are a number of other things you need to change in the manifest file: host permissions, content security policy, action declarations, and web-accessible resources.</p>
<h3 id="manifest-version-manifest-version">Manifest version {: #manifest-version }</h3>
<p>Changing the value of the manifest_version element is the key to upgrading your extension. This determines whether you’re using the MV2 or MV3 feature set:</p>
<p>{% Columns %}</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="er">//</span> <span class="er">Manifest</span> <span class="er">V2</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="er">&quot;manifest_version&quot;:</span> <span class="er">2</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="er">//</span> <span class="er">Manifest</span> <span class="er">V3</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="er">&quot;manifest_version&quot;:</span> <span class="er">3</span></a></code></pre></div>
<p>{% endColumns %}</p>
<h3 id="host-permissions-host-permissions">Host permissions {: #host-permissions }</h3>
<p>In MV3, you’ll need to specify host permissions separately from other permissions:</p>
<p>{% Columns %}</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="co">// Manifest V2</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">&quot;permissions&quot;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="st">&quot;tabs&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="st">&quot;bookmarks&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="st">&quot;http://www.blogger.com/&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-6" title="6">]<span class="op">,</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="st">&quot;optional_permissions&quot;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="st">&quot;*://*/*&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="st">&quot;unlimitedStorage&quot;</span></a>
<a class="sourceLine" id="cb3-10" title="10">]</a></code></pre></div>
<pre class="js/8-10"><code>// Manifest V3
&quot;permissions&quot;: [
  &quot;tabs&quot;,
  &quot;bookmarks&quot;
],
&quot;optional_permissions&quot;: [
  &quot;unlimitedStorage&quot;
],
&quot;host_permissions&quot;: [
  &quot;http://www.blogger.com/&quot;,
  &quot;*://*/*&quot;
],</code></pre>
<p>{% endColumns %}</p>
<p>{% Aside ‘warning’ %} You do not have to declare content script match patterns in <code>host_permissions</code> in order to inject content scripts. However, they <strong>are</strong> treated as host permissions requests by the Chrome Web Store review process. {% endAside %}</p>
<h3 id="content-security-policy-content-security-policy">Content security policy {: #content-security-policy }</h3>
<p>An extension’s <a href="https://content-security-policy.com/">content security policy</a> (CSP) was specified in MV2 as a string; in MV3 it is an object with members representing alternative CSP contexts:</p>
<p>{% Columns %}</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb5-1" title="1"><span class="er">//</span> <span class="er">Manifest</span> <span class="er">V2</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="er">&quot;content_security_policy&quot;:</span> <span class="er">&quot;...&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"><span class="er">//</span> <span class="er">Manifest</span> <span class="er">V3</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="er">&quot;content_security_policy&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">&quot;extension_pages&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">&quot;sandbox&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="fu">}</span></a></code></pre></div>
<p>{% endColumns %}</p>
<p><strong><code>extension_pages</code></strong>: This policy covers pages in your extension, including html files and service workers.</p>
<p>{% Aside %} These page types are served from the <code>chrome-extension://</code> protocol. For instance, a page in your extension is <code>chrome-extension://&lt;extension-id&gt;/foo.html</code>. {% endAside %}</p>
<p><strong><code>sandbox</code></strong>: This policy covers any <a href="/docs/extensions/mv3/manifest/sandbox">sandboxed extension pages</a> that your extension uses.</p>
<p>In addition, MV3 disallows certain CSP modifications for <code>extension_pages</code> that were permitted in MV2. The <code>script-src,</code> <code>object-src</code>, and <code>worker-src</code> directives may only have the following values:</p>
<ul>
<li><code>self</code></li>
<li><code>none</code></li>
<li>Any localhost source, (<code>http://localhost</code>, <code>http://127.0.0.1</code>, or any port on those domains)</li>
</ul>
<p>CSP modifications for <code>sandbox</code> have no such new restrictions.</p>
<h3 id="action-api-unification-action-api-unification">Action API unification {: #action-api-unification }</h3>
<p>In MV2, there were two different APIs to implement actions: <code>browser_action</code> and <code>page_action</code>. These APIs filled distinct roles when they were introduced, but over time they’ve become redundant so in MV3 we are unifying them into as single <code>action</code> API:</p>
<p>{% Columns %}</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// Manifest V2</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">// manifest.json</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="st">&quot;browser_action&quot;</span><span class="op">:</span> <span class="op">{</span> … <span class="op">},</span></a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="st">&quot;page_action&quot;</span><span class="op">:</span> <span class="op">{</span> … <span class="op">}</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">// background.js</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="va">chrome</span>.<span class="va">browserAction</span>.<span class="va">onClicked</span>.<span class="at">addListener</span>(tab <span class="kw">=&gt;</span> <span class="op">{</span> … <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="va">chrome</span>.<span class="va">pageAction</span>.<span class="va">onClicked</span>.<span class="at">addListener</span>(tab <span class="kw">=&gt;</span> <span class="op">{</span> … <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// Manifest V3</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">// manifest.json</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="op">{</span></a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="st">&quot;action&quot;</span><span class="op">:</span> <span class="op">{</span> … <span class="op">}</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="op">}</span></a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">// background.js</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="va">chrome</span>.<span class="va">action</span>.<span class="va">onClicked</span>.<span class="at">addListener</span>(tab <span class="kw">=&gt;</span> <span class="op">{</span> … <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>{% endColumns %}</p>
<h3 id="web-accessible-resources-web-accessible-resources">Web-accessible resources {: #web-accessible-resources }</h3>
<p>This change limits access to extension resources to specific sites/extensions. Instead of providing a list of files, you now provide a list of objects, each of which can map to a set of resources to a set of URLs or extension IDs:</p>
<p>{% Columns %}</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb9-1" title="1"><span class="er">//</span> <span class="er">Manifest</span> <span class="er">V2</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="er">&quot;web_accessible_resources&quot;:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="er">&lt;files&gt;</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="ot">]</span></a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb10-1" title="1"><span class="er">//</span> <span class="er">Manifest</span> <span class="er">V3</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="er">&quot;web_accessible_resources&quot;:</span> <span class="ot">[</span><span class="fu">{</span></a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="dt">&quot;resources&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;resources&gt;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="dt">&quot;matches&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;urls&gt;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="dt">&quot;extension_ids&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;keys&gt;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="er">optional</span> <span class="dt">&quot;use_dynamic_url&quot;</span><span class="fu">:</span> <span class="er">boolean</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="fu">}</span><span class="ot">]</span></a></code></pre></div>
<p>{% endColumns %}</p>
<p>Previously, the list of web accessible resources applied to all websites and extensions, which created opportunities for fingerprinting or unintentional resource access. The updated API lets extensions more tightly control what other sites or extensions can access extension resources. See the <a href="/docs/extensions/mv3/manifest/web_accessible_resources/">web accessible resources</a> documentation for usage information.</p>
<h2 id="code-execution-code-execution">Code execution {: #code-execution }</h2>
<p>MV3 imposes new restrictions that limit an extension’s ability to execute unreviewed JavaScript through a combination of platform changes and policy limitations.</p>
<p>Many extensions are unaffected by this change. However, if your MV2 extension executes remotely hosted scripts, injects code strings into pages, or evals strings at runtime, you’ll need to update your code execution strategies when migrating to MV3.</p>
<p>{% Aside %} With Manifest V3 the <code>executeScript()</code> method also moves to a different API.</p>
<ul>
<li><strong>MV2:</strong> <a href="/docs/extensions/reference/tabs/#method-executeScript">chrome.tabs.executeScript()</a></li>
<li><strong>MV3:</strong> <a href="/docs/extensions/reference/scripting/#method-executeScript">chrome.scripting.executeScript()</a>.</li>
</ul>
<p>If you use executeScript() anywhere in your code, you’ll need to update that call to use the new API. The <code>insertCSS()</code> and <code>removeCSS()</code> methods similarly move from chrome.tabs to chrome.scripting. {% endAside %}</p>
<h3 id="remotely-hosted-code-remotely-hosted-code">Remotely hosted code {: #remotely-hosted-code }</h3>
<p><em>Remotely hosted code</em> refers to any code that is not included in an extension’s package as a loadable resource. For example, both of the following are considered remotely hosted code:</p>
<ul>
<li>JavaScript files pulled from a remote server</li>
<li>a code string passed into eval at runtime</li>
</ul>
<p>In MV3, all of your extension’s logic must be bundled with the extension. You can no longer load and execute a remotely hosted file. A number of alternative approaches are available, depending on your use case and the reason for remote hosting. Two such approaches are:</p>
<p><strong>Configuration-driven features and logic</strong>—In this approach, your extension loads a remote configuration (for example a JSON file) at runtime and caches the configuration locally. The extension then uses this cached configuration to decide which features to enable.</p>
<p><strong>Externalize logic with a remote service</strong>—Consider migrating application logic from the extension to a remote web service that your extension can call. (Essentially a form of message passing.) This provides you the ability to keep code private and change the code on demand while avoiding the extra overhead of resubmitting to the Chrome Web Store.</p>
<h3 id="executing-arbitrary-strings-executing-arbitrary-strings">Executing arbitrary strings {: #executing-arbitrary-strings }</h3>
<p>In Manifest V2 it was possible to execute an arbitrary string of code using <a href="/docs/extensions/reference/tabs/#method-executeScript"><code>tabs.executeScript</code></a> and the <code>code</code> property on the options object. Manifest V3 does not allow arbitrary code execution. In order to adapt to this requirement, extension developers can either use the <a href="/docs/extensions/reference/scripting/#method-executeScript"><code>scripting.executeScript</code></a> API to inject a static file or a function.</p>
<p>Static file injection with <code>scripting.executeScript</code> is almost identical to it used to work in Tabs API. While the old method only took a single file, the new method now takes an array of files.</p>
<p>{% Columns %}</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="co">// Manifest V2</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">// background.js</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="va">chrome</span>.<span class="va">tabs</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="dt">file</span><span class="op">:</span> <span class="st">&#39;content-script.js&#39;</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">// content-script.js</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="at">alert</span>(<span class="st">&#39;File test alert&#39;</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="co">// Manifest V3</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">// background.js</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw">async</span> <span class="kw">function</span> <span class="at">getCurrentTab</span>() <span class="op">{</span><span class="co">/* ... */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="kw">let</span> tab <span class="op">=</span> <span class="cf">await</span> <span class="at">getCurrentTab</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="va">chrome</span>.<span class="va">scripting</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="dt">target</span><span class="op">:</span> <span class="op">{</span><span class="dt">tabId</span><span class="op">:</span> <span class="va">tab</span>.<span class="at">id</span><span class="op">},</span></a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="dt">files</span><span class="op">:</span> [<span class="st">&#39;content-script.js&#39;</span>]</a>
<a class="sourceLine" id="cb12-10" title="10"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">// content-script.js</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="at">alert</span>(<span class="st">&#39;File test alert&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>{% endColumns %}</p>
<p>If you need more dynamism, the new <code>func</code> property allows you to inject a function as a content script and pass variables using the <code>args</code> property. Note that the function is not run as if it was located within the content script; rather, its source is sent to the target tab and it is run there.</p>
<p>{% Columns %}</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="co">// Manifest V2</span></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">// background.js</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">let</span> name <span class="op">=</span> <span class="st">&#39;World!&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="va">chrome</span>.<span class="va">tabs</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="dt">code</span><span class="op">:</span> <span class="vs">`alert(&#39;Hello, </span><span class="sc">${</span>name<span class="sc">}</span><span class="vs">!&#39;)`</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="co">// Manifest V3</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">// background.js</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="kw">async</span> <span class="kw">function</span> <span class="at">getCurrentTab</span>() <span class="op">{</span><span class="co">/* ... */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw">let</span> tab <span class="op">=</span> <span class="cf">await</span> <span class="at">getCurrentTab</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="kw">function</span> <span class="at">showAlert</span>(givenName) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="at">alert</span>(<span class="vs">`Hello, </span><span class="sc">${</span>givenName<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb14-10" title="10"></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="kw">let</span> name <span class="op">=</span> <span class="st">&#39;World&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="va">chrome</span>.<span class="va">scripting</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb14-13" title="13">  <span class="dt">target</span><span class="op">:</span> <span class="op">{</span><span class="dt">tabId</span><span class="op">:</span> <span class="va">tab</span>.<span class="at">id</span><span class="op">},</span></a>
<a class="sourceLine" id="cb14-14" title="14">  <span class="dt">func</span><span class="op">:</span> showAlert<span class="op">,</span></a>
<a class="sourceLine" id="cb14-15" title="15">  <span class="dt">args</span><span class="op">:</span> [name]<span class="op">,</span></a>
<a class="sourceLine" id="cb14-16" title="16"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>{% endColumns %}</p>
<p>A functional version of the Manifest V3 snippets in this section can be found in the <a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/reference/mv3/intro/mv3-migration/content-scripts">chrome-extensions-samples</a> repository. See the <a href="/docs/extensions/reference/tabs/#get-the-current-tab">Tabs API examples</a> for an implementation of <code>getCurrentTab</code>.</p>
<h2 id="background-service-workers-background-service-workers">Background service workers {: #background-service-workers }</h2>
<p>Background pages in MV2 are replaced by service workers in MV3: this is a foundational change that affects most extensions.</p>
<p><a href="https://developers.google.com/web/fundamentals/primers/service-workers">Service workers</a> are event based, and like event pages they do not persist between invocations. This change generally requires some redesign, with a number of factors to consider: see <a href="/docs/extensions/mv3/migrating_to_service_workers">Migrating from Background Pages to Service Workers</a> for additional details.</p>
<p>{% Aside %} In order to aid with the migration process, MV2 extensions can use background service workers as of Chrome 87. {% endAside %}</p>
<h2 id="modifying-network-requests-modifying-network-requests">Modifying network requests {: #modifying-network-requests }</h2>
<p>There is a new <a href="/docs/extensions/reference/declarativeNetRequest">declarativeNetRequest</a> for network request modification, which provides an alternative for much of the <a href="/docs/extensions/reference/webRequest">webRequest</a> AP’s functionality.</p>
<h3 id="when-can-you-use-blocking-webrequest-when-use-blocking-webrequest">When can you use blocking webRequest? {: #when-use-blocking-webrequest }</h3>
<p>The blocking version of the <a href="/docs/extensions/reference/webRequest">webRequest</a> API still exists in MV3 but its use is restricted to force-installed extensions only. See Chrome Enterprise policies: <a href="https://cloud.google.com/docs/chrome-enterprise/policies/?policy=ExtensionSettings">ExtensionSettings</a>, <a href="https://cloud.google.com/docs/chrome-enterprise/policies/?policy=ExtensionInstallForcelist">ExtensionInstallForcelist</a>.</p>
<p>All other extensions must now use <a href="/docs/extensions/reference/declarativeNetRequest">declarativeNetRequest</a> for network request modification. This moves the actual modification of the network request into the Chrome browser: the extension no longer can read the actual network request, and in most cases needs no host permissions.</p>
<p>{% Aside %} Request redirects and header modifications <strong>do</strong> require the user to grant host permissions. {% endAside %}</p>
<h3 id="how-do-you-use-declarativenetrequest-how-use-declarativenetrequest">How do you use declarativeNetRequest? {: #how-use-declarativenetrequest }</h3>
<p>Instead of reading the request and programmatically altering it, your extension specifies a number of rules, which map a set of conditions to corresponding actions. See the <a href="/docs/extensions/reference/declarativeNetRequest">declarativeNetRequest</a> reference documentation for a more detailed description of rules.</p>
<p>This feature allows content blockers and other request-modifying extensions to implement their use cases without requiring host permissions, and without needing to read the actual requests.</p>
<p>{% Aside %} In order to aid with the migration process, the declarativeNetRequest API is available for use in MV2 extensions as of Chrome 84. {% endAside %}</p>
<h3 id="conditional-permissions-and-declarativenetrequest-declarativenetrequest-conditional-perms">Conditional permissions and declarativeNetRequest {: #declarativenetrequest-conditional-perms }</h3>
<p>Most use cases for declarativeNetRequest don’t require any host permissions at all. However, some do.</p>
<p>{% Aside %} Request redirects and header modifications <strong>do</strong> require the user to grant host permissions. {% endAside %}</p>
<p>When extensions require host permissions for these use cases, we recommend a “tiered” permissions strategy. This means implementing the extension’s core functionality without using these permissions; putting the more advanced use cases behind an optional permission.</p>
<p>This approach allows privacy-conscious users to withhold those permissions and still use much of the extension’s functionality. This means that developers can implement many common use cases, such as content-blocking functionality, without requiring any host permissions.</p>
<h2 id="sunset-for-deprecated-apis-sunset-deprecated-apis">Sunset for deprecated APIs {: #sunset-deprecated-apis }</h2>
<p>There are a number of APIs that have long been deprecated. Manifest V3 finally removes support for these deprecated APIs. These include:</p>
<ul>
<li>chrome.extension.sendRequest()</li>
<li>chrome.extension.onRequest</li>
<li>chrome.extension.onRequestExternal</li>
<li>chrome.extension.lastError</li>
<li>chrome.extension.getURL()</li>
<li>chrome.extension.getExtensionTabs()</li>
<li>chrome.tabs.Tab.selected</li>
<li>chrome.tabs.sendRequest()</li>
<li>chrome.tabs.getSelected()</li>
<li>chrome.tabs.getAllInWindow()</li>
<li>chrome.tabs.onSelectionChanged</li>
<li>chrome.tabs.onActiveChanged</li>
<li>chrome.tabs.onHighlightChanged</li>
</ul>
<p>As well as the undocumented:</p>
<ul>
<li>chrome.extension.sendMessage()</li>
<li>chrome.extension.connect()</li>
<li>chrome.extension.onConnect</li>
<li>chrome.extension.onMessage</li>
</ul>
<p>If your extensions use any of these deprecated APIs, you’ll need to make the appropriate changes when you migrate to MV3.</p>
</body>
</html>
