<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2012-09-17" />
  <title>Content scripts</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Content scripts</h1>
<p class="date">2012-09-17</p>
</header>
<p>Content scripts are files that run in the context of web pages. By using the standard <a href="https://www.w3.org/TR/DOM-Level-2-HTML/">Document Object Model</a> (DOM), they are able to read details of the web pages the browser visits, make changes to them, and pass information to their parent extension.</p>
<h2 id="understand-content-script-capabilities-capabilities">Understand content script capabilities {: #capabilities }</h2>
<p>Content scripts can access Chrome APIs used by their parent extension by exchanging <a href="/docs/extensions/mv3/messaging">messages</a> with the extension. They can also access the URL of an extension’s file with <code>chrome.runtime.getURL()</code> and use the result the same as other URLs.</p>
<pre class="js/1"><code>// Code for displaying &lt;extensionDir&gt;/images/myimage.png:
var imgURL = chrome.runtime.getURL(&quot;images/myimage.png&quot;);
document.getElementById(&quot;someImage&quot;).src = imgURL;</code></pre>
<p>Additionally, content scripts can access the following chrome APIs directly:</p>
<ul>
<li><a href="/docs/extensions/reference/i18n">i18n</a></li>
<li><a href="/docs/extensions/reference/storage">storage</a></li>
<li><a href="/docs/extensions/reference/runtime">runtime</a>:
<ul>
<li><a href="/docs/extensions/reference/runtime#method-connect">connect</a></li>
<li><a href="/docs/extensions/reference/runtime#method-getManifest">getManifest</a></li>
<li><a href="/docs/extensions/reference/runtime#method-getURL">getURL</a></li>
<li><a href="/docs/extensions/reference/runtime#property-id">id</a></li>
<li><a href="/docs/extensions/reference/runtime#event-onConnect">onConnect</a></li>
<li><a href="/docs/extensions/reference/runtime#event-onMessage">onMessage</a></li>
<li><a href="/docs/extensions/reference/runtime#method-sendMessage">sendMessage</a></li>
</ul></li>
</ul>
<p>Content scripts are unable to access other APIs directly.</p>
<h2 id="work-in-isolated-worlds-isolated_world">Work in isolated worlds {: #isolated_world }</h2>
<p>Content scripts live in an isolated world, allowing a content script to make changes to its JavaScript environment without conflicting with the page or other extensions’ content scripts.</p>
<p>{% Aside %}</p>
<p>An <em>isolated world</em> is a private execution environment that isn’t accessible to the page or other extensions. A practical consequence of this isolation is that JavaScript variables in an extension’s content scripts are not visible to the host page or other extensions’ content scripts. The concept was originally introduced with the initial launch of Chrome, providing isolation for browser tabs.</p>
<p>{% endAside %}</p>
<p>An extension may run in a web page with code similar to the example below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;mybutton&quot;</span><span class="kw">&gt;</span>click me<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw">var</span> greeting <span class="op">=</span> <span class="st">&quot;hello, &quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="kw">var</span> button <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;mybutton&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="va">button</span>.<span class="at">person_name</span> <span class="op">=</span> <span class="st">&quot;Bob&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="va">button</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb2-8" title="8">      <span class="at">alert</span>(greeting <span class="op">+</span> <span class="va">button</span>.<span class="at">person_name</span> <span class="op">+</span> <span class="st">&quot;.&quot;</span>)</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="kw">&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>That extension could inject the following content script using one of the techniques outlined in the <a href="#functionality">Inject scripts</a> section.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> greeting <span class="op">=</span> <span class="st">&quot;hola, &quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">var</span> button <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;mybutton&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="va">button</span>.<span class="at">person_name</span> <span class="op">=</span> <span class="st">&quot;Roberto&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">button</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="at">alert</span>(greeting <span class="op">+</span> <span class="va">button</span>.<span class="at">person_name</span> <span class="op">+</span> <span class="st">&quot;.&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre></div>
<p>With this change, both alerts appear in sequence when the button is clicked.</p>
<p>{% Aside %} Not only does each extension run in its own isolated world, but content scripts and the web page do too. This means that none of these (web page, content scripts, and any running extensions) can access the context and variables of the others. {% endAside %}</p>
<p>{# youtube id=“laLudeUmXHM” #}</p>
<h2 id="inject-scripts-functionality">Inject scripts {: #functionality }</h2>
<p>Content scripts can be <a href="#static-declarative">declared statically</a>{% if false %}, <a href="#dynamic-declarative">declared dynamically</a>, {% endif %} or <a href="#programmatic">programmatically injected</a>.</p>
<h3 id="inject-with-static-declarations-static-declarative">Inject with static declarations {: #static-declarative }</h3>
<p>Use static content script declarations in manifest.json for scripts that should be automatically run on a well known set of pages.</p>
<p>Statically declared scripts are registered in the manifest under the <code>"content_scripts"</code> field. They can include JavaScript files, CSS files, or both. All auto-run content scripts must specify <a href="/docs/extensions/mv3/match_patterns">match patterns</a>.</p>
<pre class="json/3-9"><code>{
 &quot;name&quot;: &quot;My extension&quot;,
 ...
 &quot;content_scripts&quot;: [
   {
     &quot;matches&quot;: [&quot;https://*.nytimes.com/*&quot;],
     &quot;css&quot;: [&quot;my-styles.css&quot;],
     &quot;js&quot;: [&quot;content-script.js&quot;]
   }
 ],
 ...
}</code></pre>
<table class="simple">
<tbody>
<tr>
<th>
Name
</th>
<th>
Type
</th>
<th>
Description
</th>
</tr>
<tr id="matches">
<td>
<code>matches</code>
</td>
<td>
array of strings
</td>
<td>
<em>Required.</em> Specifies which pages this content script will be injected into. See <a
          href="match_patterns">Match Patterns</a> for more details on the syntax of these strings and <a href="#matchAndGlob">Match patterns and globs</a> for information on how to exclude URLs.
</td>
</tr>
<tr id="css">
<td>
<code>css</code>
</td>
<td>
array of strings
</td>
<td>
<em>Optional.</em> The list of CSS files to be injected into matching pages. These are injected in the order they appear in this array, before any DOM is constructed or displayed for the page.
</td>
</tr>
<tr id="js">
<td>
<code>js</code>
</td>
<td>
<nobr>array of strings</nobr>
</td>
<td>
<em>Optional.</em> The list of JavaScript files to be injected into matching pages. These are injected in the order they appear in this array.
</td>
</tr>
<tr id="match_about_blank">
<td>
<code>match_about_blank</code>
</td>
<td>
boolean
</td>
<td>
<em>Optional.</em> Whether the script should inject into an <code>about:blank</code> frame where the parent or opener frame matches one of the patterns declared in <code>matches</code>. Defaults to false.
</td>
</tr>
</tbody>
</table>
<p>{% if false %} ### Inject with dynamic declarations {: #dynamic-declarative }</p>
<p>{% Aside ‘caution’ %}</p>
<p>This feature is not yet fully supported. It is currently in dev and is also available in Chrome Canary.</p>
<p>{% endAside %}</p>
<p>You should use dynamic declarations in the following cases:</p>
<ul>
<li>When the host is not well known</li>
<li>The script may need to be added/removed from a known host</li>
</ul>
<p><strong>TODO</strong></p>
<ul>
<li>Uses the JS scripting API
<ul>
<li>example of adding a script</li>
<li>example of removing a script</li>
</ul></li>
<li>Q: Is this going to be the cannonical reference material for content scripts? If so, we may want to include examples for the relevant Scripting API methods.</li>
</ul>
<p>See the <a href="https://docs.google.com/document/d/1p2jnIL3znAhD2VVuEbzOetgj1Qeya9yATa3B9gBGGUg/edit">api proposal</a> for additional details.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">chrome</span>.<span class="va">scripting</span>.<span class="at">registerContentScript</span>(optionsObject<span class="op">,</span> callback)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">chrome</span>.<span class="va">scripting</span>.<span class="at">unregisterContentScript</span>(idArray<span class="op">,</span> callback)<span class="op">;</span></a></code></pre></div>
<p>{% endif %}</p>
<h3 id="inject-programmatically-programmatic">Inject programmatically {: #programmatic }</h3>
<p>Use programmatic injection for content scripts that need to run in response to events or on specific occasions.</p>
<p>In order to inject a content script programmatically, your extension needs host permissions for the page it’s trying to inject scripts into. Host permissions can either be granted either by requesting them as part of your extension’s manifest (see <a href="/docs/extensions/reference/permissions"><code>host_permissions</code></a>) or temporarily via <a href="/activeTab">activeTab</a>.</p>
<p>Below we’ll look at different versions of an activeTab-based extension.</p>
<pre class="json/4-6"><code>//// manifest.json ////
{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;permissions&quot;: [
    &quot;activeTab&quot;
  ],
  &quot;background&quot;: {
    &quot;service_worker&quot;: &quot;background.js&quot;
  }
}</code></pre>
<p>Content scripts can be injected as files…</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">//// content-script.js ////</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="va">document</span>.<span class="va">body</span>.<span class="va">style</span>.<span class="at">backgroundColor</span> <span class="op">=</span> <span class="st">&#39;orange&#39;</span><span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="co">//// background.js ////</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="va">chrome</span>.<span class="va">action</span>.<span class="va">onClicked</span>.<span class="at">addListener</span>((tab) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="va">chrome</span>.<span class="va">scripting</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="dt">target</span><span class="op">:</span> <span class="op">{</span> <span class="dt">tabId</span><span class="op">:</span> <span class="va">tab</span>.<span class="at">id</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb9-5" title="5">    <span class="dt">files</span><span class="op">:</span> [<span class="st">&#39;content-script.js&#39;</span>]</a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>…or a function body can be injected and executed as a content script.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">//// background.js ////</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">function</span> <span class="at">injectedFunction</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="va">document</span>.<span class="va">body</span>.<span class="va">style</span>.<span class="at">backgroundColor</span> <span class="op">=</span> <span class="st">&#39;orange&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="va">chrome</span>.<span class="va">action</span>.<span class="va">onClicked</span>.<span class="at">addListener</span>((tab) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="va">chrome</span>.<span class="va">scripting</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb10-8" title="8">    <span class="dt">target</span><span class="op">:</span> <span class="op">{</span> <span class="dt">tabId</span><span class="op">:</span> <span class="va">tab</span>.<span class="at">id</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb10-9" title="9">    <span class="kw">function</span><span class="op">:</span> injectedFunction</a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Be aware that the injected function is a copy of the function referenced in the <code>chrome.scripting.executeScript</code> call, not the original function itself. As a result, the function’s body must be self contained; references to variables outside of the function will cause the content script to throw a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ReferenceError"><code>ReferenceError</code></a>.</p>
<p>{% if false %} When injecting as a function, you can also pass arguments to the function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">function</span> <span class="at">injectedFunction</span>(color) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="va">document</span>.<span class="va">body</span>.<span class="va">style</span>.<span class="at">backgroundColor</span> <span class="op">=</span> color<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="va">chrome</span>.<span class="va">action</span>.<span class="va">onClicked</span>.<span class="at">addListener</span>((tab) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="va">chrome</span>.<span class="va">scripting</span>.<span class="at">executeScript</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb11-7" title="7">    <span class="dt">target</span><span class="op">:</span> <span class="op">{</span> <span class="dt">tabId</span><span class="op">:</span> <span class="va">tab</span>.<span class="at">id</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb11-8" title="8">    <span class="kw">function</span><span class="op">:</span> injectedFunction<span class="op">,</span></a>
<a class="sourceLine" id="cb11-9" title="9">    <span class="dt">arguments</span><span class="op">:</span> [<span class="st">&#39;orange&#39;</span>]</a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>{% endif %}</p>
<h3 id="exclude-matches-and-globs-matchandglob">Exclude matches and globs {: #matchAndGlob }</h3>
<p>Specified page matching is customizable by including the following fields in a declarative registration.</p>
<table class="simple">
<tbody>
<tr>
<th>
Name
</th>
<th>
Type
</th>
<th>
Description
</th>
</tr>
<tr id="exclude_matches">
<td>
<code>exclude_matches</code>
</td>
<td>
array of strings
</td>
<td>
<em>Optional.</em> Excludes pages that this content script would otherwise be injected into. See <a href="match_patterns">Match Patterns</a> for more details on the syntax of these strings.
</td>
</tr>
<tr id="include_globs">
<td>
<code>include_globs</code>
</td>
<td>
array of strings
</td>
<td>
<em>Optional.</em> Applied after <code>matches</code> to include only those URLs that also match this glob. Intended to emulate the <a
          href="https://wiki.greasespot.net/Metadata_Block#.40include"><code><span class="citation" data-cites="include">@include</span></code></a> Greasemonkey keyword.
</td>
</tr>
<tr id="exclude_globs">
<td>
<code>exclude_globs</code>
</td>
<td>
array of string
</td>
<td>
<em>Optional.</em> Applied after <code>matches</code> to exclude URLs that match this glob. Intended to emulate the <a
          href="https://wiki.greasespot.net/Metadata_Block#.40include"><code><span class="citation" data-cites="exclude">@exclude</span></code></a> Greasemonkey keyword.
</td>
</tr>
</tbody>
</table>
<p>The content script will be injected into a page if both of the following are true:</p>
<ul>
<li>Its URL matches any <code>matches</code> pattern and any <code>include_globs</code> pattern</li>
<li>The URL doesn’t also match an <code>exclude_matches</code> or <code>exclude_globs</code> pattern. Because the <code>matches</code> property is required, <code>exclude_matches</code>, <code>include_globs</code>, and <code>exclude_globs</code> can only be used to limit which pages will be affected.</li>
</ul>
<p>The following extension injects the content script into <strong>https://www.nytimes.com/ health</strong> but not into <strong>https://www.nytimes.com/ business</strong> .</p>
<pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;https://*.nytimes.com/*&quot;],
      &quot;exclude_matches&quot;: [&quot;*://*/*business*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
<pre class="js/2"><code>chrome.scripting.registerContentScript({
  id: 1,
  matches: [&quot;https://*.nytimes.com/*&quot;],
  exclude_matches: [&quot;*://*/*business*&quot;],
  js: [&quot;contentScript.js&quot;]
});</code></pre>
<p>Glob properties follow a different, more flexible syntax than <a href="/docs/extensions/mv3/match_patterns">match patterns</a>. Acceptable glob strings are URLs that may contain “wildcard” asterisks and question marks. The asterisk <strong>*</strong> matches any string of any length, including the empty string, while the question mark <strong>?</strong> matches any single character.</p>
<p>For example, the glob <strong>https://???.example.com/foo/*</strong> matches any of the following:</p>
<ul>
<li><strong>https://www.example.com/foo/bar</strong></li>
<li><strong>https://the.example.com/foo/</strong></li>
</ul>
<p>However, it does <em>not</em> match the following:</p>
<ul>
<li><strong>https://my.example.com/foo/bar</strong></li>
<li><strong>https://example.com/foo/</strong></li>
<li><strong>https://www.example.com/foo</strong></li>
</ul>
<p>This extension injects the content script into <strong>https://www.nytimes.com/arts/index.html</strong> and <strong>https://www.nytimes.com/jobs/index.html</strong>, but not into <strong>https://www.nytimes.com/sports/index.html</strong>:</p>
<pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;https://*.nytimes.com/*&quot;],
      &quot;include_globs&quot;: [&quot;*nytimes.com/???s/*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
<pre class="js/3"><code>chrome.scripting.registerContentScript({
  id: 1,
  matches: [&#39;https://*.nytimes.com/*&#39;],
  include_globs: [&#39;*nytimes.com/???s/*&#39;],
  js: [&#39;contentScript.js&#39;]
});</code></pre>
<p>This extension injects the content script into <strong>https://history.nytimes.com</strong> and <strong>https://.nytimes.com/history</strong>, but not into <strong>https://science.nytimes.com</strong> or <strong>https://www.nytimes.com/science</strong>:</p>
<pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;https://*.nytimes.com/*&quot;],
      &quot;exclude_globs&quot;: [&quot;*science*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
<pre class="js/3"><code>chrome.scripting.registerContentScript({
  id: 1,
  matches: [&#39;https://*.nytimes.com/*&#39;],
  exclude_globs: [&#39;*science*&#39;],
  js: [&#39;contentScript.js&#39;]
});</code></pre>
<p>One, all, or some of these can be included to achieve the correct scope.</p>
<pre class="json/6-8"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;https://*.nytimes.com/*&quot;],
      &quot;exclude_matches&quot;: [&quot;*://*/*business*&quot;],
      &quot;include_globs&quot;: [&quot;*nytimes.com/???s/*&quot;],
      &quot;exclude_globs&quot;: [&quot;*science*&quot;],
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
<pre class="js/2-4"><code>chrome.scripting.registerContentScript({
  matches: [&#39;https://*.nytimes.com/*&#39;],
  exclude_matches: [&#39;*://*/*business*&#39;],
  include_globs: [&#39;*nytimes.com/???s/*&#39;],
  exclude_globs: [&#39;*science*&#39;],
  js: [&#39;contentScript.js&#39;]
});</code></pre>
<h3 id="run-time-run_time">Run time {: #run_time }</h3>
<p>The <code>run_at</code> field controls when JavaScript files are injected into the web page. The preferred and default value is <code>"document_idle"</code>, but you can also specify <code>"document_start"</code> or <code>"document_end"</code> if needed.</p>
<pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;https://*.nytimes.com/*&quot;],
      &quot;run_at&quot;: &quot;document_idle&quot;,
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
<pre class="js/2"><code>chrome.scripting.registerContentScript({
  matches: [&#39;https://*.nytimes.com/*&#39;],
  run_at: &#39;document_idle&#39;,
  js: [&#39;contentScript.js&#39;]
});</code></pre>
<table class="simple">
<tbody>
<tr>
<th>
Name
</th>
<th>
Type
</th>
<th>
Description
</th>
</tr>
<tr id="document_idle">
<td>
<code>document_idle</code>
</td>
<td>
string
</td>
<td>
<em>Prefered.</em> Use <code>“document_idle”</code> whenever possible.<br><br>The browser chooses a time to inject scripts between <code>“document_end”</code> and immediately after the <a
          href="https://www.whatwg.org/specs/web-apps/current-work/#handler-onload"><code>window.onload</code></a> event fires. The exact moment of injection depends on how complex the document is and how long it is taking to load, and is optimized for page load speed.<br><br>Content scripts running at <code>“document_idle”</code> do not need to listen for the <code>window.onload</code> event, they are guaranteed to run after the DOM is complete. If a script definitely needs to run after <code>window.onload</code>, the extension can check if <code>onload</code> has already fired by using the <a
          href="https://www.whatwg.org/specs/web-apps/current-work/#dom-document-readystate"><code>document.readyState</code></a> property.
</td>
</tr>
<tr id="document_start">
<td>
<code>document_start</code>
</td>
<td>
string
</td>
<td>
Scripts are injected after any files from <code>css</code>, but before any other DOM is constructed or any other script is run.
</td>
</tr>
<tr id="document_end">
<td>
<code>document_end</code>
</td>
<td>
string
</td>
<td>
Scripts are injected immediately after the DOM is complete, but before subresources like images and frames have loaded.
</td>
</tr>
</tbody>
</table>
<h3 id="specify-frames-frames">Specify frames {: #frames }</h3>
<p>The <code>"all_frames"</code> field allows the extension to specify if JavaScript and CSS files should be injected into all frames matching the specified URL requirements or only into the topmost frame in a tab.</p>
<pre class="json/6"><code>{
  &quot;name&quot;: &quot;My extension&quot;,
  ...
  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;https://*.nytimes.com/*&quot;],
      &quot;all_frames&quot;: true,
      &quot;js&quot;: [&quot;contentScript.js&quot;]
    }
  ],
  ...
}</code></pre>
<pre class="js/2"><code>chrome.scripting.registerContentScript({
  matches: [&#39;https://*.nytimes.com/*&#39;],
  all_frames: true,
  js: [&#39;contentScript.js&#39;]
});</code></pre>
<table class="simple">
<tbody>
<tr>
<th>
Name
</th>
<th>
Type
</th>
<th>
Description
</th>
</tr>
<tr id="all_frames">
<td>
<code>all_frames</code>
</td>
<td>
boolean
</td>
<td>
<em>Optional.</em> Defaults to <code>false</code>, meaning that only the top frame is matched.<br><br>If specified <code>true</code>, it will inject into all frames, even if the frame is not the topmost frame in the tab. Each frame is checked independently for URL requirements, it won’t inject into child frames if the URL requirements are not met.
</td>
</tr>
</tbody>
</table>
<h2 id="communication-with-the-embedding-page-host-page-communication">Communication with the embedding page {: #host-page-communication }</h2>
<p>Although the execution environments of content scripts and the pages that host them are isolated from each other, they share access to the page’s DOM. If the page wishes to communicate with the content script, or with the extension via the content script, it must do so through the shared DOM.</p>
<p>An example can be accomplished using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage"><code>window.postMessage</code></a>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">var</span> port <span class="op">=</span> <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">connect</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb24-2" title="2"></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&quot;message&quot;</span><span class="op">,</span> (event) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb24-4" title="4">  <span class="co">// We only accept messages from ourselves</span></a>
<a class="sourceLine" id="cb24-5" title="5">  <span class="cf">if</span> (<span class="va">event</span>.<span class="at">source</span> <span class="op">!=</span> window) <span class="op">{</span></a>
<a class="sourceLine" id="cb24-6" title="6">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb24-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb24-8" title="8"></a>
<a class="sourceLine" id="cb24-9" title="9">  <span class="cf">if</span> (<span class="va">event</span>.<span class="va">data</span>.<span class="at">type</span> <span class="op">&amp;&amp;</span> (<span class="va">event</span>.<span class="va">data</span>.<span class="at">type</span> <span class="op">==</span> <span class="st">&quot;FROM_PAGE&quot;</span>)) <span class="op">{</span></a>
<a class="sourceLine" id="cb24-10" title="10">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Content script received: &quot;</span> <span class="op">+</span> <span class="va">event</span>.<span class="va">data</span>.<span class="at">text</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-11" title="11">    <span class="va">port</span>.<span class="at">postMessage</span>(<span class="va">event</span>.<span class="va">data</span>.<span class="at">text</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb24-13" title="13"><span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1"><span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;theButton&quot;</span>).<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="va">window</span>.<span class="at">postMessage</span>(<span class="op">{</span> <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;FROM_PAGE&quot;</span><span class="op">,</span> <span class="dt">text</span><span class="op">:</span> <span class="st">&quot;Hello from the webpage!&quot;</span> <span class="op">},</span> <span class="st">&quot;*&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre></div>
<p>The non-extension page, example.html, posts messages to itself. This message is intercepted and inspected by the content script and then posted to the extension process. In this way, the page establishes a line of communication to the extension process. The reverse is possible through similar means.</p>
<h2 id="stay-secure-security">Stay secure {: #security }</h2>
<p>While isolated worlds provide a layer of protection, using content scripts can create vulnerabilities in an extension and the web page. If the content script receives content from a separate website, such as making an <a href="/docs/extensions/mv3/xhr"><code>XMLHttpRequest</code></a>, be careful to filter content <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting</a> attacks before injecting it. Only communicate over HTTPS in order to avoid <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">“man-in-the-middle”</a> attacks.</p>
<p>Be sure to filter for malicious web pages. For example, the following patterns are dangerous, and disallowed in MV3:</p>
<p>{% Compare ‘worse’ %}</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">const</span> data <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;json-data&quot;</span>)</a>
<a class="sourceLine" id="cb26-2" title="2"><span class="co">// </span><span class="al">WARNING</span><span class="co">! Might be evaluating an evil script!</span></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="kw">const</span> parsed <span class="op">=</span> <span class="at">eval</span>(<span class="st">&quot;(&quot;</span> <span class="op">+</span> data <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</a></code></pre></div>
<p>{% endCompare %}</p>
<p>{% Compare ‘worse’ %}</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">const</span> elmt_id <span class="op">=</span> ...</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="co">// </span><span class="al">WARNING</span><span class="co">! elmt_id might be &quot;); ... evil script ... //&quot;!</span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="va">window</span>.<span class="at">setTimeout</span>(<span class="st">&quot;animate(&quot;</span> <span class="op">+</span> elmt_id <span class="op">+</span> <span class="st">&quot;)&quot;</span><span class="op">,</span> <span class="dv">200</span>)<span class="op">;</span></a></code></pre></div>
<p>{% endCompare %}</p>
<p>Instead, prefer safer APIs that do not run scripts:</p>
<p>{% Compare ‘better’ %}</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">const</span> data <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;json-data&quot;</span>)</a>
<a class="sourceLine" id="cb28-2" title="2"><span class="co">// JSON.parse does not evaluate the attacker&#39;s scripts.</span></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="kw">const</span> parsed <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(data)<span class="op">;</span></a></code></pre></div>
<p>{% endCompare %}</p>
<p>{% Compare ‘better’ %}</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">const</span> elmt_id <span class="op">=</span> ...</a>
<a class="sourceLine" id="cb29-2" title="2"><span class="co">// The closure form of setTimeout does not evaluate scripts.</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="va">window</span>.<span class="at">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="at">animate</span>(elmt_id)<span class="op">,</span> <span class="dv">200</span>)<span class="op">;</span></a></code></pre></div>
<p>{% endCompare %}</p>
</body>
</html>
