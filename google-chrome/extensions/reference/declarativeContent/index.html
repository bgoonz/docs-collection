<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>index</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h2 id="usage">Usage</h2>
<p>The Declarative Content API allows you to show your extension’s <a href="/docs/extensions/pageAction">page action</a> depending on the URL of a web page and the CSS selectors its content matches, without needing to take a <a href="/docs/extensions/mv2/declare_permissions#host-permissions">host permission</a> or inject a <a href="/docs/extensions/mv2/content_scripts">content script</a>. Use the <a href="/docs/extensions/activeTab">activeTab</a> permission in order to be able to interact with a page after the user clicks on your page action.</p>
<p>If you need more precise control over when your page action appears or you need to change its appearance to match the current tab before the user clicks on it, you’ll have to keep using the <a href="/docs/extensions/pageAction">pageAction</a> API.</p>
<h2 id="rules">Rules</h2>
<p>As a <a href="/docs/extensions/events#declarative">declarative API</a>, this API lets you register rules on the <a href="#event-onPageChanged"><code>onPageChanged</code></a> <a href="/docs/extensions/events#type-Event">event</a> object which take an action (<a href="#type-ShowPageAction"><code>ShowPageAction</code></a> and <a href="#type-SetIcon"><code>SetIcon</code></a>) when a set of conditions, represented as a <a href="#type-PageStateMatcher"><code>PageStateMatcher</code></a>, are met.</p>
<p>The <a href="#type-PageStateMatcher"><code>PageStateMatcher</code></a> matches web pages if and only if all listed criteria are met. The following rule would show a page action for pages on “https://www.google.com/” when a password field is present on it:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">var</span> rule1 <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="dt">conditions</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">new</span> <span class="va">chrome</span>.<span class="va">declarativeContent</span>.<span class="at">PageStateMatcher</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb1-4" title="4">      <span class="dt">pageUrl</span><span class="op">:</span> <span class="op">{</span> <span class="dt">hostEquals</span><span class="op">:</span> <span class="st">&#39;www.google.com&#39;</span><span class="op">,</span> <span class="dt">schemes</span><span class="op">:</span> [<span class="st">&#39;https&#39;</span>] <span class="op">},</span></a>
<a class="sourceLine" id="cb1-5" title="5">      <span class="dt">css</span><span class="op">:</span> [<span class="st">&quot;input[type=&#39;password&#39;]&quot;</span>]</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-7" title="7">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="dt">actions</span><span class="op">:</span> [ <span class="kw">new</span> <span class="va">chrome</span>.<span class="va">declarativeContent</span>.<span class="at">ShowPageAction</span>() ]</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="op">};</span></a></code></pre></div>
<p>{% Aside %}</p>
<p><strong>Note:</strong> All conditions and actions are created via a constructor as shown in the example above.</p>
<p>{% endAside %}</p>
<p>In order to also show a page action for sites with a video, you can add a second condition, as each condition is sufficient to trigger all specified actions:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">var</span> rule2 <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">conditions</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="kw">new</span> <span class="va">chrome</span>.<span class="va">declarativeContent</span>.<span class="at">PageStateMatcher</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">      <span class="dt">pageUrl</span><span class="op">:</span> <span class="op">{</span> <span class="dt">hostEquals</span><span class="op">:</span> <span class="st">&#39;www.google.com&#39;</span><span class="op">,</span> <span class="dt">schemes</span><span class="op">:</span> [<span class="st">&#39;https&#39;</span>] <span class="op">},</span></a>
<a class="sourceLine" id="cb2-5" title="5">      <span class="dt">css</span><span class="op">:</span> [<span class="st">&quot;input[type=&#39;password&#39;]&quot;</span>]</a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="kw">new</span> <span class="va">chrome</span>.<span class="va">declarativeContent</span>.<span class="at">PageStateMatcher</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-8" title="8">      <span class="dt">css</span><span class="op">:</span> [<span class="st">&quot;video&quot;</span>]</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-10" title="10">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="dt">actions</span><span class="op">:</span> [ <span class="kw">new</span> <span class="va">chrome</span>.<span class="va">declarativeContent</span>.<span class="at">ShowPageAction</span>() ]</a>
<a class="sourceLine" id="cb2-12" title="12"><span class="op">};</span></a></code></pre></div>
<p><a href="/docs/extensions/events#addingrules">Added rules</a> are saved across browser restarts, so register them as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">onInstalled</span>.<span class="at">addListener</span>(<span class="kw">function</span>(details) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="va">chrome</span>.<span class="va">declarativeContent</span>.<span class="va">onPageChanged</span>.<span class="at">removeRules</span>(<span class="kw">undefined</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="va">chrome</span>.<span class="va">declarativeContent</span>.<span class="va">onPageChanged</span>.<span class="at">addRules</span>([rule2])<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>{% Aside %}</p>
<p><strong>Note:</strong> You should always register or unregister rules in bulk rather than individually because each of these operations recreates internal data structures. This re-creation is computationally expensive but facilitates a faster matching algorithm.</p>
<p>{% endAside %}</p>
<p>Combine the above rule with the <a href="/docs/extensions/activeTab">activeTab</a> permission to create an extension that doesn’t need any install-time permissions but can invite the user to click its page action on relevant pages and can run on those pages when the user clicks the page action.</p>
<h2 id="css-matching">CSS Matching</h2>
<p><a href="#property-PageStateMatcher-css"><code>PageStateMatcher.css</code></a> conditions must be <em><a href="https://www.w3.org/TR/selectors4/#compound">compound selectors</a></em>, meaning that you can’t include <a href="https://www.w3.org/community/webed/wiki/CSS/Selectors#Combinators">combinators</a> like whitespace or “<code>&gt;</code>” in your selectors. This helps Chrome match the selectors more efficiently.</p>
<table>
<tbody>
<tr>
<th>
Compound Selectors (OK)
</th>
<th>
Complex Selectors (Not OK)
</th>
</tr>
<tr>
<td>
<code>a</code>
</td>
<td>
<code>div p</code>
</td>
</tr>
<tr>
<td>
<code>iframe.special[src^=‘http’]</code>
</td>
<td>
<code>p&gt;span.highlight</code>
</td>
</tr>
<tr>
<td>
<code>ns|*</code>
</td>
<td>
<code>p + ol</code>
</td>
</tr>
<tr>
<td>
<code>#abcd:checked</code>
</td>
<td>
<code>p::first-line</code>
</td>
</tr>
</tbody>
</table>
<p>CSS conditions only match displayed elements: if an element that matches your selector is <code>display:none</code> or one of its parent elements is <code>display:none</code>, it doesn’t cause the condition to match. Elements styled with <code>visibility:hidden</code>, positioned off-screen, or hidden by other elements can still make your condition match.</p>
<h2 id="bookmarked-state-matching">Bookmarked State Matching</h2>
<p>The <a href="#property-PageStateMatcher-isBookmarked"><code>PageStateMatcher.isBookmarked</code></a> condition allows matching of the bookmarked state of the current URL in the user’s profile. To make use of this condition the “bookmarks” permission must be declared in the <a href="/docs/extensions/mv2/tabs">extension manifest</a></p>
</body>
</html>
