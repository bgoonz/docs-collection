<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2014-03-11" />
  <title>Bluetooth</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Bluetooth</h1>
<p class="date">2014-03-11</p>
</header>
<p>{% Aside ‘caution’ %}</p>
<p><strong>Important:</strong> Chrome will be removing support for Chrome Apps on all platforms. Chrome browser and the Chrome Web Store will continue to support extensions. <a href="https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html"><strong>Read the announcement</strong></a> and learn more about <a href="/apps/migration"><strong>migrating your app</strong></a>.</p>
<p>{% endAside %}</p>
<p>This document describes how to use the <a href="/docs/extensions/reference/bluetooth">Bluetooth</a>, <a href="/docs/extensions/reference/bluetoothSocket">Bluetooth Socket</a> and <a href="/docs/extensions/reference/bluetoothLowEnergy">Bluetooth Low Energy</a> APIs to communicate with Bluetooth and Bluetooth Low Energy devices.</p>
<p>For background information about Bluetooth, see the official <a href="http://www.bluetooth.org">Bluetooth specifications</a>.</p>
<p>{% Aside %}</p>
<p><strong>Note:</strong> With Chrome 56, users can select nearby Bluetooth Low Energy devices to provide to web sites that use the <a href="https://developers.google.com/web/updates/2015/07/interact-with-ble-devices-on-the-web">Web Bluetooth</a> API.</p>
<p>{% endAside %}</p>
<h2 id="manifest-requirements-manifest">Manifest requirements {: #manifest }</h2>
<p>For Chrome Apps that use Bluetooth, add the <a href="/docs/apps/manifest/bluetooth/">bluetooth</a> entry to the manifest and specify, if appropriate, the UUIDs of profiles, protocols or services you wish to implement along with whether you wish to implement these with the socket and/or Low Energy APIs.</p>
<p>For example for a socket implementation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="er">&quot;bluetooth&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="dt">&quot;uuids&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="st">&quot;1105&quot;</span><span class="ot">,</span> <span class="st">&quot;1106&quot;</span> <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="dt">&quot;socket&quot;</span><span class="fu">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>And for a Low Energy implementation:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="er">&quot;bluetooth&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">&quot;uuids&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="st">&quot;180D&quot;</span><span class="ot">,</span> <span class="st">&quot;1809&quot;</span><span class="ot">,</span> <span class="st">&quot;180F&quot;</span> <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">&quot;low_energy&quot;</span><span class="fu">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>To only access adapter state, discover nearby devices, and obtain basic information about devices, only the entry itself is required:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="er">&quot;bluetooth&quot;:</span> <span class="fu">{}</span></a></code></pre></div>
<h2 id="adapter-information-adapter_info">Adapter information {: #adapter_info }</h2>
<h3 id="obtaining-adapter-state-adapter_state">Obtaining adapter state {: #adapter_state }</h3>
<p>To obtain the state of the Bluetooth adapter, use the <a href="/docs/extensions/reference/bluetooth/#method-getAdapterState">bluetooth.getAdapterState</a> method:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">getAdapterState</span>(<span class="kw">function</span>(adapter) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Adapter &quot;</span> <span class="op">+</span> <span class="va">adapter</span>.<span class="at">address</span> <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> <span class="va">adapter</span>.<span class="at">name</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="adapter-notifications-adapter_notifications">Adapter notifications {: #adapter_notifications }</h3>
<p>The <a href="/docs/extensions/reference/bluetooth/#event-onAdapterStateChanged">bluetooth.onAdapterStateChanged</a> event is sent whenever the adapter state changes. This can be used, for example, to determine when the adapter radio is powered on or off.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> powered <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">getAdapterState</span>(<span class="kw">function</span>(adapter) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">  powered <span class="op">=</span> <span class="va">adapter</span>.<span class="at">powered</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onAdapterStateChanged</span>.<span class="at">addListener</span>(</a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="kw">function</span>(adapter) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="cf">if</span> (<span class="va">adapter</span>.<span class="at">powered</span> <span class="op">!=</span> powered) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-9" title="9">      powered <span class="op">=</span> <span class="va">adapter</span>.<span class="at">powered</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" title="10">      <span class="cf">if</span> (powered) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-11" title="11">        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Adapter radio is on&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-12" title="12">      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-13" title="13">        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Adapter radio is off&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-14" title="14">      <span class="op">}</span></a>
<a class="sourceLine" id="cb5-15" title="15">    <span class="op">}</span></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="device-information-device_info">Device information {: #device_info }</h2>
<h3 id="listing-known-devices-listing_devices">Listing known devices {: #listing_devices }</h3>
<p>To get a list of the devices known to the Bluetooth adapter, use the <a href="/docs/extensions/reference/bluetooth/#method-getDevices">bluetooth.getDevices</a> method:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">getDevices</span>(<span class="kw">function</span>(devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">devices</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(devices[i].<span class="at">address</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>All devices are returned, including paired devices and devices recently discovered. It will not begin discovery of new devices (see <a href="#discovery">Discovering nearby devices</a>).</p>
<h3 id="receiving-device-notifications-device_notifications">Receiving device notifications {: #device_notifications }</h3>
<p>Instead of repeatedly calling <a href="/docs/extensions/reference/bluetooth/#method-getDevices">bluetooth.getDevices</a>, you can use the <a href="/docs/extensions/reference/bluetooth/#event-onDeviceAdded">bluetooth.onDeviceAdded</a>, <a href="/docs/extensions/reference/bluetooth/#event-onDeviceChanged">bluetooth.onDeviceChanged</a> and <a href="/docs/extensions/reference/bluetooth/#event-onDeviceRemoved">bluetooth.onDeviceRemoved</a> events to receive notifications.</p>
<p>The <a href="/docs/extensions/reference/bluetooth/#event-onDeviceAdded">bluetooth.onDeviceAdded</a> event is sent whenever a device is discovered by the adapter or makes a connection to the adapter:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onDeviceAdded</span>.<span class="at">addListener</span>(<span class="kw">function</span>(device) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">device</span>.<span class="at">address</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Adding a listener for this event does not begin discovery of devices (see <a href="#discovery">Discovering nearby devices</a>).</p>
<p>Changes to devices, including previously discovered devices becoming paired, are notified by the <a href="/docs/extensions/reference/bluetooth/#event-onDeviceChanged">bluetooth.onDeviceChanged</a> event:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onDeviceChanged</span>.<span class="at">addListener</span>(<span class="kw">function</span>(device) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">device</span>.<span class="at">address</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Finally the <a href="/docs/extensions/reference/bluetooth/#event-onDeviceRemoved">bluetooth.onDeviceRemoved</a> event is sent whenever a paired device is removed from the system, or a discovered device has not been seen recently:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onDeviceRemoved</span>.<span class="at">addListener</span>(<span class="kw">function</span>(device) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">device</span>.<span class="at">address</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="discovering-nearby-devices-discovery">Discovering nearby devices {: #discovery }</h3>
<p>To begin discovery of nearby devices, use the <a href="/docs/extensions/reference/bluetooth/#method-startDiscovery">bluetooth.startDiscovery</a> method. Discovery can be resource intensive so you should call <a href="/docs/extensions/reference/bluetooth/#method-stopDiscovery">bluetooth.stopDiscovery</a> when done.</p>
<p>You should call <a href="/docs/extensions/reference/bluetooth/#method-startDiscovery">bluetooth.startDiscovery</a> whenever your app needs to discover nearby devices. Do not make the call conditional on the <code>discovering</code> property of <a href="/docs/extensions/reference/bluetooth/#type-AdapterState">bluetooth.AdapterState</a>. The call will succeed even if another app is discovering nearby devices, and will ensure the adapter continues to perform discovery after that other app has stopped.</p>
<p>Information about each newly discovered device is received using the <a href="/docs/extensions/reference/bluetooth/#event-onDeviceAdded">bluetooth.onDeviceAdded</a> event. For devices that have already been discovered recently, or have been previously paired with or connected to, the event will not be sent. Instead you should call <a href="/docs/extensions/reference/bluetooth/#method-getDevices">bluetooth.getDevices</a> to obtain the current information, and use the <a href="/docs/extensions/reference/bluetooth/#event-onDeviceChanged">bluetooth.onDeviceChanged</a> event to be notified of changes to that information as a result of discovery.</p>
<p>Example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">var</span> device_names <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">var</span> updateDeviceName <span class="op">=</span> <span class="kw">function</span>(device) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">  device_names[<span class="va">device</span>.<span class="at">address</span>] <span class="op">=</span> <span class="va">device</span>.<span class="at">name</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">var</span> removeDeviceName <span class="op">=</span> <span class="kw">function</span>(device) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="kw">delete</span> device_names[<span class="va">device</span>.<span class="at">address</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">// Add listeners to receive newly found devices and updates</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">// to the previously known devices.</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onDeviceAdded</span>.<span class="at">addListener</span>(updateDeviceName)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onDeviceChanged</span>.<span class="at">addListener</span>(updateDeviceName)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onDeviceRemoved</span>.<span class="at">addListener</span>(removeDeviceName)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-14" title="14"></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">// With the listeners in place, get the list of devices found in</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">// previous discovery sessions, or any currently active ones,</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">// along with paired devices.</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">getDevices</span>(<span class="kw">function</span>(devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-19" title="19">  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">devices</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-20" title="20">    <span class="at">updateDeviceName</span>(devices[i])<span class="op">;</span></a>
<a class="sourceLine" id="cb10-21" title="21">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-23" title="23"></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">// Now begin the discovery process.</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">startDiscovery</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-26" title="26">  <span class="co">// Stop discovery after 30 seconds.</span></a>
<a class="sourceLine" id="cb10-27" title="27">  <span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-28" title="28">    <span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">stopDiscovery</span>(<span class="kw">function</span>() <span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-29" title="29">  <span class="op">},</span> <span class="dv">30000</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>If the user turns off the Bluetooth radio, all discovery sessions will be ended and not resumed automatically when the radio is switched on. If this matters to your app, you should watch the <a href="/docs/extensions/reference/bluetooth/#event-onAdapterStateChanged">bluetooth.onAdapterStateChanged</a> event. If the <code>discovering</code> property changes to <code>false</code>, then your app will need to call <a href="/docs/extensions/reference/bluetooth/#method-startDiscovery">bluetooth.startDiscovery</a> again to resume. Be cautious of the resource intensive nature of discovery.</p>
<h3 id="identifying-devices-identifying_devices">Identifying devices {: #identifying_devices }</h3>
<p>A number of different options are provided for identifying devices returned by <a href="/docs/extensions/reference/bluetooth/#method-getDevices">bluetooth.getDevices</a> and the related events.</p>
<p>If the device supports the Bluetooth <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/DI.aspx">Device ID specification</a>, several properties are added to the Device object containing the fields defined by that specification. Example:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">getDevices</span>(<span class="kw">function</span>(devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">devices</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-3" title="3">    <span class="cf">if</span> (devices[<span class="dv">0</span>].<span class="at">vendorIdSource</span> <span class="op">!=</span> <span class="kw">undefined</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-4" title="4">      <span class="va">console</span>.<span class="at">log</span>(devices[<span class="dv">0</span>].<span class="at">address</span> <span class="op">+</span> <span class="st">&#39; = &#39;</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb11-5" title="5">                  devices[<span class="dv">0</span>].<span class="at">vendorIdSource</span> <span class="op">+</span> <span class="st">&#39;:&#39;</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb11-6" title="6">                  devices[<span class="dv">0</span>].<span class="va">vendorId</span>.<span class="at">toString</span>(<span class="dv">16</span>) <span class="op">+</span> <span class="st">&#39;:&#39;</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb11-7" title="7">                  devices[<span class="dv">0</span>].<span class="va">productId</span>.<span class="at">toString</span>(<span class="dv">16</span>) <span class="op">+</span> <span class="st">&#39;:&#39;</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb11-8" title="8">                  devices[<span class="dv">0</span>].<span class="va">deviceId</span>.<span class="at">toString</span>(<span class="dv">16</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb11-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The Device ID specification is usually sufficient to identify a particular model, and even revision, of a device from a vendor. Where it is not present, you must instead rely on information about the class or type of the device, optionally combined with the manufacturer prefix in the <code>address</code>.</p>
<p>Most Bluetooth devices provide Class of Device information as a bit-field interpreted according to the <a href="https://www.bluetooth.org/en-us/specification/assigned-numbers/baseband">Baseband Assigned Numbers</a> document. This bit-field is available in the <code>deviceClass</code> property.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">getDevices</span>(<span class="kw">function</span>(devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">devices</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-3" title="3">    <span class="cf">if</span> (devices[<span class="dv">0</span>].<span class="at">vendorIdSource</span> <span class="op">!=</span> <span class="kw">undefined</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">      <span class="va">console</span>.<span class="at">log</span>(devices[<span class="dv">0</span>].<span class="at">address</span> <span class="op">+</span> <span class="st">&#39; = &#39;</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb12-5" title="5">                  devices[<span class="dv">0</span>].<span class="va">deviceClass</span>.<span class="at">toString</span>(<span class="dv">16</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb12-6" title="6">    <span class="op">}</span></a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Parsing the field can be complex so for the most common device types Chrome handles this for you and sets the <code>type</code> field. Where this is not available, or insufficient for your needs, you’ll need to parse the <code>deviceClass</code> yourself.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="at">getDevices</span>(<span class="kw">function</span>(devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">devices</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-3" title="3">    <span class="cf">if</span> (devices[<span class="dv">0</span>].<span class="at">vendorIdSource</span> <span class="op">!=</span> <span class="kw">undefined</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-4" title="4">      <span class="va">console</span>.<span class="at">log</span>(devices[<span class="dv">0</span>].<span class="at">address</span> <span class="op">+</span> <span class="st">&#39; = &#39;</span> <span class="op">+</span> devices[<span class="dv">0</span>].<span class="at">type</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5">    <span class="op">}</span></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="using-rfcomm-and-l2cap-using_rfcomm">Using RFCOMM and L2CAP {: #using_rfcomm }</h2>
<p>Chrome Apps may make connections to any device that supports RFCOMM or L2CAP services. This includes the majority of classic Bluetooth devices on the market.</p>
<h3 id="connecting-to-a-socket-connecting">Connecting to a socket {: #connecting }</h3>
<p>In order to make a connection to a device you need three things. A socket to make the connection with, created using <a href="/docs/extensions/reference/bluetoothSocket#method-create">bluetoothSocket.create</a>; the address of the device you wish to connect to, and the UUID of the service itself.</p>
<p>Before making the connection you should verify that the adapter is aware of the device by using <a href="/docs/extensions/reference/bluetooth/#method-getDevice">bluetooth.getDevice</a> or the device discovery APIs.</p>
<p>The information necessary to establish the underlying connection, including whether the RFCOMM or L2CAP protocol should be used and which channel or PSM, is obtained using SDP discovery on the device.</p>
<p>Example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">var</span> uuid <span class="op">=</span> <span class="st">&#39;1105&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">var</span> onConnectedCallback <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="cf">if</span> (<span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">lastError</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-4" title="4">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Connection failed: &quot;</span> <span class="op">+</span> <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">lastError</span>.<span class="at">message</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-6" title="6">    <span class="co">// Profile implementation here.</span></a>
<a class="sourceLine" id="cb14-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb14-9" title="9"></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">create</span>(<span class="kw">function</span>(createInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-11" title="11">  <span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">connect</span>(<span class="va">createInfo</span>.<span class="at">socketId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-12" title="12">    <span class="va">device</span>.<span class="at">address</span><span class="op">,</span> uuid<span class="op">,</span> onConnectedCallback)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Keep a handle to the socketId so that you can later send data (<a href="/docs/extensions/reference/bluetoothSocket#method-send">bluetoothSocket.send</a>) to this socket.</p>
<h3 id="receiving-from-and-sending-to-a-socket-receiving">Receiving from and sending to a socket {: #receiving }</h3>
<p>Receiving data from and sending to a socket uses <code>ArrayBuffer</code> objects. To learn about ArrayBuffers, check out the overview, <a href="https://developer.mozilla.org/en-US/docs/JavaScript_typed_arrays">JavaScript typed arrays</a>, and the tutorial, <a href="https://updates.html5rocks.com/2012/06/How-to-convert-ArrayBuffer-to-and-from-String">How to convert ArrayBuffer to and from String</a>.</p>
<p>To send data you have in <code>arrayBuffer</code> use <a href="/docs/extensions/reference/bluetoothSocket#method-send">bluetoothSocket.send</a>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">send</span>(socketId<span class="op">,</span> arrayBuffer<span class="op">,</span> <span class="kw">function</span>(bytes_sent) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="cf">if</span> (<span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">lastError</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Send failed: &quot;</span> <span class="op">+</span> <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">lastError</span>.<span class="at">message</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-5" title="5">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Sent &quot;</span> <span class="op">+</span> bytes_sent <span class="op">+</span> <span class="st">&quot; bytes&quot;</span>)</a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="op">}</span>)</a></code></pre></div>
<p>In contrast to the method to send data, data is received in an event (<a href="/docs/extensions/reference/bluetoothSocket#event-onReceive">bluetoothSocket.onReceive</a>. Sockets are created unpaused (see <a href="/docs/extensions/reference/bluetoothSocket#method-setPaused">bluetoothSocket.setPaused</a>) so the listener for this event is typically added between <a href="/docs/extensions/reference/bluetoothSocket#method-create">bluetoothSocket.create</a> and <a href="/docs/extensions/reference/bluetoothSocket#method-connect">bluetoothSocket.connect</a>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="va">onRecieve</span>.<span class="at">addListener</span>(<span class="kw">function</span>(receiveInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="cf">if</span> (<span class="va">receiveInfo</span>.<span class="at">socketId</span> <span class="op">!=</span> socketId)</a>
<a class="sourceLine" id="cb16-3" title="3">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="co">// receiveInfo.data is an ArrayBuffer.</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="receiving-socket-errors-and-disconnection-errors">Receiving socket errors and disconnection {: #errors }</h3>
<p>To be notified of socket errors, including disconnection, add a listener to the <a href="/docs/extensions/reference/bluetoothSocket#event-onReceiveError">bluetoothSocket.onReceiveError</a> event.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="va">onReceiveError</span>.<span class="at">addListener</span>(<span class="kw">function</span>(errorInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="co">// Cause is in errorInfo.error.</span></a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">errorInfo</span>.<span class="at">errorMessage</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="disconnecting-from-a-socket-disconnection">Disconnecting from a socket {: #disconnection }</h3>
<p>To hang up the connection and disconnect the socket use <a href="/docs/extensions/reference/bluetoothSocket#method-disconnect">bluetoothSocket.disconnect</a>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">disconnect</span>(socketId)<span class="op">;</span></a></code></pre></div>
<h2 id="publishing-services">Publishing services</h2>
<p>In addition to making outbound connections to devices, Chrome Apps may publish services that may be used by any device that supports RFCOMM or L2CAP.</p>
<h3 id="listening-on-a-socket-listening">Listening on a socket {: #listening }</h3>
<p>Two types of published service are supported. RFCOMM is the most commonly used and covers the majority of devices and profiles:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">var</span> uuid <span class="op">=</span> <span class="st">&#39;1105&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">create</span>(<span class="kw">function</span>(createInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb19-3" title="3">  <span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">listenUsingRfcomm</span>(<span class="va">createInfo</span>.<span class="at">socketId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb19-4" title="4">    uuid<span class="op">,</span> onListenCallback)<span class="op">;</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>L2CAP is the other and covers other device types and vendor-specific uses such as firmware uploading.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">var</span> uuid <span class="op">=</span> <span class="st">&#39;0b87367c-f188-47cd-bc20-a5f4f70973c6&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">create</span>(<span class="kw">function</span>(createInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">listenUsingL2cap</span>(<span class="va">createInfo</span>.<span class="at">socketId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb20-4" title="4">    uuid<span class="op">,</span> onListenCallback)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>In both cases an optional <a href="/docs/extensions/reference/bluetoothSocket#type-ListenOptions">bluetoothSocket.ListenOptions</a> may be passed to allocate a specific channel or PSM. The callback indicates error through <code>chrome.runtime.lastError</code> and success otherwise. Keep a handle to the socketId so that you can later accept connections (<a href="/docs/extensions/reference/bluetoothSocket#event-onAccept">bluetoothSocket.onAccept</a>) from this socket.</p>
<h3 id="accepting-client-connections-accepting">Accepting client connections {: #accepting }</h3>
<p>Client connections are accepted and passed to your application through the <a href="/docs/extensions/reference/bluetoothSocket#event-onAccept">bluetoothSocket.onAccept</a> event.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="va">onAccept</span>.<span class="at">addListener</span>(<span class="kw">function</span>(acceptInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb21-2" title="2">  <span class="cf">if</span> (<span class="va">info</span>.<span class="at">socketId</span> <span class="op">!=</span> serverSocketId)</a>
<a class="sourceLine" id="cb21-3" title="3">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb21-4" title="4"></a>
<a class="sourceLine" id="cb21-5" title="5">  <span class="co">// Say hello...</span></a>
<a class="sourceLine" id="cb21-6" title="6">  <span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">send</span>(<span class="va">acceptInfo</span>.<span class="at">clientSocketId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb21-7" title="7">    data<span class="op">,</span> onSendCallback)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-8" title="8"></a>
<a class="sourceLine" id="cb21-9" title="9">  <span class="co">// Accepted sockets are initially paused,</span></a>
<a class="sourceLine" id="cb21-10" title="10">  <span class="co">// set the onReceive listener first.</span></a>
<a class="sourceLine" id="cb21-11" title="11">  <span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="va">onReceive</span>.<span class="at">addListener</span>(onReceive)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-12" title="12">  <span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">setPaused</span>(<span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-13" title="13"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="stop-accepting-client-connections-stop-accepting">Stop accepting client connections {: #stop-accepting }</h3>
<p>To stop accepting client connections and unpublish the service use <a href="/docs/extensions/reference/bluetoothSocket#method-disconnect">bluetoothSocket.disconnect</a>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothSocket</span>.<span class="at">disconnect</span>(serverSocketId)<span class="op">;</span></a></code></pre></div>
<h2 id="interacting-with-low-energy-devices-low-energy">Interacting with Low Energy devices {: #low-energy }</h2>
<p>Bluetooth Low Energy or (Bluetooth Smart) is a wireless technology aimed at reduced power consumption. The <a href="/docs/extensions/reference/bluetoothLowEnergy">Bluetooth Low Energy</a> API allows applications to implement the central role in a LE connection to a peripheral. The following sections describe how to discover, connect to, and interact with Bluetooth Low Energy peripherals.</p>
<h3 id="discovering-and-connecting-to-peripherals-le-discovery">Discovering and connecting to peripherals {: #le-discovery }</h3>
<p>As with traditional Bluetooth devices, LE peripherals can be discovered using the methods described in <a href="#discovery">Discovering nearby devices</a> . An LE device makes itself discoverable by sending data packets called “Advertising Data” and the device is said to be in <em>advertising mode</em>. The advertising data may contain UUIDs of services that are available on the device. If present, these UUIDs will be accessible using the <code>uuids</code> property of the corresponding <a href="/docs/extensions/reference/bluetooth/#type-Device">bluetooth.Device</a> object.</p>
<p>Once discovered, an LE device can be connected to by calling <a href="/docs/extensions/reference/bluetoothLowEnergy#method-connect">bluetoothLowEnergy.connect</a> so that the application can interact with its services:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1"><span class="va">chrome</span>.<span class="va">bluetooth</span>.<span class="va">onDeviceAdded</span>.<span class="at">addListener</span>(<span class="kw">function</span>(device) <span class="op">{</span></a>
<a class="sourceLine" id="cb23-2" title="2">  <span class="kw">var</span> uuid <span class="op">=</span> <span class="st">&#39;0000180d-0000-1000-8000-00805f9b34fb&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="cf">if</span> (<span class="op">!</span><span class="va">device</span>.<span class="at">uuids</span> <span class="op">||</span> <span class="va">device</span>.<span class="va">uuids</span>.<span class="at">indexOf</span>(uuid) <span class="op">&lt;</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb23-4" title="4">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb23-5" title="5"></a>
<a class="sourceLine" id="cb23-6" title="6">  <span class="co">// The device has a service with the desired UUID.</span></a>
<a class="sourceLine" id="cb23-7" title="7">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">connect</span>(<span class="va">device</span>.<span class="at">address</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb23-8" title="8">    <span class="cf">if</span> (<span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">lastError</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb23-9" title="9">      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Failed to connect: &#39;</span> <span class="op">+</span> <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">lastError</span>.<span class="at">message</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-10" title="10">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb23-11" title="11">    <span class="op">}</span></a>
<a class="sourceLine" id="cb23-12" title="12"></a>
<a class="sourceLine" id="cb23-13" title="13">    <span class="co">// Connected! Do stuff...</span></a>
<a class="sourceLine" id="cb23-14" title="14">    ...</a>
<a class="sourceLine" id="cb23-15" title="15">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-16" title="16"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Once connected, the <code>connected</code> property of the corresponding <a href="/docs/extensions/reference/bluetooth/#type-Device">bluetooth.Device</a> object will have the value <code>true</code>. Calling <a href="/docs/extensions/reference/bluetoothLowEnergy#method-connect">bluetoothLowEnergy.connect</a> establishes a claim by the application on the physical connection to the device. A physical connection to the device can exist without ever calling <a href="/docs/extensions/reference/bluetoothLowEnergy#method-connect">bluetoothLowEnergy.connect</a> (for example due to another application). In this case, while your application can still interact with the services of the device, it should always call <a href="/docs/extensions/reference/bluetoothLowEnergy#method-connect">bluetoothLowEnergy.connect</a> to prevent another application from disconnecting the physical link.</p>
<p>Once your application no longer needs to be connected, it can remove its claim on the connection by calling <a href="/docs/extensions/reference/bluetoothLowEnergy#method-disconnect">bluetoothLowEnergy.disconnect</a>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">disconnect</span>(deviceAddress)<span class="op">;</span></a></code></pre></div>
<p>Note that this won’t necessarily destroy the physical link to the device, as there may be other applications who have active connections to the device. Sometimes the device might become disconnected due to reasons that are beyond the control of the application (e.g. if the device disappears or gets explicitly disconnected by the user through utilities of the operating system). Your application should observe the <a href="/docs/extensions/reference/bluetooth/#event-onDeviceChanged">bluetooth.onDeviceChanged</a> event to get notified of changes to the connection and reconnect if necessary.</p>
<p>Once connected, the device that is running Chrome will be in the so called <em>central role</em>, while the remote device is said to be in the <em>peripheral role</em>. At this point, your application can interact with the services on the device using the methods described in the following section. <em>Note:</em> The APIs currently do not support acting as a LE peripheral; apps can only implement the central role.</p>
<h3 id="services-characteristics-and-descriptors-gatt">Services, Characteristics, and Descriptors {: #gatt }</h3>
<p>Bluetooth Low Energy is based on a simple request-response protocol called the <em>Attribute Protocol</em> (ATT). Using ATT, a central device interacts with the so called <em>attributes</em> on a peripheral device by conforming to a special Bluetooth profile called the <em>Generic Attribute Profile</em> (GATT). GATT defines the following high level concepts:</p>
<ul>
<li>Service: A GATT service represents a collection of data and associated behaviors to accomplish a particular function of a device. For example, a heart rate monitor will typically have at least one “Heart Rate Service”. Information about a GATT service is contained in a <a href="/docs/extensions/reference/bluetoothLowEnergy#type-Service">bluetoothLowEnergy.Service</a> object.</li>
<li>Characteristic: A GATT characteristic is a basic data element used to construct a GATT service, containing a value along with properties that define how that value can be accessed. For example, the “Heart Rate Service” has the “Heart Rate Measurement” characteristic, which is used to obtain the value of the user’s heart rate. Information about a GATT characteristic is contained in a <a href="/docs/extensions/reference/bluetoothLowEnergy#type-Characteristic">bluetoothLowEnergy.Characteristic</a> object.</li>
<li>Descriptor: A GATT characteristic descriptor contains further information about a characteristic. Information about a GATT characteristic descriptor is contained in a <a href="/docs/extensions/reference/bluetoothLowEnergy#type-Descriptor">bluetoothLowEnergy.Descriptor</a> object.</li>
</ul>
<p>The <a href="/docs/extensions/reference/bluetoothLowEnergy">Bluetooth Low Energy</a> API allows applications to find information about a device’s services, characteristics, and descriptors by calling <a href="/docs/extensions/reference/bluetoothLowEnergy#method-getServices">bluetoothLowEnergy.getServices</a>, <a href="/docs/extensions/reference/bluetoothLowEnergy#method-getCharacteristics">bluetoothLowEnergy.getCharacteristics</a>, and <a href="/docs/extensions/reference/bluetoothLowEnergy#method-getDescriptors">bluetoothLowEnergy.getDescriptors</a>. Apps can filter through services, characteristics, and descriptors by comparing their <code>uuid</code> field to the desired GATT UUID:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">getServices</span>(deviceAddress<span class="op">,</span> <span class="kw">function</span>(services) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" title="2">  ...</a>
<a class="sourceLine" id="cb25-3" title="3">  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">services</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-4" title="4">    <span class="cf">if</span> (services[i].<span class="at">uuid</span> <span class="op">==</span> HEART_RATE_SERVICE_UUID) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-5" title="5">      heartRateService <span class="op">=</span> services[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb25-6" title="6">      <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb25-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb25-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb25-9" title="9">  ...</a>
<a class="sourceLine" id="cb25-10" title="10"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Each service, characteristic, and descriptor accessible through the API is assigned a unique instance identifier, which can be obtained using the <code>instanceId</code> field. This instance ID can be used to identify a GATT object and to perform specific operations on it:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">getCharacteristics</span>(<span class="va">heartRateService</span>.<span class="at">instanceId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb26-2" title="2">                                             <span class="kw">function</span>(chracteristics) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-3" title="3">  ...</a>
<a class="sourceLine" id="cb26-4" title="4">  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">characteristics</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-5" title="5">    <span class="cf">if</span> (characteristics[i].<span class="at">uuid</span> <span class="op">==</span> HEART_RATE_MEASUREMENT_UUID) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-6" title="6">      measurementChar <span class="op">=</span> characteristics[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb26-7" title="7">      <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-8" title="8">    <span class="op">}</span></a>
<a class="sourceLine" id="cb26-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb26-10" title="10">  ...</a>
<a class="sourceLine" id="cb26-11" title="11">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">getDescriptors</span>(<span class="va">measurementChar</span>.<span class="at">instanceId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb26-12" title="12">                                           <span class="kw">function</span>(descriptors) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-13" title="13">    ...</a>
<a class="sourceLine" id="cb26-14" title="14">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb26-15" title="15"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="service-events-service-events">Service events {: #service-events }</h3>
<p>Once a device is connected, Chrome will discover its services. As each service is discovered and removed, the application will receive the <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onServiceAdded">bluetoothLowEnergy.onServiceAdded</a> and <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onServiceRemoved">bluetoothLowEnergy.onServiceRemoved</a> events:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1">  <span class="kw">var</span> initializeService <span class="op">=</span> <span class="kw">function</span>(service) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-2" title="2">    <span class="cf">if</span> (<span class="op">!</span>service) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-3" title="3">      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;No service selected!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-4" title="4">      <span class="co">// Reset UI, etc.</span></a>
<a class="sourceLine" id="cb27-5" title="5">      ...</a>
<a class="sourceLine" id="cb27-6" title="6">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb27-8" title="8"></a>
<a class="sourceLine" id="cb27-9" title="9">    myService <span class="op">=</span> service<span class="op">;</span></a>
<a class="sourceLine" id="cb27-10" title="10"></a>
<a class="sourceLine" id="cb27-11" title="11">    <span class="co">// Get all the characteristics and descriptors and bootstrap the app.</span></a>
<a class="sourceLine" id="cb27-12" title="12">    ...</a>
<a class="sourceLine" id="cb27-13" title="13">  <span class="op">};</span></a>
<a class="sourceLine" id="cb27-14" title="14"></a>
<a class="sourceLine" id="cb27-15" title="15">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="va">onServiceAdded</span>.<span class="at">addListener</span>(<span class="kw">function</span>(service) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-16" title="16">    <span class="cf">if</span> (<span class="va">service</span>.<span class="at">uuid</span> <span class="op">==</span> MY_SERVICE_UUID)</a>
<a class="sourceLine" id="cb27-17" title="17">      <span class="at">initializeService</span>(service)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-18" title="18">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-19" title="19"></a>
<a class="sourceLine" id="cb27-20" title="20">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="va">onServiceRemoved</span>.<span class="at">addListener</span>(<span class="kw">function</span>(service) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-21" title="21">    <span class="cf">if</span> (<span class="va">service</span>.<span class="at">instanceId</span> <span class="op">==</span> <span class="va">myService</span>.<span class="at">instanceId</span>)</a>
<a class="sourceLine" id="cb27-22" title="22">      <span class="at">initializeService</span>(<span class="kw">null</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-23" title="23">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Chrome discovers all characteristics and descriptors of a service asynchronously and sends the <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onServiceAdded">bluetoothLowEnergy.onServiceAdded</a> event once discovery has completed. If the connection to a peripheral terminates, Chrome removes all related services and sends the <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onServiceRemoved">bluetoothLowEnergy.onServiceRemoved</a> event.</p>
<p>Some peripherals may modify their services, e.g. the characteristics of a service may change or services may get added and removed entirely. Chrome notifies apps of these changes using the <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onServiceChanged">bluetoothLowEnergy.onServiceChanged</a>, <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onServiceAdded">bluetoothLowEnergy.onServiceAdded</a>, and <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onServiceRemoved">bluetoothLowEnergy.onServiceRemoved</a> events.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb28-1" title="1">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="va">onServiceChanged</span>.<span class="at">addListener</span>(<span class="kw">function</span>(service) <span class="op">{</span></a>
<a class="sourceLine" id="cb28-2" title="2">    <span class="cf">if</span> (<span class="va">service</span>.<span class="at">instanceId</span> <span class="op">!=</span> <span class="va">myService</span>.<span class="at">instanceId</span>)</a>
<a class="sourceLine" id="cb28-3" title="3">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb28-4" title="4"></a>
<a class="sourceLine" id="cb28-5" title="5">    <span class="at">updateMyService</span>(service)<span class="op">;</span></a>
<a class="sourceLine" id="cb28-6" title="6">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="reading-and-writing-a-characteristics-value-gatt-read-write">Reading and writing a characteristic’s value {: #gatt-read-write }</h3>
<p>A GATT characteristic encodes one aspect of its service. A central app reads, acts on, and modifies the state of a peripheral’s service by operating on a characteristic’s value. The characteristic value is a sequence of bytes and its meaning is defined by the high-level specification that defines a certain characteristic. For example, the value of the <em>Heart Rate Measurement</em> characteristic encodes the user’s heart rate and the total amount of calories they burned, while the <em>Body Sensor Location</em> characteristic encodes where in the body the heart rate sensor should be worn.</p>
<p>Chrome provides the <a href="/docs/extensions/reference/bluetoothLowEnergy#method-readCharacteristicValue">bluetoothLowEnergy.readCharacteristicValue</a> method to read the value of a characteristic:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1"><span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">readCharacteristicValue</span>(<span class="va">chrc</span>.<span class="at">instanceId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-2" title="2">                                                  <span class="kw">function</span>(result) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-3" title="3">  <span class="cf">if</span> (<span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">lastError</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-4" title="4">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Failed to read value: &#39;</span> <span class="op">+</span> <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">lastError</span>.<span class="at">message</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-5" title="5">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb29-7" title="7"></a>
<a class="sourceLine" id="cb29-8" title="8">  <span class="kw">var</span> bytes <span class="op">=</span> <span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="va">result</span>.<span class="at">value</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-9" title="9"></a>
<a class="sourceLine" id="cb29-10" title="10">  <span class="co">// Do stuff with the bytes.</span></a>
<a class="sourceLine" id="cb29-11" title="11">  ...</a>
<a class="sourceLine" id="cb29-12" title="12"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Some characteristics are writable, especially those that behave as “Control Points”, where writing the value has side effects. For example, the <em>Heart Rate Control Point</em> characteristic is used to tell a heart rate sensor to reset its count of total calories burned and only supports writes. To achieve this, Chrome provides the <a href="/docs/extensions/reference/bluetoothLowEnergy#method-writeCharacteristicValue">bluetoothLowEnergy.writeCharacteristicValue</a> method:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">var</span> myBytes <span class="op">=</span> <span class="kw">new</span> <span class="at">Uint8Array</span>([ ... ])<span class="op">;</span></a>
<a class="sourceLine" id="cb30-2" title="2"><span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">writeCharacteristicValue</span>(<span class="va">chrc</span>.<span class="at">instanceId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-3" title="3">                                                   <span class="va">myBytes</span>.<span class="at">buffer</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-4" title="4">                                                   <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb30-5" title="5">  <span class="cf">if</span> (<span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">lastError</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-6" title="6">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Failed to write value: &#39;</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb30-7" title="7">                <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">lastError</span>.<span class="at">message</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-8" title="8">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb30-10" title="10"></a>
<a class="sourceLine" id="cb30-11" title="11">  <span class="co">// Value is written now.</span></a>
<a class="sourceLine" id="cb30-12" title="12"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Characteristic descriptors behave the same way and can be readable and/or writable. Chrome provides the <a href="/docs/extensions/reference/bluetoothLowEnergy#method-readDescriptorValue">bluetoothLowEnergy.readDescriptorValue</a> and <a href="/docs/extensions/reference/bluetoothLowEnergy#method-writeDescriptorValue">bluetoothLowEnergy.writeDescriptorValue</a> methods to read and write the value of a descriptor.</p>
<p>To check if a characteristic supports reads or writes, an application can check the <code>properties</code> field of a <a href="/docs/extensions/reference/bluetoothLowEnergy#type-Characteristic">bluetoothLowEnergy.Characteristic</a> object. While this field does not contain information about the security requirements to access a value, it does describe which value operation the characteristic supports in general.</p>
<h3 id="handling-value-notifications-gatt-notifications">Handling value notifications {: #gatt-notifications }</h3>
<p>Some characteristics make their value known using notifications or indications. For example the <em>Heart Rate Measurement</em> characteristic is neither readable nor writable but sends updates on its current value at regular intervals. Applications can listen to these notifications using the <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onCharacteristicValueChanged">bluetoothLowEnergy.onCharacteristicValueChanged</a> event.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" title="1">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="va">onCharacteristicValueChanged</span>.<span class="at">addListener</span>(</a>
<a class="sourceLine" id="cb31-2" title="2">      <span class="kw">function</span>(chrc) <span class="op">{</span></a>
<a class="sourceLine" id="cb31-3" title="3">    <span class="cf">if</span> (<span class="va">chrc</span>.<span class="at">instanceId</span> <span class="op">!=</span> myCharId)</a>
<a class="sourceLine" id="cb31-4" title="4">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb31-5" title="5"></a>
<a class="sourceLine" id="cb31-6" title="6">    <span class="kw">var</span> bytes <span class="op">=</span> <span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="va">chrc</span>.<span class="at">value</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb31-7" title="7"></a>
<a class="sourceLine" id="cb31-8" title="8">    <span class="co">// Do stuff with the bytes.</span></a>
<a class="sourceLine" id="cb31-9" title="9">    ...</a>
<a class="sourceLine" id="cb31-10" title="10">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Even if a characteristic supports notifications/indications, they aren’t enabled by default. An application should call the <a href="/docs/extensions/reference/bluetoothLowEnergy#method-startCharacteristicNotifications">bluetoothLowEnergy.startCharacteristicNotifications</a> and <a href="/docs/extensions/reference/bluetoothLowEnergy#method-stopCharacteristicNotifications">bluetoothLowEnergy.stopCharacteristicNotifications</a> methods to start or stop receiving the <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onCharacteristicValueChanged">bluetoothLowEnergy.onCharacteristicValueChanged</a> event.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb32-1" title="1">  <span class="co">// Start receiving characteristic value notifications.</span></a>
<a class="sourceLine" id="cb32-2" title="2">  <span class="kw">var</span> notifying <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb32-3" title="3">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">startCharacteristicNotifications</span>(<span class="va">chrc</span>.<span class="at">instanceId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb32-4" title="4">                                                             <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb32-5" title="5">    <span class="cf">if</span> (<span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">lastError</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb32-6" title="6">      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Failed to enable notifications: &#39;</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb32-7" title="7">                  <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">lastError</span>.<span class="at">message</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb32-8" title="8">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb32-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb32-10" title="10"></a>
<a class="sourceLine" id="cb32-11" title="11">    notifying <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb32-12" title="12">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb32-13" title="13"></a>
<a class="sourceLine" id="cb32-14" title="14">  ...</a>
<a class="sourceLine" id="cb32-15" title="15"></a>
<a class="sourceLine" id="cb32-16" title="16">  <span class="co">// No longer interested in notifications from this characteristic.</span></a>
<a class="sourceLine" id="cb32-17" title="17">  <span class="cf">if</span> (notifying) <span class="op">{</span></a>
<a class="sourceLine" id="cb32-18" title="18">    <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">stopCharacteristicNotifications</span>(</a>
<a class="sourceLine" id="cb32-19" title="19">        <span class="va">chrc</span>.<span class="at">instanceId</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb32-20" title="20">  <span class="op">}</span></a></code></pre></div>
<p>Once notifications are started, the application will receive the <a href="/docs/extensions/reference/bluetoothLowEnergy#event-onCharacteristicValueChanged">bluetoothLowEnergy.onCharacteristicValueChanged</a> every time a notification or indication is received from the characteristic. If the characteristic supports reads, then this event will also be sent after a successful call to <a href="/docs/extensions/reference/bluetoothLowEnergy#method-readCharacteristicValue">bluetoothLowEnergy.readCharacteristicValue</a>. This allows apps to unify the control flow of a value update triggered through a read request and notifications:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" title="1">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="va">onCharacteristicValueChanged</span>.<span class="at">addListener</span>(</a>
<a class="sourceLine" id="cb33-2" title="2">      <span class="kw">function</span>(chrc) <span class="op">{</span></a>
<a class="sourceLine" id="cb33-3" title="3">    <span class="co">// Process the value.</span></a>
<a class="sourceLine" id="cb33-4" title="4">    ...</a>
<a class="sourceLine" id="cb33-5" title="5">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb33-6" title="6"></a>
<a class="sourceLine" id="cb33-7" title="7">  <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">startCharacteristicNotifications</span>(<span class="va">chrc</span>.<span class="at">instanceId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-8" title="8">                                                             <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb33-9" title="9">    <span class="co">// Notifications started. Read the initial value.</span></a>
<a class="sourceLine" id="cb33-10" title="10">    <span class="va">chrome</span>.<span class="va">bluetoothLowEnergy</span>.<span class="at">readCharacteristicValue</span>(<span class="va">chrc</span>.<span class="at">instanceId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-11" title="11">                                                      <span class="kw">function</span>(result) <span class="op">{</span></a>
<a class="sourceLine" id="cb33-12" title="12">      ...</a>
<a class="sourceLine" id="cb33-13" title="13">      <span class="co">// No need to do anything here since onCharacteristicValueChanged</span></a>
<a class="sourceLine" id="cb33-14" title="14">      <span class="co">// will handle it.</span></a>
<a class="sourceLine" id="cb33-15" title="15">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb33-16" title="16">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>If a characteristic supports notifications, its <code>properties</code> field will contain either the <code>"notify"</code> or <code>"indicate"</code> property.</p>
<p>NOTE: If a characteristic supports notifications/indications, it will have the “Client Characteristic Configuration” descriptor to enable/disable notifications. Chrome does not permit apps to write to this descriptor. Apps should instead use the <a href="/docs/extensions/reference/bluetoothLowEnergy#method-startCharacteristicNotifications">bluetoothLowEnergy.startCharacteristicNotifications</a> and <a href="/docs/extensions/reference/bluetoothLowEnergy#method-stopCharacteristicNotifications">bluetoothLowEnergy.stopCharacteristicNotifications</a> methods to control notification behavior.</p>
</body>
</html>
