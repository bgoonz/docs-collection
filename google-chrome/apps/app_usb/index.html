<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="dcterms.date" content="2012-09-17" />
    <title>USB Devices</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">USB Devices</h1>
      <p class="date">2012-09-17</p>
    </header>
    <p>{% Aside ‘caution’ %}</p>
    <p>
      <strong>Important:</strong> Chrome will be removing support for Chrome
      Apps on all platforms. Chrome browser and the Chrome Web Store will
      continue to support extensions.
      <a
        href="https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html"
        ><strong>Read the announcement</strong></a
      >
      and learn more about
      <a href="/apps/migration"><strong>migrating your app</strong></a
      >.
    </p>
    <p>{% endAside %}</p>
    <p>
      This document describes how to use the <a href="usb">USB API</a> to
      communicate with USB devices. Some devices are not accessible through the
      USB API (see the <a href="#caveats">Caveats</a> section below for
      details). Chrome Apps can also connect to <a href="serial">serial</a> and
      <a href="bluetooth">Bluetooth</a> devices.
    </p>
    <p>{% Aside %}</p>
    <p>
      <strong>Samples:</strong> For examples that illustrate how Chrome Apps can
      connect to hardware devices, see the
      <a
        href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/samples/serial"
        >serial</a
      >,
      <a
        href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/samples/servo"
        >servo</a
      >, and
      <a
        href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/samples/usb"
        >usb</a
      >
      samples.
    </p>
    <p>{% endAside %}</p>
    <p>
      For background information about USB, see the official
      <a href="http://www.usb.org/home">USB specifications</a>.<br />
      <a href="http://www.beyondlogic.org/usbnutshell/usb1.shtml"
        ><em>USB in a NutShell</em></a
      >
      is a reasonable crash course that you may find helpful.
    </p>
    <h2 id="manifest-requirement-manifest">
      Manifest requirement {: #manifest }
    </h2>
    <p>The USB API requires the “usb” permission in the manifest file:</p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="er">&quot;permissions&quot;:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="st">&quot;usb&quot;</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ot">]</span></a></code></pre>
    </div>
    <p>
      In addition, in order to prevent
      <a href="http://en.wikipedia.org/wiki/Device_fingerprint"
        >finger-printing</a
      >, you must declare all the device types you want to access in the
      manifest file. Each type of USB device corresponds to a vendor id/product
      id (VID/PID) pair. You can use
      <a href="/apps/usb#method-getDevices">usb.getDevices</a> to enumerate
      devices by their VID/PID pair.
    </p>
    <p>
      You must declare the VID/PID pairs for each type of device you want to use
      under the <code>usbDevices</code> permission in your app’s manifest file,
      as shown in the example below:
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="er">&quot;permissions&quot;:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="dt">&quot;usbDevices&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-4" title="4">      <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">        <span class="dt">&quot;vendorId&quot;</span><span class="fu">:</span> <span class="dv">123</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-6" title="6">        <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="dv">456</span></a>
<a class="sourceLine" id="cb2-7" title="7">      <span class="fu">}</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="ot">]</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="ot">]</span></a></code></pre>
    </div>
    <p>{% Aside %}</p>
    <p>
      Note that only decimal numbers are allowed in JSON format. You cannot use
      hexadecimal numbers in these fields.
    </p>
    <p>{% endAside %}</p>
    <p>
      Since <strong>Chrome 57</strong>, the requirement for declaring all the
      device types in the app manifest is relaxed for apps running as Chrome OS
      <a href="apps/manifest/kiosk_enabled">kiosk apps</a>. For kiosk apps, you
      can use the <code>interfaceClass</code> permission property to request
      permission to access USB devices that:
    </p>
    <ul>
      <li>implement a USB interface of a specific interface class</li>
      <li>have a specific USB device class</li>
    </ul>
    <p>
      For example, the following <code>usbDevices</code> permission would grant
      an app access to all USB devices that implement a printer interface
      (interface class code 7), and to USB hub devices (device class code 9):
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="er">&quot;permissions&quot;:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">&quot;usbDevices&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb3-4" title="4">      <span class="fu">{</span><span class="dt">&quot;interfaceClass&quot;</span><span class="fu">:</span> <span class="dv">7</span><span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb3-5" title="5">      <span class="fu">{</span><span class="dt">&quot;interfaceClass&quot;</span><span class="fu">:</span> <span class="dv">9</span><span class="fu">}</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="ot">]</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="ot">]</span></a></code></pre>
    </div>
    <p>
      For the list of acceptable <code>interfaceClass</code> values, see
      <a href="http://www.usb.org/developers/defined_class">USB Class Codes</a>.
    </p>
    <p>
      The <code>interfaceClass</code> property can be combined with the
      <code>vendorId</code> property to get access only to USB devices from a
      specific vendor, as demonstrated by the following example:
    </p>
    <div class="sourceCode" id="cb4">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb4-1" title="1"><span class="er">&quot;permissions&quot;:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="fu">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">&quot;usbDevices&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-4" title="4">      <span class="fu">{</span></a>
<a class="sourceLine" id="cb4-5" title="5">        <span class="dt">&quot;vendorId&quot;</span><span class="fu">:</span> <span class="dv">123</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-6" title="6">        <span class="dt">&quot;interfaceClass&quot;</span><span class="fu">:</span> <span class="dv">7</span></a>
<a class="sourceLine" id="cb4-7" title="7">      <span class="fu">}</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="ot">]</span></a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="ot">]</span></a></code></pre>
    </div>
    <p>{% Aside %}</p>
    <p>
      Note that <code>usbDevices</code> permissions with
      <code>interfaceClass</code> property have effect only when the app is
      running in kiosk session - outside a kiosk session these permissions will
      be ignored.
    </p>
    <p>{% endAside %}</p>
    <h2 id="finding-a-device-finding_device">
      Finding a device {: #finding_device }
    </h2>
    <p>
      To determine whether one or more specific devices are connected to a
      user’s system, use the
      <a href="/apps/usb#method-getDevices">usb.getDevices</a> method:
    </p>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">getDevices</span>(enumerateDevicesOptions<span class="op">,</span> callback)<span class="op">;</span></a></code></pre>
    </div>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Parameter (type)</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>EnumerateDevicesOptions (object)</td>
          <td>
            An object specifying both a <code>vendorId</code> (long) and
            <code>productId</code> (long) used to find the correct type of
            device on the bus. Your manifest must declare the
            <code>usbDevices</code> permission section listing all the
            <code>vendorId</code> and <code>deviceId</code> pairs your app wants
            to access.
          </td>
        </tr>
        <tr>
          <td>callback (function)</td>
          <td>
            Called when the device enumeration is finished. The callback will be
            executed with one parameter, an array of <code>Device</code> objects
            with three properties: <code>device</code>, <code>vendorId</code>,
            <code>productId</code>. The device property is a stable identifier
            for a connected device. It will not change until the device is
            unplugged. The detail of the identifier is opaque and subject to
            change. Do not rely on its current type.<br />If no devices are
            found, the array will be empty.
          </td>
        </tr>
      </tbody>
    </table>
    <p>Example:</p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">function</span> <span class="at">onDeviceFound</span>(devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="kw">this</span>.<span class="at">devices</span><span class="op">=</span>devices<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="cf">if</span> (devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="cf">if</span> (<span class="va">devices</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Device(s) found: &quot;</span><span class="op">+</span><span class="va">devices</span>.<span class="at">length</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Device could not be found&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Permission denied.&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="op">}</span></a>
<a class="sourceLine" id="cb6-13" title="13"></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">getDevices</span>(<span class="op">{</span><span class="st">&quot;vendorId&quot;</span><span class="op">:</span> vendorId<span class="op">,</span> <span class="st">&quot;productId&quot;</span><span class="op">:</span> productId<span class="op">},</span> onDeviceFound)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="opening-a-device-usb_open">Opening a device {: #usb_open }</h2>
    <p>
      Once the <code>Device</code> objects are returned, you can open a device
      using usb.openDevice to obtain a connection handle. You can only
      communicate with USB devices using connection handles.
    </p>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Property</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>device</td>
          <td>
            Object received in
            <a href="/apps/usb#method-getDevices">usb.getDevices</a> callback.
          </td>
        </tr>
        <tr>
          <td>data (arraybuffer)</td>
          <td>
            Contains the data sent by the device if the transfer was inbound.
          </td>
        </tr>
      </tbody>
    </table>
    <p>Example:</p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> usbConnection <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">var</span> onOpenCallback <span class="op">=</span> <span class="kw">function</span>(connection) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="cf">if</span> (connection) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-4" title="4">    usbConnection <span class="op">=</span> connection<span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Device opened.&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Device failed to open.&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="op">};</span></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">openDevice</span>(device<span class="op">,</span> onOpenCallback)<span class="op">;</span></a></code></pre>
    </div>
    <p>{% Aside %}</p>
    <p>
      Not every device can be opened successfully. In general, operating systems
      lock down many types of USB interfaces (e.g. keyboards and mice, mass
      storage devices, webcams, etc.) and they cannot be claimed by user
      applications. On Linux (other than Chrome OS), once an interface of a
      device is locked down by the OS, the whole device is locked down (because
      all the interfaces shares the same device file), even if the other
      interfaces of the device can be used in theory. On Chrome OS, you can
      request access to unlocked interfaces using the
      <a href="/apps/usb#method-requestAccess">usb.requestAccess</a> method. If
      permitted, the permission broker will unlock the device file for you.
    </p>
    <p>{% endAside %}</p>
    <p>
      To simplify the opening process, you can use the
      <a href="/apps/usb#method-findDevices">usb.findDevices</a> method, which
      enumerates, requests access, and opens devices in one call:
    </p>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">findDevices</span>(<span class="op">{</span><span class="st">&quot;vendorId&quot;</span><span class="op">:</span> vendorId<span class="op">,</span> <span class="st">&quot;productId&quot;</span><span class="op">:</span> productId<span class="op">,</span> <span class="st">&quot;interfaceId&quot;</span><span class="op">:</span> interfaceId<span class="op">},</span> callback)<span class="op">;</span></a></code></pre>
    </div>
    <p>which is equivalent to:</p>
    <div class="sourceCode" id="cb9">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">getDevices</span>(<span class="op">{</span><span class="st">&quot;vendorId&quot;</span><span class="op">:</span> vendorId<span class="op">,</span> <span class="st">&quot;productId&quot;</span><span class="op">:</span> productId<span class="op">},</span> <span class="kw">function</span> (devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>devices) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Error enumerating devices.&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="at">callback</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-5" title="5">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="kw">var</span> connections <span class="op">=</span> []<span class="op">,</span> pendingAccessRequests <span class="op">=</span> <span class="va">devices</span>.<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="va">devices</span>.<span class="at">forEach</span>(<span class="kw">function</span> (device) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-9" title="9">    <span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">requestAccess</span>(interfaceId<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb9-10" title="10">      <span class="co">// No need to check for errors at this point.</span></a>
<a class="sourceLine" id="cb9-11" title="11">      <span class="co">// Nothing can be done if an error occurs anyway. You should always try</span></a>
<a class="sourceLine" id="cb9-12" title="12">      <span class="co">// to open the device.</span></a>
<a class="sourceLine" id="cb9-13" title="13">      <span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">openDevices</span>(device<span class="op">,</span> <span class="kw">function</span> (connection) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-14" title="14">        <span class="cf">if</span> (connection) <span class="va">connections</span>.<span class="at">push</span>(connection)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-15" title="15">        pendingAccessRequests<span class="op">--;</span></a>
<a class="sourceLine" id="cb9-16" title="16">        <span class="cf">if</span> (pendingAccessRequests <span class="op">==</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-17" title="17">          <span class="at">callback</span>(connections)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-18" title="18">        <span class="op">}</span></a>
<a class="sourceLine" id="cb9-19" title="19">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-20" title="20">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-21" title="21">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb9-22" title="22"><span class="op">}</span>)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="usb-transfers-and-receiving-data-from-a-device-usb_transfers">
      USB transfers and receiving data from a device {: #usb_transfers }
    </h2>
    <p>
      The USB protocol defines four types of transfers:
      <a href="#control_transfers">control</a>,
      <a href="#bulk_transfers">bulk</a>,
      <a href="#isochronous_transfers">isochronous</a> and
      <a href="#interrupt_transfers">interrupt</a>. These transfers are
      described below.
    </p>
    <p>
      Transfers can occur in both directions: device-to-host (inbound), and
      host-to-device (outbound). Due to the nature of the USB protocol, both
      inbound and outbound messages must be initiated by the host (the computer
      that runs the Chrome app). For inbound (device-to-host) messages, the host
      (initiated by your JavaScript code) sends a message flagged as “inbound”
      to the device. The details of the message depend on the device, but
      usually will have some identification of what you are requesting from it.
      The device then responds with the requested data. The device’s response is
      handled by Chrome and delivered asynchronously to the callback you specify
      in the transfer method. An outbound (host-to-device) message is similar,
      but the response doesn’t contain data returned from the device.
    </p>
    <p>
      For each message from the device, the specified callback will receive an
      event object with the following properties:
    </p>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Property</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>resultCode (integer)</td>
          <td>
            0 is success; other values indicate failure. An error string can
            be<br />read from <code>chrome.extension.lastError</code> when a
            failure is<br />indicated.
          </td>
        </tr>
        <tr>
          <td>data (arraybuffer)</td>
          <td>
            Contains the data sent by the device if the transfer was inbound.
          </td>
        </tr>
      </tbody>
    </table>
    <p>Example:</p>
    <div class="sourceCode" id="cb10">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">var</span> onTransferCallback <span class="op">=</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">   <span class="cf">if</span> (event <span class="op">&amp;&amp;</span> <span class="va">event</span>.<span class="at">resultCode</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="va">event</span>.<span class="at">data</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">     <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;got &quot;</span> <span class="op">+</span> <span class="va">event</span>.<span class="va">data</span>.<span class="at">byteLength</span> <span class="op">+</span> <span class="st">&quot; bytes&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4">   <span class="op">}</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">bulkTransfer</span>(connectionHandle<span class="op">,</span> transferInfo<span class="op">,</span> onTransferCallback)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="control-transfers-control_transfers">
      CONTROL transfers {: #control_transfers }
    </h2>
    <p>
      Control transfers are generally used to send or receive configuration or
      command parameters to a USB device. The controlTransfer method always
      sends to/reads from endpoint 0, and no claimInterface is required. The
      method is simple and receives three parameters:
    </p>
    <div class="sourceCode" id="cb11">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">controlTransfer</span>(connectionHandle<span class="op">,</span> transferInfo<span class="op">,</span> transferCallback)</a></code></pre>
    </div>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Parameter (types)</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>connectionHandle</td>
          <td>
            Object received in
            <a href="/apps/usb#method-openDevice">usb.openDevice</a> callback.
          </td>
        </tr>
        <tr>
          <td>transferInfo</td>
          <td>
            Parameter object with values from the table below. Check your USB
            device protocol specification for details.
          </td>
        </tr>
        <tr>
          <td>transferCallback()</td>
          <td>Invoked when the transfer has completed.</td>
        </tr>
      </tbody>
    </table>
    <p>Values for <code>transferInfo</code> object:</p>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Value</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>requestType (string)</td>
          <td>“vendor”, “standard”, “class” or “reserved”.</td>
        </tr>
        <tr>
          <td>recipient (string)</td>
          <td>“device”, “interface”, “endpoint” or “other”.</td>
        </tr>
        <tr>
          <td>direction (string)</td>
          <td>
            “in” or “out”. The “in” direction is used to notify the device
            that<br />it should send information to the host. All communication
            on a USB<br />bus is host-initiated, so use an “in” transfer to
            allow a device to<br />send information back.
          </td>
        </tr>
        <tr>
          <td>request (integer)</td>
          <td>Defined by your device’s protocol.</td>
        </tr>
        <tr>
          <td>value (integer)</td>
          <td>Defined by your device’s protocol.</td>
        </tr>
        <tr>
          <td>index (integer)</td>
          <td>Defined by your device’s protocol.</td>
        </tr>
        <tr>
          <td>length (integer)</td>
          <td>
            Only used when direction is “in”. Notifies the device that this is
            the amount of data the host is expecting in response.
          </td>
        </tr>
        <tr>
          <td>data (arraybuffer)</td>
          <td>
            Defined by your device’s protocol, required when direction is “out”.
          </td>
        </tr>
      </tbody>
    </table>
    <p>Example:</p>
    <div class="sourceCode" id="cb12">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">var</span> transferInfo <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="st">&quot;requestType&quot;</span><span class="op">:</span> <span class="st">&quot;vendor&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-3" title="3">   <span class="st">&quot;recipient&quot;</span><span class="op">:</span> <span class="st">&quot;device&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="st">&quot;direction&quot;</span><span class="op">:</span> <span class="st">&quot;out&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="st">&quot;request&quot;</span><span class="op">:</span>  <span class="bn">0x31</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="st">&quot;value&quot;</span><span class="op">:</span> <span class="dv">120</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="st">&quot;index&quot;</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="co">// Note that the ArrayBuffer, not the TypedArray itself is used.</span></a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="st">&quot;data&quot;</span><span class="op">:</span> <span class="kw">new</span> <span class="at">Uint8Array</span>([<span class="dv">4</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">23</span><span class="op">,</span> <span class="dv">42</span>]).<span class="at">buffer</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="op">};</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">controlTransfer</span>(connectionHandle<span class="op">,</span> transferInfo<span class="op">,</span> optionalCallback)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="isochronous-transfers-isochronous_transfers">
      ISOCHRONOUS transfers {: #isochronous_transfers }
    </h2>
    <p>
      Isochronous transfers are the most complex type of USB transfer. They are
      commonly used for streams of data, like video and sound. To initiate an
      isochronous transfer (either inbound or outbound), you must use the
      <a href="/apps/usb#method-isochronousTransfer">usb.isochronousTransfer</a>
      method:
    </p>
    <div class="sourceCode" id="cb13">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">isochronousTransfer</span>(connectionHandle<span class="op">,</span> isochronousTransferInfo<span class="op">,</span> transferCallback)</a></code></pre>
    </div>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Parameter</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>connectionHandle</td>
          <td>
            Object received in
            <a href="/apps/usb#method-openDevice">usb.openDevice</a> callback.
          </td>
        </tr>
        <tr>
          <td>isochronousTransferInfo</td>
          <td>Parameter object with the values in the table below.</td>
        </tr>
        <tr>
          <td>transferCallback()</td>
          <td>Invoked when the transfer has completed.</td>
        </tr>
      </tbody>
    </table>
    <p>Values for <code>isochronousTransferInfo</code> object:</p>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Value</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>transferInfo (object)</td>
          <td>
            An object with the following attributes:<br /><b
              >direction (string): </b
            >“in” or “out”.<br /><b>endpoint (integer): </b>defined by your
            device. Usually can be found by looking at an USB instrospection
            tool, like <code>lsusb -v</code><br /><b>length (integer): </b>only
            used when direction is “in”. Notifies the device that this is the
            amount of data the host is expecting in response.<br />Should be AT
            LEAST <code>packets</code> × <code>packetLength</code>.<br /><b
              >data (arraybuffer): </b
            >defined by your device’s protocol; only used when direction is
            “out”.
          </td>
        </tr>
        <tr>
          <td>packets (integer)</td>
          <td>Total number of packets expected in this transfer.</td>
        </tr>
        <tr>
          <td>packetLength (integer)</td>
          <td>Expected length of each packet in this transfer.</td>
        </tr>
      </tbody>
    </table>
    <p>Example:</p>
    <div class="sourceCode" id="cb14">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">var</span> transferInfo <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="st">&quot;direction&quot;</span><span class="op">:</span> <span class="st">&quot;in&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="st">&quot;endpoint&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="st">&quot;length&quot;</span><span class="op">:</span> <span class="dv">2560</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="kw">var</span> isoTransferInfo <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="st">&quot;transferInfo&quot;</span><span class="op">:</span> transferInfo<span class="op">,</span></a>
<a class="sourceLine" id="cb14-9" title="9">  <span class="st">&quot;packets&quot;</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-10" title="10">  <span class="st">&quot;packetLength&quot;</span><span class="op">:</span> <span class="dv">128</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="op">};</span></a>
<a class="sourceLine" id="cb14-12" title="12"></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">isochronousTransfer</span>(connectionHandle<span class="op">,</span> isoTransferInfo<span class="op">,</span> optionalCallback)<span class="op">;</span></a></code></pre>
    </div>
    <p>{% Aside %}</p>
    <p>
      <strong>Notes:</strong> One isochronous transfer will contain
      <code>isoTransferInfo.packets</code> packets of
      <code>isoTransferInfo.packetLength</code> bytes. If it is an inbound
      transfer (your code requested data from the device), the
      <code>data</code> field in the onUsbEvent will be an ArrayBuffer of size
      <code>transferInfo.length</code>. It is your duty to walk through this
      ArrayBuffer and extract the different packets, each starting at a multiple
      of <code>isoTransferInfo.packetLength</code> bytes.
    </p>
    <p>
      If you are expecting a stream of data from the device, remember that you
      will have to send one “inbound” transfer for each transfer you expect
      back. USB devices don’t send transfers to the USB bus unless the host
      explicitly requests them through “inbound” transfers.
    </p>
    <p>{% endAside %}</p>
    <h2 id="bulk-transfers-bulk_transfers">
      BULK transfers {: #bulk_transfers }
    </h2>
    <p>
      Bulk transfers are commonly used to transfer a large amount of
      non-time-sensitive data in a reliable way.
      <a href="/apps/usb#method-bulkTransfer">usb.bulkTransfer</a> has three
      parameters:
    </p>
    <div class="sourceCode" id="cb15">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">bulkTransfer</span>(connectionHandle<span class="op">,</span> transferInfo<span class="op">,</span> transferCallback)<span class="op">;</span></a></code></pre>
    </div>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Parameter</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>connectionHandle</td>
          <td>
            Object received in
            <a href="/apps/usb#method-openDevice">usb.openDevice</a> callback.
          </td>
        </tr>
        <tr>
          <td>transferInfo</td>
          <td>Parameter object with the values in the table below.</td>
        </tr>
        <tr>
          <td>transferCallback</td>
          <td>Invoked when the transfer has completed.</td>
        </tr>
      </tbody>
    </table>
    <p>Values for <code>transferInfo</code> object:</p>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Value</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>direction (string)</td>
          <td>“in” or “out”.</td>
        </tr>
        <tr>
          <td>endpoint (integer)</td>
          <td>Defined by your device’s protocol.</td>
        </tr>
        <tr>
          <td>length (integer)</td>
          <td>
            Only used when direction is “in”. Notifies the device that this is
            the amount of data the host is expecting in response.
          </td>
        </tr>
        <tr>
          <td>data (ArrayBuffer)</td>
          <td>
            Defined by your device’s protocol; only used when direction is
            “out”.
          </td>
        </tr>
      </tbody>
    </table>
    <p>Example:</p>
    <div class="sourceCode" id="cb16">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">var</span> transferInfo <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="st">&quot;direction&quot;</span><span class="op">:</span> <span class="st">&quot;out&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="st">&quot;endpoint&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="st">&quot;data&quot;</span><span class="op">:</span> <span class="kw">new</span> <span class="at">Uint8Array</span>([<span class="dv">4</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">23</span><span class="op">,</span> <span class="dv">42</span>]).<span class="at">buffer</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="op">};</span></a></code></pre>
    </div>
    <h2 id="interrupt-transfers-interrupt_transfers">
      INTERRUPT transfers {: #interrupt_transfers }
    </h2>
    <p>
      Interrupt transfers are used to small amount of time sensitive data. Since
      all USB communication is initiated by the host, host code usually polls
      the device periodically, sending interrupt IN transfers that will make the
      device send data back if there is anything in the interrupt queue
      (maintained by the device).
      <a href="/apps/usb#method-interruptTransfer">usb.interruptTransfer</a> has
      three parameters:
    </p>
    <div class="sourceCode" id="cb17">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">interruptTransfer</span>(connectionHandle<span class="op">,</span> transferInfo<span class="op">,</span> transferCallback)<span class="op">;</span></a></code></pre>
    </div>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Parameter</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>connectionHandle</td>
          <td>
            Object received in
            <a href="/apps/usb#method-openDevice">usb.openDevice</a> callback.
          </td>
        </tr>
        <tr>
          <td>transferInfo</td>
          <td>Parameter object with the values in the table below.</td>
        </tr>
        <tr>
          <td>transferCallback</td>
          <td>
            Invoked when the transfer has completed. Notice that this callback
            doesn’t contain the device’s response. The purpose of the callback
            is simply to notify your code that the asynchronous transfer
            requests has been processed.
          </td>
        </tr>
      </tbody>
    </table>
    <p>Values for <code>transferInfo</code> object:</p>
    <table class="simple">
      <tbody>
        <tr>
          <th scope="col">Value</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>direction (string)</td>
          <td>“in” or “out”.</td>
        </tr>
        <tr>
          <td>endpoint (integer)</td>
          <td>Defined by your device’s protocol.</td>
        </tr>
        <tr>
          <td>length (integer)</td>
          <td>
            Only used when direction is “in”. Notifies the device that this is
            the amount of data the host is expecting in response.
          </td>
        </tr>
        <tr>
          <td>data (ArrayBuffer)</td>
          <td>
            Defined by your device’s protocol; only used when direction is
            “out”.
          </td>
        </tr>
      </tbody>
    </table>
    <p>Example:</p>
    <div class="sourceCode" id="cb18">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">var</span> transferInfo <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="st">&quot;direction&quot;</span><span class="op">:</span> <span class="st">&quot;in&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="st">&quot;endpoint&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="st">&quot;length&quot;</span><span class="op">:</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="va">chrome</span>.<span class="va">usb</span>.<span class="at">interruptTransfer</span>(connectionHandle<span class="op">,</span> transferInfo<span class="op">,</span> optionalCallback)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="caveats-caveats">Caveats {: #caveats }</h2>
    <p>
      Not all devices can be accessed through the USB API. In general, devices
      are not accessible because either the Operating System’s kernel or a
      native driver holds them off from user space code. Some examples are
      devices with HID profiles on OSX systems, and USB pen drives.
    </p>
    <p>
      On most Linux systems, USB devices are mapped with read-only permissions
      by default. To open a device through this API, your user will need to have
      write access to it too. A simple solution is to set a udev rule. Create a
      file <code>/etc/udev/rules.d/50-yourdevicename.rules</code> with the
      following content:
    </p>
    <pre
      class="text"
    ><code>SUBSYSTEM==&quot;usb&quot;, ATTR{idVendor}==&quot;[yourdevicevendor]&quot;, MODE=&quot;0664&quot;, GROUP=&quot;plugdev&quot;</code></pre>
    <p>
      Then, just restart the udev daemon: <code>service udev restart</code>. You
      can check if device permissions are set correctly by following these
      steps:
    </p>
    <ul>
      <li>Run <code>lsusb</code> to find the bus and device numbers.</li>
      <li>
        Run <code>ls -al /dev/bus/usb/[bus]/[device]</code>. This file should be
        owned by group “plugdev” and have group write permissions.
      </li>
    </ul>
    <p>
      Your app cannot do this automatically since this this procedure requires
      root access. We recommend that you provide instructions to end-users and
      link to the <a href="#caveats">Caveats</a> section on this page for an
      explanation.
    </p>
    <p>
      On Chrome OS, simply call
      <a href="/apps/usb#method-requestAccess">usb.requestAccess</a>. The
      permission broker does this for you.
    </p>
  </body>
</html>
