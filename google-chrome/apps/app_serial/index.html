<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="dcterms.date" content="2013-10-31" />
    <title>Serial Devices</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Serial Devices</h1>
      <p class="date">2013-10-31</p>
    </header>
    <p>{% Aside ‘caution’ %}</p>
    <p>
      <strong>Important:</strong> Chrome will be removing support for Chrome
      Apps on all platforms. Chrome browser and the Chrome Web Store will
      continue to support extensions.
      <a
        href="https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html"
        ><strong>Read the announcement</strong></a
      >
      and learn more about
      <a href="/apps/migration"><strong>migrating your app</strong></a
      >.
    </p>
    <p>{% endAside %}</p>
    <p>
      This document describes how to use the <a href="serial">serial API</a> to
      read and write from serial devices. Chrome Apps can also connect to
      <a href="app_usb">USB</a> and
      <a href="app_bluetooth">Bluetooth</a> devices.
    </p>
    <p>{% Aside %}</p>
    <p>
      <strong>Samples:</strong> For examples that illustrate how Chrome Apps can
      connect to hardware devices through a serial port, see the
      <a
        href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/samples/serial/adkjs#readme"
        >adkjs</a
      >,
      <a
        href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/samples/serial/ledtoggle#readme"
        >ledtoggle</a
      >
      and the
      <a
        href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/samples/servo#readme"
        >servo</a
      >
      samples.
    </p>
    <p>{% endAside %}</p>
    <h2 id="manifest-requirement-requirement">
      Manifest requirement {: #requirement }
    </h2>
    <p>You must add the “serial” permission to the manifest file:</p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="er">&quot;permissions&quot;:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="st">&quot;serial&quot;</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ot">]</span></a></code></pre>
    </div>
    <h2 id="listing-available-serial-ports-listing">
      Listing available serial ports {: #listing }
    </h2>
    <p>
      To get a list of paths associated with available serial ports, use the
      <a href="/apps/serial#method-getDevices"
        ><code>serial.getDevices</code></a
      >
      method. <strong>Note:</strong> not all serial ports are available. The API
      uses heuristics to only expose serial devices that are expected to be
      safe.
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">var</span> onGetDevices <span class="op">=</span> <span class="kw">function</span>(ports) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span><span class="va">ports</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(ports[i].<span class="at">path</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="va">chrome</span>.<span class="va">serial</span>.<span class="at">getDevices</span>(onGetDevices)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="connecting-to-a-serial-device-opening">
      Connecting to a serial device {: #opening }
    </h2>
    <p>
      If you know the path associated with the serial port, you can connect to
      it using the
      <a href="/apps/serial#method-connect"><code>serial.connect</code></a>
      method:
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="va">chrome</span>.<span class="va">serial</span>.<span class="at">connect</span>(path<span class="op">,</span> options<span class="op">,</span> callback)</a></code></pre>
    </div>
    <table border="0">
      <tbody>
        <tr>
          <th scope="col">Parameter</th>
          <th scope="col">Description</th>
        </tr>
        <tr>
          <td>path (string)</td>
          <td>
            If the path associated with your device’s port is unknown, you can
            use the
            <a href="/apps/serial#method-getDevices"
              ><code>serial.getDevices</code></a
            >
            method.
          </td>
        </tr>
        <tr>
          <td>options (object)</td>
          <td>
            Parameter object with several configuration values. See details at
            <a href="/apps/serial#type-ConnectionOptions"
              >serial.ConnectionOptions</a
            >
          </td>
        </tr>
        <tr>
          <td>callback</td>
          <td>
            Invoked when the port has been successfully opened. The callback
            will be called with one parameter, <code>connectionInfo</code>, that
            has several important values. See details at
            <a href="/apps/serial#type-ConnectionInfo">serial.ConnectionInfo</a
            >.
          </td>
        </tr>
      </tbody>
    </table>
    <p>A simple example:</p>
    <div class="sourceCode" id="cb4">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> onConnect <span class="op">=</span> <span class="kw">function</span>(connectionInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">   <span class="co">// The serial port has been opened. Save its id to use later.</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="va">_this</span>.<span class="at">connectionId</span> <span class="op">=</span> <span class="va">connectionInfo</span>.<span class="at">connectionId</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="co">// Do whatever you need to do with the opened port.</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">// Connect to the serial port /dev/ttyS01</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="va">chrome</span>.<span class="va">serial</span>.<span class="at">connect</span>(<span class="st">&quot;/dev/ttyS01&quot;</span><span class="op">,</span> <span class="op">{</span><span class="dt">bitrate</span><span class="op">:</span> <span class="dv">115200</span><span class="op">},</span> onConnect)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="disconnect-from-a-serial-port-disconnect">
      Disconnect from a serial port {: #disconnect }
    </h2>
    <p>
      When an app terminates, connections to serial ports that are not
      persistent are automatically closed by the platform. However, if you want
      to disconnect while your app is still running, you can use the
      <a href="/apps/serial#method-disconnect">serial.disconnect</a> method:
    </p>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> onDisconnect <span class="op">=</span> <span class="kw">function</span>(result) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="cf">if</span> (result) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Disconnected from the serial port&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Disconnect failed&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="va">chrome</span>.<span class="va">serial</span>.<span class="at">disconnect</span>(connectionId<span class="op">,</span> onDisconnect)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="reading-from-a-serial-port-reading">
      Reading from a serial port {: #reading }
    </h2>
    <p>
      The serial API reads from the serial port and delivers the read bytes as
      an ArrayBuffer to event listeners. Every port that your application is
      connected to will generate read events to all listeners added through
      <code>chrome.serial.onReceive.addListener(onReceiveCallback)</code>. If
      you are connected to more than one port at the same time, you may find the
      corresponding <code>connectionId</code> of an incoming read event in the
      callback parameter of
      <a href="/apps/serial#event-onReceive">serial.onReceive</a>.
    </p>
    <p>
      The following example can accumulate read bytes until a new line is read,
      converting the received ArrayBuffer to String and calling a method when a
      newline is found as the last character received:
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">var</span> stringReceived <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">var</span> onReceiveCallback <span class="op">=</span> <span class="kw">function</span>(info) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="cf">if</span> (<span class="va">info</span>.<span class="at">connectionId</span> <span class="op">==</span> expectedConnectionId <span class="op">&amp;&amp;</span> <span class="va">info</span>.<span class="at">data</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">      <span class="kw">var</span> str <span class="op">=</span> <span class="at">convertArrayBufferToString</span>(<span class="va">info</span>.<span class="at">data</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6">      <span class="cf">if</span> (<span class="va">str</span>.<span class="at">charAt</span>(<span class="va">str</span>.<span class="at">length</span><span class="dv">-1</span>) <span class="op">===</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">        stringReceived <span class="op">+=</span> <span class="va">str</span>.<span class="at">substring</span>(<span class="dv">0</span><span class="op">,</span> <span class="va">str</span>.<span class="at">length</span><span class="dv">-1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8">        <span class="at">onLineReceived</span>(stringReceived)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-9" title="9">        stringReceived <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-10" title="10">      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-11" title="11">        stringReceived <span class="op">+=</span> str<span class="op">;</span></a>
<a class="sourceLine" id="cb6-12" title="12">      <span class="op">}</span></a>
<a class="sourceLine" id="cb6-13" title="13">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-14" title="14">  <span class="op">};</span></a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="va">chrome</span>.<span class="va">serial</span>.<span class="va">onReceive</span>.<span class="at">addListener</span>(onReceiveCallback)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">// [...] not shown here: connect to the serial port</span></a></code></pre>
    </div>
    <h2 id="sending-data-to-a-serial-port-writing">
      Sending data to a serial port {: #writing }
    </h2>
    <p>
      Sending data is simpler than reading. The only catch is that if your data
      protocol is String based, you have to convert your output string to an
      <code>ArrayBuffer</code>. See the code example below:
    </p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> writeSerial<span class="op">=</span><span class="kw">function</span>(str) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="va">chrome</span>.<span class="va">serial</span>.<span class="at">send</span>(connectionId<span class="op">,</span> <span class="at">convertStringToArrayBuffer</span>(str)<span class="op">,</span> onSend)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">// Convert string to ArrayBuffer</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">var</span> convertStringToArrayBuffer<span class="op">=</span><span class="kw">function</span>(str) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="kw">var</span> buf<span class="op">=</span><span class="kw">new</span> <span class="at">ArrayBuffer</span>(<span class="va">str</span>.<span class="at">length</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="kw">var</span> bufView<span class="op">=</span><span class="kw">new</span> <span class="at">Uint8Array</span>(buf)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span><span class="va">str</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-9" title="9">    bufView[i]<span class="op">=</span><span class="va">str</span>.<span class="at">charCodeAt</span>(i)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="cf">return</span> buf<span class="op">;</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="op">}</span></a></code></pre>
    </div>
    <h2 id="flushing-a-serial-port-buffer-flushing">
      Flushing a serial port buffer {: #flushing }
    </h2>
    <p>You can flush your serial port buffer by issuing the flush command:</p>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1">  <span class="va">chrome</span>.<span class="va">serial</span>.<span class="at">flush</span>(connectionId<span class="op">,</span> onFlush)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="more-more">More {: #More }</h2>
    <p>
      The Serial API has several other features. You can, for example, set a
      connection to persistent, so it can receive data even when your app is not
      running, or you can update connection parameters on the fly, like bitrate,
      timeouts, control signals, and many others with the
      <a href="/apps/serial#method-update">serial.update</a> method. See the
      full reference of the <a href="/apps/serial">serial</a> API for more
      information.
    </p>
  </body>
</html>
