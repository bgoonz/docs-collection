<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2014-12-15" />
  <title>Native Messaging</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Native Messaging</h1>
<p class="date">2014-12-15</p>
</header>
<p>{% Aside ‘caution’ %}</p>
<p><strong>Important:</strong> Chrome will be removing support for Chrome Apps on all platforms. Chrome browser and the Chrome Web Store will continue to support extensions. <a href="https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html"><strong>Read the announcement</strong></a> and learn more about <a href="/apps/migration"><strong>migrating your app</strong></a>.</p>
<p>{% endAside %}</p>
<p>Extensions and apps can exchange messages with native applications using an API that is similar to the other <a href="messaging">message passing APIs</a>. Native applications that support this feature must register a <em>native messaging host</em> that knows how to communicate with the extension. Chrome starts the host in a separate process and communicates with it using standard input and standard output streams.</p>
<h2 id="native-messaging-host-native-messaging-host">Native messaging host {: #native-messaging-host }</h2>
<p>In order to register a native messaging host the application must install a manifest file that defines the native messaging host configuration. Below is an example of the manifest file:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;com.my_company.my_application&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;My Application&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">Program Files</span><span class="ch">\\</span><span class="st">My Application</span><span class="ch">\\</span><span class="st">chrome_native_messaging_host.exe&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;stdio&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="dt">&quot;allowed_origins&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="st">&quot;chrome-extension://knldjmfmopnpolahpmmgbagdohdnhkik/&quot;</span></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="fu">}</span></a></code></pre></div>
<p>The native messaging host manifest file must be valid JSON and contains the following fields:</p>
<table class="simple" id="native-messaging-host-manifest">
<tbody>
<tr>
<th>
Name
</th>
<th>
Description
</th>
</tr>
<tr>
<td>
<code>name</code>
</td>
<td>
Name of the native messaging host. Clients pass this string to <a href="/apps/runtime#method-connectNative">runtime.connectNative</a> or <a href="/apps/runtime#method-sendNativeMessage">runtime.sendNativeMessage</a>. This name can only contain lowercase alphanumeric characters, underscores and dots. The name cannot start or end with a dot, and a dot cannot be followed by another dot.
</td>
</tr>
<tr>
<td>
<code>description</code>
</td>
<td>
Short application description.
</td>
</tr>
<tr>
<td>
<code>path</code>
</td>
<td>
Path to the native messaging host binary. On Linux and OSX the path must be absolute. On Windows it can be relative to the directory in which the manifest file is located. The host process is started with the current directory set to the directory that contains the host binary. For example if this parameter is set to <code>C:_host.exe</code> then it will be started with current directory <code>C:&lt;/code&gt;.
</td>
</tr>
<tr>
<td>
<code>type</code>
</td>
<td>
Type of the interface used to communicate with the native messaging host. Currently there is only one possible value for this parameter: <code>stdio</code>. It indicates that Chrome should use <code>stdin</code> and <code>stdout</code> to communicate with the host.
</td>
</tr>
<tr>
<td>
<code>allowed_origins</code>
</td>
<td>
List of extensions that should have access to the native messaging host. Wildcards such as <code>chrome-extension://<em>/</em></code> are <em>not</em> allowed.
</td>
</tr>
</tbody>
</table>
<h3 id="native-messaging-host-location-native-messaging-host-location">Native messaging host location {: #native-messaging-host-location }</h3>
<p>The location of the manifest file depends on the platform.</p>
<p>On <strong>Windows</strong>, the manifest file can be located anywhere in the file system. The application installer must create registry key <code>HKEY_LOCAL_MACHINE\SOFTWARE\Google\Chrome\NativeMessagingHosts\_com.my_company.my_application_</code> or <code>HKEY_CURRENT_USER\SOFTWARE\Google\Chrome\NativeMessagingHosts\_com.my_company.my_application_</code>, and set default value of that key to the full path to the manifest file. For example, using the following command:</p>
<pre class="text"><code>REG ADD &quot;HKCU\Software\Google\Chrome\NativeMessagingHosts\com.my_company.my_application&quot; /ve /t REG_SZ /d &quot;C:\path\to\nmh-manifest.json&quot; /f</code></pre>
<p>or using the following <code>.reg</code> file:</p>
<pre class="text"><code>Windows Registry Editor Version 5.00
[HKEY_CURRENT_USER\Software\Google\Chrome\NativeMessagingHosts\com.my_company.my_application]
@=&quot;C:\\path\\to\\nmh-manifest.json&quot;</code></pre>
<p>When Chrome looks for native messaging hosts, first the 32-bit registry is queried, then the 64-bit registry.</p>
<p>On <strong>OS X</strong> and <strong>Linux</strong>, the location of the native messaging host’s manifest file varies by the browser (Google Chrome or Chromium). The system-wide native messaging hosts are looked up at a fixed location, while the user-level native messaging hosts are looked up in a subdirectory within the <a href="https://www.chromium.org/user-experience/user-data-directory">user profile directory</a> called <code>NativeMessagingHosts</code>.</p>
<ul>
<li>OS X (system-wide)
<ul>
<li>Google Chrome: <code>/Library/Google/Chrome/NativeMessagingHosts/_com.my_company.my_application_.json</code></li>
<li>Chromium: <code>/Library/Application Support/Chromium/NativeMessagingHosts/_com.my_company.my_application_.json</code></li>
</ul></li>
<li>OS X (user-specific, <em>default</em> path)
<ul>
<li>Google Chrome: <code>~/Library/Application Support/Google/Chrome/NativeMessagingHosts/_com.my_company.my_application_.json</code></li>
<li>Chromium: <code>~/Library/Application Support/Chromium/NativeMessagingHosts/_com.my_company.my_application_.json</code></li>
</ul></li>
<li>Linux (system-wide)
<ul>
<li>Google Chrome: <code>/etc/opt/chrome/native-messaging-hosts/_com.my_company.my_application_.json</code></li>
<li>Chromium: <code>/etc/chromium/native-messaging-hosts/_com.my_company.my_application_.json</code></li>
</ul></li>
<li>Linux (user-specific, <em>default</em> path)
<ul>
<li>Google Chrome: <code>~/.config/google-chrome/NativeMessagingHosts/_com.my_company.my_application_.json</code></li>
<li>Chromium: <code>~/.config/chromium/NativeMessagingHosts/_com.my_company.my_application_.json</code></li>
</ul></li>
</ul>
<h3 id="native-messaging-protocol-native-messaging-host-protocol">Native messaging protocol {: #native-messaging-host-protocol }</h3>
<p>Chrome starts each native messaging host in a separate process and communicates with it using standard input (<code>stdin</code>) and standard output (<code>stdout</code>). The same format is used to send messages in both directions: each message is serialized using JSON, UTF-8 encoded and is preceded with 32-bit message length in native byte order. The maximum size of a single message from the native messaging host is 1 MB, mainly to protect Chrome from misbehaving native applications. The maximum size of the message sent to the native messaging host is 4 GB.</p>
<p>The first argument to the native messaging host is the origin of the caller, usually <code>chrome-extension://[ID of allowed extension]</code>. This allows native messaging hosts to identify the source of the message when multiple extensions are specified in the <code>allowed_origins</code> key in the <a href="#native-messaging-host-manifest">native messaging host manifest</a>. <strong><em>Warning</em></strong>: In Windows, in Chrome 54 and earlier, the origin was passed as the second parameter instead of the first parameter.</p>
<p>When a messaging port is created using <a href="/apps/runtime#method-connectNative">runtime.connectNative</a> Chrome starts native messaging host process and keeps it running until the port is destroyed. On the other hand, when a message is sent using <a href="/apps/runtime#method-sendNativeMessage">runtime.sendNativeMessage</a>, without creating a messaging port, Chrome starts a new native messaging host process for each message. In that case the first message generated by the host process is handled as a response to the original request, i.e. Chrome will pass it to the response callback specified when <a href="/apps/runtime#method-sendNativeMessage">runtime.sendNativeMessage</a> is called. All other messages generated by the native messaging host in that case are ignored.</p>
<p>On Windows, the native messaging host is also passed a command line argument with a handle to the calling chrome native window: <code>--parent-window=&lt;decimal handle value&gt;</code>. This lets the native messaging host create native UI windows that are correctly focused.</p>
<h2 id="connecting-to-a-native-application-native-messaging-client">Connecting to a native application {: #native-messaging-client }</h2>
<p>Sending and receiving messages to and from a native application is very similar to cross-extension messaging. The main difference is that <a href="/apps/runtime#method-connectNative">runtime.connectNative</a> is used instead of <a href="/apps/runtime#method-connect">runtime.connect</a>, and <a href="/apps/runtime#method-sendNativeMessage">runtime.sendNativeMessage</a> is used instead of <a href="/apps/runtime#method-sendMessage">runtime.sendMessage</a>. These methods can only be used if the “nativeMessaging” permission is <a href="declare_permissions">declared</a> in your app’s manifest file.</p>
<p>The Following example creates a <a href="/apps/runtime#type-Port">runtime.Port</a> object that’s connected to native messaging host <code>com.my_company.my_application</code>, starts listening for messages from that port and sends one outgoing message:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> port <span class="op">=</span> <span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">connectNative</span>(<span class="st">&#39;com.my_company.my_application&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="va">port</span>.<span class="va">onMessage</span>.<span class="at">addListener</span>(<span class="kw">function</span>(msg) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Received&quot;</span> <span class="op">+</span> msg)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="va">port</span>.<span class="va">onDisconnect</span>.<span class="at">addListener</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Disconnected&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="va">port</span>.<span class="at">postMessage</span>(<span class="op">{</span> <span class="dt">text</span><span class="op">:</span> <span class="st">&quot;Hello, my_application&quot;</span> <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><a href="/apps/runtime#method-sendNativeMessage">runtime.sendNativeMessage</a> can be used to send a message to native application without creating a port, e.g.:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="at">sendNativeMessage</span>(<span class="st">&#39;com.my_company.my_application&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="op">{</span> <span class="dt">text</span><span class="op">:</span> <span class="st">&quot;Hello&quot;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">function</span>(response) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Received &quot;</span> <span class="op">+</span> response)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="debugging-native-messaging-native-messaging-debugging">Debugging native messaging {: #native-messaging-debugging }</h2>
<p>When the native messaging host fails to start, writes to <code>stderr</code> or when it violates the communication protocol, output is written to the error log of Chrome. On Linux and OS X, this log can easily be accessed by starting Chrome from the command line and watching its output in the terminal. On Windows, use <code>--enable-logging</code> as explained at <a href="https://www.chromium.org/for-testers/enable-logging">How to enable logging</a>.</p>
<p>Here are some errors and tips for solving the issues:</p>
<ul>
<li>Failed to start native messaging host.
<ul>
<li>Check whether you have sufficient permissions to execute the file.</li>
</ul></li>
<li>Invalid native messaging host name specified.
<ul>
<li>Check whether the name contains any invalid characters. Only lowercase alphanumeric characters, underscores and dots are allowed. A name cannot start or end with a dot, and a dot cannot be followed by another dot.</li>
</ul></li>
<li>Native host has exited.
<ul>
<li>The pipe to the native messaging host was broken before the message was read by Chrome. This is most likely initiated from your native messaging host.</li>
</ul></li>
<li>Specified native messaging host not found.
<ul>
<li>Is the name spelled correctly in the extension and in the manifest file?</li>
<li>Is the manifest put in the right directory and with the correct name? See <a href="#native-messaging-host-location">native messaging host location</a> for the expected formats.</li>
<li>Is the manifest file in the correct format? In particular, is the JSON syntax correct and do the values match the definition of a <a href="#native-messaging-host-manifest">native messaging host manifest</a>?</li>
<li>Does the file specified in <code>path</code> exist? On Windows, paths may be relative, but on OS X and Linux, the paths must be absolute.</li>
</ul></li>
<li>Native messaging host <em>host name</em> is not registered. (Windows-only)
<ul>
<li>The native messaging host was not found in the Windows registry. Double-check using <code>regedit</code> whether the key was really created and matches the required format as documented at <a href="#native-messaging-host-location">native messaging host location</a>.</li>
</ul></li>
<li>Access to the specified native messaging host is forbidden.
<ul>
<li>Is the extension’s origin listed in <code>allowed_origins</code>?</li>
</ul></li>
<li>Error when communicating with the native messaging host.
<ul>
<li>This is a very common error and indicates an incorrect implementation of the communication protocol in the native messaging host.
<ul>
<li>Make sure that all output in <code>stdout</code> adheres to the <a href="#native-messaging-host-protocol">native messaging protocol</a>. If you want to print some data for debugging purposes, write to <code>stderr</code>.</li>
<li>Make sure that the 32-bit message length is in the platform’s native integer format (little-endian / big-endian).</li>
<li>The message length must not exceed 1024*1024.</li>
<li>The message size must be equal to the number of bytes in the message. This may differ from the “length” of a string, because characters may be represented by multiple bytes.</li>
<li><strong>Windows-only: Make sure that the program’s I/O mode is set to <code>O_BINARY</code></strong>. By default, the I/O mode is <code>O_TEXT</code>, which corrupts the message format as line breaks (<code>\n</code> = <code>0A</code>) are replaced with Windows-style line endings (<code>\r\n</code> = <code>0D 0A</code>). The I/O mode can be set using <a href="https://msdn.microsoft.com/en-us/library/tw4k6df8.aspx"><code>__setmode</code></a>.</li>
</ul></li>
</ul></li>
</ul>
<h2 id="examples-examples">Examples {: #examples }</h2>
<p>The <a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/master/mv2-archive/api/nativeMessaging">examples/api/nativeMessaging</a> directory contains an example application that uses native messaging to communicate with a Python script that serves as a native messaging host. The sample host’s directory also contains scripts to install/remove the native messaging host.</p>
<p>To try out the example, first download and extract the <a href="/extensions/examples/api/nativeMessaging/app.zip">sample app</a> and <a href="/extensions/examples/api/nativeMessaging/host.zip">sample host</a>. Run <code>install_host.bat</code> (Windows) or <code>install_host.sh</code> (Linux / OS X) to install the native messaging host. Then <a href="getstarted#unpacked">load the app</a> and interact with the app. Run <code>uninstall_host.bat</code> or <code>uninstall_host.sh</code> to unregister the native messaging host when you are done.</p>
</body>
</html>
