<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2014-10-17" />
  <title>Step 3: Add Alarms and Notifications</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Step 3: Add Alarms and Notifications</h1>
<p class="date">2014-10-17</p>
</header>
<p>{% Aside ‘caution’ %}</p>
<p><strong>Important:</strong> Chrome will be removing support for Chrome Apps on all platforms. Chrome browser and the Chrome Web Store will continue to support extensions. <a href="https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html"><strong>Read the announcement</strong></a> and learn more about <a href="/apps/migration"><strong>migrating your app</strong></a>.</p>
<p>{% endAside %}</p>
<p>{% Aside %}</p>
<p><strong>Want to start fresh from here?</strong> Find the previous step’s code in the <a href="https://github.com/mangini/io13-codelab/archive/master.zip">reference code zip</a> under <strong><em>cheat_code &gt; solution_for_step2</em></strong>.</p>
<p>{% endAside %}</p>
<p>In this step, you will learn:</p>
<ul>
<li>How to wake your app at specified intervals to execute background tasks.</li>
<li>How to use on-screen notifications to draw attention to something important.</li>
</ul>
<p><em>Estimated time to complete this step: 20 minutes.</em><br />
To preview what you will complete in this step, <a href="#launch">jump down to the bottom of this page ↓</a>.</p>
<h2 id="enhance-your-todo-app-with-reminders-overview">Enhance your Todo app with reminders {: #overview }</h2>
<p>Enhance the Todo app by adding functionality to remind the user if they have open todos—even when the app is closed.</p>
<p>First, you need to add a way for the app to regularly check for uncompleted todos. Next, the app needs to display a message to the user, even if the Todo app window is closed. To accomplish this, you need to understand how alarms and notifications work in Chrome Apps.</p>
<h2 id="add-alarms-alarms">Add alarms {: #alarms }</h2>
<p>Use <a href="/docs/extensions/reference/alarms"><code>chrome.alarms</code></a> to set a wake up interval. As long as Chrome is running, the alarm listener is called at approximately the interval set.</p>
<h3 id="update-app-permissions-update-permissions-alarms">Update app permissions {: #update-permissions-alarms }</h3>
<p>In <strong><em>manifest.json</em></strong>, request the <code>"alarms"</code> permission:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="er">&quot;permissions&quot;:</span> <span class="ot">[</span><span class="st">&quot;storage&quot;</span><span class="ot">,</span> <span class="st">&quot;alarms&quot;</span><span class="ot">]</span><span class="er">,</span></a></code></pre></div>
<h3 id="update-background-scripts-update-background-script-alarms">Update background scripts {: #update-background-script-alarms }</h3>
<p>In <strong><em>background.js</em></strong>, add an <a href="/apps/alarms#event-onAlarm"><code>onAlarm</code></a> listener. For now, the callback function will just log a message to the Console whenever there is a todo item:</p>
<pre class="js/6-8"><code>chrome.app.runtime.onLaunched.addListener(function() {
  chrome.app.window.create(&#39;index.html&#39;, {
    id: &#39;main&#39;,
    bounds: { width: 620, height: 500 }
  });
});
chrome.alarms.onAlarm.addListener(function( alarm ) {
  console.log(&quot;Got an alarm!&quot;, alarm);
});</code></pre>
<h3 id="update-html-view-update-html-view-alarms">Update HTML view {: #update-html-view-alarms }</h3>
<p>In <strong><em>index.html</em></strong>, add an <strong>Activate alarm</strong> button:</p>
<pre class="js/1"><code>&lt;footer id=&quot;info&quot;&gt;
  &lt;button id=&quot;toggleAlarm&quot;&gt;Activate alarm&lt;/button&gt;
  ...
&lt;/footer&gt;</code></pre>
<p>You now need to write the JavaScript event handler for this new button. Recall from <a href="/apps/app_codelab_import_todomvc#csp-compliance">Step 2</a> that one of the most common CSP non-compliances is caused by inline JavaScript. In <em>index.html</em>, add this line to import a new <em>alarms.js</em> file which you will create in the following step:</p>
<pre class="js/3"><code>  &lt;/footer&gt;
  ...
  &lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;js/alarms.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;</code></pre>
<h3 id="create-alarms-script-add-alarms-script">Create alarms script {: #add-alarms-script }</h3>
<p>Create a new file in your <strong><em>js</em></strong> folder called <strong><em>alarms.js</em></strong>.</p>
<p>Use the code below to add <code>checkAlarm()</code>, <code>createAlarm()</code>, <code>cancelAlarm()</code> and <code>toggleAlarm()</code> methods, along with a click event handler to toggle the alarm when the <strong>Activate alarm</strong> button is clicked.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1">(<span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="st">&#39;use strict&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3">   <span class="kw">var</span> alarmName <span class="op">=</span> <span class="st">&#39;remindme&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">   <span class="kw">function</span> <span class="at">checkAlarm</span>(callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-5" title="5">     <span class="va">chrome</span>.<span class="va">alarms</span>.<span class="at">getAll</span>(<span class="kw">function</span>(alarms) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-6" title="6">       <span class="kw">var</span> hasAlarm <span class="op">=</span> <span class="va">alarms</span>.<span class="at">some</span>(<span class="kw">function</span>(a) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-7" title="7">         <span class="cf">return</span> <span class="va">a</span>.<span class="at">name</span> <span class="op">==</span> alarmName<span class="op">;</span></a>
<a class="sourceLine" id="cb5-8" title="8">       <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-9" title="9">       <span class="kw">var</span> newLabel<span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" title="10">       <span class="cf">if</span> (hasAlarm) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-11" title="11">         newLabel <span class="op">=</span> <span class="st">&#39;Cancel alarm&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-12" title="12">       <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-13" title="13">         newLabel <span class="op">=</span> <span class="st">&#39;Activate alarm&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-14" title="14">       <span class="op">}</span></a>
<a class="sourceLine" id="cb5-15" title="15">       <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;toggleAlarm&#39;</span>).<span class="at">innerText</span> <span class="op">=</span> newLabel<span class="op">;</span></a>
<a class="sourceLine" id="cb5-16" title="16">       <span class="cf">if</span> (callback) <span class="at">callback</span>(hasAlarm)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-17" title="17">     <span class="op">}</span>)</a>
<a class="sourceLine" id="cb5-18" title="18">   <span class="op">}</span></a>
<a class="sourceLine" id="cb5-19" title="19">   <span class="kw">function</span> <span class="at">createAlarm</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-20" title="20">     <span class="va">chrome</span>.<span class="va">alarms</span>.<span class="at">create</span>(alarmName<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-21" title="21">       <span class="dt">delayInMinutes</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">periodInMinutes</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-22" title="22">   <span class="op">}</span></a>
<a class="sourceLine" id="cb5-23" title="23">   <span class="kw">function</span> <span class="at">cancelAlarm</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-24" title="24">     <span class="va">chrome</span>.<span class="va">alarms</span>.<span class="at">clear</span>(alarmName)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-25" title="25">   <span class="op">}</span></a>
<a class="sourceLine" id="cb5-26" title="26">   <span class="kw">function</span> <span class="at">doToggleAlarm</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-27" title="27">     <span class="at">checkAlarm</span>( <span class="kw">function</span>(hasAlarm) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-28" title="28">       <span class="cf">if</span> (hasAlarm) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-29" title="29">         <span class="at">cancelAlarm</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-30" title="30">       <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-31" title="31">         <span class="at">createAlarm</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-32" title="32">       <span class="op">}</span></a>
<a class="sourceLine" id="cb5-33" title="33">       <span class="at">checkAlarm</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-34" title="34">     <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-35" title="35">   <span class="op">}</span></a>
<a class="sourceLine" id="cb5-36" title="36">  <span class="at">$$</span>(<span class="st">&#39;#toggleAlarm&#39;</span>).<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> doToggleAlarm)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-37" title="37">  <span class="at">checkAlarm</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-38" title="38"><span class="op">}</span>)()<span class="op">;</span></a></code></pre></div>
<p>Reload your app and spend a few moments activating (and deactivating) the alarm.</p>
<p>{% Aside %}</p>
<p>Since the log messages are being sent to the Console via the event page (aka background script), you need to <strong>right-click &gt; Inspect Background Page</strong> to see the log messages:</p>
<p>{% endAside %}</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/oc61HiXGKKbfETFGyNCK.png”, alt=“Inspect background page messages”, height=“522”, width=“623” %}</p>
<p>{% Aside %}</p>
<p>It’s also worthwhile to continue to use <strong>right-click &gt; Inspect Element</strong> to make sure you do not have errors in other JavaScript files.</p>
<p>{% endAside %}</p>
<p>Whenever you have the alarm activated, you should see log messages being printed in the Console every time the alarm “rings”:</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/ZkL2Fy0sumTyDvJmfmo3.png”, alt=“Alarm messages printing to the Console”, height=“456”, width=“800” %}</p>
<p>You should notice that:</p>
<ul>
<li>Even when you close the Todo app window, the alarms will keep coming.</li>
<li>On platforms other than Chrome OS, if you completely close all Chrome browser instances, alarms won’t trigger.</li>
</ul>
<p>Let’s go over some of the pieces in <em>alarms.js</em> that use <code>chrome.alarms</code> methods one by one.</p>
<h3 id="create-alarms-create-alarms">Create alarms {: #create-alarms }</h3>
<p>In <code>createAlarm()</code>, use the <a href="/docs/extensions/reference/alarms#method-create"><code>chrome.alarms.create()</code></a> API to create an alarm when <strong>Activate alarm</strong> is toggled.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">chrome</span>.<span class="va">alarms</span>.<span class="at">create</span>(alarmName<span class="op">,</span> <span class="op">{</span><span class="dt">delayInMinutes</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">periodInMinutes</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The first parameter is an optional string identifying an unique name for your alarm, for example, <code>remindme</code>. (Note: You need to set an alarm name in order to cancel it by name.)</p>
<p>The second parameter is an <code>alarmInfo</code> object. Valid properties for <code>alarmInfo</code> include <code>when</code> or <code>delayInMinutes</code>, and <code>periodInMinutes</code>. In order to reduce the load on the user’s machine, Chrome limits alarms to once every minute. We are using small values (0.1 of a minute) here for demo purposes only.</p>
<h3 id="clear-alarms-clear-alarms">Clear alarms {: #clear-alarms }</h3>
<p>In <code>cancelAlarm()</code>, use the <a href="/apps/alarms#method-clear"><code>chrome.alarms.clear()</code></a> API to cancel an alarm when <strong>Cancel alarm</strong> is toggled.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="va">chrome</span>.<span class="va">alarms</span>.<span class="at">clear</span>(alarmName)<span class="op">;</span></a></code></pre></div>
<p>The first parameter should be the identifying string you used as an alarm name in <code>chrome.alarms.create()</code>.</p>
<p>The second (optional) parameter is a callback function that should take on the format:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">function</span>(boolean wasCleared) <span class="op">{</span>...<span class="op">};</span></a></code></pre></div>
<h3 id="get-alarms-get-alarms">Get alarms {: #get-alarms }</h3>
<p>In <code>checkAlarm()</code>, use the <a href="/apps/alarms#method-getAll"><code>chrome.alarms.getAll()</code></a> API to get an array of all created alarms in order to update the UI state of the toggle button.</p>
<p><code>getAll()</code> accepts a callback function that passes in an array of <code>Alarm</code> objects. To see what’s in an <code>Alarm</code>, you can inspect running alarms in the DevTools Console like so:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">chrome</span>.<span class="va">alarms</span>.<span class="at">getAll</span>(<span class="kw">function</span>(alarms) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(alarms)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="va">console</span>.<span class="at">log</span>(alarms[<span class="dv">0</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>This will output an object such as <code>{name: "remindme", periodInMinutes: 0.1, scheduledTime: 1397587981166.858}</code> as seen below:</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/1tnuWJK9u6U79P9gNsri.png”, alt=“Use getAll() to inspect running alarms.”, height=“208”, width=“800” %}</p>
<h3 id="get-ready-for-the-next-section-next-section">Get ready for the next section {: #next-section }</h3>
<p>Now that alarms are in place to poll the app at regular intervals, use this as a base for adding visual notifications.</p>
<h2 id="add-notifications-notifications">Add notifications {: #notifications }</h2>
<p>Let’s change the alarm notification to something the user can easily notice. Use <a href="/apps/notifications"><code>chrome.notifications</code></a> to show a desktop notification like the one below:</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/05PL1Eb7DMVoXTDgbpk8.png”, alt=“Our Todo app notification”, height=“103”, width=“382” %}</p>
<p>When the user clicks on the notification, the Todo app window should come into view.</p>
<h3 id="update-app-permissions-update-permissions-notifications">Update app permissions {: #update-permissions-notifications }</h3>
<p>In <strong><em>manifest.json</em></strong>, request the <code>"notifications"</code> permission:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb10-1" title="1"><span class="er">&quot;permissions&quot;:</span> <span class="ot">[</span><span class="st">&quot;storage&quot;</span><span class="ot">,</span> <span class="st">&quot;alarms&quot;</span><span class="ot">,</span> <span class="st">&quot;notifications&quot;</span><span class="ot">]</span><span class="er">,</span></a></code></pre></div>
<h3 id="update-background-scripts-update-background-script-notifications">Update background scripts {: #update-background-script-notifications }</h3>
<p>In <strong><em>background.js</em></strong>, refactor the <code>chrome.app.window.create()</code> callback into a standalone method so you can reuse it:</p>
<pre class="js/1-6,8/0,7"><code>chrome.app.runtime.onLaunched.addListener(function() {
function launch() {
  chrome.app.window.create(&#39;index.html&#39;, {
    id: &#39;main&#39;,
    bounds: { width: 620, height: 500 }
  });
}
});
chrome.app.runtime.onLaunched.addListener(launch);
...</code></pre>
<h3 id="update-alarm-listener-update-alarm-listener">Update alarm listener {: #update-alarm-listener }</h3>
<p>At the top of the <em>background.js</em>, add a variable for a database name that’s used in the alarm listener:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">var</span> dbName <span class="op">=</span> <span class="st">&#39;todos-vanillajs&#39;</span><span class="op">;</span></a></code></pre></div>
<p>The value of <code>dbName</code> is the same database name set in line 17 of <em>js/app.js</em>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="at">Todo</span>(<span class="st">&#39;todos-vanillajs&#39;</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="create-a-notification-create-notification">Create a notification {: #create-notification }</h3>
<p>Instead of simply logging a new alarm to the Console, update the <code>onAlarm</code> listener to get stored data via <code>chrome.storage.local.get()</code> and call a <code>showNotification()</code> method:</p>
<pre class="js/2/1"><code>chrome.alarms.onAlarm.addListener(function( alarm ) {
  console.log(&quot;Got an alarm!&quot;, alarm);
  chrome.storage.local.get(dbName, showNotification);
});</code></pre>
<p>Add this <code>showNotification()</code> method to <em>background.js</em>:</p>
<pre class="js/4-22"><code>function launch(){
  ...
}

function showNotification(storedData) {
  var openTodos = 0;
  if ( storedData[dbName].todos ) {
    storedData[dbName].todos.forEach(function(todo) {
      if ( !todo.completed ) {
        openTodos++;
      }
    });
  }
  if (openTodos&gt;0) {
    // Now create the notification
    chrome.notifications.create(&#39;reminder&#39;, {
        type: &#39;basic&#39;,
        iconUrl: &#39;icon_128.png&#39;,
        title: &#39;Don\&#39;t forget!&#39;,
        message: &#39;You have &#39;+openTodos+&#39; things to do. Wake up, dude!&#39;
     }, function(notificationId) {});
  }
}

chrome.app.runtime.onLaunched.addListener(launch);
...</code></pre>
<p><code>showNotification()</code> will check for open (uncompleted) todo items. If there is at least one open todo item, create a notification popup via <a href="/apps/notifications#method-create"><code>chrome.notifications.create()</code></a>.</p>
<p>The first parameter is an uniquely identifying notification name. You must have an id set in order to clear or handle interactions with that particular notification. If the id matches an existing notification, <code>create()</code> first clears that notification before making a new notification.</p>
<p>The second parameter is a <a href="/apps/notifications#type-NotificationOptions"><code>NotificationOptions</code></a> object. There are many options for rendering the notification popup. Here we are using a “basic” notification with an icon, title, and message. Other notification types include images, lists, and progress indicators. Feel free to return to this section when you are done Step 3 and experiment with other notification features.</p>
<p>The third (optional) parameter is a callback method that should take on the format:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">function</span>(string notificationId) <span class="op">{</span>...<span class="op">};</span></a></code></pre></div>
<h3 id="handle-notification-interactions-interact-with-notification">Handle notification interactions {: #interact-with-notification }</h3>
<p>Open the Todo app when the user clicks on the notification. At the end of <em>background.js</em>, create a <a href="/apps/notifications#event-onClicked"><code>chrome.notifications.onClicked</code></a> event handler:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="va">chrome</span>.<span class="va">notifications</span>.<span class="va">onClicked</span>.<span class="at">addListener</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="at">launch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The event handler callback simply calls the <code>launch()</code> method. <code>chrome.app.window.create()</code> either creates a new Chrome App window if one doesn’t already exist, or brings into focus the currently open window that has the window id of <code>main</code>.</p>
<h2 id="launch-your-finished-todo-app-launch">Launch your finished Todo app {: #launch }</h2>
<p>You are done Step 3! Reload your Todo app now with reminders.</p>
<p>Check these behaviors work as expected:</p>
<ul>
<li>If you don’t have any uncompleted todo items, there are no popup notifications.</li>
<li>If you click on the notification when your app is closed, the Todo app will open or come into focus.</li>
</ul>
<h3 id="troubleshooting-troubleshooting">Troubleshooting {: #troubleshooting }</h3>
<p>Your final <em>background.js</em> file should look like <a href="https://github.com/mangini/io13-codelab/blob/master/cheat_code/solution_for_step3/background.js">this</a>. If notifications are not showing up, confirm that your Chrome is version 28 or higher. If notifications still don’t show up, check for error messages in the DevTools Console on both the main window (<strong>right click &gt; Inspect Element</strong>) and the background page (<strong>right click &gt; Inspect Background Page</strong>).</p>
<h2 id="for-more-information-recap">For more information {: #recap }</h2>
<p>For more detailed information about some of the APIs introduced in this step, refer to:</p>
<ul>
<li><a href="/apps/declare_permissions" title="Read &#39;Declare Permissions&#39; in the Chrome developer docs">Declare Permissions</a> <a href="#update-permissions-alarms" title="This feature mentioned in &#39;Update app permissions for alarms&#39;">↑</a></li>
<li><a href="/docs/extensions/reference/alarms" title="Read &#39;chrome.alarms&#39; in the Chrome developer docs">chrome.alarms</a> <a href="#alarms" title="This feature mentioned in &#39;Add alarm reminders&#39;">↑</a></li>
<li><a href="/apps/alarms#event-onAlarm" title="Read &#39;chrome.alarms.onAlarm&#39; in the Chrome developer docs">chrome.alarms.onAlarm</a> <a href="#update-background-script-alarms" title="This feature mentioned in &#39;&#39;">↑</a></li>
<li><a href="/apps/alarms#method-create" title="Read &#39;chrome.alarms.create()&#39; in the Chrome developer docs">chrome.alarms.create()</a> <a href="#create-alarms" title="This feature mentioned in &#39;Create alarms&#39;">↑</a></li>
<li><a href="/apps/alarms#method-clear" title="Read &#39;chrome.alarms.clear()&#39; in the Chrome developer docs">chrome.alarms.clear()</a> <a href="#clear-alarms" title="This feature mentioned in &#39;Clear alarms&#39;">↑</a></li>
<li><a href="/apps/alarms#method-getAll" title="Read &#39;chrome.alarms.getAll()&#39; in the Chrome developer docs">chrome.alarms.getAll()</a> <a href="#get-alarms" title="This feature mentioned in &#39;Get alarms&#39;">↑</a></li>
<li><a href="/apps/notifications" title="Read &#39;chrome.notifications&#39; in the Chrome developer docs">chrome.notifications</a> <a href="#notifications" title="This feature mentioned in &#39;Add notifications&#39;">↑</a></li>
<li><a href="/apps/notifications#method-create" title="Read &#39;chrome.notifications.create()&#39; in the Chrome developer docs">chrome.notifications.create()</a> <a href="#create-notification" title="This feature mentioned in &#39;Create a notification&#39;">↑</a></li>
<li><a href="/apps/notifications#type-NotificationOptions" title="Read &#39;NotificationOptions&#39; in the Chrome developer docs">NotificationOptions</a> <a href="#create-notification" title="This feature mentioned in &#39;Create a notification&#39;">↑</a></li>
<li><a href="/apps/notifications#event-onClicked" title="Read &#39;chrome.notifications.onClicked&#39; in the Chrome developer docs">chrome.notifications.onClicked</a> <a href="#interact-with-notification" title="This feature mentioned in &#39;Handle notification interactions&#39;">↑</a></li>
</ul>
<p>Ready to continue onto the next step? Go to <a href="../app_codelab_webview/">Step 4 - Open external links with a webview »</a></p>
</body>
</html>
