<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2012-09-17" />
  <title>Offline First</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Offline First</h1>
<p class="date">2012-09-17</p>
</header>
<p>{% Aside ‘caution’ %}</p>
<p><strong>Important:</strong> Chrome will be removing support for Chrome Apps on all platforms. Chrome browser and the Chrome Web Store will continue to support extensions. <a href="https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html"><strong>Read the announcement</strong></a> and learn more about <a href="/apps/migration"><strong>migrating your app</strong></a>.</p>
<p>{% endAside %}</p>
<p>Because internet connections can be flakey or non-existent, you need to consider <em>offline first</em>: write your app as if it has no internet connection. Once your app works offline, add whatever network functionality you need for your app to do more when it’s online. Read on for tips on implementing your offline-enabled app.</p>
<h2 id="overview-overview">Overview {: #overview }</h2>
<p>Chrome Apps get the following for free:</p>
<ul>
<li>Your app’s files—all of its JavaScript, CSS, and fonts, plus other resources it needs (such as images)—are <strong>already downloaded</strong>.</li>
<li>Your app can <strong>save and optionally sync</strong> small amounts of data using the <a href="storage">Chrome Storage API</a>.</li>
<li>Your app can <strong>detect changes in connectivity</strong> by listening for <a href="https://developer.mozilla.org/en/Online_and_offline_events">online and offline events</a>.</li>
</ul>
<p>But those abilities aren’t enough to guarantee that your app will work offline. Your offline-enabled app should follow these rules:</p>
<dl>
<dt>Use local data whenever possible.</dt>
<dd><p>When using resources from the internet, use <code>XMLHttpRequest</code> to get it, and then save the data locally. You can use the Chrome Storage API, IndexedDB, or Filesystem API to save data locally.</p>
</dd>
<dt>Separate your app’s UI from its data.</dt>
<dd><p>Separating the UI and data not only improves your app’s design and eases the task of enabling offline usage, but also lets you provide other views of the user’s data. An MVC framework can help you keep the UI and data separate.</p>
</dd>
<dt>Assume your app can be closed at any time.</dt>
<dd><p>Save application state (both locally and remotely, when possible) so that users can pick up wherever they left off.</p>
</dd>
<dt>Test your app thoroughly.</dt>
<dd><p>Make sure your app works well in both <a href="#testing">common and tricky scenarios</a>.</p>
</dd>
</dl>
<h2 id="security-restrictions-possibilities">Security restrictions {: #possibilities }</h2>
<p>Chrome Apps are limited in where they can place their resources:</p>
<ul>
<li>Because local data is visible on the user’s machine and can’t be securely encrypted, <strong>sensitive data must stay on the server</strong>. For example, don’t store passwords or credit card numbers locally.</li>
<li>All <strong>JavaScript</strong> that the app executes must be in the app’s package. It <strong>cannot</strong> be inline.</li>
<li><p>All <strong>CSS styles</strong>, <strong>images</strong>, and <strong>fonts</strong> can be initially located either in the app’s package or at a remote URL. If the resource is remote, you can’t specify it in your HTML. Instead, get the data using <code>XMLHttpRequest</code> (see <a href="app_external#external">Referencing external resources</a>). Then either refer to the data with a blob URL or (better yet) save and then load the data using the <a href="app_storage">Filesystem API</a>.</p>
<p>{% Aside %}</p>
<p><strong>Note:</strong> Styles can be inline or in separate <code>.css</code> files.</p>
<p>{% endAside %}</p></li>
</ul>
<p>You can, however, load large media resources such as videos and sounds from external sites. One reason for this exception to the rule is that the <code>&lt;video&gt;</code> and <code>&lt;audio&gt;</code> elements have good fallback behavior when an app has limited or no connectivity. Another reason is that fetching and serving media with <code>XMLHttpRequest</code> and blob URLs currently does not allow streaming or partial buffering.</p>
<p>To provide a sandboxed iframe, you can create an <code>&lt;webview&gt;</code> tag. Its contents can be remote, but it has no direct access to the Chrome app APIs (see <a href="app_external#webview">Embed external web pages</a>).</p>
<p>Some of the restrictions on Chrome Apps are enforced by the <a href="contentSecurityPolicy">Content Security Policy (CSP)</a> which is always the following and cannot be changed for Chrome Apps:</p>
<pre class="text"><code>default-src &#39;self&#39;;
connect-src * data: blob: filesystem:;
style-src &#39;self&#39; blob: data: filesystem: &#39;unsafe-inline&#39;;
img-src &#39;self&#39; blob: data: filesystem:;
frame-src &#39;self&#39; blob: data: filesystem:;
font-src &#39;self&#39; blob: data: filesystem:;
media-src * data: blob: filesystem:;</code></pre>
<h2 id="specifying-offline_enabled-manifest">Specifying offline_enabled {: #manifest }</h2>
<p>It is assumed that your app behaves well offline. If it doesn’t, you should advertise that fact, so that its launch icon is dimmed when the user is offline. To do so, set <code>offline_enabled</code> to <code>false</code> in the <a href="manifest">app manifest file</a>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;My app&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="er">...</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">&quot;offline_enabled&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="er">...</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="fu">}</span></a></code></pre></div>
<h2 id="saving-data-locally-saving-locally">Saving data locally {: #saving-locally }</h2>
<p>The following table shows your options for saving data locally (see also <a href="app_storage">Manage Data</a>).</p>
<table class="simple">
<tbody>
<tr>
<th>
API
</th>
<th>
Best use
</th>
<th>
Notes
</th>
</tr>
<tr>
<td>
Chrome Storage API
</td>
<td>
Small amounts of string data
</td>
<td>
Great for settings and state. Easy to sync remotely (but you don’t have to). Not good for larger amounts of data, due to quotas.
</td>
</tr>
<tr>
<td>
IndexedDB API
</td>
<td>
Structured data
</td>
<td>
Enables fast searches on data. Use with the <a href="declare_permissions">unlimitedStorage permission</a>.
</td>
</tr>
<tr>
<td>
Filesystem API
</td>
<td>
Anything else
</td>
<td>
Provides a sandboxed area where you can store files. Use with the <a href="declare_permissions">unlimitedStorage permission</a>.
</td>
</tr>
</tbody>
</table>
<p>{% Aside %}</p>
<p><strong>Note:</strong> Packaged apps cannot use Web SQL Database or localStorage. The WebSQL specification has been deprecated for awhile now, and localStorage handles data synchronously (which means it can be slow). The Storage API handles data asynchronously.</p>
<p>{% endAside %}</p>
<h2 id="saving-data-remotely-saving-remotely">Saving data remotely {: #saving-remotely }</h2>
<p>In general, how you save data remotely is up to you, but some frameworks and APIs can help (see <a href="app_frameworks">MVC Architecture</a>). If you use the Chrome Storage API, then all syncable data is automatically synced whenever the app is online and the user is signed in to Chrome. If the user isn’t signed in, they’ll be prompted to sign in. However, note that the user’s synced data is deleted if the user uninstalls your app. {QUESTION: true?}</p>
<p>Consider saving users’ data for at least 30 days after your app is uninstalled, so that users will have a good experience if they reinstall your app.</p>
<h2 id="separating-ui-from-data-mvc">Separating UI from data {: #mvc }</h2>
<p>Using an MVC framework can help you design and implement your app so that the data is completely separate from the app’s view on the data. See <a href="app_frameworks">MVC Architecture</a> for a list of MVC frameworks.</p>
<p>If your app talks to a custom server, the server should give you data, not chunks of HTML. Think in terms of RESTful APIs.</p>
<p>Once your data is separate from your app, it’s much easier to provide alternate views of the data. For example, you might provide a website view of any public data. Not only can a website view be useful when your user is away from Chrome, but it can enable search engines to find the data.</p>
<h2 id="testing-testing">Testing {: #testing }</h2>
<p>Make sure your app works well under the following circumstances:</p>
<ul>
<li>The app is installed, and then immediately goes offline. In other words, the first use of the app is offline.</li>
<li>The app is installed on one computer and then synced to another.</li>
<li>The app is uninstalled and then immediately installed again.</li>
<li>The app is running on two computers at the same time, with the same profile. The app must behave reasonably when one computer goes offline, the user does a bunch of stuff on that computer, and then the computer comes online again.</li>
<li>The app has intermittent connectivity, switching often between online and offline.</li>
</ul>
<p>Also make sure that the app saves <strong>no sensitive user data</strong> (such as passwords) on the user’s machine.</p>
</body>
</html>
