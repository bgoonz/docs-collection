<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2012-09-17" />
  <title>Chrome App Lifecycle</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Chrome App Lifecycle</h1>
<p class="date">2012-09-17</p>
</header>
<p>{% Aside ‘caution’ %}</p>
<p><strong>Important:</strong> Chrome will be removing support for Chrome Apps on all platforms. Chrome browser and the Chrome Web Store will continue to support extensions. <a href="https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html"><strong>Read the announcement</strong></a> and learn more about <a href="/apps/migration"><strong>migrating your app</strong></a>.</p>
<p>{% endAside %}</p>
<p>The app runtime and event page are responsible for managing the app lifecycle. The app runtime manages app installation, controls the event page, and can shutdown the app at anytime. The event page listens out for events from the app runtime and manages what gets launched and how.</p>
<h2 id="how-the-lifecycle-works-lifecycle">How the lifecycle works {: #lifecycle }</h2>
<p>The app runtime loads the event page from a user’s desktop and the <code>onLaunch()</code> event is fired. This event tells the event page what windows to launch and their dimensions.</p>
<p>{% Img src=“image/BrQidfK9jaQyIHwdw91aVpkPiib2/JjrzyAmp9vghsqh71tKu.png”, alt=“how app lifecycle works”, height=“329”, width=“444” %}</p>
<p>When the event page has no executing JavaScript, no pending callbacks, and no open windows, the runtime unloads the event page and closes the app. Before unloading the event page, the <code>onSuspend()</code> event is fired. This gives the event page opportunity to do simple clean-up tasks before the app is closed.</p>
<h2 id="create-event-page-and-windows-eventpage">Create event page and windows {: #eventpage }</h2>
<p>All apps must have an event page. This page contains the top-level logic of the application with none of its own UI and is responsible for creating the windows for all other app pages.</p>
<h3 id="create-event-page-create_event_page">Create event page {: #create_event_page }</h3>
<p>To create the event page, include the “background” field in the app manifest and include the <code>background.js</code> in the scripts array. Any library scripts used by the event page need to be added to the “background” field first:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="er">&quot;background&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="st">&quot;foo.js&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="st">&quot;background.js&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="fu">}</span></a></code></pre></div>
<p>Your event page must include the <code>onLaunched()</code> function. This function is called when your application is launched in any way:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">chrome</span>.<span class="va">app</span>.<span class="va">runtime</span>.<span class="va">onLaunched</span>.<span class="at">addListener</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="co">// Tell your app what to launch and how.</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="create-windows-create_windows">Create windows {: #create_windows }</h3>
<p>An event page may create one or more windows at its discretion. By default, these windows are created with a script connection to the event page and are directly scriptable by the event page.</p>
<p>Windows in Chrome Apps are not associated with any Chrome browser windows. They have an optional frame with title bar and size controls, and a recommended window ID. Windows without IDs will not restore to their size and location after restart.</p>
<p>Here’s a sample window created from <code>background.js</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="va">chrome</span>.<span class="va">app</span>.<span class="va">runtime</span>.<span class="va">onLaunched</span>.<span class="at">addListener</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="va">chrome</span>.<span class="va">app</span>.<span class="va">window</span>.<span class="at">create</span>(<span class="st">&#39;main.html&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;MyWindowID&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="dt">bounds</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">      <span class="dt">width</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-6" title="6">      <span class="dt">height</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-7" title="7">      <span class="dt">left</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-8" title="8">      <span class="dt">top</span><span class="op">:</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="op">},</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="dt">minWidth</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="dt">minHeight</span><span class="op">:</span> <span class="dv">600</span></a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="including-launch-data-launch_data">Including Launch Data {: #launch_data }</h3>
<p>Depending on how your app is launched, you may need to handle launch data in your event page. By default, there is no launch data when the app is started by the app launcher. For apps that have file handlers, you need to handle the <code>launchData.items</code> parameter to allow them to be launched with files.</p>
<h2 id="listening-for-app-runtime-events-runtime">Listening for app runtime events {: #runtime }</h2>
<p>The app runtime controls the app installs, updates, and uninstalls. You don’t need to do anything to set up the app runtime, but your event page can listen out for the <code>onInstalled()</code> event to store local settings and the <code>onSuspend()</code> event to do simple clean-up tasks before the event page is unloaded.</p>
<h3 id="storing-local-settings-local_settings">Storing local settings {: #local_settings }</h3>
<p><code>chrome.runtime.onInstalled()</code> is called when your app has first been installed, or when it has been updated. Any time this function is called, the <code>onInstalled</code> event is fired. The event page can listen for this event and use the <a href="storage">Storage API</a> to store and update local settings (see also <a href="app_storage#options">Storage options</a>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">onInstalled</span>.<span class="at">addListener</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="va">chrome</span>.<span class="va">storage</span>.<span class="va">local</span>.<span class="at">set</span>(object items<span class="op">,</span> <span class="kw">function</span> callback)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="preventing-data-loss-preventing_loss">Preventing data loss {: #preventing_loss }</h3>
<p>Users can uninstall your app at any time. When uninstalled, no executing code or private data is left behind. This can lead to data loss since the users may be uninstalling an app that has locally edited, unsynchronized data. You should stash data to prevent data loss.</p>
<p>At a minimum, you should store user settings so that if users reinstall your app, their information is still available for reuse. Using the Storage API (<a href="/apps/storage#property-sync">storage.sync</a>), user data can be automatically synced with Chrome sync.</p>
<h3 id="clean-up-before-app-closes-clean-up">Clean-up before app closes {: #clean-up }</h3>
<p>The app runtime sends the <code>onSuspend()</code> event to the event page before unloading it. Your event page can listen out for this event and do clean-up tasks and save state before the app closes.</p>
<p>Once this event is fired, the app runtime starts the process of closing the app. If the app has open windows it may be restarted in the future via the <code>onRestarted</code> event. In this case the app should save its current state to persistent storage so it can restart in the same state if it receives an <code>onRestarted</code> event. The app only has a few seconds to save its state, after which it will be terminated, so it is a good idea to be incrementally saving app state while the app is running normally.</p>
<p>After receiving <code>onSuspend</code> no further events will be delivered to the app, unless the suspension is aborted for some reason. In this case the <code>onSuspendCanceled</code> will be delivered to the app, and the app won’t be unloaded.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">chrome</span>.<span class="va">runtime</span>.<span class="va">onSuspend</span>.<span class="at">addListener</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="co">// Do some simple clean-up tasks.</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</body>
</html>
