<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>Migrating to Express 4</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Migrating to Express 4</h1>
    </header>
    <h1 id="moving-to-express-4">Moving to Express 4</h1>
    <h2 id="overview">Overview</h2>
    <p>
      Express 4 is a breaking change from Express 3. That means an existing
      Express 3 app will <em>not</em> work if you update the Express version in
      its dependencies.
    </p>
    <p>This article covers:</p>
    <ul class="doclist">
      <li><a href="#changes">Changes in Express 4</a>.</li>
      <li>
        <a href="#example-migration">An example</a> of migrating an Express 3
        app to Express 4.
      </li>
      <li><a href="#app-gen">Upgrading to the Express 4 app generator</a>.</li>
    </ul>
    <h2 id="changes">Changes in Express 4</h2>
    <p>There are several significant changes in Express 4:</p>
    <ul class="doclist">
      <li>
        <a href="#core-changes"
          >Changes to Express core and middleware system.</a
        >
        The dependencies on Connect and built-in middleware were removed, so you
        must add middleware yourself.
      </li>
      <li>
        <a href="#routing">Changes to the routing system.</a>
      </li>
      <li>
        <a href="#other-changes">Various other changes.</a>
      </li>
    </ul>
    <p>See also:</p>
    <ul>
      <li>
        <a href="https://github.com/expressjs/express/wiki/New-features-in-4.x"
          >New features in 4.x.</a
        >
      </li>
      <li>
        <a
          href="https://github.com/expressjs/express/wiki/Migrating-from-3.x-to-4.x"
          >Migrating from 3.x to 4.x.</a
        >
      </li>
    </ul>
    <h3 id="core-changes">Changes to Express core and middleware system</h3>
    <p>
      Express 4 no longer depends on Connect, and removes all built-in
      middleware from its core, except for the
      <code>express.static</code> function. This means that Express is now an
      independent routing and middleware web framework, and Express versioning
      and releases are not affected by middleware updates.
    </p>
    <p>
      Without built-in middleware, you must explicitly add all the middleware
      that is required to run your app. Simply follow these steps:
    </p>
    <ol type="1">
      <li>
        Install the module: <code>npm install --save &lt;module-name&gt;</code>
      </li>
      <li>
        In your app, require the module: <code>require('module-name')</code>
      </li>
      <li>
        Use the module according to its documentation:
        <code>app.use( ... )</code>
      </li>
    </ol>
    <p>
      The following table lists Express 3 middleware and their counterparts in
      Express 4.
    </p>
    <table class="doctable" border="1">
      <tr>
        <th>Express 3</th>
        <th>Express 4</th>
      </tr>
      <tr>
        <td>
          <code>express.bodyParser</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/body-parser">body-parser</a> +
          <a href="https://github.com/expressjs/multer">multer</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.compress</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/compression">compression</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.cookieSession</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/cookie-session"
            >cookie-session</a
          >
        </td>
      </tr>
      <tr>
        <td>
          <code>express.cookieParser</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/cookie-parser">cookie-parser</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.logger</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/morgan">morgan</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.session</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/session">express-session</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.favicon</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/serve-favicon">serve-favicon</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.responseTime</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/response-time">response-time</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.errorHandler</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/errorhandler">errorhandler</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.methodOverride</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/method-override"
            >method-override</a
          >
        </td>
      </tr>
      <tr>
        <td>
          <code>express.timeout</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/timeout">connect-timeout</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.vhost</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/vhost">vhost</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.csrf</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/csurf">csurf</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.directory</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/serve-index">serve-index</a>
        </td>
      </tr>
      <tr>
        <td>
          <code>express.static</code>
        </td>
        <td>
          <a href="https://github.com/expressjs/serve-static">serve-static</a>
        </td>
      </tr>
    </table>
    <p>
      Here is the
      <a href="https://github.com/senchalabs/connect#middleware"
        >complete list</a
      >
      of Express 4 middleware.
    </p>
    <p>
      In most cases, you can simply replace the old version 3 middleware with
      its Express 4 counterpart. For details, see the module documentation in
      GitHub.
    </p>
    <h4 id="app-use"><code>app.use</code> accepts parameters</h4>
    <p>
      In version 4 you can use a variable parameter to define the path where
      middleware functions are loaded, then read the value of the parameter from
      the route handler. For example:
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="va">app</span>.<span class="at">use</span>(<span class="st">&#39;/book/:id&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;ID:&#39;</span><span class="op">,</span> <span class="va">req</span>.<span class="va">params</span>.<span class="at">id</span>)</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="at">next</span>()</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="op">}</span>)</a></code></pre>
    </div>
    <h3 id="routing">The routing system</h3>
    <p>
      Apps now implicitly load routing middleware, so you no longer have to
      worry about the order in which middleware is loaded with respect to the
      <code>router</code> middleware.
    </p>
    <p>
      The way you define routes is unchanged, but the routing system has two new
      features to help organize your routes:
    </p>
    <p>
      {: .doclist } * A new method, <code>app.route()</code>, to create
      chainable route handlers for a route path. * A new class,
      <code>express.Router</code>, to create modular mountable route handlers.
    </p>
    <h4 id="app-route"><code>app.route()</code> method</h4>
    <p>
      The new <code>app.route()</code> method enables you to create chainable
      route handlers for a route path. Because the path is specified in a single
      location, creating modular routes is helpful, as is reducing redundancy
      and typos. For more information about routes, see
      <a href="/%7B%7B%20page.lang%20%7D%7D/4x/api.html#router"
        ><code>Router()</code> documentation</a
      >.
    </p>
    <p>
      Here is an example of chained route handlers that are defined by using the
      <code>app.route()</code> function.
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">app</span>.<span class="at">route</span>(<span class="st">&#39;/book&#39;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">  .<span class="at">get</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Get a random book&#39;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">  .<span class="at">post</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Add a book&#39;</span>)</a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-8" title="8">  .<span class="at">put</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Update the book&#39;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="op">}</span>)</a></code></pre>
    </div>
    <h4 id="express-router"><code>express.Router</code> class</h4>
    <p>
      The other feature that helps to organize routes is a new class,
      <code>express.Router</code>, that you can use to create modular mountable
      route handlers. A <code>Router</code> instance is a complete middleware
      and routing system; for this reason it is often referred to as a
      “mini-app”.
    </p>
    <p>
      The following example creates a router as a module, loads middleware in
      it, defines some routes, and mounts it on a path on the main app.
    </p>
    <p>
      For example, create a router file named <code>birds.js</code> in the app
      directory, with the following content:
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">var</span> router <span class="op">=</span> <span class="va">express</span>.<span class="at">Router</span>()</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">// middleware specific to this router</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="va">router</span>.<span class="at">use</span>(<span class="kw">function</span> <span class="at">timeLog</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Time: &#39;</span><span class="op">,</span> <span class="va">Date</span>.<span class="at">now</span>())</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="at">next</span>()</a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">// define the home page route</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="va">router</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Birds home page&#39;</span>)</a>
<a class="sourceLine" id="cb3-12" title="12"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">// define the about route</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="va">router</span>.<span class="at">get</span>(<span class="st">&#39;/about&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;About birds&#39;</span>)</a>
<a class="sourceLine" id="cb3-16" title="16"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> router</a></code></pre>
    </div>
    <p>Then, load the router module in the app:</p>
    <div class="sourceCode" id="cb4">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> birds <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./birds&#39;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">// ...</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="va">app</span>.<span class="at">use</span>(<span class="st">&#39;/birds&#39;</span><span class="op">,</span> birds)</a></code></pre>
    </div>
    <p>
      The app will now be able to handle requests to the <code>/birds</code> and
      <code>/birds/about</code> paths, and will call the
      <code>timeLog</code> middleware that is specific to the route.
    </p>
    <h3 id="other-changes">Other changes</h3>
    <p>
      The following table lists other small but important changes in Express 4:
    </p>
    <table class="doctable" border="1">
      <tr>
        <th>Object</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>Node.js</td>
        <td>
          Express 4 requires Node.js 0.10.x or later and has dropped support for
          Node.js 0.8.x.
        </td>
      </tr>
      <tr>
        <td>
          <code>http.createServer()</code>
        </td>
        <td>
          The <code>http</code> module is no longer needed, unless you need to
          directly work with it (socket.io/SPDY/HTTPS). The app can be started
          by using the <code>app.listen()</code> function.
        </td>
      </tr>
      <tr>
        <td>
          <code>app.configure()</code>
        </td>
        <td>
          The <code>app.configure()</code> function has been removed. Use the
          <code>process.env.NODE_ENV</code> or
          <code>app.get('env')</code> function to detect the environment and
          configure the app accordingly.
        </td>
      </tr>
      <tr>
        <td>
          <code>json spaces</code>
        </td>
        <td>
          The <code>json spaces</code> application property is disabled by
          default in Express 4.
        </td>
      </tr>
      <tr>
        <td>
          <code>req.accepted()</code>
        </td>
        <td>
          Use <code>req.accepts()</code>, <code>req.acceptsEncodings()</code>,
          <code>req.acceptsCharsets()</code>, and
          <code>req.acceptsLanguages()</code>.
        </td>
      </tr>
      <tr>
        <td>
          <code>res.location()</code>
        </td>
        <td>No longer resolves relative URLs.</td>
      </tr>
      <tr>
        <td>
          <code>req.params</code>
        </td>
        <td>Was an array; now an object.</td>
      </tr>
      <tr>
        <td>
          <code>res.locals</code>
        </td>
        <td>Was a function; now an object.</td>
      </tr>
      <tr>
        <td>
          <code>res.headerSent</code>
        </td>
        <td>Changed to <code>res.headersSent</code>.</td>
      </tr>
      <tr>
        <td>
          <code>app.route</code>
        </td>
        <td>Now available as <code>app.mountpath</code>.</td>
      </tr>
      <tr>
        <td>
          <code>res.on('header')</code>
        </td>
        <td>Removed.</td>
      </tr>
      <tr>
        <td>
          <code>res.charset</code>
        </td>
        <td>Removed.</td>
      </tr>
      <tr>
        <td>
          <code>res.setHeader('Set-Cookie', val)</code>
        </td>
        <td>
          Functionality is now limited to setting the basic cookie value. Use
          <code>res.cookie()</code> for added functionality.
        </td>
      </tr>
    </table>
    <h2 id="example-migration">Example app migration</h2>
    <p>
      Here is an example of migrating an Express 3 application to Express 4. The
      files of interest are <code>app.js</code> and <code>package.json</code>.
    </p>
    <h3 id>Version 3 app</h3>
    <h4 id>
      <code>app.js</code>
    </h4>
    <p>
      Consider an Express v.3 application with the following
      <code>app.js</code> file:
    </p>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">var</span> routes <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes&#39;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">var</span> user <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes/user&#39;</span>)</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">var</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">var</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">// all environments</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;port&#39;</span><span class="op">,</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">PORT</span> <span class="op">||</span> <span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb5-11" title="11"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;views&#39;</span><span class="op">,</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;views&#39;</span>))</a>
<a class="sourceLine" id="cb5-12" title="12"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;view engine&#39;</span><span class="op">,</span> <span class="st">&#39;pug&#39;</span>)</a>
<a class="sourceLine" id="cb5-13" title="13"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">favicon</span>())</a>
<a class="sourceLine" id="cb5-14" title="14"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">logger</span>(<span class="st">&#39;dev&#39;</span>))</a>
<a class="sourceLine" id="cb5-15" title="15"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">methodOverride</span>())</a>
<a class="sourceLine" id="cb5-16" title="16"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">session</span>(<span class="op">{</span> <span class="dt">secret</span><span class="op">:</span> <span class="st">&#39;your secret here&#39;</span> <span class="op">}</span>))</a>
<a class="sourceLine" id="cb5-17" title="17"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">bodyParser</span>())</a>
<a class="sourceLine" id="cb5-18" title="18"><span class="va">app</span>.<span class="at">use</span>(<span class="va">app</span>.<span class="at">router</span>)</a>
<a class="sourceLine" id="cb5-19" title="19"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">static</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;public&#39;</span>)))</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">// development only</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="cf">if</span> (<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;env&#39;</span>) <span class="op">===</span> <span class="st">&#39;development&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-23" title="23">  <span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">errorHandler</span>())</a>
<a class="sourceLine" id="cb5-24" title="24"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-25" title="25"></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="va">routes</span>.<span class="at">index</span>)</a>
<a class="sourceLine" id="cb5-27" title="27"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/users&#39;</span><span class="op">,</span> <span class="va">user</span>.<span class="at">list</span>)</a>
<a class="sourceLine" id="cb5-28" title="28"></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="va">http</span>.<span class="at">createServer</span>(app).<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb5-30" title="30">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>))</a>
<a class="sourceLine" id="cb5-31" title="31"><span class="op">}</span>)</a></code></pre>
    </div>
    <h4 id>
      <code>package.json</code>
    </h4>
    <p>
      The accompanying version 3 <code>package.json</code> file might look
      something like this:
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;application-name&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;0.0.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">&quot;private&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="dt">&quot;start&quot;</span><span class="fu">:</span> <span class="st">&quot;node app.js&quot;</span></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="dt">&quot;express&quot;</span><span class="fu">:</span> <span class="st">&quot;3.12.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="dt">&quot;pug&quot;</span><span class="fu">:</span> <span class="st">&quot;*&quot;</span></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="fu">}</span></a></code></pre>
    </div>
    <h3 id>Process</h3>
    <p>
      Begin the migration process by installing the required middleware for the
      Express 4 app and updating Express and Pug to their respective latest
      version with the following command:
    </p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">$ <span class="ex">npm</span> install serve-favicon morgan method-override express-session body-parser multer errorhandler express@latest pug@latest --save</a></code></pre>
    </div>
    <p>Make the following changes to <code>app.js</code>:</p>
    <ol type="1">
      <li>
        <p>
          The built-in Express middleware functions
          <code>express.favicon</code>, <code>express.logger</code>,
          <code>express.methodOverride</code>, <code>express.session</code>,
          <code>express.bodyParser</code> and
          <code>express.errorHandler</code> are no longer available on the
          <code>express</code> object. You must install their alternatives
          manually and load them in the app.
        </p>
      </li>
      <li>
        <p>
          You no longer need to load the <code>app.router</code> function. It is
          not a valid Express 4 app object, so remove the
          <code>app.use(app.router);</code> code.
        </p>
      </li>
      <li>
        <p>
          Make sure that the middleware functions are loaded in the correct
          order - load <code>errorHandler</code> after loading the app routes.
        </p>
      </li>
    </ol>
    <h3 id>Version 4 app</h3>
    <h4 id>
      <code>package.json</code>
    </h4>
    <p>
      Running the above <code>npm</code> command will update
      <code>package.json</code> as follows:
    </p>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;application-name&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;0.0.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="dt">&quot;private&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="dt">&quot;start&quot;</span><span class="fu">:</span> <span class="st">&quot;node app.js&quot;</span></a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-9" title="9">    <span class="dt">&quot;body-parser&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.5.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-10" title="10">    <span class="dt">&quot;errorhandler&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.1.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="dt">&quot;express&quot;</span><span class="fu">:</span> <span class="st">&quot;^4.8.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="dt">&quot;express-session&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.7.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="dt">&quot;pug&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.0.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-14" title="14">    <span class="dt">&quot;method-override&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.1.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-15" title="15">    <span class="dt">&quot;morgan&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.2.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-16" title="16">    <span class="dt">&quot;multer&quot;</span><span class="fu">:</span> <span class="st">&quot;^0.1.3&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-17" title="17">    <span class="dt">&quot;serve-favicon&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.0.1&quot;</span></a>
<a class="sourceLine" id="cb8-18" title="18">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="fu">}</span></a></code></pre>
    </div>
    <h4 id>
      <code>app.js</code>
    </h4>
    <p>
      Then, remove invalid code, load the required middleware, and make other
      changes as necessary. The <code>app.js</code> file will look like this:
    </p>
    <div class="sourceCode" id="cb9">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">var</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">var</span> routes <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes&#39;</span>)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">var</span> user <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes/user&#39;</span>)</a>
<a class="sourceLine" id="cb9-5" title="5"><span class="kw">var</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">var</span> favicon <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;serve-favicon&#39;</span>)</a>
<a class="sourceLine" id="cb9-8" title="8"><span class="kw">var</span> logger <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb9-9" title="9"><span class="kw">var</span> methodOverride <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;method-override&#39;</span>)</a>
<a class="sourceLine" id="cb9-10" title="10"><span class="kw">var</span> session <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-session&#39;</span>)</a>
<a class="sourceLine" id="cb9-11" title="11"><span class="kw">var</span> bodyParser <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;body-parser&#39;</span>)</a>
<a class="sourceLine" id="cb9-12" title="12"><span class="kw">var</span> multer <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;multer&#39;</span>)</a>
<a class="sourceLine" id="cb9-13" title="13"><span class="kw">var</span> errorHandler <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;errorhandler&#39;</span>)</a>
<a class="sourceLine" id="cb9-14" title="14"></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb9-16" title="16"></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">// all environments</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;port&#39;</span><span class="op">,</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">PORT</span> <span class="op">||</span> <span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb9-19" title="19"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;views&#39;</span><span class="op">,</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;views&#39;</span>))</a>
<a class="sourceLine" id="cb9-20" title="20"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;view engine&#39;</span><span class="op">,</span> <span class="st">&#39;pug&#39;</span>)</a>
<a class="sourceLine" id="cb9-21" title="21"><span class="va">app</span>.<span class="at">use</span>(<span class="at">favicon</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;/public/favicon.ico&#39;</span>)))</a>
<a class="sourceLine" id="cb9-22" title="22"><span class="va">app</span>.<span class="at">use</span>(<span class="at">logger</span>(<span class="st">&#39;dev&#39;</span>))</a>
<a class="sourceLine" id="cb9-23" title="23"><span class="va">app</span>.<span class="at">use</span>(<span class="at">methodOverride</span>())</a>
<a class="sourceLine" id="cb9-24" title="24"><span class="va">app</span>.<span class="at">use</span>(<span class="at">session</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb9-25" title="25">  <span class="dt">resave</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-26" title="26">  <span class="dt">saveUninitialized</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-27" title="27">  <span class="dt">secret</span><span class="op">:</span> <span class="st">&#39;uwotm8&#39;</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="op">}</span>))</a>
<a class="sourceLine" id="cb9-29" title="29"><span class="va">app</span>.<span class="at">use</span>(<span class="va">bodyParser</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb9-30" title="30"><span class="va">app</span>.<span class="at">use</span>(<span class="va">bodyParser</span>.<span class="at">urlencoded</span>(<span class="op">{</span> <span class="dt">extended</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>))</a>
<a class="sourceLine" id="cb9-31" title="31"><span class="va">app</span>.<span class="at">use</span>(<span class="at">multer</span>())</a>
<a class="sourceLine" id="cb9-32" title="32"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">static</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;public&#39;</span>)))</a>
<a class="sourceLine" id="cb9-33" title="33"></a>
<a class="sourceLine" id="cb9-34" title="34"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="va">routes</span>.<span class="at">index</span>)</a>
<a class="sourceLine" id="cb9-35" title="35"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/users&#39;</span><span class="op">,</span> <span class="va">user</span>.<span class="at">list</span>)</a>
<a class="sourceLine" id="cb9-36" title="36"></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="co">// error handling middleware should be loaded after the loading the routes</span></a>
<a class="sourceLine" id="cb9-38" title="38"><span class="cf">if</span> (<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;env&#39;</span>) <span class="op">===</span> <span class="st">&#39;development&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-39" title="39">  <span class="va">app</span>.<span class="at">use</span>(<span class="at">errorHandler</span>())</a>
<a class="sourceLine" id="cb9-40" title="40"><span class="op">}</span></a>
<a class="sourceLine" id="cb9-41" title="41"></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="kw">var</span> server <span class="op">=</span> <span class="va">http</span>.<span class="at">createServer</span>(app)</a>
<a class="sourceLine" id="cb9-43" title="43"><span class="va">server</span>.<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb9-44" title="44">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>))</a>
<a class="sourceLine" id="cb9-45" title="45"><span class="op">}</span>)</a></code></pre>
    </div>
    <div class="doc-box doc-info" data-markdown="1">
      <p>
        Unless you need to work directly with the <code>http</code> module
        (socket.io/SPDY/HTTPS), loading it is not required, and the app can be
        simply started this way:
      </p>
      <div class="sourceCode" id="cb10">
        <pre
          class="sourceCode js"
        ><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="va">app</span>.<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>))</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="op">}</span>)</a></code></pre>
      </div>
    </div>
    <h3 id>Run the app</h3>
    <p>
      The migration process is complete, and the app is now an Express 4 app. To
      confirm, start the app by using the following command:
    </p>
    <div class="sourceCode" id="cb11">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1">$ <span class="ex">node</span> .</a></code></pre>
    </div>
    <p>
      Load <a href="http://localhost:3000">http://localhost:3000</a> and see the
      home page being rendered by Express 4.
    </p>
    <h2 id="app-gen">Upgrading to the Express 4 app generator</h2>
    <p>
      The command-line tool to generate an Express app is still
      <code>express</code>, but to upgrade to the new version, you must
      uninstall the Express 3 app generator and then install the new
      <code>express-generator</code>.
    </p>
    <h3 id>Installing</h3>
    <p>
      If you already have the Express 3 app generator installed on your system,
      you must uninstall it:
    </p>
    <div class="sourceCode" id="cb12">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1">$ <span class="ex">npm</span> uninstall -g express</a></code></pre>
    </div>
    <p>
      Depending on how your file and directory privileges are configured, you
      might need to run this command with <code>sudo</code>.
    </p>
    <p>Now install the new generator:</p>
    <div class="sourceCode" id="cb13">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1">$ <span class="ex">npm</span> install -g express-generator</a></code></pre>
    </div>
    <p>
      Depending on how your file and directory privileges are configured, you
      might need to run this command with <code>sudo</code>.
    </p>
    <p>
      Now the <code>express</code> command on your system is updated to the
      Express 4 generator.
    </p>
    <h3 id>Changes to the app generator</h3>
    <p>
      Command options and use largely remain the same, with the following
      exceptions:
    </p>
    <p>
      {: .doclist } * Removed the <code>--sessions</code> option. * Removed the
      <code>--jshtml</code> option. * Added the <code>--hogan</code> option to
      support <a href="http://twitter.github.io/hogan.js/">Hogan.js</a>.
    </p>
    <h3 id>Example</h3>
    <p>Execute the following command to create an Express 4 app:</p>
    <div class="sourceCode" id="cb14">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1">$ <span class="ex">express</span> app4</a></code></pre>
    </div>
    <p>
      If you look at the contents of the <code>app4/app.js</code> file, you will
      notice that all the middleware functions (except
      <code>express.static</code>) that are required for the app are loaded as
      independent modules, and the <code>router</code> middleware is no longer
      explicitly loaded in the app.
    </p>
    <p>
      You will also notice that the <code>app.js</code> file is now a Node.js
      module, in contrast to the standalone app that was generated by the old
      generator.
    </p>
    <p>
      After installing the dependencies, start the app by using the following
      command:
    </p>
    <div class="sourceCode" id="cb15">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1">$ <span class="ex">npm</span> start</a></code></pre>
    </div>
    <p>
      If you look at the npm start script in the <code>package.json</code> file,
      you will notice that the actual command that starts the app is
      <code>node ./bin/www</code>, which used to be <code>node app.js</code> in
      Express 3.
    </p>
    <p>
      Because the <code>app.js</code> file that was generated by the Express 4
      generator is now a Node.js module, it can no longer be started
      independently as an app (unless you modify the code). The module must be
      loaded in a Node.js file and started via the Node.js file. The Node.js
      file is <code>./bin/www</code> in this case.
    </p>
    <p>
      Neither the <code>bin</code> directory nor the extensionless
      <code>www</code> file is mandatory for creating an Express app or starting
      the app. They are just suggestions made by the generator, so feel free to
      modify them to suit your needs.
    </p>
    <p>
      To get rid of the <code>www</code> directory and keep things the “Express
      3 way”, delete the line that says <code>module.exports = app;</code> at
      the end of the <code>app.js</code> file, then paste the following code in
      its place:
    </p>
    <div class="sourceCode" id="cb16">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;port&#39;</span><span class="op">,</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">PORT</span> <span class="op">||</span> <span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">var</span> server <span class="op">=</span> <span class="va">app</span>.<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="at">debug</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">server</span>.<span class="at">address</span>().<span class="at">port</span>)</a>
<a class="sourceLine" id="cb16-5" title="5"><span class="op">}</span>)</a></code></pre>
    </div>
    <p>
      Ensure that you load the <code>debug</code> module at the top of the
      <code>app.js</code> file by using the following code:
    </p>
    <div class="sourceCode" id="cb17">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">var</span> debug <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;debug&#39;</span>)(<span class="st">&#39;app4&#39;</span>)</a></code></pre>
    </div>
    <p>
      Next, change <code>"start": "node ./bin/www"</code> in the
      <code>package.json</code> file to <code>"start": "node app.js"</code>.
    </p>
    <p>
      You have now moved the functionality of <code>./bin/www</code> back to
      <code>app.js</code>. This change is not recommended, but the exercise
      helps you to understand how the <code>./bin/www</code> file works, and why
      the <code>app.js</code> file no longer starts on its own.
    </p>
  </body>
</html>
