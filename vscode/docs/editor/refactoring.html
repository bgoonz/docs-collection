<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>refactoring</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <h1 id="refactoring">Refactoring</h1>
    <p>
      <a href="https://en.wikipedia.org/wiki/Code_refactoring"
        >Source code refactoring</a
      >
      can improve the quality and maintainability of your project by
      restructuring your code while not modifying the runtime behavior. Visual
      Studio Code supports refactoring operations (refactorings) such as
      <a href="https://refactoring.com/catalog/extractMethod.html"
        >Extract Method</a
      >
      and
      <a href="https://refactoring.com/catalog/extractVariable.html"
        >Extract Variable</a
      >
      to improve your code base from within your editor.
    </p>
    <figure>
      <img
        src="images/refactoring/refactoring-hero.png"
        alt="refactoring hero image"
      />
      <figcaption>refactoring hero image</figcaption>
    </figure>
    <p>
      For example, a common refactoring used to avoid duplicating code (a
      maintenance headache) is the
      <a href="https://refactoring.com/catalog/extractMethod.html"
        >Extract Method</a
      >
      refactoring, where you select source code that you’d like to reuse
      elsewhere and pull it out into its own shared method.
    </p>
    <p>
      Refactorings are provided by a language service and VS Code has built-in
      support for TypeScript and JavaScript refactoring through the
      <a href="https://www.typescriptlang.org/">TypeScript</a> language service.
      Refactoring support for other programming languages is provided through VS
      Code <a href="/docs/editor/extension-marketplace.md">extensions</a> which
      contribute language services. The UI and commands for refactoring are the
      same across languages, and in this topic we’ll demonstrate refactoring
      support with the TypeScript language service.
    </p>
    <h2 id="code-actions-quick-fixes-and-refactorings">
      Code Actions = Quick Fixes and refactorings
    </h2>
    <p>
      In VS Code, Code Actions can provide both refactorings and Quick Fixes for
      detected issues (highlighted with green squiggles). An available Code
      Action is announced by a lightbulb near the source code when the cursor is
      on a squiggle or selected text region. Clicking on the Code Action
      lightbulb or using the <strong>Quick Fix</strong> command
      <code>kb(editor.action.quickFix)</code> will display Quick Fixes and
      refactorings.
    </p>
    <p>
      If you’d just like to see refactorings without Quick Fixes, you can use
      the <strong>Refactor</strong> command
      (<code>kb(editor.action.refactor)</code>).
    </p>
    <blockquote>
      <p>
        <strong>Note:</strong> If you prefer to not see the Code Action
        lightbulb in your editor, you can disable lightbulbs with the
        <code>editor.lightbulb.enable</code>
        <a href="/docs/getstarted/settings.md">setting</a>. You can still open
        Quick Fixes through <strong>Quick Fix</strong> command and
        <code>kb(editor.action.quickFix)</code> keyboard shortcut.
      </p>
    </blockquote>
    <h2 id="refactoring-actions">Refactoring actions</h2>
    <h3 id="extract-method">Extract Method</h3>
    <p>
      Select the source code you’d like to extract and then click on the
      lightbulb in the gutter or press (<code>kb(editor.action.quickFix)</code>)
      to see available refactorings. Source code fragments can be extracted into
      a new method, or into a new function at various different scopes. During
      the extract refactoring, you will be prompted to provide a meaningful
      name.
    </p>
    <h3 id="extract-variable">Extract Variable</h3>
    <p>
      TypeScript language service provides
      <strong>Extract to const</strong> refactoring to create a new local
      variable for the currently selected expression:
    </p>
    <figure>
      <img src="images/refactoring/ts-extract-local.gif" alt="Extract local" />
      <figcaption>Extract local</figcaption>
    </figure>
    <p>
      When working with classes, you can also extract a value to a new property.
    </p>
    <h2 id="rename-symbol">Rename symbol</h2>
    <p>
      Renaming is a common operation related to refactoring source code and VS
      Code has a separate <strong>Rename Symbol</strong> command
      (<code>kb(editor.action.rename)</code>). Some languages support rename
      symbol across files. Press <code>kb(editor.action.rename)</code> and then
      type the new desired name and press <code>kbstyle(Enter)</code>. All
      usages of the symbol will be renamed, across files.
    </p>
    <figure>
      <img src="images/refactoring/rename.png" alt="Rename" />
      <figcaption>Rename</figcaption>
    </figure>
    <h2 id="keybindings-for-code-actions">Keybindings for Code Actions</h2>
    <p>
      The <code>editor.action.codeAction</code> command lets you configure
      keybindings for specific Code Actions. This keybinding, for example,
      triggers the <strong>Extract function</strong> refactoring Code Actions:
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="dt">&quot;key&quot;</span><span class="fu">:</span> <span class="st">&quot;ctrl+shift+r ctrl+e&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="dt">&quot;command&quot;</span><span class="fu">:</span> <span class="st">&quot;editor.action.codeAction&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;refactor.extract.function&quot;</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="fu">}</span></a></code></pre>
    </div>
    <p>
      Code Action kinds are specified by extensions using the enhanced
      <code>CodeActionProvided</code> API. Kinds are hierarchical, so
      <code>"kind": "refactor"</code> will show all refactoring Code Actions,
      whereas <code>"kind": "refactor.extract.function"</code> will only show
      <strong>Extract function</strong> refactorings.
    </p>
    <p>
      Using the above keybinding, if only a single
      <code>"refactor.extract.function"</code> Code Action is available, it will
      be automatically applied. If multiple
      <strong>Extract function</strong> Code Actions are available, we bring up
      a context menu to select them:
    </p>
    <figure>
      <img
        src="images/refactoring/code-action-context-menu.png"
        alt="Select Code Action context menu"
      />
      <figcaption>Select Code Action context menu</figcaption>
    </figure>
    <p>
      You can also control how/when Code Actions are automatically applied using
      the <code>apply</code> argument:
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">&quot;key&quot;</span><span class="fu">:</span> <span class="st">&quot;ctrl+shift+r ctrl+e&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">&quot;command&quot;</span><span class="fu">:</span> <span class="st">&quot;editor.action.codeAction&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;refactor.extract.function&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="dt">&quot;apply&quot;</span><span class="fu">:</span> <span class="st">&quot;first&quot;</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="fu">}</span></a></code></pre>
    </div>
    <p>Valid values for <code>"apply"</code>:</p>
    <ul>
      <li>
        <code>"first"</code> - Always automatically apply the first available
        Code Action.
      </li>
      <li>
        <code>"ifSingle"</code> - Default. Automatically apply the Code Action
        if only one is available. Otherwise, show the context menu.
      </li>
      <li>
        <code>"never"</code> - Always show the Code Action context menu, even if
        only a single Code Action is available.
      </li>
    </ul>
    <p>
      When a Code Action keybinding is configured with
      <code>"preferred": true</code>, only preferred Quick Fixes and
      refactorings are shown. A preferred Quick Fix addresses the underlying
      error, while a preferred refactoring is the most common refactoring
      choice. For example, while multiple
      <code>refactor.extract.constant</code> refactorings may exist, each
      extracting to a different scope in the file, the preferred
      <code>refactor.extract.constant</code> refactoring is the one that
      extracts to a local variable.
    </p>
    <p>
      This keybinding uses <code>"preferred": true</code> to create a
      refactoring that always tries to extract the selected source code to a
      constant in the local scope:
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">&quot;key&quot;</span><span class="fu">:</span> <span class="st">&quot;shift+ctrl+e&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="dt">&quot;command&quot;</span><span class="fu">:</span> <span class="st">&quot;editor.action.codeAction&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;refactor.extract.constant&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="dt">&quot;preferred&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="dt">&quot;apply&quot;</span><span class="fu">:</span> <span class="st">&quot;ifsingle&quot;</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="fu">}</span></a></code></pre>
    </div>
    <h2 id="extensions-with-refactorings">Extensions with refactorings</h2>
    <p>
      You can find extensions that support refactoring by looking in the VS Code
      <a href="https://marketplace.visualstudio.com/vscode">Marketplace</a>. You
      can go to the Extensions view (<code>kb(workbench.view.extensions)</code>)
      and type ‘refactor’ in the search box. You can then sort by install count
      or ratings to see which extensions are popular.
    </p>
    <div class="marketplace-extensions-refactor"></div>
    <blockquote>
      <p>
        Tip: The extensions shown above are dynamically queried. Click on an
        extension tile above to read the description and reviews to decide which
        extension is best for you.
      </p>
    </blockquote>
    <h2 id="next-steps">Next steps</h2>
    <ul>
      <li>
        <a href="/docs/introvideos/codeediting.md"
          >Intro Video - Code Editing</a
        >
        - Watch an introductory video on code editing features.
      </li>
      <li>
        <a href="/docs/editor/editingevolved">Code Navigation</a> - VS Code lets
        you move quickly through your source code.
      </li>
      <li>
        <a href="/docs/editor/debugging.md">Debugging</a> - Learn about
        debugging with VS Code.
      </li>
    </ul>
    <h2 id="common-questions">Common questions</h2>
    <h3 id="why-dont-i-see-any-lightbulbs-when-there-are-errors-in-my-code">
      Why don’t I see any lightbulbs when there are errors in my code?
    </h3>
    <p>
      Lightbulbs (Code Actions) are only shown when your cursor hovers over the
      text showing the error. Hovering over the text will show the error
      description, but you need to move the cursor or select text to see
      lightbulbs for Quick Fixes and refactorings.
    </p>
  </body>
</html>
