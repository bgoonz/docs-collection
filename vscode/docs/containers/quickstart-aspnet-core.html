<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>quickstart-aspnet-core</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <h1 id="asp.net-core-in-a-container">ASP.NET Core in a container</h1>
    <p>In this guide you will learn how to:</p>
    <ul>
      <li>
        Create a <code>Dockerfile</code> file describing a simple .NET Core
        service container.
      </li>
      <li>Build, run, and verify the functionality of the service.</li>
      <li>Debug the service running as a container.</li>
    </ul>
    <h2 id="prerequisites">Prerequisites</h2>
    <ul>
      <li>
        Docker and the VS Code Docker extension must be installed as described
        on the <a href="/docs/containers/overview.md#installation">overview</a>.
      </li>
      <li>
        For .NET development, install
        <a href="https://dotnet.microsoft.com/download">.NET Core SDK</a>.
      </li>
      <li>
        Microsoft
        <a
          href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp"
          >C# for Visual Studio Code</a
        >
        extension.
      </li>
    </ul>
    <h2 id="create-a-.net-core-web-api-project">
      Create a .NET Core Web API project
    </h2>
    <ol type="1">
      <li>Create a folder for the project.</li>
      <li>
        <p>
          Open developer command prompt in the project folder and initialize the
          project:
        </p>
        <div class="sourceCode" id="cb1">
          <pre
            class="sourceCode bash"
          ><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">dotnet</span> new webapi --no-https</a></code></pre>
        </div>
      </li>
    </ol>
    <h2 id="add-docker-files-to-the-project">
      Add Docker files to the project
    </h2>
    <ol type="1">
      <li>Open the project folder in VS Code.</li>
      <li>
        Wait for the C# extension to prompt you to add required assets for build
        and debug, and choose <strong>Yes</strong>. You can also open the
        Command Palette (<code>kb(workbench.action.showCommands)</code>) and use
        the <strong>.NET: Generate Assets for Build and Debug</strong> command.
      </li>
      <li>
        <p>
          Open Command Palette (<code>kb(workbench.action.showCommands)</code>)
          and use
          <strong>Docker: Add Docker Files to Workspace…</strong> command:
        </p>
        <figure>
          <img
            src="images/quickstarts/aspnetcore-add-dotnet.png"
            alt="Add Dockerfile to a .NET project"
          />
          <figcaption>Add Dockerfile to a .NET project</figcaption>
        </figure>
      </li>
      <li>
        Use <strong>.NET: ASP.NET Core</strong> when prompted for application
        platform.
      </li>
      <li>
        Choose <strong>Windows</strong> or <strong>Linux</strong> when prompted
        to choose the operating system. &gt; Windows is only applicable if your
        Docker installation is configured to use Windows containers.
      </li>
      <li>
        You will be asked if you want to add Docker Compose files. We will not
        use Docker Compose in this tutorial, so both “Yes” and “No” answers are
        fine.
      </li>
      <li>Change the port for application endpoint to <code>5000</code>.</li>
      <li>
        <p>
          <code>Dockerfile</code> and <code>.dockerignore</code> files are added
          to the workspace.
        </p>
        <p>
          The extension will also create a set of
          <strong>VS Code tasks</strong> for building and running the container
          (in both debug- and release configuration, four tasks in total), and a
          <strong>debugging configuration</strong> for launching the container
          in debug mode.
        </p>
      </li>
    </ol>
    <h2 id="build-the-application">Build the application</h2>
    <ol type="1">
      <li>
        Open terminal prompt
        (<code>kb(workbench.action.terminal.toggleTerminal)</code>).
      </li>
      <li>
        <p>Issue <code>dotnet build</code> command to build the application:</p>
        <pre class="output"><code>~/code/scratch/netcorerest$ dotnet build
Microsoft (R) Build Engine version 16.3.0+0f4c62fea for .NET Core
Copyright (C) Microsoft Corporation. All rights reserved.

Restore completed in 18.97 ms for ~/code/scratch/netcorerest/netcorerest.csproj.
netcorerest -&gt; ~/code/scratch/netcorerest/bin/Debug/netcoreapp3.0/netcorerest.dll

 Build succeeded.
     0 Warning(s)
     0 Error(s)</code></pre>
      </li>
    </ol>
    <h2 id="add-an-environment-variable-to-the-image">
      Add an environment variable to the image
    </h2>
    <p>
      You can use the Docker extension to author Docker files. The extension
      provides completions and contextual help. To see these capabilities add an
      environment variable to your service image by following these:
    </p>
    <ol type="1">
      <li>Open the <code>Dockerfile</code> file.</li>
      <li>
        <p>
          Use <code>ENV</code> instruction to add an environment variable to the
          service container image. The instruction should be placed in the
          <code>base</code> stage of the <code>Dockerfile</code> (the first
          stage in the file). Set the <code>ASPNETCORE_URLS</code> variable to
          <code>http://*:5000</code>:
        </p>
        <figure>
          <img
            src="images/quickstarts/aspnetcore-intellisense-env.png"
            alt="Add an environment variable to Docker image"
          />
          <figcaption>Add an environment variable to Docker image</figcaption>
        </figure>
        <p>
          Note how the Docker extension lists all available Dockerfile
          instructions and describes the syntax.
        </p>
        <blockquote>
          <p>
            The Docker extension uses the <code>base</code> stage of the
            <code>Dockerfile</code> to create a debug version of the container
            image for your service. Put the
            <code>ASPNETCORE_URLS</code> environment variable definition in the
            <code>base</code> stage to have this variable available in both
            debug and release versions of the container image.
          </p>
        </blockquote>
      </li>
      <li>
        <p>Save the <code>Dockerfile</code> file.</p>
      </li>
    </ol>
    <h2 id="build-the-image">Build the image</h2>
    <ol type="1">
      <li>
        Open Command Palette (<code>kb(workbench.action.showCommands)</code>)
        and issue <strong>Docker Images: Build Image…</strong> command.
      </li>
      <li>
        <p>
          Open Docker Explorer and verify that the new image is visible in the
          Images tree:
        </p>
        <figure>
          <img
            src="images/quickstarts/aspnetcore-verify-image.png"
            alt="Verify Docker image exists"
          />
          <figcaption>Verify Docker image exists</figcaption>
        </figure>
      </li>
    </ol>
    <h2 id="test-the-service-container">Test the service container</h2>
    <ol type="1">
      <li>
        <p>
          Right-click on the image built in previous step and choose
          <strong>Run</strong> or <strong>Run Interactive</strong>. The
          container should start and you should be able to see it in the
          “Containers” pane of the Docker Explorer:
        </p>
        <figure>
          <img
            src="images/quickstarts/aspnetcore-running-container.png"
            alt="Running service container"
          />
          <figcaption>Running service container</figcaption>
        </figure>
      </li>
      <li>
        <p>
          Open the web browser and navigate to
          <a href="http://localhost:5000/WeatherForecast"
            >http://localhost:5000/WeatherForecast</a
          >. You should see weather data in JSON format, similar to following:
        </p>
        <pre class="jsonc"><code>[
    {&quot;date&quot;:&quot;2019-11-07T23:31:57.0527092+00:00&quot;,&quot;temperatureC&quot;:4,&quot;temperatureF&quot;:39,&quot;summary&quot;:&quot;Bracing&quot;},
    {&quot;date&quot;:&quot;2019-11-08T23:31:57.0539243+00:00&quot;,&quot;temperatureC&quot;:-19,&quot;temperatureF&quot;:-2,&quot;summary&quot;:&quot;Freezing&quot;},
    {&quot;date&quot;:&quot;2019-11-09T23:31:57.0539269+00:00&quot;,&quot;temperatureC&quot;:2,&quot;temperatureF&quot;:35,&quot;summary&quot;:&quot;Freezing&quot;},
    {&quot;date&quot;:&quot;2019-11-10T23:31:57.0539275+00:00&quot;,&quot;temperatureC&quot;:-4,&quot;temperatureF&quot;:25,&quot;summary&quot;:&quot;Freezing&quot;},
    {&quot;date&quot;:&quot;2019-11-11T23:31:57.053928+00:00&quot;,&quot;temperatureC&quot;:9,&quot;temperatureF&quot;:48,&quot;summary&quot;:&quot;Bracing&quot;}
 ]</code></pre>
        <blockquote>
          <p>
            By default Docker will assign a randomly chosen
            <strong>host port</strong> to a port exposed by a container (the
            <strong>container port</strong>). In our application the exposed
            (container) port is 5000. When you issue
            <strong>Run</strong> command for an image, VS Code will try to use
            the same port number for the host port and container port. This
            makes it easy to remember which port to use to communicate with the
            container, but it won’t work if the host port is already in use.
          </p>
          <p>
            If you cannot see the data from the container in your browser, make
            sure there are no errors reported by the
            <code>docker run</code> command (look at the command output in the
            terminal window). You can also verify which host port is using by
            the container by right-clicking the container in the Docker Explorer
            and choosing <strong>Inspect</strong>. This will open a JSON
            document that describes the container in detail. Search for
            <code>PortBindings</code> element, for example:
          </p>
          <pre class="jsonc"><code>&quot;PortBindings&quot;: {
  &quot;5000/tcp&quot;: [
    {
      &quot;HostIp&quot;: &quot;&quot;,
      &quot;HostPort&quot;: &quot;5000&quot;
    }
  ]
},</code></pre>
        </blockquote>
      </li>
      <li>
        <p>
          When done testing, right-click the container in the Docker Explorer
          and choose <strong>Stop</strong>.
        </p>
      </li>
    </ol>
    <h2 id="debug-in-container">Debug in container</h2>
    <p>
      When Docker files were added to the application, the Docker extension also
      added a <strong>VS Code debugger configuration</strong> for debugging the
      service when it is running inside a container. The extension will
      automatically detect the protocol and port that the service is using and
      point the browser to the service, but we need to tell it what URL path to
      use.
    </p>
    <ol type="1">
      <li>
        Set a breakpoint at the beginning of the code for the
        <code>Get()</code> method of the
        <code>Controllers/WeatherForecastController.cs</code> file.
      </li>
      <li>
        Open <code>.vscode/launch.json</code> file and find
        <code>Docker .NET Core Launch</code> debug configuration.
      </li>
      <li>
        <p>
          Add <code>dockerServerReadyAction</code> to
          <code>Docker .NET Core Launch</code> configuration:
        </p>
        <div class="sourceCode" id="cb5">
          <pre
            class="sourceCode json"
          ><code class="sourceCode json"><a class="sourceLine" id="cb5-1" title="1"><span class="er">&quot;dockerServerReadyAction&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">    <span class="dt">&quot;uriFormat&quot;</span><span class="fu">:</span> <span class="st">&quot;%s://localhost:%s/WeatherForecast&quot;</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="fu">}</span></a></code></pre>
        </div>
      </li>
      <li>
        <p>Make sure the configuration is selected as active:</p>
        <figure>
          <img
            src="images/quickstarts/aspnetcore-debug-configuration.png"
            alt="Selected Docker debug configuration"
          />
          <figcaption>Selected Docker debug configuration</figcaption>
        </figure>
      </li>
      <li>
        Start debugging (<code>kb(workbench.action.debug.start)</code>).
        <ul>
          <li>The debug version of the service container builds and starts.</li>
          <li>The browser opens to request a new weather forecast.</li>
          <li>
            The breakpoint in the <code>WeatherForecastController</code> is hit.
          </li>
        </ul>
      </li>
    </ol>
    <p>
      You can use specific port on the host by changing the Docker run options
      used by <code>docker-run: debug</code> task (defined in
      <code>.vscode/tasks.json</code> file). For example, if you want to use the
      same port (5000) to expose the service, the
      <code>docker-run: debug</code> task definition would look like this:
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">    <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;docker-run&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="dt">&quot;label&quot;</span><span class="fu">:</span> <span class="st">&quot;docker-run: debug&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="dt">&quot;dependsOn&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="st">&quot;docker-build: debug&quot;</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="dt">&quot;dockerRun&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-8" title="8">        <span class="dt">&quot;ports&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb6-9" title="9">            <span class="fu">{</span> <span class="dt">&quot;hostPort&quot;</span><span class="fu">:</span> <span class="dv">5000</span><span class="fu">,</span> <span class="dt">&quot;containerPort&quot;</span><span class="fu">:</span> <span class="dv">5000</span> <span class="fu">}</span></a>
<a class="sourceLine" id="cb6-10" title="10">        <span class="ot">]</span></a>
<a class="sourceLine" id="cb6-11" title="11">    <span class="fu">},</span></a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="dt">&quot;netCore&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-13" title="13">        <span class="dt">&quot;appProject&quot;</span><span class="fu">:</span> <span class="st">&quot;${workspaceFolder}/netcorerest.csproj&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-14" title="14">        <span class="dt">&quot;enableDebugging&quot;</span><span class="fu">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb6-15" title="15">    <span class="fu">}</span></a></code></pre>
    </div>
    <h2 id="next-steps">Next steps</h2>
    <p>You’re done! Now that your container is ready, you may want to:</p>
    <ul>
      <li>
        <a href="/docs/containers/debug-netcore.md"
          >Learn about debugging .NET Core in a container</a
        >
      </li>
      <li>
        <a href="/docs/containers/reference.md"
          >Customize your Docker build and run tasks</a
        >
      </li>
      <li>
        <a href="/docs/containers/app-service.md"
          >Deploy a containerized app to Azure App Service</a
        >
      </li>
      <li>
        <a href="/docs/containers/docker-compose.md"
          >Learn about using Docker Compose</a
        >
      </li>
    </ul>
  </body>
</html>
