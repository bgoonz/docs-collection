
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=e3218817eb7eb">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Using AVIF to compress images on your site</title>
<meta name="description" content="Serving desktop-sized images to mobile devices can use 2–4x more data than needed. Instead of a &quot;one-size-fits-all&quot; approach to images, serve different image sizes to different devices. " />

<link rel="canonical" href="https://web.dev/compress-images-avif/" />

<meta itemprop="name" content="Using AVIF to compress images on your site" />
<meta itemprop="description" content="Serving desktop-sized images to mobile devices can use 2–4x more data than needed. Instead of a &quot;one-size-fits-all&quot; approach to images, serve different image sizes to different devices. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/compress-images-avif/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Using AVIF to compress images on your site" />
<meta property="og:description" content="Serving desktop-sized images to mobile devices can use 2–4x more data than needed. Instead of a &quot;one-size-fits-all&quot; approach to images, serve different image sizes to different devices. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="The AVIF logo" />
<meta property="tag" content="performance" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Using AVIF to compress images on your site" />
<meta name="twitter:description" content="Serving desktop-sized images to mobile devices can use 2–4x more data than needed. Instead of a &quot;one-size-fits-all&quot; approach to images, serve different image sizes to different devices. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>








<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=03a384e4a406a', 'module');




  loadScript('/js/content.js?v=a2ad5c845e406', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="30" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
      
    
    


<div class="guide-landing-page">
  
  

  
    <img     alt="The AVIF logo"     class="w-hero w-hero--cover"     decoding="auto"     height="480"               sizes="100vw"     src="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format"     srcset="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=200 200w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=228 228w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=260 260w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=296 296w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=338 338w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=385 385w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=439 439w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=500 500w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=571 571w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=650 650w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=741 741w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=845 845w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=964 964w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0jtMLyN4T7C7UazJCYEH.jpg?auto=format&w=1600 1600w"          width="1600"   />
  

  <web-table-of-contents>
    <h2 class="w-toc__header">
      <a href="#using-avif-to-compress-images-on-your-site" class="w-toc__header--link">
        Using AVIF to compress images on your site
      </a>
    </h2>
    <div class="w-toc__list">
        <ul><li><a href="#what's-new">What's New</a></li><li><a href="#libaom">Libaom</a></li><li><a href="#libavif">Libavif</a></li><li><a href="#encoding-avif-images-with-avifenc">Encoding AVIF images with avifenc</a></li><li><a href="#building-command-line-encoder-avifenc">Building command line encoder avifenc</a></li><li><a href="#understanding-the-avifenc-command-line-parameters">Understanding the avifenc command line parameters</a></li><li><a href="#create-an-avif-image-with-default-settings">Create an AVIF image with default settings</a></li><li><a href="#speeding-up-the-encoder">Speeding up the encoder</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div>
  </web-table-of-contents>
  <web-table-of-contents-button></web-table-of-contents-button>

  
  <div class="w-actions">
    <share-action authors="i18n.authors.jaikk.title | i18n.authors.wtc.title"
      class="gc-analytics-event w-actions__fab w-actions__fab--share"
      data-category="web.dev"
      data-label="share"
      data-action="click"
      data-icon="share"
      tabindex="0"
      role="button"
    >
      <span>Share</span>
    </share-action>
    <a class="w-actions__fab w-actions__fab--subscribe gc-analytics-event" data-category="web.dev" data-label="view-subscribe" data-action="click" href="/newsletter/">
  <span>subscribe</span>
</a>

  </div>

  <div class="w-layout-container--narrow w-post-content">
    <header class="w-article-header">
      
        <div class="w-post-breadcrumbs">
          <ul class="w-breadcrumbs">
  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link w-breadcrumbs__link--left-justify gc-analytics-event"
      data-category="web.dev"
      data-label="post, home breadcrumb"
      data-action="click"
      href="/"
    >
      Home
    </a>
  </li>

  <svg
    class="w-breadcrumbs__icon"
    xmlns="http://www.w3.org/2000/svg"
    height="24"
    viewBox="0 0 24 24"
    width="24"
    aria-hidden="true"
  >
    <path d="M0 0h24v24H0V0z" fill="none" />
    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
  </svg>

  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link gc-analytics-event"
      data-category="web.dev"
      data-label="post, path breadcrumb"
      data-action="click"
      href=/blog
    >
      All articles
    </a>
  </li>
</ul>
        </div>
      

      <h1 id="using-avif-to-compress-images-on-your-site" class="w-article-header__headline">Using AVIF to compress images on your site</h1>
      

      
        <div class="w-author__published">
          <time>Jun 7, 2021</time>
          
        </div>
      
      

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <a href="/authors/jaikk/"><img     alt="Jai Krishnan"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/BKGlQ9PreNrLEV74mhKX.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/BKGlQ9PreNrLEV74mhKX.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/BKGlQ9PreNrLEV74mhKX.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/BKGlQ9PreNrLEV74mhKX.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/BKGlQ9PreNrLEV74mhKX.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/BKGlQ9PreNrLEV74mhKX.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/jaikk/">Jai Krishnan</a>
    </cite>
    
  </div>
</div>
          
            <div class="w-author">
  <a href="/authors/wtc/"><img     alt="Wan-Teh Chang"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/tyVCzJx2Qe2hCSwXzhrk.jpeg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/tyVCzJx2Qe2hCSwXzhrk.jpeg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/tyVCzJx2Qe2hCSwXzhrk.jpeg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/tyVCzJx2Qe2hCSwXzhrk.jpeg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/tyVCzJx2Qe2hCSwXzhrk.jpeg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/tyVCzJx2Qe2hCSwXzhrk.jpeg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/wtc/">Wan-Teh Chang</a>
    </cite>
    
  </div>
</div>
          
        </div>
      
    </header>

    

    <p>We
<a href="/fast/#optimize-your-images">frequently write</a>
about the bloat on websites from images,
and tools like
<a href="/optimize-vitals-lighthouse/">Lighthouse</a>
highlight when image loading is having a negative impact on user experience,
such as increasing load time,
or taking bandwidth away from more important resources.
One way to fix this is to use modern compression to reduce the file size of images,
and a new option for web developers is the
<a href="https://aomediacodec.github.io/av1-avif/" rel="noopener">AVIF image format</a>.
This blog post talks about recent updates to open source tooling for AVIF,
introduces the libaom and libavif encoding libraries,
and includes a tutorial for using these libraries to encode AVIF images efficiently.</p>
<p>AVIF is an image format based on the AV1 video codec,
and standardized by the
<a href="https://aomedia.org" rel="noopener">Alliance for Open Media</a>.
AVIF offers significant compression gains over other image formats like JPEG and WebP.
While the exact savings will depend on the content, encoding settings, and quality target,
<a href="https://jakearchibald.com/2020/avif-has-landed/" rel="noopener">we</a> and
<a href="https://netflixtechblog.com/avif-for-next-generation-image-coding-b1d75675fe4" rel="noopener">others</a>
have seen &gt;50% savings vs. JPEG.</p>
<div class="w-columns">
<figure class="w-figure">
  <a href="https://storage.googleapis.com/web-dev-uploads/image/foR0vJZKULb5AGJExlazy1xYDgI2/kVqh1xli2O6mqKF3fQNx.avif" target="_blank">
    <img src="https://storage.googleapis.com/web-dev-uploads/image/foR0vJZKULb5AGJExlazy1xYDgI2/kVqh1xli2O6mqKF3fQNx.avif" width="1120" height="840" alt="The image using AVIF">
  </a>
  <figcaption class="w-figcaption">
  1120 x 840 AVIF at 18,769 bytes (click to enlarge)
</figure>
<figure class="w-figure">
  <a href="https://storage.googleapis.com/web-dev-uploads/image/foR0vJZKULb5AGJExlazy1xYDgI2/Jy0O0q0mLXl668HAo43n.jpeg" target="_blank">
    <img src="https://storage.googleapis.com/web-dev-uploads/image/foR0vJZKULb5AGJExlazy1xYDgI2/Jy0O0q0mLXl668HAo43n.jpeg" width="1120" height="840" alt="The image using JPEG">
  </a>
  <figcaption class="w-figcaption">
  1120 x 840 JPEG at 20,036 bytes (click to enlarge)
  </figcaption>
</figure>
</div>
<p>Additionally, AVIF adds codec and container support for new image features such as
<a href="https://w3c.github.io/ColorWeb-CG/" rel="noopener">High Dynamic Range and Wide Color Gamut</a>,
<a href="https://norkin.org/research/film_grain/" rel="noopener">film grain synthesis</a>,
and progressive decoding.</p>
<div class="w-aside w-aside--note">
<p>AVIF supports two types of progressive decoding.
Spatial scalability can be used to offer a lower resolution image for network constrained users
and 'progressively' provide a higher resolution image by sending just
the additional data required to fill in the high frequency details.
Quality scalability offers a similar progression by steadily improving visual quality with each render.</p>
</div>
<h2 id="what's-new">What's New <a class="w-headline-link" href="#what's-new">#</a></h2>
<p>Since landing AVIF support in Chrome M85 last summer,
AVIF support in the open source ecosystem has improved on a number of fronts.</p>
<h3 id="libaom">Libaom <a class="w-headline-link" href="#libaom">#</a></h3>
<p><a href="https://aomedia.googlesource.com/aom/" rel="noopener">Libaom</a>
is an open source AV1 encoder and decoder maintained by the companies in the Alliance for Open Media,
and used in many production services at Google and other member companies.
Between the libaom 2.0.0 release—around the same time Chrome added AVIF support—and the recent 3.1.0 release,
there have been significant still image encoding optimizations added to the codebase.
These include:</p>
<ul>
<li>Optimizations for multi-threading and tiled encoding.</li>
<li>5x reduction in memory usage.</li>
<li>6.5x reduction in CPU usage, as shown in the chart below.</li>
</ul>
<figure class="w-figure">
  <img     alt=""          decoding="async"     height="467"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format"     srcset="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/mJJfiNsC7Qgl98IJ1LNi.png?auto=format&w=1600 1600w"          width="800"   />
  <figcaption class="w-figcaption">Using speed=6, cq-level=18, for 8.1 MP images</figcaption>
</figure>
<p>These changes massively reduce the cost of encoding AVIF—
particularly the most frequently loaded,
or highest priority images on your site.
As <a href="https://www.cnet.com/news/google-supercharges-youtube-with-a-custom-video-chip/" rel="noopener">hardware-accelerated encoding</a>
of AV1 becomes more available on servers and cloud services,
the cost to create AVIF images will continue to drop.</p>
<h3 id="libavif">Libavif <a class="w-headline-link" href="#libavif">#</a></h3>
<p><a href="https://github.com/AOMediaCodec/libavif" rel="noopener">Libavif</a>,
the reference implementation of AVIF,
is an open source AVIF muxer and parser which is used in Chrome for decoding AVIF images.
It can also be used with libaom for creating AVIF images from your existing uncompressed images,
or transcoding from existing web images (JPEG, PNG, etc).</p>
<p>Libavif recently added support for a wider range of encoder settings,
including integration with more advanced libaom encoder settings.
Optimizations in the processing pipeline like fast YUV-to-RGB conversion using libyuv
and premultiplied alpha support further speed up the decoding process.
And finally, support for the all-intra encoding mode newly added in libaom 3.1.0
brings all the libaom improvements mentioned in the above.</p>
<p>Note: <a href="https://github.com/strukturag/libheif" rel="noopener">libheif</a>
is another popular open source AVIF muxer and parser,
used in
<a href="https://imagemagick.org/index.php" rel="noopener">ImageMagick</a>,
<a href="https://github.com/libvips/libvips" rel="noopener">libvips</a>, and the
<a href="https://sharp.pixelplumbing.com/" rel="noopener">sharp</a> Node.js module.</p>
<h2 id="encoding-avif-images-with-avifenc">Encoding AVIF images with avifenc <a class="w-headline-link" href="#encoding-avif-images-with-avifenc">#</a></h2>
<p>A quick way to experiment with AVIF is
<a href="https://squoosh.app/" rel="noopener">Squoosh.app</a>.
Squoosh runs a WebAssembly version of libavif,
and exposes many of the same features as the command line tools.
It's an easy way to compare AVIF to other formats old and new.
There's also a
<a href="https://www.npmjs.com/package/@squoosh/cli" rel="noopener">CLI version</a>
of Squoosh aimed at Node apps.</p>
<p>However, WebAssembly doesn't yet have access to all the performance primitives of CPUs,
so if you want to run libavif at its fastest,
we recommend the command line encoder, avifenc.</p>
<p>To understand how to encode AVIF images,
we will present a tutorial using the
<a href="https://codelabs.developers.google.com/codelabs/avif/images/happy_dog.jpg" rel="noopener">same source image</a>
used in our example above.  To start, you will need:</p>
<ul>
<li><a href="https://www.google.com/chrome/" rel="noopener">Chrome</a> version 85 or later</li>
<li><a href="https://cmake.org/" rel="noopener">cmake</a></li>
<li><a href="https://git-scm.com/" rel="noopener">git</a></li>
<li><a href="https://ninja-build.org/" rel="noopener">ninja</a></li>
</ul>
<p>You will also need to install the development packages for zlib, libpng, and libjpeg.
The commands for the Debian and Ubuntu Linux distributions are:</p>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> zlib1g-dev<br><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libpng-dev<br><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libjpeg-dev</code></pre>
</web-copy-code><h3 id="building-command-line-encoder-avifenc">Building command line encoder avifenc <a class="w-headline-link" href="#building-command-line-encoder-avifenc">#</a></h3>
<h4 id="1.-get-the-code">1. Get the code <a class="w-headline-link" href="#1.-get-the-code">#</a></h4>
<p>Check out a release tag of libavif.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token function">git</span> clone -b v0.9.1 https://github.com/AOMediaCodec/libavif.git</code></pre>
</web-copy-code><h4 id="2.-change-directory-to-libavif">2. Change directory to libavif <a class="w-headline-link" href="#2.-change-directory-to-libavif">#</a></h4>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> libavif</code></pre>
</web-copy-code><p>There are many different ways you can configure avifenc and libavif to build.
You can find more information at <a href="https://github.com/AOMediaCodec/libavif" rel="noopener">libavif</a>.
We are going to build avifenc so that it is statically linked to the
AV1 encoder and decoder library, <a href="https://aomedia.googlesource.com/aom" rel="noopener">libaom</a>.</p>
<h4 id="3.-get-and-build-libaom">3. Get and build libaom <a class="w-headline-link" href="#3.-get-and-build-libaom">#</a></h4>
<p>Change to the libavif external dependencies directory.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> ext</code></pre>
</web-copy-code><p>The next command will pull the libaom source code
and build libaom statically.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell">./aom.cmd</code></pre>
</web-copy-code><p>Change directory to libavif.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span></code></pre>
</web-copy-code><h4 id="4.-build-the-command-line-encoding-tool-avifenc">4. Build the command line encoding tool, avifenc <a class="w-headline-link" href="#4.-build-the-command-line-encoding-tool-avifenc">#</a></h4>
<p>It is a good idea to create a build directory for avifenc.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token function">mkdir</span> build</code></pre>
</web-copy-code><p>Change to the build directory.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> build</code></pre>
</web-copy-code><p>Create the build files for avifenc.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell">cmake -DCMAKE_BUILD_TYPE<span class="token operator">=</span>Release -DBUILD_SHARED_LIBS<span class="token operator">=</span><span class="token number">0</span> -DAVIF_CODEC_AOM<span class="token operator">=</span><span class="token number">1</span> -DAVIF_LOCAL_AOM<span class="token operator">=</span><span class="token number">1</span> -DAVIF_BUILD_APPS<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">..</span></code></pre>
</web-copy-code><p>Build avifenc.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell"><span class="token function">make</span></code></pre>
</web-copy-code><p>You have successfully built avifenc!</p>
<h3 id="understanding-the-avifenc-command-line-parameters">Understanding the avifenc command line parameters <a class="w-headline-link" href="#understanding-the-avifenc-command-line-parameters">#</a></h3>
<p>avifenc uses the command-line structure:</p>
<web-copy-code><pre class="language-shell"><code class="language-shell">./avifenc <span class="token punctuation">[</span>options<span class="token punctuation">]</span> input.file output.avif</code></pre>
</web-copy-code><p>The basic parameters for avifenc used in this tutorial are:</p>
<table class="w-table">
  <thead>
    <tr>
      <th>avifenc</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>--min 0</td><td>Set min quantizer for color to 0</td>
    </tr>
    <tr>
      <td>--max 63</td><td>Set max quantizer for color to 63</td>
    </tr>
    <tr>
      <td>--minalpha 0</td><td>Set min quantizer for alpha to 0</td>
    </tr>
    <tr>
      <td>--maxalpha 63</td><td>Set max quantizer for alpha to 63</td>
    </tr>
    <tr>
      <td>-a end-usage=q</td><td>Set the rate control mode to Constant Quality (Q) mode</td>
    </tr>
    <tr>
      <td>-a cq-level=Q</td><td>Set quantize level for both color and alpha to Q</td>
    </tr>
    <tr>
      <td>-a color:cq-level=Q</td><td>Set quantize level for color to Q</td>
    </tr>
    <tr>
      <td>-a alpha:cq-level=Q</td><td>Set quantize level for alpha to Q</td>
    </tr>
    <tr>
      <td>-a tune=ssim</td><td>Tune for SSIM (default is to tune for PSNR)</td>
    </tr>
    <tr>
      <td>--jobs J</td><td>Use J worker threads (default: 1)</td>
    </tr>
    <tr>
      <td>--speed S</td><td>Set encoder speed from 0-10 (slowest-fastest. default: 6)</td>
    </tr>
  </tbody>
</table>
<p>The cq-level option sets the quantize level (0-63) to control the quality for color or alpha.</p>
<div class="w-aside w-aside--note">
<p>You can think of cq-level as the &quot;amount&quot; of quantization, so a lower value yields higher quality</p>
</div>
<div class="w-aside w-aside--note">
<p>Higher speed settings will run faster,
but produce worse compression efficiency and quality.
This tutorial uses the default setting of Speed 6,
which we recommend as a balance of encode speed, compression efficiency, and quality.</p>
</div>
<h3 id="create-an-avif-image-with-default-settings">Create an AVIF image with default settings <a class="w-headline-link" href="#create-an-avif-image-with-default-settings">#</a></h3>
<p>The most basic parameters for avifenc to run, are setting the input and output files.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell">./avifenc happy_dog.jpg happy_dog.avif</code></pre>
</web-copy-code><p>We recommend the following command line to encode an image, say at quantize level 18:</p>
<web-copy-code><pre class="language-shell"><code class="language-shell">./avifenc --min <span class="token number">0</span> --max <span class="token number">63</span> -a end-usage<span class="token operator">=</span>q -a cq-level<span class="token operator">=</span><span class="token number">18</span> -a <span class="token assign-left variable">tune</span><span class="token operator">=</span>ssim happy_dog.jpg happy_dog.avif</code></pre>
</web-copy-code><div class="w-aside w-aside--note">
<p><code>&quot;--min 0 --max 63 -a end-usage=q -a cq-level=18 -a tune=ssim&quot;</code>
are the recommended settings for AVIF images.
If the image has an alpha channel,
add <code>&quot;--minalpha 0 --maxalpha 63&quot;</code>.
To specify different quantize levels for color and alpha,
replace <code>&quot;-a cq-level=18&quot;</code> with, say,
<code>&quot;-a color:cq-level=18 -a alpha:cq-level=10&quot;</code>.</p>
</div>
<p>Avifenc has a lot of options that will affect both quality and speed.
If you want to see the options and learn more about them just run <code>./avifenc</code></p>
<p>You now have your very own AVIF image!</p>
<h3 id="speeding-up-the-encoder">Speeding up the encoder <a class="w-headline-link" href="#speeding-up-the-encoder">#</a></h3>
<p>One parameter that may be good to change
depending on how many cores you have on your machine is the <code>--jobs</code> parameter.
This parameter sets how many threads avifenc will use to create AVIF images.
Try running this at the command line.</p>
<web-copy-code><pre class="language-shell"><code class="language-shell">./avifenc --min <span class="token number">0</span> --max <span class="token number">63</span> -a end-usage<span class="token operator">=</span>q -a cq-level<span class="token operator">=</span><span class="token number">18</span> -a <span class="token assign-left variable">tune</span><span class="token operator">=</span>ssim --jobs <span class="token number">8</span> happy_dog.jpg happy_dog.avif</code></pre>
</web-copy-code><p>This tells avifenc to use 8 threads when creating the AVIF image,
which speeds up AVIF encoding by roughly 5x.</p>
<h2 id="conclusion">Conclusion <a class="w-headline-link" href="#conclusion">#</a></h2>
<p>Using libaom, libavif and other open source tooling,
you can get the best image quality and performance for your website using AVIF.
The format is still relatively new,
and optimizations and tooling integrations are actively being developed.
If you have questions, comments, or feature requests,
reach out on the
<a href="https://groups.google.com/a/aomedia.org/g/av1-discuss" rel="noopener">av1-discuss mailing list</a>,
<a href="https://github.com/AOMediaCodec/community/wiki" rel="noopener">AOM Github community</a>, and
<a href="https://github.com/AOMediaCodec/av1-avif/wiki" rel="noopener">AVIF wiki</a>.</p>


    

    
  <div class="w-chips ">
    
      
    
      
        
        <a class="w-chip" href="/tags/performance/">Performance</a>
      
    
      
    
  </div>


    <div class="w-post-github-link w-mt--l w-mb--l">
      <span class="w-mr--sm">
        
        Last updated: <time>Jun 7, 2021</time>
        
      </span>
      <a
        href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/compress-images-avif/index.md"
      >
        Improve article
      </a>
       
    </div>

    
    <web-feedback additional-questions=""></web-feedback>
  </div>

  
    
    <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back
      w-article-navigation__link--single gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/blog"
  >
    Return to all articles
  </a>
</nav>
  
</div>

  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://devwebfeed.appspot.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">
              DevWeb Content Firehose
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/@ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/home"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
