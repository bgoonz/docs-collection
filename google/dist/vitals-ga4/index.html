
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=7a1cf8bac058d">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Measure and debug performance with Google Analytics 4 and BigQuery</title>
<meta name="description" content="Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio. " />

<link rel="canonical" href="https://web.dev/vitals-ga4/" />

<meta itemprop="name" content="Measure and debug performance with Google Analytics 4 and BigQuery" />
<meta itemprop="description" content="Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/vitals-ga4/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Measure and debug performance with Google Analytics 4 and BigQuery" />
<meta property="og:description" content="Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="Web Vitals logo" />
<meta property="tag" content="performance" />
<meta property="tag" content="web-vitals" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Measure and debug performance with Google Analytics 4 and BigQuery" />
<meta name="twitter:description" content="Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>








<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=b561f1f4b575b', 'module');




  loadScript('/js/content.js?v=547fb13605bfd', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="30" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
      
    
    


<div class="guide-landing-page">
  
  

  
    <img     alt="Web Vitals logo"     class="w-hero w-hero--cover"     decoding="auto"     height="480"               sizes="100vw"     src="https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/WNrgCVjmp8Gyc8EbZ9Jv.png?auto=format&w=1600 1600w"          width="1600"   />
  

  <web-table-of-contents>
    <h2 class="w-toc__header">
      <a href="#measure-and-debug-performance-with-google-analytics-4-and-bigquery" class="w-toc__header--link">
        Measure and debug performance with Google Analytics 4 and BigQuery
      </a>
    </h2>
    <div class="w-toc__list">
        <ul><li><a href="#measure">Measure</a></li><li><a href="#analyze">Analyze</a></li><li><a href="#query-web-vitals-data">Query Web Vitals data</a></li><li><a href="#example-queries">Example queries</a></li><li><a href="#debug">Debug</a></li><li><a href="#example-queries-2">Example queries</a></li><li><a href="#visualize">Visualize</a></li><li><a href="#visualize-query-results-in-data-studio">Visualize query results in Data Studio</a></li><li><a href="#materialize-web-vitals-data">Materialize Web Vitals data</a></li><li><a href="#using-the-web-vitals-connector">Using the Web Vitals Connector</a></li><li><a href="#navigate-the-dashboard">Navigate the dashboard</a></li><li><a href="#advanced-usage">Advanced usage</a></li><li><a href="#summary">Summary</a></li></ul></div>
  </web-table-of-contents>
  <web-table-of-contents-button></web-table-of-contents-button>

  
  <div class="w-actions">
    <share-action authors="@philwalton | @_mkazi_"
      class="gc-analytics-event w-actions__fab w-actions__fab--share"
      data-category="web.dev"
      data-label="share"
      data-action="click"
      data-icon="share"
      tabindex="0"
      role="button"
    >
      <span>Share</span>
    </share-action>
    <a class="w-actions__fab w-actions__fab--subscribe gc-analytics-event" data-category="web.dev" data-label="view-subscribe" data-action="click" href="/newsletter/">
  <span>subscribe</span>
</a>

  </div>

  <div class="w-layout-container--narrow w-post-content">
    <header class="w-article-header">
      
        <div class="w-post-breadcrumbs">
          <ul class="w-breadcrumbs">
  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link w-breadcrumbs__link--left-justify gc-analytics-event"
      data-category="web.dev"
      data-label="post, home breadcrumb"
      data-action="click"
      href="/"
    >
      Home
    </a>
  </li>

  <svg
    class="w-breadcrumbs__icon"
    xmlns="http://www.w3.org/2000/svg"
    height="24"
    viewBox="0 0 24 24"
    width="24"
    aria-hidden="true"
  >
    <path d="M0 0h24v24H0V0z" fill="none" />
    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
  </svg>

  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link gc-analytics-event"
      data-category="web.dev"
      data-label="post, path breadcrumb"
      data-action="click"
      href=/blog
    >
      All articles
    </a>
  </li>
</ul>
        </div>
      

      <h1 id="measure-and-debug-performance-with-google-analytics-4-and-bigquery" class="w-article-header__headline">Measure and debug performance with Google Analytics 4 and BigQuery</h1>
      
        <p class="w-article-header__subhead w-mb--non">
          <p>Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.</p>

        </p>
      

      
        <div class="w-author__published">
          <time>May 18, 2021</time>
           <span class="w-author__separator">•</span> Updated <time>May 18, 2021</time> 
        </div>
      
      

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <a href="/authors/philipwalton/"><img     alt="Philip Walton"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/philipwalton/">Philip Walton</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/philwalton"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/philipwalton">GitHub</a>
      </li>
      
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://philipwalton.com">Blog</a>
      </li>
    </ul>
  </div>
</div>
          
            <div class="w-author">
  <a href="/authors/mkazi/"><img     alt="Minhaz Kazi"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/mkazi/">Minhaz Kazi</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/_mkazi_"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/minhaz">GitHub</a>
      </li>
      
      
    </ul>
  </div>
</div>
          
        </div>
      
    </header>

    

    <p>Google provides a number of tools—<a href="https://support.google.com/webmasters/answer/9205520" rel="noopener">Search
Console</a>, <a href="https://developers.google.com/speed/pagespeed/insights/" rel="noopener">PageSpeed
Insights</a> (PSI), and
the <a href="https://developers.google.com/web/tools/chrome-user-experience-report" rel="noopener">Chrome User Experience
Report</a>
(CrUX)—that let developers see how their sites perform against the <a href="/vitals/#core-web-vitals">Core Web
Vitals</a> metrics for their real users <a href="/user-centric-performance-metrics/#in-the-field">in the
field</a>.</p>
<p>These tools are great in that they give you a high-level view of your site's
real-user performance, and they require absolutely no setup to start using.</p>
<p>However, there are a few critical reasons why you don't want to rely on these
tools alone to measure your site's performance:</p>
<ul>
<li>CrUX-based tools report data by either monthly or previous 28-day periods.
This means you'll have to wait a long time after making any changes before you
can see the results.</li>
<li>CrUX-based tools can only be segment by a limited number of dimensions, such as
country, connection type, and device category (desktop or mobile). You can't
slice the data by dimensions specific to your business (for example: engaged
users, users in a particular experiment group, etc.).</li>
<li>CrUX-based tools can tell you <em>what</em> your performance is, but they can't tell
you <em>why</em>. With analytics tools you can send additional data to help you track
down and debug issues.</li>
</ul>
<p>For these reasons, we recommend all site owners monitor Core Web Vitals metrics
using their existing analytics tool. This post explains how you can use free
tools offered by Google to do just that.</p>
<p>Once you have everything set up, you'll be able to create dashboards like these:</p>
<img     alt="Web Vitals Connector report screenshot"          decoding="async"     height="452"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format"     srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&w=1600 1600w"          width="800"   />
<img     alt="Web Vitals Connector report screenshot"          decoding="async"     height="474"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format"     srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&w=1600 1600w"          width="800"   />
<p>And If you want a visual overview of all the steps outlined here, check out <a href="https://www.youtube.com/watch?v=xg47r3Y6K8I" rel="noopener">our talk from Google I/O '21</a>:</p>
<div class="youtube">  <lite-youtube    videoid="xg47r3Y6K8I"      >  </lite-youtube></div>
<h2 id="measure">Measure <a class="w-headline-link" href="#measure">#</a></h2>
<p>Measuring performance has always been possible with Google Analytics using
<a href="https://support.google.com/analytics/answer/2709829" rel="noopener">custom metrics</a>, but there
are a few new features in <a href="https://support.google.com/analytics/answer/10089681" rel="noopener">Google Analytics
4</a> (GA4) that developers
in particular should be excited about.</p>
<ul>
<li>Zero-config, <a href="https://developers.google.com/analytics/devguides/collection/ga4/events#custom_events" rel="noopener">custom
event</a>
parameters</li>
<li>Free <a href="https://support.google.com/analytics/answer/9358801" rel="noopener">BigQuery export</a>,
so you can query your data using SQL</li>
</ul>
<p>While the Google Analytics web interface does have powerful analysis tools, it's
hard to beat the power and flexibility of raw event data access using a query
language you likely already know.</p>
<p>To get started measuring Core Web Vitals using Google Analytics 4 and BigQuery,
you need to do three things:</p>
<ol>
<li><a href="https://support.google.com/analytics/answer/10089681#start" rel="noopener">Create a Google Analytics 4
property</a> and a
<a href="https://cloud.google.com/bigquery" rel="noopener">BigQuery project</a>.</li>
<li>Enable <a href="https://support.google.com/analytics/answer/9358801" rel="noopener">BigQuery export</a>
in your Google Analytics property config, so all data you receive will be
automatically populated in your BigQuery project tables.</li>
<li>Add the <a href="https://github.com/GoogleChrome/web-vitals" rel="noopener">web-vitals</a> JavaScript
library to your site, so you can measure the Core Web Vitals metrics and
<a href="https://github.com/GoogleChrome/web-vitals#using-gtagjs-google-analytics-4" rel="noopener">send the data to Google Analytics
4</a>.</li>
</ol>
<h2 id="analyze">Analyze <a class="w-headline-link" href="#analyze">#</a></h2>
<p>Once you're all set up, you should see event data populating in the BigQuery
interface, and you should be able to query the data like this:</p>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>my_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'LCP'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'CLS'</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><p>Here's a preview of the results from that query:</p>
<img     alt="Web Vitals event data in BigQuery"          decoding="async"     height="418"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format"     srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&w=1600 1600w"          width="800"   />
<h3 id="query-web-vitals-data">Query Web Vitals data <a class="w-headline-link" href="#query-web-vitals-data">#</a></h3>
<p>Before you start querying your Web Vitals event data, it's important to
understand how the data is aggregated.</p>
<p>The most important thing to understand is that, in some cases, <a href="https://github.com/GoogleChrome/web-vitals#:~:text=In%20other%20cases%2C%20a%20metric%20callback%20may%20be%20called%20more%20than%20once%3A" rel="noopener">multiple events
may be
received</a>
for the same metric, on the same page. This can happen if the metric value
changes and an updated value is reported (a common occurrence with CLS).</p>
<p>For Web Vitals events, the last value sent is always the most accurate one, so
before performing any analysis, it's important to filter for just those values.
The code snippet provided by the web-vitals JavaScript library to send data to
Google Analytics 4 includes sending a unique ID per metric, so you can use the
following query to limit your results to just the last-received value for each
metric ID:</p>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Subquery all Web Vitals events from the last 28 days</span><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br>      <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br>    <span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>    <span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>      _TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span></code></pre>
</web-copy-code><p>Note that all other queries referenced in this post will start with this
subquery.</p>
<p>The next few sections show a few examples of common Web Vitals queries you might
want to run.</p>
<h3 id="example-queries">Example queries <a class="w-headline-link" href="#example-queries">#</a></h3>
<h4 id="lcp-fid-and-cls-at-the-75percent-percentile-(p75)-across-the-whole-site">LCP, FID, and CLS at the 75% percentile (p75) across the whole site <a class="w-headline-link" href="#lcp-fid-and-cls-at-the-75percent-percentile-(p75)-across-the-whole-site">#</a></h4>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Subquery all Web Vitals events from the last 28 days</span><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br>      <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br>    <span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>    <span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>      _TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token comment"># Main query logic</span><br><span class="token keyword">SELECT</span><br>  metric_name<span class="token punctuation">,</span><br>  APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> p75<span class="token punctuation">,</span><br>  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span><br>    metric_name<span class="token punctuation">,</span><br>    <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br>  <span class="token keyword">FROM</span> web_vitals_events<br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span></code></pre>
</web-copy-code><h4 id="all-individual-lcp-values-from-highest-to-lowest">All individual LCP values from highest to lowest <a class="w-headline-link" href="#all-individual-lcp-values-from-highest-to-lowest">#</a></h4>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Subquery all Web Vitals events from the last 28 days</span><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br>      <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br>    <span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>    <span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>      _TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token comment"># Main query logic</span><br><span class="token keyword">SELECT</span><br>  <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br><span class="token keyword">FROM</span> web_vitals_events<br><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'LCP'</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> metric_value <span class="token keyword">DESC</span></code></pre>
</web-copy-code><h4 id="lcp-scores-(p75)-of-the-10-most-popular-pages">LCP scores (p75) of the 10 most popular pages <a class="w-headline-link" href="#lcp-scores-(p75)-of-the-10-most-popular-pages">#</a></h4>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Subquery all Web Vitals events from the last 28 days</span><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br>      <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br>    <span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>    <span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>      _TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token comment"># Main query logic</span><br><span class="token keyword">SELECT</span><br>  page_path<span class="token punctuation">,</span><br>  APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> LCP<span class="token punctuation">,</span><br>  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span><br>    REGEXP_SUBSTR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"page_location"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token string">'\.com(\/[^?]*)'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br>    <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br>  <span class="token keyword">FROM</span> web_vitals_events<br>  <span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'LCP'</span><br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> count <span class="token keyword">DESC</span><br><span class="token keyword">LIMIT</span> <span class="token number">10</span></code></pre>
</web-copy-code><h4 id="top-10-pages-with-the-worst-cls-(p75)">Top 10 pages with the worst CLS (p75) <a class="w-headline-link" href="#top-10-pages-with-the-worst-cls-(p75)">#</a></h4>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Subquery all Web Vitals events from the last 28 days</span><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br>      <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br>    <span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>    <span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>      _TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token comment"># Main query logic</span><br><span class="token keyword">SELECT</span><br>  page_path<span class="token punctuation">,</span><br>  APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> CLS<span class="token punctuation">,</span><br>  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span><br>    REGEXP_SUBSTR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"page_location"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token string">'\.com(\/[^?]*)'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br>    <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br>  <span class="token keyword">FROM</span> web_vitals_events<br>  <span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'CLS'</span><br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><br><span class="token keyword">HAVING</span> count <span class="token operator">></span> <span class="token number">50</span> <span class="token comment"># Limit to relatively popular pages</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CLS <span class="token keyword">DESC</span><br><span class="token keyword">LIMIT</span> <span class="token number">10</span></code></pre>
</web-copy-code><h2 id="debug">Debug <a class="w-headline-link" href="#debug">#</a></h2>
<p>The above queries show how to query the Web Vitals metric data, which is helpful
for understanding your current performance and how it's trending over time. But
what can you do if your performance is worse than expected but you're not sure
why?</p>
<p>Knowing <em>what</em> your scores are is not helpful if you're not able to take action
and fix the problems.</p>
<p><a href="/debug-web-vitals-in-the-field/">Debug Web Vitals in the field</a> explains how
you can send additional debug information with your analytics data. If you
follow the instructions detailed in that post, you should see that debug
information appear in BigQuery as well.</p>
<p>The following queries show how to use the <code>debug_target</code> event parameter to help
identify the root cause of performance issues.</p>
<h3 id="example-queries-2">Example queries <a class="w-headline-link" href="#example-queries-2">#</a></h3>
<h4 id="top-elements-contributing-to-cls">Top elements contributing to CLS <a class="w-headline-link" href="#top-elements-contributing-to-cls">#</a></h4>
<p>The <code>debug_target</code> is a CSS selector string that corresponds to the element on
the page that is most relevant to the metric value.</p>
<p>With CLS, the <code>debug_target</code> represents the largest element from the largest
layout shift that contributed to the CLS value. If no elements shifted then the
<code>debug_target</code> value will be <code>null</code>.</p>
<p>The following query will list pages from worst to best by their CLS at the 75th
percentile, grouped by <code>debug_target</code>:</p>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Subquery all Web Vitals events from the last 28 days</span><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br>      <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br>    <span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>    <span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>      _TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token comment"># Main query logic</span><br><span class="token keyword">SELECT</span><br>  page_path<span class="token punctuation">,</span><br>  debug_target<span class="token punctuation">,</span><br>  APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> CLS<span class="token punctuation">,</span><br>  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span><br>    REGEXP_SUBSTR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"page_location"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token string">'\.com(\/[^?]*)'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"debug_target"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> debug_target<span class="token punctuation">,</span><br>    <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br>    <span class="token operator">*</span><br>  <span class="token keyword">FROM</span> web_vitals_events<br>  <span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'CLS'</span><br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><br><span class="token keyword">HAVING</span> count <span class="token operator">></span> <span class="token number">50</span> <span class="token comment"># Limit to relatively popular pages</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CLS <span class="token keyword">DESC</span></code></pre>
</web-copy-code><img     alt="Query result for top elements contributing to CLS"          decoding="async"     height="445"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format"     srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&w=1600 1600w"          width="800"   />
<p>Knowing what elements on the page are shifting should make it much easier to
identify and fix the root cause of the problem.</p>
<p>Keep in mind that the elements reported here might not be the same elements that
you see shifting when you're debugging your pages locally, which is why it's so
important to capture this data in the first place. It's very hard to fix things
that you don't realize are problems!</p>
<h4 id="debug-other-metrics">Debug other metrics <a class="w-headline-link" href="#debug-other-metrics">#</a></h4>
<p>The above query shows the results for the CLS metric, but the exact same
technique can be used to report on the debug targets for LCP and FID. Just
replace the where clause with the relevant metric to debug:</p>
<web-copy-code><pre class="language-sql"><code class="language-sql"><del class="highlight-line highlight-line-remove"><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'CLS'</span></del><br><ins class="highlight-line highlight-line-add"><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'LCP'</span></ins></code></pre>
</web-copy-code><p>Again, you can refer to <a href="/debug-web-vitals-in-the-field/">Debug Web Vitals in the
field</a> for instructions on how to collect and
send debug information for each of the Core Web Vitals metrics.</p>
<h2 id="visualize">Visualize <a class="w-headline-link" href="#visualize">#</a></h2>
<p>It can be challenging to get insights just by looking at the query results
alone. For example, the following query lists daily 75th percentile values for
LCP in the dataset.</p>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Subquery all Web Vitals events from the last 28 days</span><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br>  <span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br>      <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br>    <span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>    <span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>      _TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token comment"># Main query logic</span><br><span class="token keyword">SELECT</span><br>  event_date<span class="token punctuation">,</span><br>  metric_name<span class="token punctuation">,</span><br>  APPROX_QUANTILES<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> p75<br><span class="token keyword">FROM</span><br>  <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span><br>      event_date<span class="token punctuation">,</span><br>      metric_name<span class="token punctuation">,</span><br>      <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<br>    <span class="token keyword">FROM</span> web_vitals_events<br>    <span class="token keyword">WHERE</span><br>      metric_name <span class="token operator">=</span> <span class="token string">'LCP'</span><br>  <span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><br>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> event_date</code></pre>
</web-copy-code><p>From these query results, it's difficult to identify trends or outliers just by
looking at the data.</p>
<img     alt="Daily metric value query results"          decoding="async"     height="386"          loading="lazy"     sizes="(min-width: 400px) 400px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format"     srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&w=800 800w"          width="400"   />
<p>In such cases, visualizing the data can help you derive insights more quickly.</p>
<h3 id="visualize-query-results-in-data-studio">Visualize query results in Data Studio <a class="w-headline-link" href="#visualize-query-results-in-data-studio">#</a></h3>
<p>BigQuery provides a quick way to visualize any query results through Data
Studio. <a href="https://datastudio.google.com/" rel="noopener">Data Studio</a> is a data visualization
and dashboarding tool that is free to use. To visualize your query results,
after running your query in the BigQuery UI, click the <em>Explore Data button</em> and
select <em>Explore with Data Studio</em>.</p>
<img     alt="Explore with Data Studio option in BigQuery"          decoding="async"     height="191"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format"     srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&w=1600 1600w"          width="800"   />
<p>This will create a direct link from BigQuery into Data Studio in the explore
view. In this view, you can select the fields you want to visualize, choose
chart types, setup filters, and create ad hoc charts for quick visual analysis.
From the above query results, you can create this line chart to see the trend of
LCP values over time:</p>
<img     alt="Line chart of daily LCP values in Data Studio"          decoding="async"     height="413"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format"     srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=200 200w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=228 228w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=260 260w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=296 296w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=338 338w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=385 385w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=439 439w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=500 500w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=571 571w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=650 650w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=741 741w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=845 845w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=964 964w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&w=1600 1600w"          width="800"   />
<p>With this direct link between BigQuery and Data Studio, you can create quick
charts from any of your queries and do visual analysis. However, if you want to
do additional analysis, you might want to look at several charts in an
interactive dashboard to get a more holistic view or to be able to drill down
into the data. Having a handy dashboard means you don't have to write queries
and generate charts manually every time you want to analyze your metrics.</p>
<p>You can create a dashboard in Data Studio using the <a href="https://support.google.com/datastudio/answer/6370296" rel="noopener">native BigQuery
connector</a>. To do so,
navigate to <a href="https://datastudio.google.com" rel="noopener">datastudio.google.com</a>, create a new
data source, select the BigQuery connector, and choose the dataset you want to
work with:</p>
<img     alt="Using the BigQuery native connector in Data Studio"          decoding="async"     height="302"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format"     srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=200 200w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=228 228w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=260 260w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=296 296w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=338 338w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=385 385w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=439 439w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=500 500w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=571 571w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=650 650w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=741 741w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=845 845w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=964 964w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&w=1600 1600w"          width="800"   />
<h3 id="materialize-web-vitals-data">Materialize Web Vitals data <a class="w-headline-link" href="#materialize-web-vitals-data">#</a></h3>
<p>When creating dashboards of the Web Vitals event data as described above, it's
not efficient to use the Google Analytics 4 export dataset directly. Due to the
structure of the GA4 data and the preprocessing required for the Web Vitals
metrics, parts of your query will end up running multiple times. This creates
two problems: dashboard performance and BigQuery costs.</p>
<p>You can use the <a href="https://cloud.google.com/bigquery/docs/sandbox" rel="noopener">BigQuery sandbox
mode</a> for free. With BigQuery's
<a href="https://cloud.google.com/bigquery/pricing#free-tier" rel="noopener">free usage tier</a>, the
first 1 TB of query data processed per month is free. For the analysis methods
discussed in this post, unless you are using a significantly large dataset or
are heavily querying the dataset regularly, you should be able to stay within
this free limit every month. But if you have a high traffic website and want to
regularly monitor different metrics using a fast interactive dashboard, we
suggest preprocessing and materializing your web vitals data while making use of
BigQuery efficiency features like partitioning, clustering, and caching.</p>
<p>The following script will preprocess your BigQuery data (source table) and
create a materialized table (target table). When using this query for your own
dataset, you might also want to define a date range for the source table to
lower the amount of data processed.</p>
<web-copy-code><pre class="language-sql"><code class="language-sql"><span class="token comment"># Materialize Web Vitals metrics from GA4 event export data</span><br><br><span class="token comment"># Replace target table name</span><br><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">TABLE</span> bigquery_project_id<span class="token punctuation">.</span>ga4_demo_dev<span class="token punctuation">.</span>web_vitals_summary<br>  <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>event_timestamp<span class="token punctuation">)</span><br>  CLUSTER <span class="token keyword">BY</span> metric_name<br><span class="token keyword">AS</span><br><span class="token keyword">SELECT</span><br>  ga_session_id<span class="token punctuation">,</span><br>  <span class="token keyword">IF</span><span class="token punctuation">(</span><br>    <span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>events<span class="token punctuation">)</span> <span class="token keyword">AS</span> e <span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>event_name <span class="token operator">=</span> <span class="token string">'first_visit'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token string">'New user'</span><span class="token punctuation">,</span><br>    <span class="token string">'Returning user'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> user_type<span class="token punctuation">,</span><br>  <span class="token keyword">IF</span><span class="token punctuation">(</span><br>    <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>session_engaged<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Engaged'</span><span class="token punctuation">,</span> <span class="token string">'Not engaged'</span><span class="token punctuation">)</span><br>    <span class="token keyword">AS</span> session_engagement<span class="token punctuation">,</span><br>  evt<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">EXCEPT</span> <span class="token punctuation">(</span>session_engaged<span class="token punctuation">,</span> event_name<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  event_name <span class="token keyword">AS</span> metric_name<span class="token punctuation">,</span><br>  FORMAT_TIMESTAMP<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> event_timestamp<span class="token punctuation">)</span> <span class="token keyword">AS</span> event_date<br><span class="token keyword">FROM</span><br>  <span class="token punctuation">(</span><br>    <span class="token keyword">SELECT</span><br>      ga_session_id<span class="token punctuation">,</span><br>      ARRAY_AGG<span class="token punctuation">(</span>custom_event<span class="token punctuation">)</span> <span class="token keyword">AS</span> events<br>    <span class="token keyword">FROM</span><br>      <span class="token punctuation">(</span><br>        <span class="token keyword">SELECT</span><br>          ga_session_id<span class="token punctuation">,</span><br>          STRUCT<span class="token punctuation">(</span><br>            country<span class="token punctuation">,</span><br>            device_category<span class="token punctuation">,</span><br>            device_os<span class="token punctuation">,</span><br>            traffic_medium<span class="token punctuation">,</span><br>            traffic_name<span class="token punctuation">,</span><br>            traffic_source<span class="token punctuation">,</span><br>            page_path<span class="token punctuation">,</span><br>            debug_target<span class="token punctuation">,</span><br>            event_timestamp<span class="token punctuation">,</span><br>            event_name<span class="token punctuation">,</span><br>            metric_id<span class="token punctuation">,</span><br>            <span class="token keyword">IF</span><span class="token punctuation">(</span>event_name <span class="token operator">=</span> <span class="token string">'LCP'</span><span class="token punctuation">,</span> metric_value <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">,</span> metric_value<span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br>            user_pseudo_id<span class="token punctuation">,</span><br>            session_engaged<span class="token punctuation">,</span><br>            session_revenue<span class="token punctuation">)</span> <span class="token keyword">AS</span> custom_event<br>        <span class="token keyword">FROM</span><br>          <span class="token punctuation">(</span><br>            <span class="token keyword">SELECT</span><br>              <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'ga_session_id'</span><span class="token punctuation">)</span><br>                <span class="token keyword">AS</span> ga_session_id<span class="token punctuation">,</span><br>              <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br>                <span class="token keyword">AS</span> metric_id<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>device<span class="token punctuation">.</span>category<span class="token punctuation">)</span> <span class="token keyword">AS</span> device_category<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>device<span class="token punctuation">.</span>operating_system<span class="token punctuation">)</span> <span class="token keyword">AS</span> device_os<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>traffic_source<span class="token punctuation">.</span>medium<span class="token punctuation">)</span> <span class="token keyword">AS</span> traffic_medium<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>traffic_source<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">AS</span> traffic_name<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>traffic_source<span class="token punctuation">.</span>source<span class="token punctuation">)</span> <span class="token keyword">AS</span> traffic_source<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span><br>                REGEXP_SUBSTR<span class="token punctuation">(</span><br>                  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'page_location'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                  r<span class="token string">'^[^?]+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span><br>                <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'debug_target'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>                <span class="token keyword">AS</span> debug_target<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>user_pseudo_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> user_pseudo_id<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>geo<span class="token punctuation">.</span>country<span class="token punctuation">)</span> <span class="token keyword">AS</span> country<span class="token punctuation">,</span><br>              ANY_VALUE<span class="token punctuation">(</span>event_name<span class="token punctuation">)</span> <span class="token keyword">AS</span> event_name<span class="token punctuation">,</span><br>              <span class="token function">SUM</span><span class="token punctuation">(</span>ecommerce<span class="token punctuation">.</span>purchase_revenue<span class="token punctuation">)</span> <span class="token keyword">AS</span> session_revenue<span class="token punctuation">,</span><br>              <span class="token function">MAX</span><span class="token punctuation">(</span><br>                <span class="token punctuation">(</span><br>                  <span class="token keyword">SELECT</span><br>                    <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><br>                      <span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>                  <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span><br>                  <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'session_engaged'</span><br>                <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> session_engaged<span class="token punctuation">,</span><br>              TIMESTAMP_MICROS<span class="token punctuation">(</span><span class="token function">MAX</span><span class="token punctuation">(</span>event_timestamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> event_timestamp<span class="token punctuation">,</span><br>              <span class="token function">MAX</span><span class="token punctuation">(</span><br>                <span class="token punctuation">(</span><br>                  <span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span><br>                  <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span><br>                  <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><br>                <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br>            <span class="token keyword">FROM</span><br>              <span class="token comment"># Replace source table name</span><br>              <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br>            <span class="token keyword">WHERE</span><br>              event_name <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'LCP'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'first_visit'</span><span class="token punctuation">,</span> <span class="token string">'purchase'</span><span class="token punctuation">)</span><br>            <span class="token keyword">GROUP</span> <span class="token keyword">BY</span><br>              <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><br>          <span class="token punctuation">)</span><br>      <span class="token punctuation">)</span><br>    <span class="token keyword">WHERE</span><br>      ga_session_id <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><br>    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ga_session_id<br>  <span class="token punctuation">)</span><br><span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> UNNEST<span class="token punctuation">(</span>events<span class="token punctuation">)</span> <span class="token keyword">AS</span> evt<br><span class="token keyword">WHERE</span> evt<span class="token punctuation">.</span>event_name <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'first_visit'</span><span class="token punctuation">,</span> <span class="token string">'purchase'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>This materialized dataset has several advantages:</p>
<ul>
<li>The data structure is flattened and easier to query.</li>
<li>It retains only the Web Vitals events from the original GA4 dataset.</li>
<li>Session ID, user type (new vs returning), and session engagement information
is directly available in columns.</li>
<li>The table is
<a href="https://cloud.google.com/bigquery/docs/partitioned-tables" rel="noopener">partitioned</a> by
date and <a href="https://cloud.google.com/bigquery/docs/clustered-tables" rel="noopener">clustered</a>
by metric name. This usually reduces the amount of data processed for each
query.</li>
<li>Since you don't need to use wildcards to query this table, query results can
get cached for upto 24 hours. This reduces costs from repeating the same
query.</li>
<li>If you use the BigQuery BI engine, you can run <a href="https://cloud.google.com/bi-engine/docs/optimized-sql" rel="noopener">optimized SQL functions and
operators</a> on this
table.</li>
</ul>
<p>You can directly query this materialized table from within BigQuery UI or use it
in Data Studio using the BigQuery connector.</p>
<h3 id="using-the-web-vitals-connector">Using the Web Vitals Connector <a class="w-headline-link" href="#using-the-web-vitals-connector">#</a></h3>
<p>Since making a dashboard from scratch is time consuming, we developed a packaged
solution that will create a template dashboard for you. First make sure that you
have materialized your Web Vitals table using the above query. Then access the
Web Vitals connector for Data Studio using this link:
<a href="https://goo.gle/web-vitals-connector" rel="noopener">goo.gle/web-vitals-connector</a></p>
<p>After providing a one time authorization, you should see the following
configuration screen:</p>
<img     alt="Web Vitals Connector authorization screen"          decoding="async"     height="502"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format"     srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&w=1600 1600w"          width="800"   />
<p>Provide the materialized BigQuery table ID (i.e. the target table) and your
BigQuery billing project ID. After clicking connect, Data Studio will create a
new templated dashboard and associate your data with it.  You can edit, modify,
and share the dashboard as you like. If you create a dashboard once, you don't
have to visit the connector link again, unless you want to create multiple
dashboards from different datasets.</p>
<h3 id="navigate-the-dashboard">Navigate the dashboard <a class="w-headline-link" href="#navigate-the-dashboard">#</a></h3>
<p>As you navigate the dashboard, you can see the daily trends of the Web Vitals
metrics and some usage information for your website like users and sessions, in
the <em>Summary</em> tab.</p>
<p>In the <em>User Analysis</em> tab, you can select a metric and then get a breakdown of
the metrics percentile as well as user count by different usage and business
metrics.</p>
<p>The <em>Page Path Analysis</em> tab will help you to identify problem areas on your
website. Here, You can pick a metric to see the overview. But you also see the
scatter-map of all the page paths with the percentile value on y axis and record
count on x axis. The scatter map can help to identify pages which have lower
than expected metric values. Once you select the pages either via the scatter
chart of the <em>Page path</em> table, you can further drill down the problem area by
viewing the <em>Debug Target</em> table.</p>
<p>The <em>Revenue Analysis</em> tab is an example of how you can monitor your business
and performance metrics in the same place. This section plots all sessions where
the user made a purchase. You can compare the revenue earned vs user experience
during a specific session .</p>
<h3 id="advanced-usage">Advanced usage <a class="w-headline-link" href="#advanced-usage">#</a></h3>
<p>As you become more familiar with the dataset, you can edit the dashboard and add
your own charts for richer and targeted analysis. To make the dashboard more
useful, you can take the following steps:</p>
<ul>
<li>Setup scheduled query in BigQuery to get updated data. The materialization
query we ran above only takes a snapshot of your data at that moment. If you
want to keep your dashboard updated with new data, you can run a scheduled
query that will run every day and append your materialized table with the new
data.</li>
<li>Join first party data (e.g. CRM) for business insights. In the materialized
table, you can add <code>user_id</code> as a separate column. This will let you join your
first party data. If your first party data is not already in BigQuery, you can
either <a href="https://cloud.google.com/bigquery/docs/loading-data" rel="noopener">load the data</a> or
use a <a href="https://cloud.google.com/bigquery/external-data-sources" rel="noopener">federated data
source</a>.</li>
<li>Report your site or app version as a parameter in the data you send to Google
Analytics and add it as a column in the materialized table. Then you can add
that version data as a dimension in your charts to make it easier to see
version changes affect performance.</li>
<li>If you are expecting significantly heavy usage of the dataset through direct
query or the dashboard, you can try using the paid version of <a href="https://cloud.google.com/bi-engine/docs/introduction" rel="noopener">BigQuery BI
Engine</a>.</li>
</ul>
<h2 id="summary">Summary <a class="w-headline-link" href="#summary">#</a></h2>
<p>This post covered the basics of how to use Google Analytics 4 and BigQuery to
measure and debug performance with real-user data collected in the field. It
also explained how to build automated reports and dashboards using Data Studio
and the <a href="https://goo.gle/web-vitals-connector" rel="noopener">Web Vitals Connector</a> to make
visualizing the data as easy as possible.</p>
<p>Some key takeaways from this post:</p>
<ul>
<li>Measuring performance with real user data is critical for understanding,
debugging, and optimizing your site.</li>
<li>You can get deeper insights when your performance metrics and your business
metrics are in the same system. Google Analytics and BigQuery make this
possible.</li>
<li>BigQuery export of raw Google Analytics data gives you unlimited potential for
in-depth, custom analysis using a query language you likely already know.</li>
<li>Google has a number of APIs and visualization tools like Data Studio that give
you the freedom to build your reports exactly the way you want them to be
built.</li>
</ul>


    

    
  <div class="w-chips ">
    
      
    
      
    
      
        
        <a class="w-chip" href="/tags/performance/">Performance</a>
      
    
      
        
        <a class="w-chip" href="/tags/web-vitals/">Web Vitals</a>
      
    
  </div>


    <div class="w-post-github-link w-mt--l w-mb--l">
      <span class="w-mr--sm">
        
        Last updated: <time>May 18, 2021</time>
        
      </span>
      <a
        href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/vitals-ga4/index.md"
      >
        Improve article
      </a>
       
    </div>

    
    <web-feedback additional-questions=""></web-feedback>
  </div>

  
    
    <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back
      w-article-navigation__link--single gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/blog"
  >
    Return to all articles
  </a>
</nav>
  
</div>

  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://devwebfeed.appspot.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">
              DevWeb Content Firehose
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/@ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/home"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
