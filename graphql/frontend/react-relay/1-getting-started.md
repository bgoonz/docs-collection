### Backend

Since this is a frontend track, we donâ€™t want to spend too much time setting up the backend. This is why we use [Graphcool](https://www.graph.cool/), a service that provides a production-ready GraphQL API out-of-the-box.

#### The Data Model

Youâ€™ll use the [Graphcool CLI](https://www.graph.cool/docs/reference/cli/overview-kie1quohli/) to generate the server based on the data model that we need for the app. Speaking of the data model, here is what the final version of it looks like written in the [GraphQL Schema Definition Language](https://www.graph.cool/docs/faq/graphql-sdl-schema-definition-language-kr84dktnp0/) (SDL):

    type User {
      name: String!
      links: [Link!] @relation(name: "UsersLinks")
      votes: [Vote!] @relation(name: "UsersVotes")
    }

    type Link {
      url: String!
      postedBy: User @relation(name: "UsersLinks")
      votes: [Vote!] @relation(name: "VotesOnLink")
    }

    type Vote {
      user: User @relation(name: "UsersVotes")
      link: Link @relation(name: "VotesOnLink")
    }

#### Creating the GraphQL Server

The first thing you need to do is install the Graphcool CLI with npm.

Open up a terminal window and type the following:

    npm install -g graphcool

> **NOTE**: This tutorial uses the [legacy](https://www.graph.cool/docs/reference/service-definition/legacy-console-projects-aemieb1aev) version of [Graphcool](https://www.graph.cool/) and will be updated soon to use the new [Graphcool Framework](https://blog.graph.cool/introducing-the-graphcool-framework-d9edab2a7816). The CLI commands mentioned in tutorial are outdated, you can read more about the new CLI [here](https://www.graph.cool/docs/reference/cli/overview-kie1quohli/). If you still want to go through this tutorial, you can install the old version of the CLI using `npm install -g graphcool@0.4`.

Now you can go and create the server.

Type the following command into the terminal:

    graphcool init --schema https://graphqlbin.com/hn-relay.graphql --name Hackernews

This will execute the `graphcool init` command with two arguments:

- `--schema`: This option accepts a `.graphql`-schema thatâ€™s either stored _locally_ or at a _remote URL_. In your case, youâ€™re using the schema stored at <https://graphqlbin.com/hn-relay.graphql>, weâ€™ll take a look at it in a bit.
- `--name`: This is the name of the Graphcool project youâ€™re creating, here youâ€™re simply calling it `Hackernews`.

Note that this command will open up a browser window first and ask you to authenticate on the Graphcool platform.

The schema thatâ€™s stored at <https://graphqlbin.com/hn-relay.graphql> is identical to the one that you just saw.

Once the project was created, youâ€™ll find the [Graphcool Project File](https://www.graph.cool/docs/reference/cli/project-files-ow2yei7mew/) (`project.graphcool`) in the directory where you executed the command. It should look similar to this:

    # project: cj4liutcbackk01648jagrepi
    # version: 1

    type File @model {
      contentType: String!
      createdAt: DateTime!
      id: ID! @isUnique
      name: String!
      secret: String! @isUnique
      size: Int!
      updatedAt: DateTime!
      url: String! @isUnique
    }

    type Link @model {
      createdAt: DateTime!
      id: ID! @isUnique
      postedBy: User @relation(name: "UsersLinks")
      updatedAt: DateTime!
      url: String!
      votes: [Vote!]! @relation(name: "VotesOnLink")
    }

    type User @model {
      createdAt: DateTime!
      id: ID! @isUnique
      links: [Link!]! @relation(name: "UsersLinks")
      name: String!
      updatedAt: DateTime!
      votes: [Vote!]! @relation(name: "UsersVotes")
    }

    type Vote @model {
      createdAt: DateTime!
      id: ID! @isUnique
      link: Link @relation(name: "VotesOnLink")
      updatedAt: DateTime!
      user: User @relation(name: "UsersVotes")
    }

The top of the file contains some metadata about the project, namely the _project ID_ and the _version number of the schema_.

The [`User`](https://www.graph.cool/docs/reference/schema/system-artifacts-uhieg2shio/#user-type) and [`File`](https://www.graph.cool/docs/reference/schema/system-artifacts-uhieg2shio/#file-type) types are generated by Graphcool and have some special characteristics. `User` can be used for _authentication_ and `File` for _file management_.

Also notice that each type has three fields called `id`, `createdAt` and `updatedAt`. These are managed by the system and read-only for you.

#### Populate The Database & GraphQL Playgrounds

Before you move on to setup the frontend, go ahead and create some initial data in the project so youâ€™ve got something to see once you start rendering data in the app!

Youâ€™ll do this by using a GraphQL [Playground](https://www.graph.cool/docs/reference/console/playground-oe1ier4iej/) which is an interactive environment that allows you to send queries and mutations. Itâ€™s a great way to explore the capabilities of an API.

Open up a terminal and navigate to the directory where `project.graphcool` is located. Then execute the following command:

    graphcool playground

This command will read the project ID from the project file and open up a GraphQL Playground for that project in a browser.

The left pane of the Playground is the _editor_ that you can use to write your queries and mutations (and even subscriptions). Once you click the play button in the middle, the response to the request will be displayed in the _results_ pane on the right.

Copy the following two mutations into the _editor_ pane:

    mutation CreateGraphcoolLink {
      createLink(
        description: "The coolest GraphQL backend ðŸ˜Ž",
        url: "https://graph.cool") {
        id
      }
    }

    mutation CreateRelayLink {
      createLink(
        description: "Highly performant GraphQL client from Facebook",
        url: "https://facebook.github.io/relay/") {
        id
      }
    }

Since youâ€™re adding two mutations to the editor at once, the mutations need to have _operation names_. In your case, these are `CreateGraphcoolLink` and `CreateRelayLink`.

Click the _Play_-button in the middle of the two panes and select each mutation from the dropdown exactly once.

![Click the Play button](http://imgur.com/ZBgeq22.png)

This creates two new `Link` records in the database. You can verify that the mutations actually worked by either viewing the currently stored data in the [data browser](https://www.graph.cool/docs/reference/console/data-browser-och3ookaeb/) (simply click _DATA_ in the left side-menu) or by sending the following query in the already open Playground:

    {
      allLinks {
        id
        description
        url
      }
    }

If everything wen well, the query will return the following data:

    {
      "data": {
        "allLinks": [
          {
            "id": "cj4jo6xxat8o901420m0yy60i",
            "description": "The coolest GraphQL backend ðŸ˜Ž",
            "url": "https://graph.cool"
          },
          {
            "id": "cj4jo6z4it8on0142p7q015hc",
            "description": "Highly performant GraphQL client from Facebook",
            "url": "https://facebook.github.io/relay/"
          }
        ]
      }
    }

### Frontend

#### Creating the App

Next, you are going to create the React project! As mentioned in the beginning, youâ€™ll use `create-react-app` for that.

If you havenâ€™t already, you need to install `create-react-app` using npm:

    npm install -g create-react-app

Next, you can use it to bootstrap your React application:

    create-react-app hackernews-react-relay

This will create a new directory called `hackernews-react-relay` that has all the basic configuration setup.

Make sure everything works by navigating into the directory and starting the app:

    cd hackernews-react-relay
    yarn start

This will open a browser and navigate to `http://localhost:3000` where the app is running. If everything went well, youâ€™ll see the following:

![Navigating to localhost:3000](http://imgur.com/Yujwwi6.png)

Next you should move `project.graphcool` into the `hackernews-react-relay` directory to manage everything in one place.

To improve the project structure, you can now create two directories, both inside the `src` folder. The first is called `components` and will hold all our React components. Call the second one `styles`, that one is for all the CSS files.

Now clean up the existing files accordingly. Move `App.js` into `components` and `App.css` as well as `index.css` into `styles`.

Your project structure should now look as follows:

    .
    â”œâ”€â”€ README.md
    â”œâ”€â”€ node_modules
    â”œâ”€â”€ project.graphcool
    â”œâ”€â”€ package.json
    â”œâ”€â”€ public
    â”‚Â Â  â”œâ”€â”€ favicon.ico
    â”‚Â Â  â”œâ”€â”€ index.html
    â”‚Â Â  â””â”€â”€ manifest.json
    â”œâ”€â”€ src
    â”‚Â Â  â”œâ”€â”€ App.test.js
    â”‚Â Â  â”œâ”€â”€ components
    â”‚Â Â  â”‚Â Â  â””â”€â”€ App.js
    â”‚Â Â  â”œâ”€â”€ index.js
    â”‚Â Â  â”œâ”€â”€ logo.svg
    â”‚Â Â  â”œâ”€â”€ registerServiceWorker.js
    â”‚Â Â  â””â”€â”€ styles
    â”‚Â Â      â”œâ”€â”€ App.css
    â”‚Â Â      â””â”€â”€ index.css
    â””â”€â”€ yarn.lock

Now that youâ€™ve updated the structure of your project and moved `App.js` and `index.css` you need to make sure they are imported properly in `index.js`. Open `index.js` and update the import statements with the new relative paths:

    import './styles/index.css';
    import App from './components/App';

#### Prepare Styling

This tutorial is about the concepts of GraphQL and how you can use it from within a React application with Relay, so we want to spend the least time on styling issues. To ease up usage of CSS in this project, youâ€™ll use the [Tachyons](http://tachyons.io/) library which provides a number of CSS classes.

Open `index.html` and add a third `link` tag right below the two existing ones that pulls in Tachyons:

    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.2.1/css/tachyons.min.css"/>

Since we still want to have a bit more custom styling here and there, we also prepared some styles for you that you need to include in the project.

Open `index.css` and replace its content with the following:

    body {
      margin: 0;
      padding: 0;
      font-family: Verdana, Geneva, sans-serif;
    }

    input {
      max-width: 500px;
    }

    .gray {
      color: #828282;
    }

    .orange {
      background-color: #ff6600;
    }

    .background-gray {
      background-color: rgb(246,246,239);
    }

    .f11 {
      font-size: 11px;
    }

    .w85 {
      width: 85%;
    }

    .button {
      font-family: monospace;
      font-size: 10pt;
      color: black;
      background-color: buttonface;
      text-align: center;
      padding: 2px 6px 3px;
      border-width: 2px;
      border-style: outset;
      border-color: buttonface;
      cursor: pointer;
      max-width: 250px;
    }

#### Installing Relay Dependencies

Next, you need to pull in the functionality of Relay into your project. In particular, there are three dependencies you need to install:

1.  [`react-relay`](https://github.com/facebook/relay/tree/master/packages/react-relay): Contains major functionality of the Relay runtime and is responsible for all networking and caching tasks.
2.  [`relay-compiler`](https://github.com/facebook/relay/tree/master/packages/relay-compiler): The Relay Compiler is a tool youâ€™ll use at _build time_ to validate and optimize the GraphQL code youâ€™re writing in the project. Read more about it in the [official docs](https://facebook.github.io/relay/docs/relay-compiler.html).
3.  [`babel-plugin-relay`](https://github.com/facebook/relay/tree/master/packages/babel-plugin-relay): Relay leverages a [Babel](https://babeljs.io/) plugin to transform the GraphQL code you write in a project and bring it into the right format for the Relay Compiler. Read more about it in the [official docs](https://facebook.github.io/relay/docs/babel-plugin-relay.html).

> [Here](https://github.com/facebook/relay/tree/master/packages) is high-level overview on the architecture used for Relay Modern.

First, install the `react-relay` package:

    yarn add react-relay

Next, go ahead and add the `relay-compiler` as a development dependency:

    yarn add relay-compiler --dev

Finally, install the `babel-plugin-relay`, again only as a development dependency:

    yarn add babel-plugin-relay --dev

#### Eject from `create-react-app` to configure Babel

`create-react-app` hides all the build tooling configurations from you and provides a comfortable spot for starting out. However, in your case you actually need to do some custom Babel configurations to get Relay to work. So you need to [_eject_](https://facebook.github.io/react/blog/2016/07/22/create-apps-with-no-configuration.html#no-lock-in) from `create-react-app`.

In the terminal, use the following command:

    yarn eject

This command essentially opens up the _blackbox_ that was handed to you by `create-react-app` and letâ€™s you do the build configuration yourself. In this case, you need to add the `babel-plugin-relay` that you installed in the previous step to the build process.

Open `package.json` and add the `relay` plugin by modifying the `babel` section like so:

    "babel": {
      "presets": [
        "react-app"
      ],
      "plugins": [
        "relay"
      ]
    },

Thatâ€™s it already for the Babel configuration. Set up the Relay `Environment` in the app next!

#### Creating the Relay `Environment`

The [Relay Environment](https://facebook.github.io/relay/docs/relay-environment.html) provides the core of the Relay functionality at runtime by â€œ\[bundling\] together the configuration, cache storage, and network-handling that Relay needs in order to operate.â€

A Relay Environment needs to be instantiated with two major components:

1.  A `Network` that knows which GraphQL server it can talk to
2.  A `Store` that takes care of the caching

To achieve this, create new file in the projectâ€™s `src` directory called `Environment.js` and add the following code to it:

    // 1
    const {
      Environment,
      Network,
      RecordSource,
      Store,
    } = require('relay-runtime')

    // 2
    const store = new Store(new RecordSource())

    // 3
    const network = Network.create((operation, variables) => {
      // 4
      return fetch('__RELAY_API_ENDPOINT__', {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          query: operation.text,
          variables,
        }),
      }).then(response => {
        return response.json()
      })
    })

    // 5
    const environment = new Environment({
      network,
      store,
    })

    // 6
    export default environment

This code has been taken from the example in the [docs](https://facebook.github.io/relay/docs/relay-environment.html#a-simple-example) and was only slightly customised.

Letâ€™s quickly discuss the commented sections to understand better whatâ€™s going on:

1.  You first import the required JS modules that you need to instantiate and configure the `Environment`.
2.  Here you instantiate the required `Store` that will store the cached data.
3.  Now you create a `Network` that knows your GraphQL server from before, itâ€™s instantiated with a function that returns a `Promise` of a networking call to the GraphQL API - here thatâ€™s done using `fetch`.
4.  The `Network` needs to know the server endpoint for your API. In the next step, youâ€™ll replace the placeholder `__RELAY_API_ENDPOINT__` with your actual endpoint.
5.  With the `store` and `network` available you can instantiate the actual `Environment`.
6.  Lastly you need to export the `environment` from this module.

There are two ways for you to get your endpoint. You can either open the [Graphcool Console](https://console.graph.cool) and click the _Endoints_-button in the bottom-left corner. The second option is to use the CLI which is what youâ€™ll do now.

Open up a terminal to navigate to the root directory of your project (where `project.graphcool` is located) and execute the following command:

    graphcool endpoints

This command will display four different endpoints that each have a specific purpose. Since youâ€™re using Relay in this tutorial, you need to use the endpoint for the `Relay API`.

> Note: All endpoints follow a similar structure in that there is a fixed portion of the URL and the last part is the ID of your project. For the `Relay API`, the structure looks as follows: `https://api.graph.cool/relay/v1/<project-id>`

Copy the endpoint from the terminal output and paste it into `src/Environment.js` replacing the current placeholder `__RELAY_API_ENDPOINT__`.

#### Downloading the Schema

Before you can start using Relay, youâ€™ll need to download the _full_ GraphQL schema into your project and make it available to the Relay Compiler.

> Note: There is a difference between the GraphQL schema that you saw above and a _full_ GraphQL schema. The full schema is required for every GraphQL server since it defines all capabilities of the API by spelling out [the `Query` and `Mutation` types](http://graphql.org/learn/schema/#the-query-and-mutation-types). However, when using Graphcool, you only define a subset of this schema, namely the types of your _data model_. The rest of the schema that represents the actual API will then be generated for you.

Youâ€™ll download the schema using a tool called [`get-graphql-schema`](https://github.com/graphcool/get-graphql-schema).

First, install `get-graphql-schema` with npm by typing the following command into a terminal:

    npm install -g get-graphql-schema

Next, you need to use the endpoint for the Relay API again since thatâ€™s where `get-graphql-schema` will download the schema from.

In the terminal, navigate to the root directory of your project and execute the following command, again replacing the placeholder `__RELAY_API_ENDPOINT__` with the actual URL that you also copied into `Environment.js`:

    get-graphql-schema __RELAY_API_ENDPOINT__ > ./schema.graphql

Notice that the `>` in the this command means that the output of `get-graphql-schema __RELAY_API_ENDPOINT__` will be written to a new file called `schema.graphql`. This file needs to be placed into the root directory of your project, so the project structure should now look as follows:

    .
    â”œâ”€â”€ README.md
    â”œâ”€â”€ config
    â”œâ”€â”€ node_modules
    â”œâ”€â”€ project.graphcool
    â”œâ”€â”€ schema.graphql
    â”œâ”€â”€ package.json
    â”œâ”€â”€ public
    â”œâ”€â”€ src
    â””â”€â”€ yarn.lock

Thatâ€™s it, youâ€™re all set to start loading some data into your app! ðŸš€
