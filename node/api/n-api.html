<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>n-api</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <h1 id="node-api">Node-API</h1>
    <!--introduced_in=v8.0.0-->
    <!-- type=misc -->
    <blockquote>
      <p>Stability: 2 - Stable</p>
    </blockquote>
    <p>
      Node-API (formerly N-API) is an API for building native Addons. It is
      independent from the underlying JavaScript runtime (for example, V8) and
      is maintained as part of Node.js itself. This API will be Application
      Binary Interface (ABI) stable across versions of Node.js. It is intended
      to insulate addons from changes in the underlying JavaScript engine and
      allow modules compiled for one major version to run on later major
      versions of Node.js without recompilation. The
      <a href="https://nodejs.org/en/docs/guides/abi-stability/"
        >ABI Stability</a
      >
      guide provides a more in-depth explanation.
    </p>
    <p>
      Addons are built/packaged with the same approach/tools outlined in the
      section titled <a href="addons.md">C++ Addons</a>. The only difference is
      the set of APIs that are used by the native code. Instead of using the V8
      or
      <a href="https://github.com/nodejs/nan"
        >Native Abstractions for Node.js</a
      >
      APIs, the functions available in Node-API are used.
    </p>
    <p>
      APIs exposed by Node-API are generally used to create and manipulate
      JavaScript values. Concepts and operations generally map to ideas
      specified in the ECMA-262 Language Specification. The APIs have the
      following properties:
    </p>
    <ul>
      <li>
        All Node-API calls return a status code of type
        <code>napi_status</code>. This status indicates whether the API call
        succeeded or failed.
      </li>
      <li>The API’s return value is passed via an out parameter.</li>
      <li>
        All JavaScript values are abstracted behind an opaque type named
        <code>napi_value</code>.
      </li>
      <li>
        In case of an error status code, additional information can be obtained
        using <code>napi_get_last_error_info</code>. More information can be
        found in the error handling section
        <a href="#n_api_error_handling">Error handling</a>.
      </li>
    </ul>
    <p>
      Node-API is a C API that ensures ABI stability across Node.js versions and
      different compiler levels. A C++ API can be easier to use. To support
      using C++, the project maintains a C++ wrapper module called
      <a href="https://github.com/nodejs/node-addon-api"
        ><code>node-addon-api</code></a
      >. This wrapper provides an inlineable C++ API. Binaries built with
      <code>node-addon-api</code> will depend on the symbols for the Node-API
      C-based functions exported by Node.js. <code>node-addon-api</code> is a
      more efficient way to write code that calls Node-API. Take, for example,
      the following <code>node-addon-api</code> code. The first section shows
      the <code>node-addon-api</code> code and the second section shows what
      actually gets used in the addon.
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode cpp"
      ><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1">Object obj = Object::New(env);</a>
<a class="sourceLine" id="cb1-2" title="2">obj[<span class="st">&quot;foo&quot;</span>] = String::New(env, <span class="st">&quot;bar&quot;</span>);</a></code></pre>
    </div>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode cpp"
      ><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1">napi_status status;</a>
<a class="sourceLine" id="cb2-2" title="2">napi_value object, string;</a>
<a class="sourceLine" id="cb2-3" title="3">status = napi_create_object(env, &amp;object);</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="cf">if</span> (status != napi_ok) {</a>
<a class="sourceLine" id="cb2-5" title="5">  napi_throw_error(env, ...);</a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb2-7" title="7">}</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9">status = napi_create_string_utf8(env, <span class="st">&quot;bar&quot;</span>, NAPI_AUTO_LENGTH, &amp;string);</a>
<a class="sourceLine" id="cb2-10" title="10"><span class="cf">if</span> (status != napi_ok) {</a>
<a class="sourceLine" id="cb2-11" title="11">  napi_throw_error(env, ...);</a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb2-13" title="13">}</a>
<a class="sourceLine" id="cb2-14" title="14"></a>
<a class="sourceLine" id="cb2-15" title="15">status = napi_set_named_property(env, object, <span class="st">&quot;foo&quot;</span>, string);</a>
<a class="sourceLine" id="cb2-16" title="16"><span class="cf">if</span> (status != napi_ok) {</a>
<a class="sourceLine" id="cb2-17" title="17">  napi_throw_error(env, ...);</a>
<a class="sourceLine" id="cb2-18" title="18">  <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb2-19" title="19">}</a></code></pre>
    </div>
    <p>
      The end result is that the addon only uses the exported C APIs. As a
      result, it still gets the benefits of the ABI stability provided by the C
      API.
    </p>
    <p>
      When using <code>node-addon-api</code> instead of the C APIs, start with
      the API
      <a href="https://github.com/nodejs/node-addon-api#api-documentation"
        >docs</a
      >
      for <code>node-addon-api</code>.
    </p>
    <p>
      The
      <a href="https://nodejs.github.io/node-addon-examples/"
        >Node-API Resource</a
      > offers an excellent orientation and tips for developers just getting
      started with Node-API and <code>node-addon-api</code>.
    </p>
    <h2 id="implications-of-abi-stability">Implications of ABI stability</h2>
    <p>
      Although Node-API provides an ABI stability guarantee, other parts of
      Node.js do not, and any external libraries used from the addon may not. In
      particular, none of the following APIs provide an ABI stability guarantee
      across major versions:
    </p>
    <ul>
      <li>
        <p>the Node.js C++ APIs available via any of</p>
        <div class="sourceCode" id="cb3">
          <pre
            class="sourceCode cpp"
          ><code class="sourceCode cpp"><a class="sourceLine" id="cb3-1" title="1"><span class="pp">#include </span><span class="im">&lt;node.h&gt;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="pp">#include </span><span class="im">&lt;node_buffer.h&gt;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="pp">#include </span><span class="im">&lt;node_version.h&gt;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="pp">#include </span><span class="im">&lt;node_object_wrap.h&gt;</span></a></code></pre>
        </div>
      </li>
      <li>
        <p>
          the libuv APIs which are also included with Node.js and available via
        </p>
        <div class="sourceCode" id="cb4">
          <pre
            class="sourceCode cpp"
          ><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="pp">#include </span><span class="im">&lt;uv.h&gt;</span></a></code></pre>
        </div>
      </li>
      <li>
        <p>the V8 API available via</p>
        <div class="sourceCode" id="cb5">
          <pre
            class="sourceCode cpp"
          ><code class="sourceCode cpp"><a class="sourceLine" id="cb5-1" title="1"><span class="pp">#include </span><span class="im">&lt;v8.h&gt;</span></a></code></pre>
        </div>
      </li>
    </ul>
    <p>
      Thus, for an addon to remain ABI-compatible across Node.js major versions,
      it must use Node-API exclusively by restricting itself to using
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb6-1" title="1"><span class="pp">#include </span><span class="im">&lt;node_api.h&gt;</span></a></code></pre>
    </div>
    <p>
      and by checking, for all external libraries that it uses, that the
      external library makes ABI stability guarantees similar to Node-API.
    </p>
    <h2 id="building">Building</h2>
    <p>
      Unlike modules written in JavaScript, developing and deploying Node.js
      native addons using Node-API requires an additional set of tools. Besides
      the basic tools required to develop for Node.js, the native addon
      developer requires a toolchain that can compile C and C++ code into a
      binary. In addition, depending upon how the native addon is deployed, the
      <em>user</em> of the native addon will also need to have a C/C++ toolchain
      installed.
    </p>
    <p>
      For Linux developers, the necessary C/C++ toolchain packages are readily
      available. <a href="https://gcc.gnu.org">GCC</a> is widely used in the
      Node.js community to build and test across a variety of platforms. For
      many developers, the <a href="https://llvm.org">LLVM</a> compiler
      infrastructure is also a good choice.
    </p>
    <p>
      For Mac developers,
      <a href="https://developer.apple.com/xcode/">Xcode</a> offers all the
      required compiler tools. However, it is not necessary to install the
      entire Xcode IDE. The following command installs the necessary toolchain:
    </p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode bash"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="ex">xcode-select</span> --install</a></code></pre>
    </div>
    <p>
      For Windows developers,
      <a href="https://visualstudio.microsoft.com">Visual Studio</a> offers all
      the required compiler tools. However, it is not necessary to install the
      entire Visual Studio IDE. The following command installs the necessary
      toolchain:
    </p>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode bash"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">npm</span> install --global windows-build-tools</a></code></pre>
    </div>
    <p>
      The sections below describe the additional tools available for developing
      and deploying Node.js native addons.
    </p>
    <h3 id="build-tools">Build tools</h3>
    <p>
      Both the tools listed here require that <em>users</em> of the native addon
      have a C/C++ toolchain installed in order to successfully install the
      native addon.
    </p>
    <h4 id="node-gyp">node-gyp</h4>
    <p>
      <a href="https://github.com/nodejs/node-gyp">node-gyp</a> is a build
      system based on the
      <a href="https://github.com/nodejs/gyp-next">gyp-next</a> fork of Google’s
      <a href="https://gyp.gsrc.io">GYP</a> tool and comes bundled with npm.
      GYP, and therefore node-gyp, requires that Python be installed.
    </p>
    <p>
      Historically, node-gyp has been the tool of choice for building native
      addons. It has widespread adoption and documentation. However, some
      developers have run into limitations in node-gyp.
    </p>
    <h4 id="cmake.js">CMake.js</h4>
    <p>
      <a href="https://github.com/cmake-js/cmake-js">CMake.js</a> is an
      alternative build system based on <a href="https://cmake.org">CMake</a>.
    </p>
    <p>
      CMake.js is a good choice for projects that already use CMake or for
      developers affected by limitations in node-gyp.
    </p>
    <h3 id="uploading-precompiled-binaries">Uploading precompiled binaries</h3>
    <p>
      The three tools listed here permit native addon developers and maintainers
      to create and upload binaries to public or private servers. These tools
      are typically integrated with CI/CD build systems like
      <a href="https://travis-ci.org">Travis CI</a> and
      <a href="https://www.appveyor.com">AppVeyor</a> to build and upload
      binaries for a variety of platforms and architectures. These binaries are
      then available for download by users who do not need to have a C/C++
      toolchain installed.
    </p>
    <h4 id="node-pre-gyp">node-pre-gyp</h4>
    <p>
      <a href="https://github.com/mapbox/node-pre-gyp">node-pre-gyp</a> is a
      tool based on node-gyp that adds the ability to upload binaries to a
      server of the developer’s choice. node-pre-gyp has particularly good
      support for uploading binaries to Amazon S3.
    </p>
    <h4 id="prebuild">prebuild</h4>
    <p>
      <a href="https://github.com/prebuild/prebuild">prebuild</a> is a tool that
      supports builds using either node-gyp or CMake.js. Unlike node-pre-gyp
      which supports a variety of servers, prebuild uploads binaries only to
      <a
        href="https://help.github.com/en/github/administering-a-repository/about-releases"
        >GitHub releases</a
      >. prebuild is a good choice for GitHub projects using CMake.js.
    </p>
    <h4 id="prebuildify">prebuildify</h4>
    <p>
      <a href="https://github.com/prebuild/prebuildify">prebuildify</a> is a
      tool based on node-gyp. The advantage of prebuildify is that the built
      binaries are bundled with the native module when it’s uploaded to npm. The
      binaries are downloaded from npm and are immediately available to the
      module user when the native module is installed.
    </p>
    <h2 id="usage">Usage</h2>
    <p>
      In order to use the Node-API functions, include the file
      <a href="https://github.com/nodejs/node/blob/HEAD/src/node_api.h"
        ><code>node_api.h</code></a
      >
      which is located in the src directory in the node development tree:
    </p>
    <div class="sourceCode" id="cb9">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb9-1" title="1"><span class="pp">#include </span><span class="im">&lt;node_api.h&gt;</span></a></code></pre>
    </div>
    <p>
      This will opt into the default <code>NAPI_VERSION</code> for the given
      release of Node.js. In order to ensure compatibility with specific
      versions of Node-API, the version can be specified explicitly when
      including the header:
    </p>
    <div class="sourceCode" id="cb10">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb10-1" title="1"><span class="pp">#define NAPI_VERSION 3</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="pp">#include </span><span class="im">&lt;node_api.h&gt;</span></a></code></pre>
    </div>
    <p>
      This restricts the Node-API surface to just the functionality that was
      available in the specified (and earlier) versions.
    </p>
    <p>
      Some of the Node-API surface is experimental and requires explicit opt-in:
    </p>
    <div class="sourceCode" id="cb11">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb11-1" title="1"><span class="pp">#define NAPI_EXPERIMENTAL</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="pp">#include </span><span class="im">&lt;node_api.h&gt;</span></a></code></pre>
    </div>
    <p>
      In this case the entire API surface, including any experimental APIs, will
      be available to the module code.
    </p>
    <h2 id="node-api-version-matrix">Node-API version matrix</h2>
    <p>
      Node-API versions are additive and versioned independently from Node.js.
      Version 4 is an extension to version 3 in that it has all of the APIs from
      version 3 with some additions. This means that it is not necessary to
      recompile for new versions of Node.js which are listed as supporting a
      later version.
    </p>
    <!-- For accessibility purposes, this table needs row headers. That means we
     can't do it in markdown. Hence, the raw HTML. -->
    <table>
      <tr>
        <td></td>
        <th scope="col">1</th>
        <th scope="col">2</th>
        <th scope="col">3</th>
      </tr>
      <tr>
        <th scope="row">v6.x</th>
        <td></td>
        <td></td>
        <td>v6.14.2*</td>
      </tr>
      <tr>
        <th scope="row">v8.x</th>
        <td>v8.6.0**</td>
        <td>v8.10.0*</td>
        <td>v8.11.2</td>
      </tr>
      <tr>
        <th scope="row">v9.x</th>
        <td>v9.0.0*</td>
        <td>v9.3.0*</td>
        <td>v9.11.0*</td>
      </tr>
      <tr>
        <th scope="row">≥ v10.x</th>
        <td>all releases</td>
        <td>all releases</td>
        <td>all releases</td>
      </tr>
    </table>
    <table>
      <tr>
        <td></td>
        <th scope="col">4</th>
        <th scope="col">5</th>
        <th scope="col">6</th>
        <th scope="col">7</th>
        <th scope="col">8</th>
      </tr>
      <tr>
        <th scope="row">v10.x</th>
        <td>v10.16.0</td>
        <td>v10.17.0</td>
        <td>v10.20.0</td>
        <td>v10.23.0</td>
        <td></td>
      </tr>
      <tr>
        <th scope="row">v11.x</th>
        <td>v11.8.0</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <th scope="row">v12.x</th>
        <td>v12.0.0</td>
        <td>v12.11.0</td>
        <td>v12.17.0</td>
        <td>v12.19.0</td>
        <td>v12.22.0</td>
      </tr>
      <tr>
        <th scope="row">v13.x</th>
        <td>v13.0.0</td>
        <td>v13.0.0</td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <th scope="row">v14.x</th>
        <td>v14.0.0</td>
        <td>v14.0.0</td>
        <td>v14.0.0</td>
        <td>v14.12.0</td>
        <td>v14.17.0</td>
      </tr>
      <tr>
        <th scope="row">v15.x</th>
        <td>v15.0.0</td>
        <td>v15.0.0</td>
        <td>v15.0.0</td>
        <td>v15.0.0</td>
        <td>v15.12.0</td>
      </tr>
      <tr>
        <th scope="row">v16.x</th>
        <td>v16.0.0</td>
        <td>v16.0.0</td>
        <td>v16.0.0</td>
        <td>v16.0.0</td>
        <td>v16.0.0</td>
      </tr>
    </table>
    <p>* Node-API was experimental.</p>
    <p>
      ** Node.js 8.0.0 included Node-API as experimental. It was released as
      Node-API version 1 but continued to evolve until Node.js 8.6.0. The API is
      different in versions prior to Node.js 8.6.0. We recommend Node-API
      version 3 or later.
    </p>
    <p>
      Each API documented for Node-API will have a header named
      <code>added in:</code>, and APIs which are stable will have the additional
      header <code>Node-API version:</code>. APIs are directly usable when using
      a Node.js version which supports the Node-API version shown in
      <code>Node-API version:</code> or higher. When using a Node.js version
      that does not support the <code>Node-API version:</code> listed or if
      there is no <code>Node-API version:</code> listed, then the API will only
      be available if <code>#define NAPI_EXPERIMENTAL</code> precedes the
      inclusion of <code>node_api.h</code> or <code>js_native_api.h</code>. If
      an API appears not to be available on a version of Node.js which is later
      than the one shown in <code>added in:</code> then this is most likely the
      reason for the apparent absence.
    </p>
    <p>
      The Node-APIs associated strictly with accessing ECMAScript features from
      native code can be found separately in <code>js_native_api.h</code> and
      <code>js_native_api_types.h</code>. The APIs defined in these headers are
      included in <code>node_api.h</code> and <code>node_api_types.h</code>. The
      headers are structured in this way in order to allow implementations of
      Node-API outside of Node.js. For those implementations the Node.js
      specific APIs may not be applicable.
    </p>
    <p>
      The Node.js-specific parts of an addon can be separated from the code that
      exposes the actual functionality to the JavaScript environment so that the
      latter may be used with multiple implementations of Node-API. In the
      example below, <code>addon.c</code> and <code>addon.h</code> refer only to
      <code>js_native_api.h</code>. This ensures that <code>addon.c</code> can
      be reused to compile against either the Node.js implementation of Node-API
      or any implementation of Node-API outside of Node.js.
    </p>
    <p>
      <code>addon_node.c</code> is a separate file that contains the Node.js
      specific entry point to the addon and which instantiates the addon by
      calling into <code>addon.c</code> when the addon is loaded into a Node.js
      environment.
    </p>
    <div class="sourceCode" id="cb12">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb12-1" title="1"><span class="co">// addon.h</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="pp">#ifndef _ADDON_H_</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="pp">#define _ADDON_H_</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="pp">#include </span><span class="im">&lt;js_native_api.h&gt;</span></a>
<a class="sourceLine" id="cb12-5" title="5">napi_value create_addon(napi_env env);</a>
<a class="sourceLine" id="cb12-6" title="6"><span class="pp">#endif  </span><span class="co">// _ADDON_H_</span></a></code></pre>
    </div>
    <div class="sourceCode" id="cb13">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb13-1" title="1"><span class="co">// addon.c</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="pp">#include </span><span class="im">&quot;addon.h&quot;</span></a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="pp">#define NAPI_CALL(env, call)                                      \</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="pp">  do {                                                            \</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="pp">    napi_status status = (call);                                  \</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="pp">    if (status != napi_ok) {                                      \</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="pp">      const napi_extended_error_info* error_info = NULL;          \</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="pp">      napi_get_last_error_info((env), &amp;error_info);               \</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="pp">      bool is_pending;                                            \</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="pp">      napi_is_exception_pending((env), &amp;is_pending);              \</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="pp">      if (!is_pending) {                                          \</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="pp">        const char* message = (error_info-&gt;error_message == NULL) \</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="pp">            ? &quot;empty error message&quot;                               \</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="pp">            : error_info-&gt;error_message;                          \</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="pp">        napi_throw_error((env), NULL, message);                   \</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="pp">        return NULL;                                              \</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="pp">      }                                                           \</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="pp">    }                                                             \</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="pp">  } while(0)</span></a>
<a class="sourceLine" id="cb13-21" title="21"></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="dt">static</span> napi_value</a>
<a class="sourceLine" id="cb13-23" title="23">DoSomethingUseful(napi_env env, napi_callback_info info) {</a>
<a class="sourceLine" id="cb13-24" title="24">  <span class="co">// Do something useful.</span></a>
<a class="sourceLine" id="cb13-25" title="25">  <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb13-26" title="26">}</a>
<a class="sourceLine" id="cb13-27" title="27"></a>
<a class="sourceLine" id="cb13-28" title="28">napi_value create_addon(napi_env env) {</a>
<a class="sourceLine" id="cb13-29" title="29">  napi_value result;</a>
<a class="sourceLine" id="cb13-30" title="30">  NAPI_CALL(env, napi_create_object(env, &amp;result));</a>
<a class="sourceLine" id="cb13-31" title="31"></a>
<a class="sourceLine" id="cb13-32" title="32">  napi_value exported_function;</a>
<a class="sourceLine" id="cb13-33" title="33">  NAPI_CALL(env, napi_create_function(env,</a>
<a class="sourceLine" id="cb13-34" title="34">                                      <span class="st">&quot;doSomethingUseful&quot;</span>,</a>
<a class="sourceLine" id="cb13-35" title="35">                                      NAPI_AUTO_LENGTH,</a>
<a class="sourceLine" id="cb13-36" title="36">                                      DoSomethingUseful,</a>
<a class="sourceLine" id="cb13-37" title="37">                                      NULL,</a>
<a class="sourceLine" id="cb13-38" title="38">                                      &amp;exported_function));</a>
<a class="sourceLine" id="cb13-39" title="39"></a>
<a class="sourceLine" id="cb13-40" title="40">  NAPI_CALL(env, napi_set_named_property(env,</a>
<a class="sourceLine" id="cb13-41" title="41">                                         result,</a>
<a class="sourceLine" id="cb13-42" title="42">                                         <span class="st">&quot;doSomethingUseful&quot;</span>,</a>
<a class="sourceLine" id="cb13-43" title="43">                                         exported_function));</a>
<a class="sourceLine" id="cb13-44" title="44"></a>
<a class="sourceLine" id="cb13-45" title="45">  <span class="cf">return</span> result;</a>
<a class="sourceLine" id="cb13-46" title="46">}</a></code></pre>
    </div>
    <div class="sourceCode" id="cb14">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb14-1" title="1"><span class="co">// addon_node.c</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="pp">#include </span><span class="im">&lt;node_api.h&gt;</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="pp">#include </span><span class="im">&quot;addon.h&quot;</span></a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5">NAPI_MODULE_INIT() {</a>
<a class="sourceLine" id="cb14-6" title="6">  <span class="co">// This function body is expected to return a `napi_value`.</span></a>
<a class="sourceLine" id="cb14-7" title="7">  <span class="co">// The variables `napi_env env` and `napi_value exports` may be used within</span></a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="co">// the body, as they are provided by the definition of `NAPI_MODULE_INIT()`.</span></a>
<a class="sourceLine" id="cb14-9" title="9">  <span class="cf">return</span> create_addon(env);</a>
<a class="sourceLine" id="cb14-10" title="10">}</a></code></pre>
    </div>
    <h2 id="environment-life-cycle-apis">Environment life cycle APIs</h2>
    <p>
      <a href="https://tc39.es/ecma262/#sec-agents">Section 8.7</a> of the
      <a href="https://tc39.github.io/ecma262/"
        >ECMAScript Language Specification</a
      >
      defines the concept of an “Agent” as a self-contained environment in which
      JavaScript code runs. Multiple such Agents may be started and terminated
      either concurrently or in sequence by the process.
    </p>
    <p>
      A Node.js environment corresponds to an ECMAScript Agent. In the main
      process, an environment is created at startup, and additional environments
      can be created on separate threads to serve as
      <a href="https://nodejs.org/api/worker_threads.html">worker threads</a>.
      When Node.js is embedded in another application, the main thread of the
      application may also construct and destroy a Node.js environment multiple
      times during the life cycle of the application process such that each
      Node.js environment created by the application may, in turn, during its
      life cycle create and destroy additional environments as worker threads.
    </p>
    <p>
      From the perspective of a native addon this means that the bindings it
      provides may be called multiple times, from multiple contexts, and even
      concurrently from multiple threads.
    </p>
    <p>
      Native addons may need to allocate global state which they use during
      their entire life cycle such that the state must be unique to each
      instance of the addon.
    </p>
    <p>
      To this end, Node-API provides a way to allocate data such that its life
      cycle is tied to the life cycle of the Agent.
    </p>
    <h3 id="napi_set_instance_data">napi_set_instance_data</h3>
    <!-- YAML
added:
 - v12.8.0
 - v10.20.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb15">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb15-1" title="1">napi_status napi_set_instance_data(napi_env env,</a>
<a class="sourceLine" id="cb15-2" title="2">                                   <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb15-3" title="3">                                   napi_finalize finalize_cb,</a>
<a class="sourceLine" id="cb15-4" title="4">                                   <span class="dt">void</span>* finalize_hint);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] data</code>: The data item to make available to bindings of
        this instance.
      </li>
      <li>
        <code>[in] finalize_cb</code>: The function to call when the environment
        is being torn down. The function receives <code>data</code> so that it
        might free it.
        <a href="#n_api_napi_finalize"><code>napi_finalize</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] finalize_hint</code>: Optional hint to pass to the finalize
        callback during collection.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API associates <code>data</code> with the currently running Agent.
      <code>data</code> can later be retrieved using
      <code>napi_get_instance_data()</code>. Any existing data associated with
      the currently running Agent which was set by means of a previous call to
      <code>napi_set_instance_data()</code> will be overwritten. If a
      <code>finalize_cb</code> was provided by the previous call, it will not be
      called.
    </p>
    <h3 id="napi_get_instance_data">napi_get_instance_data</h3>
    <!-- YAML
added:
 - v12.8.0
 - v10.20.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb16">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb16-1" title="1">napi_status napi_get_instance_data(napi_env env,</a>
<a class="sourceLine" id="cb16-2" title="2">                                   <span class="dt">void</span>** data);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[out] data</code>: The data item that was previously associated
        with the currently running Agent by a call to
        <code>napi_set_instance_data()</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API retrieves data that was previously associated with the currently
      running Agent via <code>napi_set_instance_data()</code>. If no data is
      set, the call will succeed and <code>data</code> will be set to
      <code>NULL</code>.
    </p>
    <h2 id="basic-node-api-data-types">Basic Node-API data types</h2>
    <p>
      Node-API exposes the following fundamental datatypes as abstractions that
      are consumed by the various APIs. These APIs should be treated as opaque,
      introspectable only with other Node-API calls.
    </p>
    <h3 id="napi_status">napi_status</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      Integral status code indicating the success or failure of a Node-API call.
      Currently, the following status codes are supported.
    </p>
    <div class="sourceCode" id="cb17">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb17-2" title="2">  napi_ok,</a>
<a class="sourceLine" id="cb17-3" title="3">  napi_invalid_arg,</a>
<a class="sourceLine" id="cb17-4" title="4">  napi_object_expected,</a>
<a class="sourceLine" id="cb17-5" title="5">  napi_string_expected,</a>
<a class="sourceLine" id="cb17-6" title="6">  napi_name_expected,</a>
<a class="sourceLine" id="cb17-7" title="7">  napi_function_expected,</a>
<a class="sourceLine" id="cb17-8" title="8">  napi_number_expected,</a>
<a class="sourceLine" id="cb17-9" title="9">  napi_boolean_expected,</a>
<a class="sourceLine" id="cb17-10" title="10">  napi_array_expected,</a>
<a class="sourceLine" id="cb17-11" title="11">  napi_generic_failure,</a>
<a class="sourceLine" id="cb17-12" title="12">  napi_pending_exception,</a>
<a class="sourceLine" id="cb17-13" title="13">  napi_cancelled,</a>
<a class="sourceLine" id="cb17-14" title="14">  napi_escape_called_twice,</a>
<a class="sourceLine" id="cb17-15" title="15">  napi_handle_scope_mismatch,</a>
<a class="sourceLine" id="cb17-16" title="16">  napi_callback_scope_mismatch,</a>
<a class="sourceLine" id="cb17-17" title="17">  napi_queue_full,</a>
<a class="sourceLine" id="cb17-18" title="18">  napi_closing,</a>
<a class="sourceLine" id="cb17-19" title="19">  napi_bigint_expected,</a>
<a class="sourceLine" id="cb17-20" title="20">  napi_date_expected,</a>
<a class="sourceLine" id="cb17-21" title="21">  napi_arraybuffer_expected,</a>
<a class="sourceLine" id="cb17-22" title="22">  napi_detachable_arraybuffer_expected,</a>
<a class="sourceLine" id="cb17-23" title="23">  napi_would_deadlock,  <span class="co">/* unused */</span></a>
<a class="sourceLine" id="cb17-24" title="24">} napi_status;</a></code></pre>
    </div>
    <p>
      If additional information is required upon an API returning a failed
      status, it can be obtained by calling
      <code>napi_get_last_error_info</code>.
    </p>
    <h3 id="napi_extended_error_info">napi_extended_error_info</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb18">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">typedef</span> <span class="kw">struct</span> {</a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="dt">const</span> <span class="dt">char</span>* error_message;</a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="dt">void</span>* engine_reserved;</a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="dt">uint32_t</span> engine_error_code;</a>
<a class="sourceLine" id="cb18-5" title="5">  napi_status error_code;</a>
<a class="sourceLine" id="cb18-6" title="6">} napi_extended_error_info;</a></code></pre>
    </div>
    <ul>
      <li>
        <code>error_message</code>: UTF8-encoded string containing a VM-neutral
        description of the error.
      </li>
      <li>
        <code>engine_reserved</code>: Reserved for VM-specific error details.
        This is currently not implemented for any VM.
      </li>
      <li>
        <code>engine_error_code</code>: VM-specific error code. This is
        currently not implemented for any VM.
      </li>
      <li>
        <code>error_code</code>: The Node-API status code that originated with
        the last error.
      </li>
    </ul>
    <p>
      See the <a href="#n_api_error_handling">Error handling</a> section for
      additional information.
    </p>
    <h3 id="napi_env">napi_env</h3>
    <p>
      <code>napi_env</code> is used to represent a context that the underlying
      Node-API implementation can use to persist VM-specific state. This
      structure is passed to native functions when they’re invoked, and it must
      be passed back when making Node-API calls. Specifically, the same
      <code>napi_env</code> that was passed in when the initial native function
      was called must be passed to any subsequent nested Node-API calls. Caching
      the <code>napi_env</code> for the purpose of general reuse, and passing
      the <code>napi_env</code> between instances of the same addon running on
      different
      <a href="worker_threads.md#worker_threads_class_worker"
        ><code>Worker</code></a
      >
      threads is not allowed. The <code>napi_env</code> becomes invalid when an
      instance of a native addon is unloaded. Notification of this event is
      delivered through the callbacks given to
      <a href="#n_api_napi_add_env_cleanup_hook"
        ><code>napi_add_env_cleanup_hook</code></a
      >
      and
      <a href="#n_api_napi_set_instance_data"
        ><code>napi_set_instance_data</code></a
      >.
    </p>
    <h3 id="napi_value">napi_value</h3>
    <p>
      This is an opaque pointer that is used to represent a JavaScript value.
    </p>
    <h3 id="napi_threadsafe_function">napi_threadsafe_function</h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <p>
      This is an opaque pointer that represents a JavaScript function which can
      be called asynchronously from multiple threads via
      <code>napi_call_threadsafe_function()</code>.
    </p>
    <h3 id="napi_threadsafe_function_release_mode">
      napi_threadsafe_function_release_mode
    </h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <p>
      A value to be given to <code>napi_release_threadsafe_function()</code> to
      indicate whether the thread-safe function is to be closed immediately
      (<code>napi_tsfn_abort</code>) or merely released
      (<code>napi_tsfn_release</code>) and thus available for subsequent use via
      <code>napi_acquire_threadsafe_function()</code> and
      <code>napi_call_threadsafe_function()</code>.
    </p>
    <div class="sourceCode" id="cb19">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb19-2" title="2">  napi_tsfn_release,</a>
<a class="sourceLine" id="cb19-3" title="3">  napi_tsfn_abort</a>
<a class="sourceLine" id="cb19-4" title="4">} napi_threadsafe_function_release_mode;</a></code></pre>
    </div>
    <h3 id="napi_threadsafe_function_call_mode">
      napi_threadsafe_function_call_mode
    </h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <p>
      A value to be given to <code>napi_call_threadsafe_function()</code> to
      indicate whether the call should block whenever the queue associated with
      the thread-safe function is full.
    </p>
    <div class="sourceCode" id="cb20">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb20-2" title="2">  napi_tsfn_nonblocking,</a>
<a class="sourceLine" id="cb20-3" title="3">  napi_tsfn_blocking</a>
<a class="sourceLine" id="cb20-4" title="4">} napi_threadsafe_function_call_mode;</a></code></pre>
    </div>
    <h3 id="node-api-memory-management-types">
      Node-API memory management types
    </h3>
    <h4 id="napi_handle_scope">napi_handle_scope</h4>
    <p>
      This is an abstraction used to control and modify the lifetime of objects
      created within a particular scope. In general, Node-API values are created
      within the context of a handle scope. When a native method is called from
      JavaScript, a default handle scope will exist. If the user does not
      explicitly create a new handle scope, Node-API values will be created in
      the default handle scope. For any invocations of code outside the
      execution of a native method (for instance, during a libuv callback
      invocation), the module is required to create a scope before invoking any
      functions that can result in the creation of JavaScript values.
    </p>
    <p>
      Handle scopes are created using
      <a href="#n_api_napi_open_handle_scope"
        ><code>napi_open_handle_scope</code></a
      >
      and are destroyed using
      <a href="#n_api_napi_close_handle_scope"
        ><code>napi_close_handle_scope</code></a
      >. Closing the scope can indicate to the GC that all
      <code>napi_value</code>s created during the lifetime of the handle scope
      are no longer referenced from the current stack frame.
    </p>
    <p>
      For more details, review the
      <a href="#n_api_object_lifetime_management">Object lifetime management</a
      >.
    </p>
    <h4 id="napi_escapable_handle_scope">napi_escapable_handle_scope</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      Escapable handle scopes are a special type of handle scope to return
      values created within a particular handle scope to a parent scope.
    </p>
    <h4 id="napi_ref">napi_ref</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      This is the abstraction to use to reference a <code>napi_value</code>.
      This allows for users to manage the lifetimes of JavaScript values,
      including defining their minimum lifetimes explicitly.
    </p>
    <p>
      For more details, review the
      <a href="#n_api_object_lifetime_management">Object lifetime management</a
      >.
    </p>
    <h4 id="napi_type_tag">napi_type_tag</h4>
    <!-- YAML
added:
  - v14.8.0
  - v12.19.0
napiVersion: 8
-->
    <p>
      A 128-bit value stored as two unsigned 64-bit integers. It serves as a
      UUID with which JavaScript objects can be “tagged” in order to ensure that
      they are of a certain type. This is a stronger check than
      <a href="#n_api_napi_instanceof"><code>napi_instanceof</code></a
      >, because the latter can report a false positive if the object’s
      prototype has been manipulated. Type-tagging is most useful in conjunction
      with <a href="#n_api_napi_wrap"><code>napi_wrap</code></a> because it
      ensures that the pointer retrieved from a wrapped object can be safely
      cast to the native type corresponding to the type tag that had been
      previously applied to the JavaScript object.
    </p>
    <div class="sourceCode" id="cb21">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">typedef</span> <span class="kw">struct</span> {</a>
<a class="sourceLine" id="cb21-2" title="2">  <span class="dt">uint64_t</span> lower;</a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="dt">uint64_t</span> upper;</a>
<a class="sourceLine" id="cb21-4" title="4">} napi_type_tag;</a></code></pre>
    </div>
    <h4 id="napi_async_cleanup_hook_handle">napi_async_cleanup_hook_handle</h4>
    <!-- YAML
added:
  - v14.10.0
  - v12.19.0
-->
    <p>
      An opaque value returned by
      <a href="#n_api_napi_add_async_cleanup_hook"
        ><code>napi_add_async_cleanup_hook</code></a
      >. It must be passed to
      <a href="#n_api_napi_remove_async_cleanup_hook"
        ><code>napi_remove_async_cleanup_hook</code></a
      >
      when the chain of asynchronous cleanup events completes.
    </p>
    <h3 id="node-api-callback-types">Node-API callback types</h3>
    <h4 id="napi_callback_info">napi_callback_info</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      Opaque datatype that is passed to a callback function. It can be used for
      getting additional information about the context in which the callback was
      invoked.
    </p>
    <h4 id="napi_callback">napi_callback</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      Function pointer type for user-provided native functions which are to be
      exposed to JavaScript via Node-API. Callback functions should satisfy the
      following signature:
    </p>
    <div class="sourceCode" id="cb22">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">typedef</span> napi_value (*napi_callback)(napi_env, napi_callback_info);</a></code></pre>
    </div>
    <p>
      Unless for reasons discussed in
      <a href="#n_api_object_lifetime_management">Object Lifetime Management</a
      >, creating a handle and/or callback scope inside a
      <code>napi_callback</code> is not necessary.
    </p>
    <h4 id="napi_finalize">napi_finalize</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      Function pointer type for add-on provided functions that allow the user to
      be notified when externally-owned data is ready to be cleaned up because
      the object with which it was associated with, has been garbage-collected.
      The user must provide a function satisfying the following signature which
      would get called upon the object’s collection. Currently,
      <code>napi_finalize</code> can be used for finding out when objects that
      have external data are collected.
    </p>
    <div class="sourceCode" id="cb23">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">typedef</span> <span class="dt">void</span> (*napi_finalize)(napi_env env,</a>
<a class="sourceLine" id="cb23-2" title="2">                              <span class="dt">void</span>* finalize_data,</a>
<a class="sourceLine" id="cb23-3" title="3">                              <span class="dt">void</span>* finalize_hint);</a></code></pre>
    </div>
    <p>
      Unless for reasons discussed in
      <a href="#n_api_object_lifetime_management">Object Lifetime Management</a
      >, creating a handle and/or callback scope inside the function body is not
      necessary.
    </p>
    <h4 id="napi_async_execute_callback">napi_async_execute_callback</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      Function pointer used with functions that support asynchronous operations.
      Callback functions must satisfy the following signature:
    </p>
    <div class="sourceCode" id="cb24">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">typedef</span> <span class="dt">void</span> (*napi_async_execute_callback)(napi_env env, <span class="dt">void</span>* data);</a></code></pre>
    </div>
    <p>
      Implementations of this function must avoid making Node-API calls that
      execute JavaScript or interact with JavaScript objects. Node-API calls
      should be in the <code>napi_async_complete_callback</code> instead. Do not
      use the <code>napi_env</code> parameter as it will likely result in
      execution of JavaScript.
    </p>
    <h4 id="napi_async_complete_callback">napi_async_complete_callback</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <p>
      Function pointer used with functions that support asynchronous operations.
      Callback functions must satisfy the following signature:
    </p>
    <div class="sourceCode" id="cb25">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">typedef</span> <span class="dt">void</span> (*napi_async_complete_callback)(napi_env env,</a>
<a class="sourceLine" id="cb25-2" title="2">                                             napi_status status,</a>
<a class="sourceLine" id="cb25-3" title="3">                                             <span class="dt">void</span>* data);</a></code></pre>
    </div>
    <p>
      Unless for reasons discussed in
      <a href="#n_api_object_lifetime_management">Object Lifetime Management</a
      >, creating a handle and/or callback scope inside the function body is not
      necessary.
    </p>
    <h4 id="napi_threadsafe_function_call_js">
      napi_threadsafe_function_call_js
    </h4>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <p>
      Function pointer used with asynchronous thread-safe function calls. The
      callback will be called on the main thread. Its purpose is to use a data
      item arriving via the queue from one of the secondary threads to construct
      the parameters necessary for a call into JavaScript, usually via
      <code>napi_call_function</code>, and then make the call into JavaScript.
    </p>
    <p>
      The data arriving from the secondary thread via the queue is given in the
      <code>data</code> parameter and the JavaScript function to call is given
      in the <code>js_callback</code> parameter.
    </p>
    <p>
      Node-API sets up the environment prior to calling this callback, so it is
      sufficient to call the JavaScript function via
      <code>napi_call_function</code> rather than via
      <code>napi_make_callback</code>.
    </p>
    <p>Callback functions must satisfy the following signature:</p>
    <div class="sourceCode" id="cb26">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">typedef</span> <span class="dt">void</span> (*napi_threadsafe_function_call_js)(napi_env env,</a>
<a class="sourceLine" id="cb26-2" title="2">                                                 napi_value js_callback,</a>
<a class="sourceLine" id="cb26-3" title="3">                                                 <span class="dt">void</span>* context,</a>
<a class="sourceLine" id="cb26-4" title="4">                                                 <span class="dt">void</span>* data);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment to use for API calls, or
        <code>NULL</code> if the thread-safe function is being torn down and
        <code>data</code> may need to be freed.
      </li>
      <li>
        <code>[in] js_callback</code>: The JavaScript function to call, or
        <code>NULL</code> if the thread-safe function is being torn down and
        <code>data</code> may need to be freed. It may also be
        <code>NULL</code> if the thread-safe function was created without
        <code>js_callback</code>.
      </li>
      <li>
        <code>[in] context</code>: The optional data with which the thread-safe
        function was created.
      </li>
      <li>
        <code>[in] data</code>: Data created by the secondary thread. It is the
        responsibility of the callback to convert this native data to JavaScript
        values (with Node-API functions) that can be passed as parameters when
        <code>js_callback</code> is invoked. This pointer is managed entirely by
        the threads and this callback. Thus this callback should free the data.
      </li>
    </ul>
    <p>
      Unless for reasons discussed in
      <a href="#n_api_object_lifetime_management">Object Lifetime Management</a
      >, creating a handle and/or callback scope inside the function body is not
      necessary.
    </p>
    <h4 id="napi_async_cleanup_hook">napi_async_cleanup_hook</h4>
    <!-- YAML
added:
  - v14.10.0
  - v12.19.0
-->
    <p>
      Function pointer used with
      <a href="#n_api_napi_add_async_cleanup_hook"
        ><code>napi_add_async_cleanup_hook</code></a
      >. It will be called when the environment is being torn down.
    </p>
    <p>Callback functions must satisfy the following signature:</p>
    <div class="sourceCode" id="cb27">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">typedef</span> <span class="dt">void</span> (*napi_async_cleanup_hook)(napi_async_cleanup_hook_handle handle,</a>
<a class="sourceLine" id="cb27-2" title="2">                                        <span class="dt">void</span>* data);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] handle</code>: The handle that must be passed to
        <a href="#n_api_napi_remove_async_cleanup_hook"
          ><code>napi_remove_async_cleanup_hook</code></a
        >
        after completion of the asynchronous cleanup.
      </li>
      <li>
        <code>[in] data</code>: The data that was passed to
        <a href="#n_api_napi_add_async_cleanup_hook"
          ><code>napi_add_async_cleanup_hook</code></a
        >.
      </li>
    </ul>
    <p>
      The body of the function should initiate the asynchronous cleanup actions
      at the end of which <code>handle</code> must be passed in a call to
      <a href="#n_api_napi_remove_async_cleanup_hook"
        ><code>napi_remove_async_cleanup_hook</code></a
      >.
    </p>
    <h2 id="error-handling">Error handling</h2>
    <p>
      Node-API uses both return values and JavaScript exceptions for error
      handling. The following sections explain the approach for each case.
    </p>
    <h3 id="return-values">Return values</h3>
    <p>
      All of the Node-API functions share the same error handling pattern. The
      return type of all API functions is <code>napi_status</code>.
    </p>
    <p>
      The return value will be <code>napi_ok</code> if the request was
      successful and no uncaught JavaScript exception was thrown. If an error
      occurred AND an exception was thrown, the <code>napi_status</code> value
      for the error will be returned. If an exception was thrown, and no error
      occurred, <code>napi_pending_exception</code> will be returned.
    </p>
    <p>
      In cases where a return value other than <code>napi_ok</code> or
      <code>napi_pending_exception</code> is returned,
      <a href="#n_api_napi_is_exception_pending"
        ><code>napi_is_exception_pending</code></a
      >
      must be called to check if an exception is pending. See the section on
      exceptions for more details.
    </p>
    <p>
      The full set of possible <code>napi_status</code> values is defined in
      <code>napi_api_types.h</code>.
    </p>
    <p>
      The <code>napi_status</code> return value provides a VM-independent
      representation of the error which occurred. In some cases it is useful to
      be able to get more detailed information, including a string representing
      the error as well as VM (engine)-specific information.
    </p>
    <p>
      In order to retrieve this information
      <a href="#n_api_napi_get_last_error_info"
        ><code>napi_get_last_error_info</code></a
      >
      is provided which returns a
      <code>napi_extended_error_info</code> structure. The format of the
      <code>napi_extended_error_info</code> structure is as follows:
    </p>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb28">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">typedef</span> <span class="kw">struct</span> napi_extended_error_info {</a>
<a class="sourceLine" id="cb28-2" title="2">  <span class="dt">const</span> <span class="dt">char</span>* error_message;</a>
<a class="sourceLine" id="cb28-3" title="3">  <span class="dt">void</span>* engine_reserved;</a>
<a class="sourceLine" id="cb28-4" title="4">  <span class="dt">uint32_t</span> engine_error_code;</a>
<a class="sourceLine" id="cb28-5" title="5">  napi_status error_code;</a>
<a class="sourceLine" id="cb28-6" title="6">};</a></code></pre>
    </div>
    <ul>
      <li>
        <code>error_message</code>: Textual representation of the error that
        occurred.
      </li>
      <li>
        <code>engine_reserved</code>: Opaque handle reserved for engine use
        only.
      </li>
      <li><code>engine_error_code</code>: VM specific error code.</li>
      <li><code>error_code</code>: Node-API status code for the last error.</li>
    </ul>
    <p>
      <a href="#n_api_napi_get_last_error_info"
        ><code>napi_get_last_error_info</code></a
      >
      returns the information for the last Node-API call that was made.
    </p>
    <p>
      Do not rely on the content or format of any of the extended information as
      it is not subject to SemVer and may change at any time. It is intended
      only for logging purposes.
    </p>
    <h4 id="napi_get_last_error_info">napi_get_last_error_info</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb29">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb29-1" title="1">napi_status</a>
<a class="sourceLine" id="cb29-2" title="2">napi_get_last_error_info(napi_env env,</a>
<a class="sourceLine" id="cb29-3" title="3">                         <span class="dt">const</span> napi_extended_error_info** result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: The
        <code>napi_extended_error_info</code> structure with more information
        about the error.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API retrieves a <code>napi_extended_error_info</code> structure with
      information about the last error that occurred.
    </p>
    <p>
      The content of the <code>napi_extended_error_info</code> returned is only
      valid up until a Node-API function is called on the same <code>env</code>.
    </p>
    <p>
      Do not rely on the content or format of any of the extended information as
      it is not subject to SemVer and may change at any time. It is intended
      only for logging purposes.
    </p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h3 id="exceptions">Exceptions</h3>
    <p>
      Any Node-API function call may result in a pending JavaScript exception.
      This is the case for any of the API functions, even those that may not
      cause the execution of JavaScript.
    </p>
    <p>
      If the <code>napi_status</code> returned by a function is
      <code>napi_ok</code> then no exception is pending and no additional action
      is required. If the <code>napi_status</code> returned is anything other
      than <code>napi_ok</code> or <code>napi_pending_exception</code>, in order
      to try to recover and continue instead of simply returning immediately,
      <a href="#n_api_napi_is_exception_pending"
        ><code>napi_is_exception_pending</code></a
      >
      must be called in order to determine if an exception is pending or not.
    </p>
    <p>
      In many cases when a Node-API function is called and an exception is
      already pending, the function will return immediately with a
      <code>napi_status</code> of <code>napi_pending_exception</code>. However,
      this is not the case for all functions. Node-API allows a subset of the
      functions to be called to allow for some minimal cleanup before returning
      to JavaScript. In that case, <code>napi_status</code> will reflect the
      status for the function. It will not reflect previous pending exceptions.
      To avoid confusion, check the error status after every function call.
    </p>
    <p>When an exception is pending one of two approaches can be employed.</p>
    <p>
      The first approach is to do any appropriate cleanup and then return so
      that execution will return to JavaScript. As part of the transition back
      to JavaScript, the exception will be thrown at the point in the JavaScript
      code where the native method was invoked. The behavior of most Node-API
      calls is unspecified while an exception is pending, and many will simply
      return <code>napi_pending_exception</code>, so do as little as possible
      and then return to JavaScript where the exception can be handled.
    </p>
    <p>
      The second approach is to try to handle the exception. There will be cases
      where the native code can catch the exception, take the appropriate
      action, and then continue. This is only recommended in specific cases
      where it is known that the exception can be safely handled. In these cases
      <a href="#n_api_napi_get_and_clear_last_exception"
        ><code>napi_get_and_clear_last_exception</code></a
      >
      can be used to get and clear the exception. On success, result will
      contain the handle to the last JavaScript <code>Object</code> thrown. If
      it is determined, after retrieving the exception, the exception cannot be
      handled after all it can be re-thrown it with
      <a href="#n_api_napi_throw"><code>napi_throw</code></a> where error is the
      JavaScript value to be thrown.
    </p>
    <p>
      The following utility functions are also available in case native code
      needs to throw an exception or determine if a <code>napi_value</code> is
      an instance of a JavaScript <code>Error</code> object:
      <a href="#n_api_napi_throw_error"><code>napi_throw_error</code></a
      >,
      <a href="#n_api_napi_throw_type_error"
        ><code>napi_throw_type_error</code></a
      >,
      <a href="#n_api_napi_throw_range_error"
        ><code>napi_throw_range_error</code></a
      >
      and <a href="#n_api_napi_is_error"><code>napi_is_error</code></a
      >.
    </p>
    <p>
      The following utility functions are also available in case native code
      needs to create an <code>Error</code> object:
      <a href="#n_api_napi_create_error"><code>napi_create_error</code></a
      >,
      <a href="#n_api_napi_create_type_error"
        ><code>napi_create_type_error</code></a
      >, and
      <a href="#n_api_napi_create_range_error"
        ><code>napi_create_range_error</code></a
      >, where result is the <code>napi_value</code> that refers to the newly
      created JavaScript <code>Error</code> object.
    </p>
    <p>
      The Node.js project is adding error codes to all of the errors generated
      internally. The goal is for applications to use these error codes for all
      error checking. The associated error messages will remain, but will only
      be meant to be used for logging and display with the expectation that the
      message can change without SemVer applying. In order to support this model
      with Node-API, both in internal functionality and for module specific
      functionality (as its good practice), the <code>throw_</code> and
      <code>create_</code> functions take an optional code parameter which is
      the string for the code to be added to the error object. If the optional
      parameter is <code>NULL</code> then no code will be associated with the
      error. If a code is provided, the name associated with the error is also
      updated to be:
    </p>
    <pre class="text"><code>originalName [code]</code></pre>
    <p>
      where <code>originalName</code> is the original name associated with the
      error and <code>code</code> is the code that was provided. For example, if
      the code is <code>'ERR_ERROR_1'</code> and a <code>TypeError</code> is
      being created the name will be:
    </p>
    <pre class="text"><code>TypeError [ERR_ERROR_1]</code></pre>
    <h4 id="napi_throw">napi_throw</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb32">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb32-1" title="1">NAPI_EXTERN napi_status napi_throw(napi_env env, napi_value error);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] error</code>: The JavaScript value to be thrown.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API throws the JavaScript value provided.</p>
    <h4 id="napi_throw_error">napi_throw_error</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb33">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb33-1" title="1">NAPI_EXTERN napi_status napi_throw_error(napi_env env,</a>
<a class="sourceLine" id="cb33-2" title="2">                                         <span class="dt">const</span> <span class="dt">char</span>* code,</a>
<a class="sourceLine" id="cb33-3" title="3">                                         <span class="dt">const</span> <span class="dt">char</span>* msg);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] code</code>: Optional error code to be set on the error.
      </li>
      <li>
        <code>[in] msg</code>: C string representing the text to be associated
        with the error.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API throws a JavaScript <code>Error</code> with the text provided.
    </p>
    <h4 id="napi_throw_type_error">napi_throw_type_error</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb34">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb34-1" title="1">NAPI_EXTERN napi_status napi_throw_type_error(napi_env env,</a>
<a class="sourceLine" id="cb34-2" title="2">                                              <span class="dt">const</span> <span class="dt">char</span>* code,</a>
<a class="sourceLine" id="cb34-3" title="3">                                              <span class="dt">const</span> <span class="dt">char</span>* msg);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] code</code>: Optional error code to be set on the error.
      </li>
      <li>
        <code>[in] msg</code>: C string representing the text to be associated
        with the error.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API throws a JavaScript <code>TypeError</code> with the text
      provided.
    </p>
    <h4 id="napi_throw_range_error">napi_throw_range_error</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb35">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb35-1" title="1">NAPI_EXTERN napi_status napi_throw_range_error(napi_env env,</a>
<a class="sourceLine" id="cb35-2" title="2">                                               <span class="dt">const</span> <span class="dt">char</span>* code,</a>
<a class="sourceLine" id="cb35-3" title="3">                                               <span class="dt">const</span> <span class="dt">char</span>* msg);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] code</code>: Optional error code to be set on the error.
      </li>
      <li>
        <code>[in] msg</code>: C string representing the text to be associated
        with the error.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API throws a JavaScript <code>RangeError</code> with the text
      provided.
    </p>
    <h4 id="napi_is_error">napi_is_error</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb36">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb36-1" title="1">NAPI_EXTERN napi_status napi_is_error(napi_env env,</a>
<a class="sourceLine" id="cb36-2" title="2">                                      napi_value value,</a>
<a class="sourceLine" id="cb36-3" title="3">                                      <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: The <code>napi_value</code> to be checked.
      </li>
      <li>
        <code>[out] result</code>: Boolean value that is set to true if
        <code>napi_value</code> represents an error, false otherwise.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API queries a <code>napi_value</code> to check if it represents an
      error object.
    </p>
    <h4 id="napi_create_error">napi_create_error</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb37">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb37-1" title="1">NAPI_EXTERN napi_status napi_create_error(napi_env env,</a>
<a class="sourceLine" id="cb37-2" title="2">                                          napi_value code,</a>
<a class="sourceLine" id="cb37-3" title="3">                                          napi_value msg,</a>
<a class="sourceLine" id="cb37-4" title="4">                                          napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] code</code>: Optional <code>napi_value</code> with the string
        for the error code to be associated with the error.
      </li>
      <li>
        <code>[in] msg</code>: <code>napi_value</code> that references a
        JavaScript <code>string</code> to be used as the message for the
        <code>Error</code>.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        error created.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns a JavaScript <code>Error</code> with the text provided.
    </p>
    <h4 id="napi_create_type_error">napi_create_type_error</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb38">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb38-1" title="1">NAPI_EXTERN napi_status napi_create_type_error(napi_env env,</a>
<a class="sourceLine" id="cb38-2" title="2">                                               napi_value code,</a>
<a class="sourceLine" id="cb38-3" title="3">                                               napi_value msg,</a>
<a class="sourceLine" id="cb38-4" title="4">                                               napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] code</code>: Optional <code>napi_value</code> with the string
        for the error code to be associated with the error.
      </li>
      <li>
        <code>[in] msg</code>: <code>napi_value</code> that references a
        JavaScript <code>string</code> to be used as the message for the
        <code>Error</code>.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        error created.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns a JavaScript <code>TypeError</code> with the text
      provided.
    </p>
    <h4 id="napi_create_range_error">napi_create_range_error</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb39">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb39-1" title="1">NAPI_EXTERN napi_status napi_create_range_error(napi_env env,</a>
<a class="sourceLine" id="cb39-2" title="2">                                                napi_value code,</a>
<a class="sourceLine" id="cb39-3" title="3">                                                napi_value msg,</a>
<a class="sourceLine" id="cb39-4" title="4">                                                napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] code</code>: Optional <code>napi_value</code> with the string
        for the error code to be associated with the error.
      </li>
      <li>
        <code>[in] msg</code>: <code>napi_value</code> that references a
        JavaScript <code>string</code> to be used as the message for the
        <code>Error</code>.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        error created.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns a JavaScript <code>RangeError</code> with the text
      provided.
    </p>
    <h4 id="napi_get_and_clear_last_exception">
      napi_get_and_clear_last_exception
    </h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb40">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb40-1" title="1">napi_status napi_get_and_clear_last_exception(napi_env env,</a>
<a class="sourceLine" id="cb40-2" title="2">                                              napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: The exception if one is pending,
        <code>NULL</code> otherwise.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h4 id="napi_is_exception_pending">napi_is_exception_pending</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb41">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb41-1" title="1">napi_status napi_is_exception_pending(napi_env env, <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: Boolean value that is set to true if an
        exception is pending.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h4 id="napi_fatal_exception">napi_fatal_exception</h4>
    <!-- YAML
added: v9.10.0
napiVersion: 3
-->
    <div class="sourceCode" id="cb42">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb42-1" title="1">napi_status napi_fatal_exception(napi_env env, napi_value err);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] err</code>: The error that is passed to
        <code>'uncaughtException'</code>.
      </li>
    </ul>
    <p>
      Trigger an <code>'uncaughtException'</code> in JavaScript. Useful if an
      async callback throws an exception with no way to recover.
    </p>
    <h3 id="fatal-errors">Fatal errors</h3>
    <p>
      In the event of an unrecoverable error in a native module, a fatal error
      can be thrown to immediately terminate the process.
    </p>
    <h4 id="napi_fatal_error">napi_fatal_error</h4>
    <!-- YAML
added: v8.2.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb43">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb43-1" title="1">NAPI_NO_RETURN <span class="dt">void</span> napi_fatal_error(<span class="dt">const</span> <span class="dt">char</span>* location,</a>
<a class="sourceLine" id="cb43-2" title="2">                                     <span class="dt">size_t</span> location_len,</a>
<a class="sourceLine" id="cb43-3" title="3">                                     <span class="dt">const</span> <span class="dt">char</span>* message,</a>
<a class="sourceLine" id="cb43-4" title="4">                                     <span class="dt">size_t</span> message_len);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] location</code>: Optional location at which the error
        occurred.
      </li>
      <li>
        <code>[in] location_len</code>: The length of the location in bytes, or
        <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.
      </li>
      <li><code>[in] message</code>: The message associated with the error.</li>
      <li>
        <code>[in] message_len</code>: The length of the message in bytes, or
        <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.
      </li>
    </ul>
    <p>The function call does not return, the process will be terminated.</p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h2 id="object-lifetime-management">Object lifetime management</h2>
    <p>
      As Node-API calls are made, handles to objects in the heap for the
      underlying VM may be returned as <code>napi_values</code>. These handles
      must hold the objects ‘live’ until they are no longer required by the
      native code, otherwise the objects could be collected before the native
      code was finished using them.
    </p>
    <p>
      As object handles are returned they are associated with a ‘scope’. The
      lifespan for the default scope is tied to the lifespan of the native
      method call. The result is that, by default, handles remain valid and the
      objects associated with these handles will be held live for the lifespan
      of the native method call.
    </p>
    <p>
      In many cases, however, it is necessary that the handles remain valid for
      either a shorter or longer lifespan than that of the native method. The
      sections which follow describe the Node-API functions that can be used to
      change the handle lifespan from the default.
    </p>
    <h3 id="making-handle-lifespan-shorter-than-that-of-the-native-method">
      Making handle lifespan shorter than that of the native method
    </h3>
    <p>
      It is often necessary to make the lifespan of handles shorter than the
      lifespan of a native method. For example, consider a native method that
      has a loop which iterates through the elements in a large array:
    </p>
    <div class="sourceCode" id="cb44">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb44-1" title="1"><span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">1000000</span>; i++) {</a>
<a class="sourceLine" id="cb44-2" title="2">  napi_value result;</a>
<a class="sourceLine" id="cb44-3" title="3">  napi_status status = napi_get_element(env, object, i, &amp;result);</a>
<a class="sourceLine" id="cb44-4" title="4">  <span class="cf">if</span> (status != napi_ok) {</a>
<a class="sourceLine" id="cb44-5" title="5">    <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb44-6" title="6">  }</a>
<a class="sourceLine" id="cb44-7" title="7">  <span class="co">// do something with element</span></a>
<a class="sourceLine" id="cb44-8" title="8">}</a></code></pre>
    </div>
    <p>
      This would result in a large number of handles being created, consuming
      substantial resources. In addition, even though the native code could only
      use the most recent handle, all of the associated objects would also be
      kept alive since they all share the same scope.
    </p>
    <p>
      To handle this case, Node-API provides the ability to establish a new
      ‘scope’ to which newly created handles will be associated. Once those
      handles are no longer required, the scope can be ‘closed’ and any handles
      associated with the scope are invalidated. The methods available to
      open/close scopes are
      <a href="#n_api_napi_open_handle_scope"
        ><code>napi_open_handle_scope</code></a
      >
      and
      <a href="#n_api_napi_close_handle_scope"
        ><code>napi_close_handle_scope</code></a
      >.
    </p>
    <p>
      Node-API only supports a single nested hierarchy of scopes. There is only
      one active scope at any time, and all new handles will be associated with
      that scope while it is active. Scopes must be closed in the reverse order
      from which they are opened. In addition, all scopes created within a
      native method must be closed before returning from that method.
    </p>
    <p>
      Taking the earlier example, adding calls to
      <a href="#n_api_napi_open_handle_scope"
        ><code>napi_open_handle_scope</code></a
      >
      and
      <a href="#n_api_napi_close_handle_scope"
        ><code>napi_close_handle_scope</code></a
      >
      would ensure that at most a single handle is valid throughout the
      execution of the loop:
    </p>
    <div class="sourceCode" id="cb45">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb45-1" title="1"><span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">1000000</span>; i++) {</a>
<a class="sourceLine" id="cb45-2" title="2">  napi_handle_scope scope;</a>
<a class="sourceLine" id="cb45-3" title="3">  napi_status status = napi_open_handle_scope(env, &amp;scope);</a>
<a class="sourceLine" id="cb45-4" title="4">  <span class="cf">if</span> (status != napi_ok) {</a>
<a class="sourceLine" id="cb45-5" title="5">    <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb45-6" title="6">  }</a>
<a class="sourceLine" id="cb45-7" title="7">  napi_value result;</a>
<a class="sourceLine" id="cb45-8" title="8">  status = napi_get_element(env, object, i, &amp;result);</a>
<a class="sourceLine" id="cb45-9" title="9">  <span class="cf">if</span> (status != napi_ok) {</a>
<a class="sourceLine" id="cb45-10" title="10">    <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb45-11" title="11">  }</a>
<a class="sourceLine" id="cb45-12" title="12">  <span class="co">// do something with element</span></a>
<a class="sourceLine" id="cb45-13" title="13">  status = napi_close_handle_scope(env, scope);</a>
<a class="sourceLine" id="cb45-14" title="14">  <span class="cf">if</span> (status != napi_ok) {</a>
<a class="sourceLine" id="cb45-15" title="15">    <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb45-16" title="16">  }</a>
<a class="sourceLine" id="cb45-17" title="17">}</a></code></pre>
    </div>
    <p>
      When nesting scopes, there are cases where a handle from an inner scope
      needs to live beyond the lifespan of that scope. Node-API supports an
      ‘escapable scope’ in order to support this case. An escapable scope allows
      one handle to be ‘promoted’ so that it ‘escapes’ the current scope and the
      lifespan of the handle changes from the current scope to that of the outer
      scope.
    </p>
    <p>
      The methods available to open/close escapable scopes are
      <a href="#n_api_napi_open_escapable_handle_scope"
        ><code>napi_open_escapable_handle_scope</code></a
      >
      and
      <a href="#n_api_napi_close_escapable_handle_scope"
        ><code>napi_close_escapable_handle_scope</code></a
      >.
    </p>
    <p>
      The request to promote a handle is made through
      <a href="#n_api_napi_escape_handle"><code>napi_escape_handle</code></a>
      which can only be called once.
    </p>
    <h4 id="napi_open_handle_scope">napi_open_handle_scope</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb46">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb46-1" title="1">NAPI_EXTERN napi_status napi_open_handle_scope(napi_env env,</a>
<a class="sourceLine" id="cb46-2" title="2">                                               napi_handle_scope* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the new
        scope.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API opens a new scope.</p>
    <h4 id="napi_close_handle_scope">napi_close_handle_scope</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb47">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb47-1" title="1">NAPI_EXTERN napi_status napi_close_handle_scope(napi_env env,</a>
<a class="sourceLine" id="cb47-2" title="2">                                                napi_handle_scope scope);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] scope</code>: <code>napi_value</code> representing the scope
        to be closed.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API closes the scope passed in. Scopes must be closed in the reverse
      order from which they were created.
    </p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h4 id="napi_open_escapable_handle_scope">
      napi_open_escapable_handle_scope
    </h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb48">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb48-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb48-2" title="2">    napi_open_escapable_handle_scope(napi_env env,</a>
<a class="sourceLine" id="cb48-3" title="3">                                     napi_handle_scope* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the new
        scope.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API opens a new scope from which one object can be promoted to the
      outer scope.
    </p>
    <h4 id="napi_close_escapable_handle_scope">
      napi_close_escapable_handle_scope
    </h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb49">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb49-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb49-2" title="2">    napi_close_escapable_handle_scope(napi_env env,</a>
<a class="sourceLine" id="cb49-3" title="3">                                      napi_handle_scope scope);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] scope</code>: <code>napi_value</code> representing the scope
        to be closed.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API closes the scope passed in. Scopes must be closed in the reverse
      order from which they were created.
    </p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h4 id="napi_escape_handle">napi_escape_handle</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb50">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb50-1" title="1">napi_status napi_escape_handle(napi_env env,</a>
<a class="sourceLine" id="cb50-2" title="2">                               napi_escapable_handle_scope scope,</a>
<a class="sourceLine" id="cb50-3" title="3">                               napi_value escapee,</a>
<a class="sourceLine" id="cb50-4" title="4">                               napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] scope</code>: <code>napi_value</code> representing the
        current scope.
      </li>
      <li>
        <code>[in] escapee</code>: <code>napi_value</code> representing the
        JavaScript <code>Object</code> to be escaped.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        handle to the escaped <code>Object</code> in the outer scope.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API promotes the handle to the JavaScript object so that it is valid
      for the lifetime of the outer scope. It can only be called once per scope.
      If it is called more than once an error will be returned.
    </p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h3
      id="references-to-objects-with-a-lifespan-longer-than-that-of-the-native-method"
    >
      References to objects with a lifespan longer than that of the native
      method
    </h3>
    <p>
      In some cases an addon will need to be able to create and reference
      objects with a lifespan longer than that of a single native method
      invocation. For example, to create a constructor and later use that
      constructor in a request to creates instances, it must be possible to
      reference the constructor object across many different instance creation
      requests. This would not be possible with a normal handle returned as a
      <code>napi_value</code> as described in the earlier section. The lifespan
      of a normal handle is managed by scopes and all scopes must be closed
      before the end of a native method.
    </p>
    <p>
      Node-API provides methods to create persistent references to an object.
      Each persistent reference has an associated count with a value of 0 or
      higher. The count determines if the reference will keep the corresponding
      object live. References with a count of 0 do not prevent the object from
      being collected and are often called ‘weak’ references. Any count greater
      than 0 will prevent the object from being collected.
    </p>
    <p>
      References can be created with an initial reference count. The count can
      then be modified through
      <a href="#n_api_napi_reference_ref"><code>napi_reference_ref</code></a>
      and
      <a href="#n_api_napi_reference_unref"><code>napi_reference_unref</code></a
      >. If an object is collected while the count for a reference is 0, all
      subsequent calls to get the object associated with the reference
      <a href="#n_api_napi_get_reference_value"
        ><code>napi_get_reference_value</code></a
      >
      will return <code>NULL</code> for the returned <code>napi_value</code>. An
      attempt to call
      <a href="#n_api_napi_reference_ref"><code>napi_reference_ref</code></a>
      for a reference whose object has been collected results in an error.
    </p>
    <p>
      References must be deleted once they are no longer required by the addon.
      When a reference is deleted, it will no longer prevent the corresponding
      object from being collected. Failure to delete a persistent reference
      results in a ‘memory leak’ with both the native memory for the persistent
      reference and the corresponding object on the heap being retained forever.
    </p>
    <p>
      There can be multiple persistent references created which refer to the
      same object, each of which will either keep the object live or not based
      on its individual count.
    </p>
    <h4 id="napi_create_reference">napi_create_reference</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb51">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb51-1" title="1">NAPI_EXTERN napi_status napi_create_reference(napi_env env,</a>
<a class="sourceLine" id="cb51-2" title="2">                                              napi_value value,</a>
<a class="sourceLine" id="cb51-3" title="3">                                              <span class="dt">uint32_t</span> initial_refcount,</a>
<a class="sourceLine" id="cb51-4" title="4">                                              napi_ref* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing the
        <code>Object</code> to which we want a reference.
      </li>
      <li>
        <code>[in] initial_refcount</code>: Initial reference count for the new
        reference.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_ref</code> pointing to the new
        reference.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API create a new reference with the specified reference count to the
      <code>Object</code> passed in.
    </p>
    <h4 id="napi_delete_reference">napi_delete_reference</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb52">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb52-1" title="1">NAPI_EXTERN napi_status napi_delete_reference(napi_env env, napi_ref ref);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] ref</code>: <code>napi_ref</code> to be deleted.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API deletes the reference passed in.</p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h4 id="napi_reference_ref">napi_reference_ref</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb53">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb53-1" title="1">NAPI_EXTERN napi_status napi_reference_ref(napi_env env,</a>
<a class="sourceLine" id="cb53-2" title="2">                                           napi_ref ref,</a>
<a class="sourceLine" id="cb53-3" title="3">                                           <span class="dt">uint32_t</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] ref</code>: <code>napi_ref</code> for which the reference
        count will be incremented.
      </li>
      <li><code>[out] result</code>: The new reference count.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API increments the reference count for the reference passed in and
      returns the resulting reference count.
    </p>
    <h4 id="napi_reference_unref">napi_reference_unref</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb54">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb54-1" title="1">NAPI_EXTERN napi_status napi_reference_unref(napi_env env,</a>
<a class="sourceLine" id="cb54-2" title="2">                                             napi_ref ref,</a>
<a class="sourceLine" id="cb54-3" title="3">                                             <span class="dt">uint32_t</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] ref</code>: <code>napi_ref</code> for which the reference
        count will be decremented.
      </li>
      <li><code>[out] result</code>: The new reference count.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API decrements the reference count for the reference passed in and
      returns the resulting reference count.
    </p>
    <h4 id="napi_get_reference_value">napi_get_reference_value</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb55">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb55-1" title="1">NAPI_EXTERN napi_status napi_get_reference_value(napi_env env,</a>
<a class="sourceLine" id="cb55-2" title="2">                                                 napi_ref ref,</a>
<a class="sourceLine" id="cb55-3" title="3">                                                 napi_value* result);</a></code></pre>
    </div>
    <p>
      the <code>napi_value passed</code> in or out of these methods is a handle
      to the object to which the reference is related.
    </p>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] ref</code>: <code>napi_ref</code> for which we requesting the
        corresponding <code>Object</code>.
      </li>
      <li>
        <code>[out] result</code>: The <code>napi_value</code> for the
        <code>Object</code> referenced by the <code>napi_ref</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      If still valid, this API returns the <code>napi_value</code> representing
      the JavaScript <code>Object</code> associated with the
      <code>napi_ref</code>. Otherwise, result will be <code>NULL</code>.
    </p>
    <h3 id="cleanup-on-exit-of-the-current-node.js-instance">
      Cleanup on exit of the current Node.js instance
    </h3>
    <p>
      While a Node.js process typically releases all its resources when exiting,
      embedders of Node.js, or future Worker support, may require addons to
      register clean-up hooks that will be run once the current Node.js instance
      exits.
    </p>
    <p>
      Node-API provides functions for registering and un-registering such
      callbacks. When those callbacks are run, all resources that are being held
      by the addon should be freed up.
    </p>
    <h4 id="napi_add_env_cleanup_hook">napi_add_env_cleanup_hook</h4>
    <!-- YAML
added: v10.2.0
napiVersion: 3
-->
    <div class="sourceCode" id="cb56">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb56-1" title="1">NODE_EXTERN napi_status napi_add_env_cleanup_hook(napi_env env,</a>
<a class="sourceLine" id="cb56-2" title="2">                                                  <span class="dt">void</span> (*fun)(<span class="dt">void</span>* arg),</a>
<a class="sourceLine" id="cb56-3" title="3">                                                  <span class="dt">void</span>* arg);</a></code></pre>
    </div>
    <p>
      Registers <code>fun</code> as a function to be run with the
      <code>arg</code> parameter once the current Node.js environment exits.
    </p>
    <p>
      A function can safely be specified multiple times with different
      <code>arg</code> values. In that case, it will be called multiple times as
      well. Providing the same <code>fun</code> and <code>arg</code> values
      multiple times is not allowed and will lead the process to abort.
    </p>
    <p>
      The hooks will be called in reverse order, i.e. the most recently added
      one will be called first.
    </p>
    <p>
      Removing this hook can be done by using
      <a href="#n_api_napi_remove_env_cleanup_hook"
        ><code>napi_remove_env_cleanup_hook</code></a
      >. Typically, that happens when the resource for which this hook was added
      is being torn down anyway.
    </p>
    <p>
      For asynchronous cleanup,
      <a href="#n_api_napi_add_async_cleanup_hook"
        ><code>napi_add_async_cleanup_hook</code></a
      >
      is available.
    </p>
    <h4 id="napi_remove_env_cleanup_hook">napi_remove_env_cleanup_hook</h4>
    <!-- YAML
added: v10.2.0
napiVersion: 3
-->
    <div class="sourceCode" id="cb57">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb57-1" title="1">NAPI_EXTERN napi_status napi_remove_env_cleanup_hook(napi_env env,</a>
<a class="sourceLine" id="cb57-2" title="2">                                                     <span class="dt">void</span> (*fun)(<span class="dt">void</span>* arg),</a>
<a class="sourceLine" id="cb57-3" title="3">                                                     <span class="dt">void</span>* arg);</a></code></pre>
    </div>
    <p>
      Unregisters <code>fun</code> as a function to be run with the
      <code>arg</code> parameter once the current Node.js environment exits.
      Both the argument and the function value need to be exact matches.
    </p>
    <p>
      The function must have originally been registered with
      <code>napi_add_env_cleanup_hook</code>, otherwise the process will abort.
    </p>
    <h4 id="napi_add_async_cleanup_hook">napi_add_async_cleanup_hook</h4>
    <!-- YAML
added:
  - v14.8.0
  - v12.19.0
napiVersion: 8
changes:
  - version:
    - v14.10.0
    - v12.19.0
    pr-url: https://github.com/nodejs/node/pull/34819
    description: Changed signature of the `hook` callback.
-->
    <div class="sourceCode" id="cb58">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb58-1" title="1">NAPI_EXTERN napi_status napi_add_async_cleanup_hook(</a>
<a class="sourceLine" id="cb58-2" title="2">    napi_env env,</a>
<a class="sourceLine" id="cb58-3" title="3">    napi_async_cleanup_hook hook,</a>
<a class="sourceLine" id="cb58-4" title="4">    <span class="dt">void</span>* arg,</a>
<a class="sourceLine" id="cb58-5" title="5">    napi_async_cleanup_hook_handle* remove_handle);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] hook</code>: The function pointer to call at environment
        teardown.
      </li>
      <li>
        <code>[in] arg</code>: The pointer to pass to <code>hook</code> when it
        gets called.
      </li>
      <li>
        <code>[out] remove_handle</code>: Optional handle that refers to the
        asynchronous cleanup hook.
      </li>
    </ul>
    <p>
      Registers <code>hook</code>, which is a function of type
      <a href="#n_api_napi_async_cleanup_hook"
        ><code>napi_async_cleanup_hook</code></a
      >, as a function to be run with the <code>remove_handle</code> and
      <code>arg</code> parameters once the current Node.js environment exits.
    </p>
    <p>
      Unlike
      <a href="#n_api_napi_add_env_cleanup_hook"
        ><code>napi_add_env_cleanup_hook</code></a
      >, the hook is allowed to be asynchronous.
    </p>
    <p>
      Otherwise, behavior generally matches that of
      <a href="#n_api_napi_add_env_cleanup_hook"
        ><code>napi_add_env_cleanup_hook</code></a
      >.
    </p>
    <p>
      If <code>remove_handle</code> is not <code>NULL</code>, an opaque value
      will be stored in it that must later be passed to
      <a href="#n_api_napi_remove_async_cleanup_hook"
        ><code>napi_remove_async_cleanup_hook</code></a
      >, regardless of whether the hook has already been invoked. Typically,
      that happens when the resource for which this hook was added is being torn
      down anyway.
    </p>
    <h4 id="napi_remove_async_cleanup_hook">napi_remove_async_cleanup_hook</h4>
    <!-- YAML
added:
  - v14.8.0
  - v12.19.0
changes:
  - version:
    - v14.10.0
    - v12.19.0
    pr-url: https://github.com/nodejs/node/pull/34819
    description: Removed `env` parameter.
-->
    <div class="sourceCode" id="cb59">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb59-1" title="1">NAPI_EXTERN napi_status napi_remove_async_cleanup_hook(</a>
<a class="sourceLine" id="cb59-2" title="2">    napi_async_cleanup_hook_handle remove_handle);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] remove_handle</code>: The handle to an asynchronous cleanup
        hook that was created with
        <a href="#n_api_napi_add_async_cleanup_hook"
          ><code>napi_add_async_cleanup_hook</code></a
        >.
      </li>
    </ul>
    <p>
      Unregisters the cleanup hook corresponding to <code>remove_handle</code>.
      This will prevent the hook from being executed, unless it has already
      started executing. This must be called on any
      <code>napi_async_cleanup_hook_handle</code> value obtained from
      <a href="#n_api_napi_add_async_cleanup_hook"
        ><code>napi_add_async_cleanup_hook</code></a
      >.
    </p>
    <h2 id="module-registration">Module registration</h2>
    <p>
      Node-API modules are registered in a manner similar to other modules
      except that instead of using the <code>NODE_MODULE</code> macro the
      following is used:
    </p>
    <div class="sourceCode" id="cb60">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb60-1" title="1">NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)</a></code></pre>
    </div>
    <p>
      The next difference is the signature for the <code>Init</code> method. For
      a Node-API module it is as follows:
    </p>
    <div class="sourceCode" id="cb61">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb61-1" title="1">napi_value Init(napi_env env, napi_value exports);</a></code></pre>
    </div>
    <p>
      The return value from <code>Init</code> is treated as the
      <code>exports</code> object for the module. The <code>Init</code> method
      is passed an empty object via the <code>exports</code> parameter as a
      convenience. If <code>Init</code> returns <code>NULL</code>, the parameter
      passed as <code>exports</code> is exported by the module. Node-API modules
      cannot modify the <code>module</code> object but can specify anything as
      the <code>exports</code> property of the module.
    </p>
    <p>
      To add the method <code>hello</code> as a function so that it can be
      called as a method provided by the addon:
    </p>
    <div class="sourceCode" id="cb62">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb62-1" title="1">napi_value Init(napi_env env, napi_value exports) {</a>
<a class="sourceLine" id="cb62-2" title="2">  napi_status status;</a>
<a class="sourceLine" id="cb62-3" title="3">  napi_property_descriptor desc = {</a>
<a class="sourceLine" id="cb62-4" title="4">    <span class="st">&quot;hello&quot;</span>,</a>
<a class="sourceLine" id="cb62-5" title="5">    NULL,</a>
<a class="sourceLine" id="cb62-6" title="6">    Method,</a>
<a class="sourceLine" id="cb62-7" title="7">    NULL,</a>
<a class="sourceLine" id="cb62-8" title="8">    NULL,</a>
<a class="sourceLine" id="cb62-9" title="9">    NULL,</a>
<a class="sourceLine" id="cb62-10" title="10">    napi_writable | napi_enumerable | napi_configurable,</a>
<a class="sourceLine" id="cb62-11" title="11">    NULL</a>
<a class="sourceLine" id="cb62-12" title="12">  };</a>
<a class="sourceLine" id="cb62-13" title="13">  status = napi_define_properties(env, exports, <span class="dv">1</span>, &amp;desc);</a>
<a class="sourceLine" id="cb62-14" title="14">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb62-15" title="15">  <span class="cf">return</span> exports;</a>
<a class="sourceLine" id="cb62-16" title="16">}</a></code></pre>
    </div>
    <p>
      To set a function to be returned by the <code>require()</code> for the
      addon:
    </p>
    <div class="sourceCode" id="cb63">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb63-1" title="1">napi_value Init(napi_env env, napi_value exports) {</a>
<a class="sourceLine" id="cb63-2" title="2">  napi_value method;</a>
<a class="sourceLine" id="cb63-3" title="3">  napi_status status;</a>
<a class="sourceLine" id="cb63-4" title="4">  status = napi_create_function(env, <span class="st">&quot;exports&quot;</span>, NAPI_AUTO_LENGTH, Method, NULL, &amp;method);</a>
<a class="sourceLine" id="cb63-5" title="5">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb63-6" title="6">  <span class="cf">return</span> method;</a>
<a class="sourceLine" id="cb63-7" title="7">}</a></code></pre>
    </div>
    <p>
      To define a class so that new instances can be created (often used with
      <a href="#n_api_object_wrap">Object wrap</a>):
    </p>
    <div class="sourceCode" id="cb64">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb64-1" title="1"><span class="co">// </span><span class="al">NOTE</span><span class="co">: partial example, not all referenced code is included</span></a>
<a class="sourceLine" id="cb64-2" title="2">napi_value Init(napi_env env, napi_value exports) {</a>
<a class="sourceLine" id="cb64-3" title="3">  napi_status status;</a>
<a class="sourceLine" id="cb64-4" title="4">  napi_property_descriptor properties[] = {</a>
<a class="sourceLine" id="cb64-5" title="5">    { <span class="st">&quot;value&quot;</span>, NULL, NULL, GetValue, SetValue, NULL, napi_writable | napi_configurable, NULL },</a>
<a class="sourceLine" id="cb64-6" title="6">    DECLARE_NAPI_METHOD(<span class="st">&quot;plusOne&quot;</span>, PlusOne),</a>
<a class="sourceLine" id="cb64-7" title="7">    DECLARE_NAPI_METHOD(<span class="st">&quot;multiply&quot;</span>, Multiply),</a>
<a class="sourceLine" id="cb64-8" title="8">  };</a>
<a class="sourceLine" id="cb64-9" title="9"></a>
<a class="sourceLine" id="cb64-10" title="10">  napi_value cons;</a>
<a class="sourceLine" id="cb64-11" title="11">  status =</a>
<a class="sourceLine" id="cb64-12" title="12">      napi_define_class(env, <span class="st">&quot;MyObject&quot;</span>, New, NULL, <span class="dv">3</span>, properties, &amp;cons);</a>
<a class="sourceLine" id="cb64-13" title="13">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb64-14" title="14"></a>
<a class="sourceLine" id="cb64-15" title="15">  status = napi_create_reference(env, cons, <span class="dv">1</span>, &amp;constructor);</a>
<a class="sourceLine" id="cb64-16" title="16">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb64-17" title="17"></a>
<a class="sourceLine" id="cb64-18" title="18">  status = napi_set_named_property(env, exports, <span class="st">&quot;MyObject&quot;</span>, cons);</a>
<a class="sourceLine" id="cb64-19" title="19">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb64-20" title="20"></a>
<a class="sourceLine" id="cb64-21" title="21">  <span class="cf">return</span> exports;</a>
<a class="sourceLine" id="cb64-22" title="22">}</a></code></pre>
    </div>
    <p>
      You can also use the <code>NAPI_MODULE_INIT</code> macro, which acts as a
      shorthand for <code>NAPI_MODULE</code> and defining an
      <code>Init</code> function:
    </p>
    <div class="sourceCode" id="cb65">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb65-1" title="1">NAPI_MODULE_INIT() {</a>
<a class="sourceLine" id="cb65-2" title="2">  napi_value answer;</a>
<a class="sourceLine" id="cb65-3" title="3">  napi_status result;</a>
<a class="sourceLine" id="cb65-4" title="4"></a>
<a class="sourceLine" id="cb65-5" title="5">  status = napi_create_int64(env, <span class="dv">42</span>, &amp;answer);</a>
<a class="sourceLine" id="cb65-6" title="6">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb65-7" title="7"></a>
<a class="sourceLine" id="cb65-8" title="8">  status = napi_set_named_property(env, exports, <span class="st">&quot;answer&quot;</span>, answer);</a>
<a class="sourceLine" id="cb65-9" title="9">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb65-10" title="10"></a>
<a class="sourceLine" id="cb65-11" title="11">  <span class="cf">return</span> exports;</a>
<a class="sourceLine" id="cb65-12" title="12">}</a></code></pre>
    </div>
    <p>
      All Node-API addons are context-aware, meaning they may be loaded multiple
      times. There are a few design considerations when declaring such a module.
      The documentation on
      <a href="addons.md#addons_context_aware_addons">context-aware addons</a>
      provides more details.
    </p>
    <p>
      The variables <code>env</code> and <code>exports</code> will be available
      inside the function body following the macro invocation.
    </p>
    <p>
      For more details on setting properties on objects, see the section on
      <a href="#n_api_working_with_javascript_properties"
        >Working with JavaScript properties</a
      >.
    </p>
    <p>
      For more details on building addon modules in general, refer to the
      existing API.
    </p>
    <h2 id="working-with-javascript-values">Working with JavaScript values</h2>
    <p>
      Node-API exposes a set of APIs to create all types of JavaScript values.
      Some of these types are documented under
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values"
        >Section 6</a
      >
      of the
      <a href="https://tc39.github.io/ecma262/"
        >ECMAScript Language Specification</a
      >.
    </p>
    <p>Fundamentally, these APIs are used to do one of the following:</p>
    <ol type="1">
      <li>Create a new JavaScript object</li>
      <li>Convert from a primitive C type to a Node-API value</li>
      <li>Convert from Node-API value to a primitive C type</li>
      <li>
        Get global instances including <code>undefined</code> and
        <code>null</code>
      </li>
    </ol>
    <p>
      Node-API values are represented by the type <code>napi_value</code>. Any
      Node-API call that requires a JavaScript value takes in a
      <code>napi_value</code>. In some cases, the API does check the type of the
      <code>napi_value</code> up-front. However, for better performance, it’s
      better for the caller to make sure that the <code>napi_value</code> in
      question is of the JavaScript type expected by the API.
    </p>
    <h3 id="enum-types">Enum types</h3>
    <h4 id="napi_key_collection_mode">napi_key_collection_mode</h4>
    <!-- YAML
added:
 - v13.7.0
 - v12.17.0
 - v10.20.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb66">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb66-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb66-2" title="2">  napi_key_include_prototypes,</a>
<a class="sourceLine" id="cb66-3" title="3">  napi_key_own_only</a>
<a class="sourceLine" id="cb66-4" title="4">} napi_key_collection_mode;</a></code></pre>
    </div>
    <p>Describes the <code>Keys/Properties</code> filter enums:</p>
    <p>
      <code>napi_key_collection_mode</code> limits the range of collected
      properties.
    </p>
    <p>
      <code>napi_key_own_only</code> limits the collected properties to the
      given object only. <code>napi_key_include_prototypes</code> will include
      all keys of the objects’s prototype chain as well.
    </p>
    <h4 id="napi_key_filter">napi_key_filter</h4>
    <!-- YAML
added:
 - v13.7.0
 - v12.17.0
 - v10.20.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb67">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb67-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb67-2" title="2">  napi_key_all_properties = <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb67-3" title="3">  napi_key_writable = <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb67-4" title="4">  napi_key_enumerable = <span class="dv">1</span> &lt;&lt; <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb67-5" title="5">  napi_key_configurable = <span class="dv">1</span> &lt;&lt; <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb67-6" title="6">  napi_key_skip_strings = <span class="dv">1</span> &lt;&lt; <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb67-7" title="7">  napi_key_skip_symbols = <span class="dv">1</span> &lt;&lt; <span class="dv">4</span></a>
<a class="sourceLine" id="cb67-8" title="8">} napi_key_filter;</a></code></pre>
    </div>
    <p>Property filter bits. They can be or’ed to build a composite filter.</p>
    <h4 id="napi_key_conversion">napi_key_conversion</h4>
    <!-- YAML
added:
 - v13.7.0
 - v12.17.0
 - v10.20.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb68">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb68-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb68-2" title="2">  napi_key_keep_numbers,</a>
<a class="sourceLine" id="cb68-3" title="3">  napi_key_numbers_to_strings</a>
<a class="sourceLine" id="cb68-4" title="4">} napi_key_conversion;</a></code></pre>
    </div>
    <p>
      <code>napi_key_numbers_to_strings</code> will convert integer indices to
      strings. <code>napi_key_keep_numbers</code> will return numbers for
      integer indices.
    </p>
    <h4 id="napi_valuetype">napi_valuetype</h4>
    <div class="sourceCode" id="cb69">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb69-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb69-2" title="2">  <span class="co">// ES6 types (corresponds to typeof)</span></a>
<a class="sourceLine" id="cb69-3" title="3">  napi_undefined,</a>
<a class="sourceLine" id="cb69-4" title="4">  napi_null,</a>
<a class="sourceLine" id="cb69-5" title="5">  napi_boolean,</a>
<a class="sourceLine" id="cb69-6" title="6">  napi_number,</a>
<a class="sourceLine" id="cb69-7" title="7">  napi_string,</a>
<a class="sourceLine" id="cb69-8" title="8">  napi_symbol,</a>
<a class="sourceLine" id="cb69-9" title="9">  napi_object,</a>
<a class="sourceLine" id="cb69-10" title="10">  napi_function,</a>
<a class="sourceLine" id="cb69-11" title="11">  napi_external,</a>
<a class="sourceLine" id="cb69-12" title="12">  napi_bigint,</a>
<a class="sourceLine" id="cb69-13" title="13">} napi_valuetype;</a></code></pre>
    </div>
    <p>
      Describes the type of a <code>napi_value</code>. This generally
      corresponds to the types described in
      <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types"
        >Section 6.1</a
      >
      of the ECMAScript Language Specification. In addition to types in that
      section, <code>napi_valuetype</code> can also represent
      <code>Function</code>s and <code>Object</code>s with external data.
    </p>
    <p>
      A JavaScript value of type <code>napi_external</code> appears in
      JavaScript as a plain object such that no properties can be set on it, and
      no prototype.
    </p>
    <h4 id="napi_typedarray_type">napi_typedarray_type</h4>
    <div class="sourceCode" id="cb70">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb70-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb70-2" title="2">  napi_int8_array,</a>
<a class="sourceLine" id="cb70-3" title="3">  napi_uint8_array,</a>
<a class="sourceLine" id="cb70-4" title="4">  napi_uint8_clamped_array,</a>
<a class="sourceLine" id="cb70-5" title="5">  napi_int16_array,</a>
<a class="sourceLine" id="cb70-6" title="6">  napi_uint16_array,</a>
<a class="sourceLine" id="cb70-7" title="7">  napi_int32_array,</a>
<a class="sourceLine" id="cb70-8" title="8">  napi_uint32_array,</a>
<a class="sourceLine" id="cb70-9" title="9">  napi_float32_array,</a>
<a class="sourceLine" id="cb70-10" title="10">  napi_float64_array,</a>
<a class="sourceLine" id="cb70-11" title="11">  napi_bigint64_array,</a>
<a class="sourceLine" id="cb70-12" title="12">  napi_biguint64_array,</a>
<a class="sourceLine" id="cb70-13" title="13">} napi_typedarray_type;</a></code></pre>
    </div>
    <p>
      This represents the underlying binary scalar datatype of the
      <code>TypedArray</code>. Elements of this enum correspond to
      <a href="https://tc39.github.io/ecma262/#sec-typedarray-objects"
        >Section 22.2</a
      >
      of the
      <a href="https://tc39.github.io/ecma262/"
        >ECMAScript Language Specification</a
      >.
    </p>
    <h3 id="object-creation-functions">Object creation functions</h3>
    <h4 id="napi_create_array">napi_create_array</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb71">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb71-1" title="1">napi_status napi_create_array(napi_env env, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>Array</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns a Node-API value corresponding to a JavaScript
      <code>Array</code> type. JavaScript arrays are described in
      <a href="https://tc39.github.io/ecma262/#sec-array-objects"
        >Section 22.1</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_array_with_length">napi_create_array_with_length</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb72">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb72-1" title="1">napi_status napi_create_array_with_length(napi_env env,</a>
<a class="sourceLine" id="cb72-2" title="2">                                          <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb72-3" title="3">                                          napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] length</code>: The initial length of the <code>Array</code>.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>Array</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns a Node-API value corresponding to a JavaScript
      <code>Array</code> type. The <code>Array</code>’s length property is set
      to the passed-in length parameter. However, the underlying buffer is not
      guaranteed to be pre-allocated by the VM when the array is created. That
      behavior is left to the underlying VM implementation. If the buffer must
      be a contiguous block of memory that can be directly read and/or written
      via C, consider using
      <a href="#n_api_napi_create_external_arraybuffer"
        ><code>napi_create_external_arraybuffer</code></a
      >.
    </p>
    <p>
      JavaScript arrays are described in
      <a href="https://tc39.github.io/ecma262/#sec-array-objects"
        >Section 22.1</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_arraybuffer">napi_create_arraybuffer</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb73">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb73-1" title="1">napi_status napi_create_arraybuffer(napi_env env,</a>
<a class="sourceLine" id="cb73-2" title="2">                                    <span class="dt">size_t</span> byte_length,</a>
<a class="sourceLine" id="cb73-3" title="3">                                    <span class="dt">void</span>** data,</a>
<a class="sourceLine" id="cb73-4" title="4">                                    napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] length</code>: The length in bytes of the array buffer to
        create.
      </li>
      <li>
        <code>[out] data</code>: Pointer to the underlying byte buffer of the
        <code>ArrayBuffer</code>.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>ArrayBuffer</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns a Node-API value corresponding to a JavaScript
      <code>ArrayBuffer</code>. <code>ArrayBuffer</code>s are used to represent
      fixed-length binary data buffers. They are normally used as a
      backing-buffer for <code>TypedArray</code> objects. The
      <code>ArrayBuffer</code> allocated will have an underlying byte buffer
      whose size is determined by the <code>length</code> parameter that’s
      passed in. The underlying buffer is optionally returned back to the caller
      in case the caller wants to directly manipulate the buffer. This buffer
      can only be written to directly from native code. To write to this buffer
      from JavaScript, a typed array or <code>DataView</code> object would need
      to be created.
    </p>
    <p>
      JavaScript <code>ArrayBuffer</code> objects are described in
      <a href="https://tc39.github.io/ecma262/#sec-arraybuffer-objects"
        >Section 24.1</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_buffer">napi_create_buffer</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb74">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb74-1" title="1">napi_status napi_create_buffer(napi_env env,</a>
<a class="sourceLine" id="cb74-2" title="2">                               <span class="dt">size_t</span> size,</a>
<a class="sourceLine" id="cb74-3" title="3">                               <span class="dt">void</span>** data,</a>
<a class="sourceLine" id="cb74-4" title="4">                               napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] size</code>: Size in bytes of the underlying buffer.</li>
      <li><code>[out] data</code>: Raw pointer to the underlying buffer.</li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        <code>node::Buffer</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API allocates a <code>node::Buffer</code> object. While this is still
      a fully-supported data structure, in most cases using a
      <code>TypedArray</code> will suffice.
    </p>
    <h4 id="napi_create_buffer_copy">napi_create_buffer_copy</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb75">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb75-1" title="1">napi_status napi_create_buffer_copy(napi_env env,</a>
<a class="sourceLine" id="cb75-2" title="2">                                    <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb75-3" title="3">                                    <span class="dt">const</span> <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb75-4" title="4">                                    <span class="dt">void</span>** result_data,</a>
<a class="sourceLine" id="cb75-5" title="5">                                    napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] size</code>: Size in bytes of the input buffer (should be the
        same as the size of the new buffer).
      </li>
      <li>
        <code>[in] data</code>: Raw pointer to the underlying buffer to copy
        from.
      </li>
      <li>
        <code>[out] result_data</code>: Pointer to the new <code>Buffer</code>’s
        underlying data buffer.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        <code>node::Buffer</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API allocates a <code>node::Buffer</code> object and initializes it
      with data copied from the passed-in buffer. While this is still a
      fully-supported data structure, in most cases using a
      <code>TypedArray</code> will suffice.
    </p>
    <h4 id="napi_create_date">napi_create_date</h4>
    <!-- YAML
added:
 - v11.11.0
 - v10.17.0
napiVersion: 5
-->
    <div class="sourceCode" id="cb76">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb76-1" title="1">napi_status napi_create_date(napi_env env,</a>
<a class="sourceLine" id="cb76-2" title="2">                             <span class="dt">double</span> time,</a>
<a class="sourceLine" id="cb76-3" title="3">                             napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] time</code>: ECMAScript time value in milliseconds since 01
        January, 1970 UTC.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>Date</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API does not observe leap seconds; they are ignored, as ECMAScript
      aligns with POSIX time specification.
    </p>
    <p>This API allocates a JavaScript <code>Date</code> object.</p>
    <p>
      JavaScript <code>Date</code> objects are described in
      <a href="https://tc39.github.io/ecma262/#sec-date-objects"
        >Section 20.3</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_external">napi_create_external</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb77">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb77-1" title="1">napi_status napi_create_external(napi_env env,</a>
<a class="sourceLine" id="cb77-2" title="2">                                 <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb77-3" title="3">                                 napi_finalize finalize_cb,</a>
<a class="sourceLine" id="cb77-4" title="4">                                 <span class="dt">void</span>* finalize_hint,</a>
<a class="sourceLine" id="cb77-5" title="5">                                 napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] data</code>: Raw pointer to the external data.</li>
      <li>
        <code>[in] finalize_cb</code>: Optional callback to call when the
        external value is being collected.
        <a href="#n_api_napi_finalize"><code>napi_finalize</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] finalize_hint</code>: Optional hint to pass to the finalize
        callback during collection.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing an
        external value.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API allocates a JavaScript value with external data attached to it.
      This is used to pass external data through JavaScript code, so it can be
      retrieved later by native code using
      <a href="#n_api_napi_get_value_external"
        ><code>napi_get_value_external</code></a
      >.
    </p>
    <p>
      The API adds a <code>napi_finalize</code> callback which will be called
      when the JavaScript object just created is ready for garbage collection.
      It is similar to <code>napi_wrap()</code> except that:
    </p>
    <ul>
      <li>
        the native data cannot be retrieved later using
        <code>napi_unwrap()</code>,
      </li>
      <li>
        nor can it be removed later using <code>napi_remove_wrap()</code>, and
      </li>
      <li>
        the object created by the API can be used with <code>napi_wrap()</code>.
      </li>
    </ul>
    <p>
      The created value is not an object, and therefore does not support
      additional properties. It is considered a distinct value type: calling
      <code>napi_typeof()</code> with an external value yields
      <code>napi_external</code>.
    </p>
    <h4 id="napi_create_external_arraybuffer">
      napi_create_external_arraybuffer
    </h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb78">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb78-1" title="1">napi_status</a>
<a class="sourceLine" id="cb78-2" title="2">napi_create_external_arraybuffer(napi_env env,</a>
<a class="sourceLine" id="cb78-3" title="3">                                 <span class="dt">void</span>* external_data,</a>
<a class="sourceLine" id="cb78-4" title="4">                                 <span class="dt">size_t</span> byte_length,</a>
<a class="sourceLine" id="cb78-5" title="5">                                 napi_finalize finalize_cb,</a>
<a class="sourceLine" id="cb78-6" title="6">                                 <span class="dt">void</span>* finalize_hint,</a>
<a class="sourceLine" id="cb78-7" title="7">                                 napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] external_data</code>: Pointer to the underlying byte buffer
        of the <code>ArrayBuffer</code>.
      </li>
      <li>
        <code>[in] byte_length</code>: The length in bytes of the underlying
        buffer.
      </li>
      <li>
        <code>[in] finalize_cb</code>: Optional callback to call when the
        <code>ArrayBuffer</code> is being collected.
        <a href="#n_api_napi_finalize"><code>napi_finalize</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] finalize_hint</code>: Optional hint to pass to the finalize
        callback during collection.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>ArrayBuffer</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns a Node-API value corresponding to a JavaScript
      <code>ArrayBuffer</code>. The underlying byte buffer of the
      <code>ArrayBuffer</code> is externally allocated and managed. The caller
      must ensure that the byte buffer remains valid until the finalize callback
      is called.
    </p>
    <p>
      The API adds a <code>napi_finalize</code> callback which will be called
      when the JavaScript object just created is ready for garbage collection.
      It is similar to <code>napi_wrap()</code> except that:
    </p>
    <ul>
      <li>
        the native data cannot be retrieved later using
        <code>napi_unwrap()</code>,
      </li>
      <li>
        nor can it be removed later using <code>napi_remove_wrap()</code>, and
      </li>
      <li>
        the object created by the API can be used with <code>napi_wrap()</code>.
      </li>
    </ul>
    <p>
      JavaScript <code>ArrayBuffer</code>s are described in
      <a href="https://tc39.github.io/ecma262/#sec-arraybuffer-objects"
        >Section 24.1</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_external_buffer">napi_create_external_buffer</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb79">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb79-1" title="1">napi_status napi_create_external_buffer(napi_env env,</a>
<a class="sourceLine" id="cb79-2" title="2">                                        <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb79-3" title="3">                                        <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb79-4" title="4">                                        napi_finalize finalize_cb,</a>
<a class="sourceLine" id="cb79-5" title="5">                                        <span class="dt">void</span>* finalize_hint,</a>
<a class="sourceLine" id="cb79-6" title="6">                                        napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] length</code>: Size in bytes of the input buffer (should be
        the same as the size of the new buffer).
      </li>
      <li>
        <code>[in] data</code>: Raw pointer to the underlying buffer to expose
        to JavaScript.
      </li>
      <li>
        <code>[in] finalize_cb</code>: Optional callback to call when the
        <code>ArrayBuffer</code> is being collected.
        <a href="#n_api_napi_finalize"><code>napi_finalize</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] finalize_hint</code>: Optional hint to pass to the finalize
        callback during collection.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        <code>node::Buffer</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API allocates a <code>node::Buffer</code> object and initializes it
      with data backed by the passed in buffer. While this is still a
      fully-supported data structure, in most cases using a
      <code>TypedArray</code> will suffice.
    </p>
    <p>
      The API adds a <code>napi_finalize</code> callback which will be called
      when the JavaScript object just created is ready for garbage collection.
      It is similar to <code>napi_wrap()</code> except that:
    </p>
    <ul>
      <li>
        the native data cannot be retrieved later using
        <code>napi_unwrap()</code>,
      </li>
      <li>
        nor can it be removed later using <code>napi_remove_wrap()</code>, and
      </li>
      <li>
        the object created by the API can be used with <code>napi_wrap()</code>.
      </li>
    </ul>
    <p>For Node.js &gt;=4 <code>Buffers</code> are <code>Uint8Array</code>s.</p>
    <h4 id="napi_create_object">napi_create_object</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb80">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb80-1" title="1">napi_status napi_create_object(napi_env env, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>Object</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API allocates a default JavaScript <code>Object</code>. It is the
      equivalent of doing <code>new Object()</code> in JavaScript.
    </p>
    <p>
      The JavaScript <code>Object</code> type is described in
      <a href="https://tc39.github.io/ecma262/#sec-object-type"
        >Section 6.1.7</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_symbol">napi_create_symbol</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb81">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb81-1" title="1">napi_status napi_create_symbol(napi_env env,</a>
<a class="sourceLine" id="cb81-2" title="2">                               napi_value description,</a>
<a class="sourceLine" id="cb81-3" title="3">                               napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] description</code>: Optional <code>napi_value</code> which
        refers to a JavaScript <code>string</code> to be set as the description
        for the symbol.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>symbol</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API creates a JavaScript <code>symbol</code> value from a
      UTF8-encoded C string.
    </p>
    <p>
      The JavaScript <code>symbol</code> type is described in
      <a href="https://tc39.github.io/ecma262/#sec-symbol-objects"
        >Section 19.4</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_typedarray">napi_create_typedarray</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb82">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb82-1" title="1">napi_status napi_create_typedarray(napi_env env,</a>
<a class="sourceLine" id="cb82-2" title="2">                                   napi_typedarray_type type,</a>
<a class="sourceLine" id="cb82-3" title="3">                                   <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb82-4" title="4">                                   napi_value arraybuffer,</a>
<a class="sourceLine" id="cb82-5" title="5">                                   <span class="dt">size_t</span> byte_offset,</a>
<a class="sourceLine" id="cb82-6" title="6">                                   napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] type</code>: Scalar datatype of the elements within the
        <code>TypedArray</code>.
      </li>
      <li>
        <code>[in] length</code>: Number of elements in the
        <code>TypedArray</code>.
      </li>
      <li>
        <code>[in] arraybuffer</code>: <code>ArrayBuffer</code> underlying the
        typed array.
      </li>
      <li>
        <code>[in] byte_offset</code>: The byte offset within the
        <code>ArrayBuffer</code> from which to start projecting the
        <code>TypedArray</code>.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>TypedArray</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API creates a JavaScript <code>TypedArray</code> object over an
      existing <code>ArrayBuffer</code>. <code>TypedArray</code> objects provide
      an array-like view over an underlying data buffer where each element has
      the same underlying binary scalar datatype.
    </p>
    <p>
      It’s required that
      <code>(length * size_of_element) + byte_offset</code> should be &lt;= the
      size in bytes of the array passed in. If not, a
      <code>RangeError</code> exception is raised.
    </p>
    <p>
      JavaScript <code>TypedArray</code> objects are described in
      <a href="https://tc39.github.io/ecma262/#sec-typedarray-objects"
        >Section 22.2</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_dataview">napi_create_dataview</h4>
    <!-- YAML
added: v8.3.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb83">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb83-1" title="1">napi_status napi_create_dataview(napi_env env,</a>
<a class="sourceLine" id="cb83-2" title="2">                                 <span class="dt">size_t</span> byte_length,</a>
<a class="sourceLine" id="cb83-3" title="3">                                 napi_value arraybuffer,</a>
<a class="sourceLine" id="cb83-4" title="4">                                 <span class="dt">size_t</span> byte_offset,</a>
<a class="sourceLine" id="cb83-5" title="5">                                 napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] length</code>: Number of elements in the
        <code>DataView</code>.
      </li>
      <li>
        <code>[in] arraybuffer</code>: <code>ArrayBuffer</code> underlying the
        <code>DataView</code>.
      </li>
      <li>
        <code>[in] byte_offset</code>: The byte offset within the
        <code>ArrayBuffer</code> from which to start projecting the
        <code>DataView</code>.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>DataView</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API creates a JavaScript <code>DataView</code> object over an
      existing <code>ArrayBuffer</code>. <code>DataView</code> objects provide
      an array-like view over an underlying data buffer, but one which allows
      items of different size and type in the <code>ArrayBuffer</code>.
    </p>
    <p>
      It is required that <code>byte_length + byte_offset</code> is less than or
      equal to the size in bytes of the array passed in. If not, a
      <code>RangeError</code> exception is raised.
    </p>
    <p>
      JavaScript <code>DataView</code> objects are described in
      <a href="https://tc39.github.io/ecma262/#sec-dataview-objects"
        >Section 24.3</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h3 id="functions-to-convert-from-c-types-to-node-api">
      Functions to convert from C types to Node-API
    </h3>
    <h4 id="napi_create_int32">napi_create_int32</h4>
    <!-- YAML
added: v8.4.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb84">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb84-1" title="1">napi_status napi_create_int32(napi_env env, <span class="dt">int32_t</span> value, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: Integer value to be represented in JavaScript.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>number</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API is used to convert from the C <code>int32_t</code> type to the
      JavaScript <code>number</code> type.
    </p>
    <p>
      The JavaScript <code>number</code> type is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type"
        >Section 6.1.6</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_uint32">napi_create_uint32</h4>
    <!-- YAML
added: v8.4.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb85">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb85-1" title="1">napi_status napi_create_uint32(napi_env env, <span class="dt">uint32_t</span> value, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: Unsigned integer value to be represented in
        JavaScript.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>number</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API is used to convert from the C <code>uint32_t</code> type to the
      JavaScript <code>number</code> type.
    </p>
    <p>
      The JavaScript <code>number</code> type is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type"
        >Section 6.1.6</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_int64">napi_create_int64</h4>
    <!-- YAML
added: v8.4.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb86">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb86-1" title="1">napi_status napi_create_int64(napi_env env, <span class="dt">int64_t</span> value, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: Integer value to be represented in JavaScript.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>number</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API is used to convert from the C <code>int64_t</code> type to the
      JavaScript <code>number</code> type.
    </p>
    <p>
      The JavaScript <code>number</code> type is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type"
        >Section 6.1.6</a
      >
      of the ECMAScript Language Specification. Note the complete range of
      <code>int64_t</code> cannot be represented with full precision in
      JavaScript. Integer values outside the range of
      <a href="https://tc39.github.io/ecma262/#sec-number.min_safe_integer"
        ><code>Number.MIN_SAFE_INTEGER</code></a
      >
      <code>-(2**53 - 1)</code> -
      <a href="https://tc39.github.io/ecma262/#sec-number.max_safe_integer"
        ><code>Number.MAX_SAFE_INTEGER</code></a
      >
      <code>(2**53 - 1)</code> will lose precision.
    </p>
    <h4 id="napi_create_double">napi_create_double</h4>
    <!-- YAML
added: v8.4.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb87">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb87-1" title="1">napi_status napi_create_double(napi_env env, <span class="dt">double</span> value, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: Double-precision value to be represented in
        JavaScript.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>number</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API is used to convert from the C <code>double</code> type to the
      JavaScript <code>number</code> type.
    </p>
    <p>
      The JavaScript <code>number</code> type is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type"
        >Section 6.1.6</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_bigint_int64">napi_create_bigint_int64</h4>
    <!-- YAML
added: v10.7.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb88">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb88-1" title="1">napi_status napi_create_bigint_int64(napi_env env,</a>
<a class="sourceLine" id="cb88-2" title="2">                                     <span class="dt">int64_t</span> value,</a>
<a class="sourceLine" id="cb88-3" title="3">                                     napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: Integer value to be represented in JavaScript.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>BigInt</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API converts the C <code>int64_t</code> type to the JavaScript
      <code>BigInt</code> type.
    </p>
    <h4 id="napi_create_bigint_uint64">napi_create_bigint_uint64</h4>
    <!-- YAML
added: v10.7.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb89">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb89-1" title="1">napi_status napi_create_bigint_uint64(napi_env env,</a>
<a class="sourceLine" id="cb89-2" title="2">                                      <span class="dt">uint64_t</span> value,</a>
<a class="sourceLine" id="cb89-3" title="3">                                      napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: Unsigned integer value to be represented in
        JavaScript.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>BigInt</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API converts the C <code>uint64_t</code> type to the JavaScript
      <code>BigInt</code> type.
    </p>
    <h4 id="napi_create_bigint_words">napi_create_bigint_words</h4>
    <!-- YAML
added: v10.7.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb90">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb90-1" title="1">napi_status napi_create_bigint_words(napi_env env,</a>
<a class="sourceLine" id="cb90-2" title="2">                                     <span class="dt">int</span> sign_bit,</a>
<a class="sourceLine" id="cb90-3" title="3">                                     <span class="dt">size_t</span> word_count,</a>
<a class="sourceLine" id="cb90-4" title="4">                                     <span class="dt">const</span> <span class="dt">uint64_t</span>* words,</a>
<a class="sourceLine" id="cb90-5" title="5">                                     napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] sign_bit</code>: Determines if the resulting
        <code>BigInt</code> will be positive or negative.
      </li>
      <li>
        <code>[in] word_count</code>: The length of the
        <code>words</code> array.
      </li>
      <li>
        <code>[in] words</code>: An array of <code>uint64_t</code> little-endian
        64-bit words.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>BigInt</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API converts an array of unsigned 64-bit words into a single
      <code>BigInt</code> value.
    </p>
    <p>
      The resulting <code>BigInt</code> is calculated as: (–1)<sup
        ><code>sign_bit</code></sup
      >
      (<code>words[0]</code> × (2<sup>64</sup>)<sup>0</sup> +
      <code>words[1]</code> × (2<sup>64</sup>)<sup>1</sup> + …)
    </p>
    <h4 id="napi_create_string_latin1">napi_create_string_latin1</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb91">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb91-1" title="1">napi_status napi_create_string_latin1(napi_env env,</a>
<a class="sourceLine" id="cb91-2" title="2">                                      <span class="dt">const</span> <span class="dt">char</span>* str,</a>
<a class="sourceLine" id="cb91-3" title="3">                                      <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb91-4" title="4">                                      napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] str</code>: Character buffer representing an
        ISO-8859-1-encoded string.
      </li>
      <li>
        <code>[in] length</code>: The length of the string in bytes, or
        <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>string</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API creates a JavaScript <code>string</code> value from an
      ISO-8859-1-encoded C string. The native string is copied.
    </p>
    <p>
      The JavaScript <code>string</code> type is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type"
        >Section 6.1.4</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_string_utf16">napi_create_string_utf16</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb92">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb92-1" title="1">napi_status napi_create_string_utf16(napi_env env,</a>
<a class="sourceLine" id="cb92-2" title="2">                                     <span class="dt">const</span> char16_t* str,</a>
<a class="sourceLine" id="cb92-3" title="3">                                     <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb92-4" title="4">                                     napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] str</code>: Character buffer representing a UTF16-LE-encoded
        string.
      </li>
      <li>
        <code>[in] length</code>: The length of the string in two-byte code
        units, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>string</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API creates a JavaScript <code>string</code> value from a
      UTF16-LE-encoded C string. The native string is copied.
    </p>
    <p>
      The JavaScript <code>string</code> type is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type"
        >Section 6.1.4</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_create_string_utf8">napi_create_string_utf8</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb93">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb93-1" title="1">napi_status napi_create_string_utf8(napi_env env,</a>
<a class="sourceLine" id="cb93-2" title="2">                                    <span class="dt">const</span> <span class="dt">char</span>* str,</a>
<a class="sourceLine" id="cb93-3" title="3">                                    <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb93-4" title="4">                                    napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] str</code>: Character buffer representing a UTF8-encoded
        string.
      </li>
      <li>
        <code>[in] length</code>: The length of the string in bytes, or
        <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing a
        JavaScript <code>string</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API creates a JavaScript <code>string</code> value from a
      UTF8-encoded C string. The native string is copied.
    </p>
    <p>
      The JavaScript <code>string</code> type is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type"
        >Section 6.1.4</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h3 id="functions-to-convert-from-node-api-to-c-types">
      Functions to convert from Node-API to C types
    </h3>
    <h4 id="napi_get_array_length">napi_get_array_length</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb94">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb94-1" title="1">napi_status napi_get_array_length(napi_env env,</a>
<a class="sourceLine" id="cb94-2" title="2">                                  napi_value value,</a>
<a class="sourceLine" id="cb94-3" title="3">                                  <span class="dt">uint32_t</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing the
        JavaScript <code>Array</code> whose length is being queried.
      </li>
      <li>
        <code>[out] result</code>: <code>uint32</code> representing length of
        the array.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API returns the length of an array.</p>
    <p>
      <code>Array</code> length is described in
      <a
        href="https://tc39.github.io/ecma262/#sec-properties-of-array-instances-length"
        >Section 22.1.4.1</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h4 id="napi_get_arraybuffer_info">napi_get_arraybuffer_info</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb95">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb95-1" title="1">napi_status napi_get_arraybuffer_info(napi_env env,</a>
<a class="sourceLine" id="cb95-2" title="2">                                      napi_value arraybuffer,</a>
<a class="sourceLine" id="cb95-3" title="3">                                      <span class="dt">void</span>** data,</a>
<a class="sourceLine" id="cb95-4" title="4">                                      <span class="dt">size_t</span>* byte_length)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] arraybuffer</code>: <code>napi_value</code> representing the
        <code>ArrayBuffer</code> being queried.
      </li>
      <li>
        <code>[out] data</code>: The underlying data buffer of the
        <code>ArrayBuffer</code>. If byte_length is <code>0</code>, this may be
        <code>NULL</code> or any other pointer value.
      </li>
      <li>
        <code>[out] byte_length</code>: Length in bytes of the underlying data
        buffer.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API is used to retrieve the underlying data buffer of an
      <code>ArrayBuffer</code> and its length.
    </p>
    <p>
      <em>WARNING</em>: Use caution while using this API. The lifetime of the
      underlying data buffer is managed by the <code>ArrayBuffer</code> even
      after it’s returned. A possible safe way to use this API is in conjunction
      with
      <a href="#n_api_napi_create_reference"
        ><code>napi_create_reference</code></a
      >, which can be used to guarantee control over the lifetime of the
      <code>ArrayBuffer</code>. It’s also safe to use the returned data buffer
      within the same callback as long as there are no calls to other APIs that
      might trigger a GC.
    </p>
    <h4 id="napi_get_buffer_info">napi_get_buffer_info</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb96">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb96-1" title="1">napi_status napi_get_buffer_info(napi_env env,</a>
<a class="sourceLine" id="cb96-2" title="2">                                 napi_value value,</a>
<a class="sourceLine" id="cb96-3" title="3">                                 <span class="dt">void</span>** data,</a>
<a class="sourceLine" id="cb96-4" title="4">                                 <span class="dt">size_t</span>* length)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing the
        <code>node::Buffer</code> being queried.
      </li>
      <li>
        <code>[out] data</code>: The underlying data buffer of the
        <code>node::Buffer</code>. If length is <code>0</code>, this may be
        <code>NULL</code> or any other pointer value.
      </li>
      <li>
        <code>[out] length</code>: Length in bytes of the underlying data
        buffer.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API is used to retrieve the underlying data buffer of a
      <code>node::Buffer</code> and its length.
    </p>
    <p>
      <em>Warning</em>: Use caution while using this API since the underlying
      data buffer’s lifetime is not guaranteed if it’s managed by the VM.
    </p>
    <h4 id="napi_get_prototype">napi_get_prototype</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb97">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb97-1" title="1">napi_status napi_get_prototype(napi_env env,</a>
<a class="sourceLine" id="cb97-2" title="2">                               napi_value object,</a>
<a class="sourceLine" id="cb97-3" title="3">                               napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] object</code>: <code>napi_value</code> representing
        JavaScript <code>Object</code> whose prototype to return. This returns
        the equivalent of <code>Object.getPrototypeOf</code> (which is not the
        same as the function’s <code>prototype</code> property).
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing
        prototype of the given object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <h4 id="napi_get_typedarray_info">napi_get_typedarray_info</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb98">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb98-1" title="1">napi_status napi_get_typedarray_info(napi_env env,</a>
<a class="sourceLine" id="cb98-2" title="2">                                     napi_value typedarray,</a>
<a class="sourceLine" id="cb98-3" title="3">                                     napi_typedarray_type* type,</a>
<a class="sourceLine" id="cb98-4" title="4">                                     <span class="dt">size_t</span>* length,</a>
<a class="sourceLine" id="cb98-5" title="5">                                     <span class="dt">void</span>** data,</a>
<a class="sourceLine" id="cb98-6" title="6">                                     napi_value* arraybuffer,</a>
<a class="sourceLine" id="cb98-7" title="7">                                     <span class="dt">size_t</span>* byte_offset)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] typedarray</code>: <code>napi_value</code> representing the
        <code>TypedArray</code> whose properties to query.
      </li>
      <li>
        <code>[out] type</code>: Scalar datatype of the elements within the
        <code>TypedArray</code>.
      </li>
      <li>
        <code>[out] length</code>: The number of elements in the
        <code>TypedArray</code>.
      </li>
      <li>
        <code>[out] data</code>: The data buffer underlying the
        <code>TypedArray</code> adjusted by the <code>byte_offset</code> value
        so that it points to the first element in the <code>TypedArray</code>.
        If the length of the array is <code>0</code>, this may be
        <code>NULL</code> or any other pointer value.
      </li>
      <li>
        <code>[out] arraybuffer</code>: The <code>ArrayBuffer</code> underlying
        the <code>TypedArray</code>.
      </li>
      <li>
        <code>[out] byte_offset</code>: The byte offset within the underlying
        native array at which the first element of the arrays is located. The
        value for the data parameter has already been adjusted so that data
        points to the first element in the array. Therefore, the first byte of
        the native array would be at <code>data - byte_offset</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API returns various properties of a typed array.</p>
    <p>
      <em>Warning</em>: Use caution while using this API since the underlying
      data buffer is managed by the VM.
    </p>
    <h4 id="napi_get_dataview_info">napi_get_dataview_info</h4>
    <!-- YAML
added: v8.3.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb99">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb99-1" title="1">napi_status napi_get_dataview_info(napi_env env,</a>
<a class="sourceLine" id="cb99-2" title="2">                                   napi_value dataview,</a>
<a class="sourceLine" id="cb99-3" title="3">                                   <span class="dt">size_t</span>* byte_length,</a>
<a class="sourceLine" id="cb99-4" title="4">                                   <span class="dt">void</span>** data,</a>
<a class="sourceLine" id="cb99-5" title="5">                                   napi_value* arraybuffer,</a>
<a class="sourceLine" id="cb99-6" title="6">                                   <span class="dt">size_t</span>* byte_offset)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] dataview</code>: <code>napi_value</code> representing the
        <code>DataView</code> whose properties to query.
      </li>
      <li>
        <code>[out] byte_length</code>: Number of bytes in the
        <code>DataView</code>.
      </li>
      <li>
        <code>[out] data</code>: The data buffer underlying the
        <code>DataView</code>. If byte_length is <code>0</code>, this may be
        <code>NULL</code> or any other pointer value.
      </li>
      <li>
        <code>[out] arraybuffer</code>: <code>ArrayBuffer</code> underlying the
        <code>DataView</code>.
      </li>
      <li>
        <code>[out] byte_offset</code>: The byte offset within the data buffer
        from which to start projecting the <code>DataView</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API returns various properties of a <code>DataView</code>.</p>
    <h4 id="napi_get_date_value">napi_get_date_value</h4>
    <!-- YAML
added:
 - v11.11.0
 - v10.17.0
napiVersion: 5
-->
    <div class="sourceCode" id="cb100">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb100-1" title="1">napi_status napi_get_date_value(napi_env env,</a>
<a class="sourceLine" id="cb100-2" title="2">                                napi_value value,</a>
<a class="sourceLine" id="cb100-3" title="3">                                <span class="dt">double</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing a
        JavaScript <code>Date</code>.
      </li>
      <li>
        <code>[out] result</code>: Time value as a
        <code>double</code> represented as milliseconds since midnight at the
        beginning of 01 January, 1970 UTC.
      </li>
    </ul>
    <p>
      This API does not observe leap seconds; they are ignored, as ECMAScript
      aligns with POSIX time specification.
    </p>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-date
      <code>napi_value</code> is passed in it returns
      <code>napi_date_expected</code>.
    </p>
    <p>
      This API returns the C double primitive of time value for the given
      JavaScript <code>Date</code>.
    </p>
    <h4 id="napi_get_value_bool">napi_get_value_bool</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb101">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb101-1" title="1">napi_status napi_get_value_bool(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>Boolean</code>.
      </li>
      <li>
        <code>[out] result</code>: C boolean primitive equivalent of the given
        JavaScript <code>Boolean</code>.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-boolean
      <code>napi_value</code> is passed in it returns
      <code>napi_boolean_expected</code>.
    </p>
    <p>
      This API returns the C boolean primitive equivalent of the given
      JavaScript <code>Boolean</code>.
    </p>
    <h4 id="napi_get_value_double">napi_get_value_double</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb102">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb102-1" title="1">napi_status napi_get_value_double(napi_env env,</a>
<a class="sourceLine" id="cb102-2" title="2">                                  napi_value value,</a>
<a class="sourceLine" id="cb102-3" title="3">                                  <span class="dt">double</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>number</code>.
      </li>
      <li>
        <code>[out] result</code>: C double primitive equivalent of the given
        JavaScript <code>number</code>.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-number
      <code>napi_value</code> is passed in it returns
      <code>napi_number_expected</code>.
    </p>
    <p>
      This API returns the C double primitive equivalent of the given JavaScript
      <code>number</code>.
    </p>
    <h4 id="napi_get_value_bigint_int64">napi_get_value_bigint_int64</h4>
    <!-- YAML
added: v10.7.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb103">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb103-1" title="1">napi_status napi_get_value_bigint_int64(napi_env env,</a>
<a class="sourceLine" id="cb103-2" title="2">                                        napi_value value,</a>
<a class="sourceLine" id="cb103-3" title="3">                                        <span class="dt">int64_t</span>* result,</a>
<a class="sourceLine" id="cb103-4" title="4">                                        <span class="dt">bool</span>* lossless);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>BigInt</code>.
      </li>
      <li>
        <code>[out] result</code>: C <code>int64_t</code> primitive equivalent
        of the given JavaScript <code>BigInt</code>.
      </li>
      <li>
        <code>[out] lossless</code>: Indicates whether the
        <code>BigInt</code> value was converted losslessly.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-<code
        >BigInt</code
      >
      is passed in it returns <code>napi_bigint_expected</code>.
    </p>
    <p>
      This API returns the C <code>int64_t</code> primitive equivalent of the
      given JavaScript <code>BigInt</code>. If needed it will truncate the
      value, setting <code>lossless</code> to <code>false</code>.
    </p>
    <h4 id="napi_get_value_bigint_uint64">napi_get_value_bigint_uint64</h4>
    <!-- YAML
added: v10.7.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb104">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb104-1" title="1">napi_status napi_get_value_bigint_uint64(napi_env env,</a>
<a class="sourceLine" id="cb104-2" title="2">                                        napi_value value,</a>
<a class="sourceLine" id="cb104-3" title="3">                                        <span class="dt">uint64_t</span>* result,</a>
<a class="sourceLine" id="cb104-4" title="4">                                        <span class="dt">bool</span>* lossless);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>BigInt</code>.
      </li>
      <li>
        <code>[out] result</code>: C <code>uint64_t</code> primitive equivalent
        of the given JavaScript <code>BigInt</code>.
      </li>
      <li>
        <code>[out] lossless</code>: Indicates whether the
        <code>BigInt</code> value was converted losslessly.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-<code
        >BigInt</code
      >
      is passed in it returns <code>napi_bigint_expected</code>.
    </p>
    <p>
      This API returns the C <code>uint64_t</code> primitive equivalent of the
      given JavaScript <code>BigInt</code>. If needed it will truncate the
      value, setting <code>lossless</code> to <code>false</code>.
    </p>
    <h4 id="napi_get_value_bigint_words">napi_get_value_bigint_words</h4>
    <!-- YAML
added: v10.7.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb105">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb105-1" title="1">napi_status napi_get_value_bigint_words(napi_env env,</a>
<a class="sourceLine" id="cb105-2" title="2">                                        napi_value value,</a>
<a class="sourceLine" id="cb105-3" title="3">                                        <span class="dt">int</span>* sign_bit,</a>
<a class="sourceLine" id="cb105-4" title="4">                                        <span class="dt">size_t</span>* word_count,</a>
<a class="sourceLine" id="cb105-5" title="5">                                        <span class="dt">uint64_t</span>* words);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>BigInt</code>.
      </li>
      <li>
        <code>[out] sign_bit</code>: Integer representing if the JavaScript
        <code>BigInt</code> is positive or negative.
      </li>
      <li>
        <code>[in/out] word_count</code>: Must be initialized to the length of
        the <code>words</code> array. Upon return, it will be set to the actual
        number of words that would be needed to store this <code>BigInt</code>.
      </li>
      <li>
        <code>[out] words</code>: Pointer to a pre-allocated 64-bit word array.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API converts a single <code>BigInt</code> value into a sign bit,
      64-bit little-endian array, and the number of elements in the array.
      <code>sign_bit</code> and <code>words</code> may be both set to
      <code>NULL</code>, in order to get only <code>word_count</code>.
    </p>
    <h4 id="napi_get_value_external">napi_get_value_external</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb106">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb106-1" title="1">napi_status napi_get_value_external(napi_env env,</a>
<a class="sourceLine" id="cb106-2" title="2">                                    napi_value value,</a>
<a class="sourceLine" id="cb106-3" title="3">                                    <span class="dt">void</span>** result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        external value.
      </li>
      <li>
        <code>[out] result</code>: Pointer to the data wrapped by the JavaScript
        external value.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-external
      <code>napi_value</code> is passed in it returns
      <code>napi_invalid_arg</code>.
    </p>
    <p>
      This API retrieves the external data pointer that was previously passed to
      <code>napi_create_external()</code>.
    </p>
    <h4 id="napi_get_value_int32">napi_get_value_int32</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb107">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb107-1" title="1">napi_status napi_get_value_int32(napi_env env,</a>
<a class="sourceLine" id="cb107-2" title="2">                                 napi_value value,</a>
<a class="sourceLine" id="cb107-3" title="3">                                 <span class="dt">int32_t</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>number</code>.
      </li>
      <li>
        <code>[out] result</code>: C <code>int32</code> primitive equivalent of
        the given JavaScript <code>number</code>.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-number
      <code>napi_value</code> is passed in <code>napi_number_expected</code>.
    </p>
    <p>
      This API returns the C <code>int32</code> primitive equivalent of the
      given JavaScript <code>number</code>.
    </p>
    <p>
      If the number exceeds the range of the 32 bit integer, then the result is
      truncated to the equivalent of the bottom 32 bits. This can result in a
      large positive number becoming a negative number if the value is &gt;
      2<sup>31</sup> - 1.
    </p>
    <p>
      Non-finite number values (<code>NaN</code>, <code>+Infinity</code>, or
      <code>-Infinity</code>) set the result to zero.
    </p>
    <h4 id="napi_get_value_int64">napi_get_value_int64</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb108">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb108-1" title="1">napi_status napi_get_value_int64(napi_env env,</a>
<a class="sourceLine" id="cb108-2" title="2">                                 napi_value value,</a>
<a class="sourceLine" id="cb108-3" title="3">                                 <span class="dt">int64_t</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>number</code>.
      </li>
      <li>
        <code>[out] result</code>: C <code>int64</code> primitive equivalent of
        the given JavaScript <code>number</code>.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-number
      <code>napi_value</code> is passed in it returns
      <code>napi_number_expected</code>.
    </p>
    <p>
      This API returns the C <code>int64</code> primitive equivalent of the
      given JavaScript <code>number</code>.
    </p>
    <p>
      <code>number</code> values outside the range of
      <a href="https://tc39.github.io/ecma262/#sec-number.min_safe_integer"
        ><code>Number.MIN_SAFE_INTEGER</code></a
      >
      <code>-(2**53 - 1)</code> -
      <a href="https://tc39.github.io/ecma262/#sec-number.max_safe_integer"
        ><code>Number.MAX_SAFE_INTEGER</code></a
      >
      <code>(2**53 - 1)</code> will lose precision.
    </p>
    <p>
      Non-finite number values (<code>NaN</code>, <code>+Infinity</code>, or
      <code>-Infinity</code>) set the result to zero.
    </p>
    <h4 id="napi_get_value_string_latin1">napi_get_value_string_latin1</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb109">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb109-1" title="1">napi_status napi_get_value_string_latin1(napi_env env,</a>
<a class="sourceLine" id="cb109-2" title="2">                                         napi_value value,</a>
<a class="sourceLine" id="cb109-3" title="3">                                         <span class="dt">char</span>* buf,</a>
<a class="sourceLine" id="cb109-4" title="4">                                         <span class="dt">size_t</span> bufsize,</a>
<a class="sourceLine" id="cb109-5" title="5">                                         <span class="dt">size_t</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        string.
      </li>
      <li>
        <code>[in] buf</code>: Buffer to write the ISO-8859-1-encoded string
        into. If <code>NULL</code> is passed in, the length of the string in
        bytes and excluding the null terminator is returned in
        <code>result</code>.
      </li>
      <li>
        <code>[in] bufsize</code>: Size of the destination buffer. When this
        value is insufficient, the returned string is truncated and
        null-terminated.
      </li>
      <li>
        <code>[out] result</code>: Number of bytes copied into the buffer,
        excluding the null terminator.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-<code
        >string</code
      >
      <code>napi_value</code> is passed in it returns
      <code>napi_string_expected</code>.
    </p>
    <p>
      This API returns the ISO-8859-1-encoded string corresponding the value
      passed in.
    </p>
    <h4 id="napi_get_value_string_utf8">napi_get_value_string_utf8</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb110">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb110-1" title="1">napi_status napi_get_value_string_utf8(napi_env env,</a>
<a class="sourceLine" id="cb110-2" title="2">                                       napi_value value,</a>
<a class="sourceLine" id="cb110-3" title="3">                                       <span class="dt">char</span>* buf,</a>
<a class="sourceLine" id="cb110-4" title="4">                                       <span class="dt">size_t</span> bufsize,</a>
<a class="sourceLine" id="cb110-5" title="5">                                       <span class="dt">size_t</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        string.
      </li>
      <li>
        <code>[in] buf</code>: Buffer to write the UTF8-encoded string into. If
        <code>NULL</code> is passed in, the length of the string in bytes and
        excluding the null terminator is returned in <code>result</code>.
      </li>
      <li>
        <code>[in] bufsize</code>: Size of the destination buffer. When this
        value is insufficient, the returned string is truncated and
        null-terminated.
      </li>
      <li>
        <code>[out] result</code>: Number of bytes copied into the buffer,
        excluding the null terminator.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-<code
        >string</code
      >
      <code>napi_value</code> is passed in it returns
      <code>napi_string_expected</code>.
    </p>
    <p>
      This API returns the UTF8-encoded string corresponding the value passed
      in.
    </p>
    <h4 id="napi_get_value_string_utf16">napi_get_value_string_utf16</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb111">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb111-1" title="1">napi_status napi_get_value_string_utf16(napi_env env,</a>
<a class="sourceLine" id="cb111-2" title="2">                                        napi_value value,</a>
<a class="sourceLine" id="cb111-3" title="3">                                        char16_t* buf,</a>
<a class="sourceLine" id="cb111-4" title="4">                                        <span class="dt">size_t</span> bufsize,</a>
<a class="sourceLine" id="cb111-5" title="5">                                        <span class="dt">size_t</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        string.
      </li>
      <li>
        <code>[in] buf</code>: Buffer to write the UTF16-LE-encoded string into.
        If <code>NULL</code> is passed in, the length of the string in 2-byte
        code units and excluding the null terminator is returned.
      </li>
      <li>
        <code>[in] bufsize</code>: Size of the destination buffer. When this
        value is insufficient, the returned string is truncated and
        null-terminated.
      </li>
      <li>
        <code>[out] result</code>: Number of 2-byte code units copied into the
        buffer, excluding the null terminator.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-<code
        >string</code
      >
      <code>napi_value</code> is passed in it returns
      <code>napi_string_expected</code>.
    </p>
    <p>
      This API returns the UTF16-encoded string corresponding the value passed
      in.
    </p>
    <h4 id="napi_get_value_uint32">napi_get_value_uint32</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb112">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb112-1" title="1">napi_status napi_get_value_uint32(napi_env env,</a>
<a class="sourceLine" id="cb112-2" title="2">                                  napi_value value,</a>
<a class="sourceLine" id="cb112-3" title="3">                                  <span class="dt">uint32_t</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: <code>napi_value</code> representing JavaScript
        <code>number</code>.
      </li>
      <li>
        <code>[out] result</code>: C primitive equivalent of the given
        <code>napi_value</code> as a <code>uint32_t</code>.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-number
      <code>napi_value</code> is passed in it returns
      <code>napi_number_expected</code>.
    </p>
    <p>
      This API returns the C primitive equivalent of the given
      <code>napi_value</code> as a <code>uint32_t</code>.
    </p>
    <h3 id="functions-to-get-global-instances">
      Functions to get global instances
    </h3>
    <h4 id="napi_get_boolean">napi_get_boolean</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb113">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb113-1" title="1">napi_status napi_get_boolean(napi_env env, <span class="dt">bool</span> value, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The value of the boolean to retrieve.</li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing
        JavaScript <code>Boolean</code> singleton to retrieve.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API is used to return the JavaScript singleton object that is used to
      represent the given boolean value.
    </p>
    <h4 id="napi_get_global">napi_get_global</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb114">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb114-1" title="1">napi_status napi_get_global(napi_env env, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing
        JavaScript <code>global</code> object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API returns the <code>global</code> object.</p>
    <h4 id="napi_get_null">napi_get_null</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb115">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb115-1" title="1">napi_status napi_get_null(napi_env env, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing
        JavaScript <code>null</code> object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API returns the <code>null</code> object.</p>
    <h4 id="napi_get_undefined">napi_get_undefined</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb116">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb116-1" title="1">napi_status napi_get_undefined(napi_env env, napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing
        JavaScript Undefined value.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API returns the Undefined object.</p>
    <h2 id="working-with-javascript-values-and-abstract-operations">
      Working with JavaScript values and abstract operations
    </h2>
    <p>
      Node-API exposes a set of APIs to perform some abstract operations on
      JavaScript values. Some of these operations are documented under
      <a href="https://tc39.github.io/ecma262/#sec-abstract-operations"
        >Section 7</a
      >
      of the
      <a href="https://tc39.github.io/ecma262/"
        >ECMAScript Language Specification</a
      >.
    </p>
    <p>These APIs support doing one of the following:</p>
    <ol type="1">
      <li>
        Coerce JavaScript values to specific JavaScript types (such as
        <code>number</code> or <code>string</code>).
      </li>
      <li>Check the type of a JavaScript value.</li>
      <li>Check for equality between two JavaScript values.</li>
    </ol>
    <h3 id="napi_coerce_to_bool">napi_coerce_to_bool</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb117">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb117-1" title="1">napi_status napi_coerce_to_bool(napi_env env,</a>
<a class="sourceLine" id="cb117-2" title="2">                                napi_value value,</a>
<a class="sourceLine" id="cb117-3" title="3">                                napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to coerce.</li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        coerced JavaScript <code>Boolean</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API implements the abstract operation <code>ToBoolean()</code> as
      defined in
      <a href="https://tc39.github.io/ecma262/#sec-toboolean">Section 7.1.2</a>
      of the ECMAScript Language Specification. This API can be re-entrant if
      getters are defined on the passed-in <code>Object</code>.
    </p>
    <h3 id="napi_coerce_to_number">napi_coerce_to_number</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb118">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb118-1" title="1">napi_status napi_coerce_to_number(napi_env env,</a>
<a class="sourceLine" id="cb118-2" title="2">                                  napi_value value,</a>
<a class="sourceLine" id="cb118-3" title="3">                                  napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to coerce.</li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        coerced JavaScript <code>number</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API implements the abstract operation <code>ToNumber()</code> as
      defined in
      <a href="https://tc39.github.io/ecma262/#sec-tonumber">Section 7.1.3</a>
      of the ECMAScript Language Specification. This API can be re-entrant if
      getters are defined on the passed-in <code>Object</code>.
    </p>
    <h3 id="napi_coerce_to_object">napi_coerce_to_object</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb119">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb119-1" title="1">napi_status napi_coerce_to_object(napi_env env,</a>
<a class="sourceLine" id="cb119-2" title="2">                                  napi_value value,</a>
<a class="sourceLine" id="cb119-3" title="3">                                  napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to coerce.</li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        coerced JavaScript <code>Object</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API implements the abstract operation <code>ToObject()</code> as
      defined in
      <a href="https://tc39.github.io/ecma262/#sec-toobject">Section 7.1.13</a>
      of the ECMAScript Language Specification. This API can be re-entrant if
      getters are defined on the passed-in <code>Object</code>.
    </p>
    <h3 id="napi_coerce_to_string">napi_coerce_to_string</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb120">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb120-1" title="1">napi_status napi_coerce_to_string(napi_env env,</a>
<a class="sourceLine" id="cb120-2" title="2">                                  napi_value value,</a>
<a class="sourceLine" id="cb120-3" title="3">                                  napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to coerce.</li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        coerced JavaScript <code>string</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API implements the abstract operation <code>ToString()</code> as
      defined in
      <a href="https://tc39.github.io/ecma262/#sec-toobject">Section 7.1.13</a>
      of the ECMAScript Language Specification. This API can be re-entrant if
      getters are defined on the passed-in <code>Object</code>.
    </p>
    <h3 id="napi_typeof">napi_typeof</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb121">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb121-1" title="1">napi_status napi_typeof(napi_env env, napi_value value, napi_valuetype* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] value</code>: The JavaScript value whose type to query.
      </li>
      <li><code>[out] result</code>: The type of the JavaScript value.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <ul>
      <li>
        <code>napi_invalid_arg</code> if the type of <code>value</code> is not a
        known ECMAScript type and <code>value</code> is not an External value.
      </li>
    </ul>
    <p>
      This API represents behavior similar to invoking the
      <code>typeof</code> Operator on the object as defined in
      <a href="https://tc39.github.io/ecma262/#sec-typeof-operator"
        >Section 12.5.5</a
      >
      of the ECMAScript Language Specification. However, there are some
      differences:
    </p>
    <ol type="1">
      <li>It has support for detecting an External value.</li>
      <li>
        It detects <code>null</code> as a separate type, while ECMAScript
        <code>typeof</code> would detect <code>object</code>.
      </li>
    </ol>
    <p>
      If <code>value</code> has a type that is invalid, an error is returned.
    </p>
    <h3 id="napi_instanceof">napi_instanceof</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb122">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb122-1" title="1">napi_status napi_instanceof(napi_env env,</a>
<a class="sourceLine" id="cb122-2" title="2">                            napi_value object,</a>
<a class="sourceLine" id="cb122-3" title="3">                            napi_value constructor,</a>
<a class="sourceLine" id="cb122-4" title="4">                            <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] object</code>: The JavaScript value to check.</li>
      <li>
        <code>[in] constructor</code>: The JavaScript function object of the
        constructor function to check against.
      </li>
      <li>
        <code>[out] result</code>: Boolean that is set to true if
        <code>object instanceof constructor</code> is true.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API represents invoking the <code>instanceof</code> Operator on the
      object as defined in
      <a href="https://tc39.github.io/ecma262/#sec-instanceofoperator"
        >Section 12.10.4</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h3 id="napi_is_array">napi_is_array</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb123">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb123-1" title="1">napi_status napi_is_array(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to check.</li>
      <li><code>[out] result</code>: Whether the given object is an array.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API represents invoking the <code>IsArray</code> operation on the
      object as defined in
      <a href="https://tc39.github.io/ecma262/#sec-isarray">Section 7.2.2</a> of
      the ECMAScript Language Specification.
    </p>
    <h3 id="napi_is_arraybuffer">napi_is_arraybuffer</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb124">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb124-1" title="1">napi_status napi_is_arraybuffer(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to check.</li>
      <li>
        <code>[out] result</code>: Whether the given object is an
        <code>ArrayBuffer</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API checks if the <code>Object</code> passed in is an array buffer.
    </p>
    <h3 id="napi_is_buffer">napi_is_buffer</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb125">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb125-1" title="1">napi_status napi_is_buffer(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to check.</li>
      <li>
        <code>[out] result</code>: Whether the given
        <code>napi_value</code> represents a <code>node::Buffer</code> object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API checks if the <code>Object</code> passed in is a buffer.</p>
    <h3 id="napi_is_date">napi_is_date</h3>
    <!-- YAML
added:
 - v11.11.0
 - v10.17.0
napiVersion: 5
-->
    <div class="sourceCode" id="cb126">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb126-1" title="1">napi_status napi_is_date(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to check.</li>
      <li>
        <code>[out] result</code>: Whether the given
        <code>napi_value</code> represents a JavaScript
        <code>Date</code> object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API checks if the <code>Object</code> passed in is a date.</p>
    <h3 id="napi_is_error-1">napi_is_error</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb127">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb127-1" title="1">napi_status napi_is_error(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to check.</li>
      <li>
        <code>[out] result</code>: Whether the given
        <code>napi_value</code> represents an <code>Error</code> object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API checks if the <code>Object</code> passed in is an
      <code>Error</code>.
    </p>
    <h3 id="napi_is_typedarray">napi_is_typedarray</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb128">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb128-1" title="1">napi_status napi_is_typedarray(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to check.</li>
      <li>
        <code>[out] result</code>: Whether the given
        <code>napi_value</code> represents a <code>TypedArray</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API checks if the <code>Object</code> passed in is a typed array.
    </p>
    <h3 id="napi_is_dataview">napi_is_dataview</h3>
    <!-- YAML
added: v8.3.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb129">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb129-1" title="1">napi_status napi_is_dataview(napi_env env, napi_value value, <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The JavaScript value to check.</li>
      <li>
        <code>[out] result</code>: Whether the given
        <code>napi_value</code> represents a <code>DataView</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API checks if the <code>Object</code> passed in is a
      <code>DataView</code>.
    </p>
    <h3 id="napi_strict_equals">napi_strict_equals</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb130">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb130-1" title="1">napi_status napi_strict_equals(napi_env env,</a>
<a class="sourceLine" id="cb130-2" title="2">                               napi_value lhs,</a>
<a class="sourceLine" id="cb130-3" title="3">                               napi_value rhs,</a>
<a class="sourceLine" id="cb130-4" title="4">                               <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] lhs</code>: The JavaScript value to check.</li>
      <li><code>[in] rhs</code>: The JavaScript value to check against.</li>
      <li>
        <code>[out] result</code>: Whether the two
        <code>napi_value</code> objects are equal.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API represents the invocation of the Strict Equality algorithm as
      defined in
      <a href="https://tc39.github.io/ecma262/#sec-strict-equality-comparison"
        >Section 7.2.14</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h3 id="napi_detach_arraybuffer">napi_detach_arraybuffer</h3>
    <!-- YAML
added:
 - v13.0.0
 - v12.16.0
 - v10.22.0
napiVersion: 7
-->
    <div class="sourceCode" id="cb131">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb131-1" title="1">napi_status napi_detach_arraybuffer(napi_env env,</a>
<a class="sourceLine" id="cb131-2" title="2">                                    napi_value arraybuffer)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] arraybuffer</code>: The JavaScript
        <code>ArrayBuffer</code> to be detached.
      </li>
    </ul>
    <p>
      Returns <code>napi_ok</code> if the API succeeded. If a non-detachable
      <code>ArrayBuffer</code> is passed in it returns
      <code>napi_detachable_arraybuffer_expected</code>.
    </p>
    <p>
      Generally, an <code>ArrayBuffer</code> is non-detachable if it has been
      detached before. The engine may impose additional conditions on whether an
      <code>ArrayBuffer</code> is detachable. For example, V8 requires that the
      <code>ArrayBuffer</code> be external, that is, created with
      <a href="#n_api_napi_create_external_arraybuffer"
        ><code>napi_create_external_arraybuffer</code></a
      >.
    </p>
    <p>
      This API represents the invocation of the <code>ArrayBuffer</code> detach
      operation as defined in
      <a href="https://tc39.es/ecma262/#sec-detacharraybuffer"
        >Section 24.1.1.3</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h3 id="napi_is_detached_arraybuffer">napi_is_detached_arraybuffer</h3>
    <!-- YAML
added:
 - v13.3.0
 - v12.16.0
 - v10.22.0
napiVersion: 7
-->
    <div class="sourceCode" id="cb132">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb132-1" title="1">napi_status napi_is_detached_arraybuffer(napi_env env,</a>
<a class="sourceLine" id="cb132-2" title="2">                                         napi_value arraybuffer,</a>
<a class="sourceLine" id="cb132-3" title="3">                                         <span class="dt">bool</span>* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] arraybuffer</code>: The JavaScript
        <code>ArrayBuffer</code> to be checked.
      </li>
      <li>
        <code>[out] result</code>: Whether the <code>arraybuffer</code> is
        detached.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      The <code>ArrayBuffer</code> is considered detached if its internal data
      is <code>null</code>.
    </p>
    <p>
      This API represents the invocation of the <code>ArrayBuffer</code>
      <code>IsDetachedBuffer</code> operation as defined in
      <a href="https://tc39.es/ecma262/#sec-isdetachedbuffer"
        >Section 24.1.1.2</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h2 id="working-with-javascript-properties">
      Working with JavaScript properties
    </h2>
    <p>
      Node-API exposes a set of APIs to get and set properties on JavaScript
      objects. Some of these types are documented under
      <a href="https://tc39.github.io/ecma262/#sec-abstract-operations"
        >Section 7</a
      >
      of the
      <a href="https://tc39.github.io/ecma262/"
        >ECMAScript Language Specification</a
      >.
    </p>
    <p>
      Properties in JavaScript are represented as a tuple of a key and a value.
      Fundamentally, all property keys in Node-API can be represented in one of
      the following forms:
    </p>
    <ul>
      <li>Named: a simple UTF8-encoded string</li>
      <li>
        Integer-Indexed: an index value represented by <code>uint32_t</code>
      </li>
      <li>
        JavaScript value: these are represented in Node-API by
        <code>napi_value</code>. This can be a
        <code>napi_value</code> representing a <code>string</code>,
        <code>number</code>, or <code>symbol</code>.
      </li>
    </ul>
    <p>
      Node-API values are represented by the type <code>napi_value</code>. Any
      Node-API call that requires a JavaScript value takes in a
      <code>napi_value</code>. However, it’s the caller’s responsibility to make
      sure that the <code>napi_value</code> in question is of the JavaScript
      type expected by the API.
    </p>
    <p>
      The APIs documented in this section provide a simple interface to get and
      set properties on arbitrary JavaScript objects represented by
      <code>napi_value</code>.
    </p>
    <p>For instance, consider the following JavaScript code snippet:</p>
    <div class="sourceCode" id="cb133">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb133-1" title="1"><span class="kw">const</span> obj <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb133-2" title="2"><span class="va">obj</span>.<span class="at">myProp</span> <span class="op">=</span> <span class="dv">123</span><span class="op">;</span></a></code></pre>
    </div>
    <p>
      The equivalent can be done using Node-API values with the following
      snippet:
    </p>
    <div class="sourceCode" id="cb134">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb134-1" title="1">napi_status status = napi_generic_failure;</a>
<a class="sourceLine" id="cb134-2" title="2"></a>
<a class="sourceLine" id="cb134-3" title="3"><span class="co">// const obj = {}</span></a>
<a class="sourceLine" id="cb134-4" title="4">napi_value obj, value;</a>
<a class="sourceLine" id="cb134-5" title="5">status = napi_create_object(env, &amp;obj);</a>
<a class="sourceLine" id="cb134-6" title="6"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb134-7" title="7"></a>
<a class="sourceLine" id="cb134-8" title="8"><span class="co">// Create a napi_value for 123</span></a>
<a class="sourceLine" id="cb134-9" title="9">status = napi_create_int32(env, <span class="dv">123</span>, &amp;value);</a>
<a class="sourceLine" id="cb134-10" title="10"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb134-11" title="11"></a>
<a class="sourceLine" id="cb134-12" title="12"><span class="co">// obj.myProp = 123</span></a>
<a class="sourceLine" id="cb134-13" title="13">status = napi_set_named_property(env, obj, <span class="st">&quot;myProp&quot;</span>, value);</a>
<a class="sourceLine" id="cb134-14" title="14"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a></code></pre>
    </div>
    <p>
      Indexed properties can be set in a similar manner. Consider the following
      JavaScript snippet:
    </p>
    <div class="sourceCode" id="cb135">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb135-1" title="1"><span class="kw">const</span> arr <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb135-2" title="2">arr[<span class="dv">123</span>] <span class="op">=</span> <span class="st">&#39;hello&#39;</span><span class="op">;</span></a></code></pre>
    </div>
    <p>
      The equivalent can be done using Node-API values with the following
      snippet:
    </p>
    <div class="sourceCode" id="cb136">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb136-1" title="1">napi_status status = napi_generic_failure;</a>
<a class="sourceLine" id="cb136-2" title="2"></a>
<a class="sourceLine" id="cb136-3" title="3"><span class="co">// const arr = [];</span></a>
<a class="sourceLine" id="cb136-4" title="4">napi_value arr, value;</a>
<a class="sourceLine" id="cb136-5" title="5">status = napi_create_array(env, &amp;arr);</a>
<a class="sourceLine" id="cb136-6" title="6"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb136-7" title="7"></a>
<a class="sourceLine" id="cb136-8" title="8"><span class="co">// Create a napi_value for &#39;hello&#39;</span></a>
<a class="sourceLine" id="cb136-9" title="9">status = napi_create_string_utf8(env, <span class="st">&quot;hello&quot;</span>, NAPI_AUTO_LENGTH, &amp;value);</a>
<a class="sourceLine" id="cb136-10" title="10"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb136-11" title="11"></a>
<a class="sourceLine" id="cb136-12" title="12"><span class="co">// arr[123] = &#39;hello&#39;;</span></a>
<a class="sourceLine" id="cb136-13" title="13">status = napi_set_element(env, arr, <span class="dv">123</span>, value);</a>
<a class="sourceLine" id="cb136-14" title="14"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a></code></pre>
    </div>
    <p>
      Properties can be retrieved using the APIs described in this section.
      Consider the following JavaScript snippet:
    </p>
    <div class="sourceCode" id="cb137">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb137-1" title="1"><span class="kw">const</span> arr <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb137-2" title="2"><span class="kw">const</span> value <span class="op">=</span> arr[<span class="dv">123</span>]<span class="op">;</span></a></code></pre>
    </div>
    <p>
      The following is the approximate equivalent of the Node-API counterpart:
    </p>
    <div class="sourceCode" id="cb138">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb138-1" title="1">napi_status status = napi_generic_failure;</a>
<a class="sourceLine" id="cb138-2" title="2"></a>
<a class="sourceLine" id="cb138-3" title="3"><span class="co">// const arr = []</span></a>
<a class="sourceLine" id="cb138-4" title="4">napi_value arr, value;</a>
<a class="sourceLine" id="cb138-5" title="5">status = napi_create_array(env, &amp;arr);</a>
<a class="sourceLine" id="cb138-6" title="6"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb138-7" title="7"></a>
<a class="sourceLine" id="cb138-8" title="8"><span class="co">// const value = arr[123]</span></a>
<a class="sourceLine" id="cb138-9" title="9">status = napi_get_element(env, arr, <span class="dv">123</span>, &amp;value);</a>
<a class="sourceLine" id="cb138-10" title="10"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a></code></pre>
    </div>
    <p>
      Finally, multiple properties can also be defined on an object for
      performance reasons. Consider the following JavaScript:
    </p>
    <div class="sourceCode" id="cb139">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb139-1" title="1"><span class="kw">const</span> obj <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb139-2" title="2"><span class="va">Object</span>.<span class="at">defineProperties</span>(obj<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb139-3" title="3">  <span class="st">&#39;foo&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">123</span><span class="op">,</span> <span class="dt">writable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">configurable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">true</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb139-4" title="4">  <span class="st">&#39;bar&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">456</span><span class="op">,</span> <span class="dt">writable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">configurable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb139-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      The following is the approximate equivalent of the Node-API counterpart:
    </p>
    <div class="sourceCode" id="cb140">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb140-1" title="1">napi_status status = napi_status_generic_failure;</a>
<a class="sourceLine" id="cb140-2" title="2"></a>
<a class="sourceLine" id="cb140-3" title="3"><span class="co">// const obj = {};</span></a>
<a class="sourceLine" id="cb140-4" title="4">napi_value obj;</a>
<a class="sourceLine" id="cb140-5" title="5">status = napi_create_object(env, &amp;obj);</a>
<a class="sourceLine" id="cb140-6" title="6"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb140-7" title="7"></a>
<a class="sourceLine" id="cb140-8" title="8"><span class="co">// Create napi_values for 123 and 456</span></a>
<a class="sourceLine" id="cb140-9" title="9">napi_value fooValue, barValue;</a>
<a class="sourceLine" id="cb140-10" title="10">status = napi_create_int32(env, <span class="dv">123</span>, &amp;fooValue);</a>
<a class="sourceLine" id="cb140-11" title="11"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb140-12" title="12">status = napi_create_int32(env, <span class="dv">456</span>, &amp;barValue);</a>
<a class="sourceLine" id="cb140-13" title="13"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a>
<a class="sourceLine" id="cb140-14" title="14"></a>
<a class="sourceLine" id="cb140-15" title="15"><span class="co">// Set the properties</span></a>
<a class="sourceLine" id="cb140-16" title="16">napi_property_descriptor descriptors[] = {</a>
<a class="sourceLine" id="cb140-17" title="17">  { <span class="st">&quot;foo&quot;</span>, NULL, NULL, NULL, NULL, fooValue, napi_writable | napi_configurable, NULL },</a>
<a class="sourceLine" id="cb140-18" title="18">  { <span class="st">&quot;bar&quot;</span>, NULL, NULL, NULL, NULL, barValue, napi_writable | napi_configurable, NULL }</a>
<a class="sourceLine" id="cb140-19" title="19">}</a>
<a class="sourceLine" id="cb140-20" title="20">status = napi_define_properties(env,</a>
<a class="sourceLine" id="cb140-21" title="21">                                obj,</a>
<a class="sourceLine" id="cb140-22" title="22">                                <span class="kw">sizeof</span>(descriptors) / <span class="kw">sizeof</span>(descriptors[<span class="dv">0</span>]),</a>
<a class="sourceLine" id="cb140-23" title="23">                                descriptors);</a>
<a class="sourceLine" id="cb140-24" title="24"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> status;</a></code></pre>
    </div>
    <h3 id="structures">Structures</h3>
    <h4 id="napi_property_attributes">napi_property_attributes</h4>
    <!-- YAML
changes:
 - version: v14.12.0
   pr-url: https://github.com/nodejs/node/pull/35214
   description: added `napi_default_method` and `napi_default_property`.
-->
    <div class="sourceCode" id="cb141">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb141-1" title="1"><span class="kw">typedef</span> <span class="kw">enum</span> {</a>
<a class="sourceLine" id="cb141-2" title="2">  napi_default = <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb141-3" title="3">  napi_writable = <span class="dv">1</span> &lt;&lt; <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb141-4" title="4">  napi_enumerable = <span class="dv">1</span> &lt;&lt; <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb141-5" title="5">  napi_configurable = <span class="dv">1</span> &lt;&lt; <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb141-6" title="6"></a>
<a class="sourceLine" id="cb141-7" title="7">  <span class="co">// Used with napi_define_class to distinguish static properties</span></a>
<a class="sourceLine" id="cb141-8" title="8">  <span class="co">// from instance properties. Ignored by napi_define_properties.</span></a>
<a class="sourceLine" id="cb141-9" title="9">  napi_static = <span class="dv">1</span> &lt;&lt; <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb141-10" title="10"></a>
<a class="sourceLine" id="cb141-11" title="11">  <span class="co">// Default for class methods.</span></a>
<a class="sourceLine" id="cb141-12" title="12">  napi_default_method = napi_writable | napi_configurable,</a>
<a class="sourceLine" id="cb141-13" title="13"></a>
<a class="sourceLine" id="cb141-14" title="14">  <span class="co">// Default for object properties, like in JS obj[prop].</span></a>
<a class="sourceLine" id="cb141-15" title="15">  napi_default_jsproperty = napi_writable |</a>
<a class="sourceLine" id="cb141-16" title="16">                          napi_enumerable |</a>
<a class="sourceLine" id="cb141-17" title="17">                          napi_configurable,</a>
<a class="sourceLine" id="cb141-18" title="18">} napi_property_attributes;</a></code></pre>
    </div>
    <p>
      <code>napi_property_attributes</code> are flags used to control the
      behavior of properties set on a JavaScript object. Other than
      <code>napi_static</code> they correspond to the attributes listed in
      <a href="https://tc39.github.io/ecma262/#table-2">Section 6.1.7.1</a> of
      the
      <a href="https://tc39.github.io/ecma262/"
        >ECMAScript Language Specification</a
      >. They can be one or more of the following bitflags:
    </p>
    <ul>
      <li>
        <code>napi_default</code>: No explicit attributes are set on the
        property. By default, a property is read only, not enumerable and not
        configurable.
      </li>
      <li><code>napi_writable</code>: The property is writable.</li>
      <li><code>napi_enumerable</code>: The property is enumerable.</li>
      <li>
        <code>napi_configurable</code>: The property is configurable as defined
        in
        <a href="https://tc39.github.io/ecma262/#table-2">Section 6.1.7.1</a> of
        the
        <a href="https://tc39.github.io/ecma262/"
          >ECMAScript Language Specification</a
        >.
      </li>
      <li>
        <code>napi_static</code>: The property will be defined as a static
        property on a class as opposed to an instance property, which is the
        default. This is used only by
        <a href="#n_api_napi_define_class"><code>napi_define_class</code></a
        >. It is ignored by <code>napi_define_properties</code>.
      </li>
      <li>
        <code>napi_default_method</code>: Like a method in a JS class, the
        property is configurable and writeable, but not enumerable.
      </li>
      <li>
        <code>napi_default_jsproperty</code>: Like a property set via assignment
        in JavaScript, the property is writable, enumerable, and configurable.
      </li>
    </ul>
    <h4 id="napi_property_descriptor">napi_property_descriptor</h4>
    <div class="sourceCode" id="cb142">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb142-1" title="1"><span class="kw">typedef</span> <span class="kw">struct</span> {</a>
<a class="sourceLine" id="cb142-2" title="2">  <span class="co">// One of utf8name or name should be NULL.</span></a>
<a class="sourceLine" id="cb142-3" title="3">  <span class="dt">const</span> <span class="dt">char</span>* utf8name;</a>
<a class="sourceLine" id="cb142-4" title="4">  napi_value name;</a>
<a class="sourceLine" id="cb142-5" title="5"></a>
<a class="sourceLine" id="cb142-6" title="6">  napi_callback method;</a>
<a class="sourceLine" id="cb142-7" title="7">  napi_callback getter;</a>
<a class="sourceLine" id="cb142-8" title="8">  napi_callback setter;</a>
<a class="sourceLine" id="cb142-9" title="9">  napi_value value;</a>
<a class="sourceLine" id="cb142-10" title="10"></a>
<a class="sourceLine" id="cb142-11" title="11">  napi_property_attributes attributes;</a>
<a class="sourceLine" id="cb142-12" title="12">  <span class="dt">void</span>* data;</a>
<a class="sourceLine" id="cb142-13" title="13">} napi_property_descriptor;</a></code></pre>
    </div>
    <ul>
      <li>
        <code>utf8name</code>: Optional string describing the key for the
        property, encoded as UTF8. One of <code>utf8name</code> or
        <code>name</code> must be provided for the property.
      </li>
      <li>
        <code>name</code>: Optional <code>napi_value</code> that points to a
        JavaScript string or symbol to be used as the key for the property. One
        of <code>utf8name</code> or <code>name</code> must be provided for the
        property.
      </li>
      <li>
        <code>value</code>: The value that’s retrieved by a get access of the
        property if the property is a data property. If this is passed in, set
        <code>getter</code>, <code>setter</code>, <code>method</code> and
        <code>data</code> to <code>NULL</code> (since these members won’t be
        used).
      </li>
      <li>
        <code>getter</code>: A function to call when a get access of the
        property is performed. If this is passed in, set <code>value</code> and
        <code>method</code> to <code>NULL</code> (since these members won’t be
        used). The given function is called implicitly by the runtime when the
        property is accessed from JavaScript code (or if a get on the property
        is performed using a Node-API call).
        <a href="#n_api_napi_callback"><code>napi_callback</code></a> provides
        more details.
      </li>
      <li>
        <code>setter</code>: A function to call when a set access of the
        property is performed. If this is passed in, set <code>value</code> and
        <code>method</code> to <code>NULL</code> (since these members won’t be
        used). The given function is called implicitly by the runtime when the
        property is set from JavaScript code (or if a set on the property is
        performed using a Node-API call).
        <a href="#n_api_napi_callback"><code>napi_callback</code></a> provides
        more details.
      </li>
      <li>
        <code>method</code>: Set this to make the property descriptor object’s
        <code>value</code> property to be a JavaScript function represented by
        <code>method</code>. If this is passed in, set <code>value</code>,
        <code>getter</code> and <code>setter</code> to <code>NULL</code> (since
        these members won’t be used).
        <a href="#n_api_napi_callback"><code>napi_callback</code></a> provides
        more details.
      </li>
      <li>
        <code>attributes</code>: The attributes associated with the particular
        property. See
        <a href="#n_api_napi_property_attributes"
          ><code>napi_property_attributes</code></a
        >.
      </li>
      <li>
        <code>data</code>: The callback data passed into <code>method</code>,
        <code>getter</code> and <code>setter</code> if this function is invoked.
      </li>
    </ul>
    <h3 id="functions">Functions</h3>
    <h4 id="napi_get_property_names">napi_get_property_names</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb143">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb143-1" title="1">napi_status napi_get_property_names(napi_env env,</a>
<a class="sourceLine" id="cb143-2" title="2">                                    napi_value object,</a>
<a class="sourceLine" id="cb143-3" title="3">                                    napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object from which to retrieve the
        properties.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing an
        array of JavaScript values that represent the property names of the
        object. The API can be used to iterate over <code>result</code> using
        <a href="#n_api_napi_get_array_length"
          ><code>napi_get_array_length</code></a
        >
        and <a href="#n_api_napi_get_element"><code>napi_get_element</code></a
        >.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns the names of the enumerable properties of
      <code>object</code> as an array of strings. The properties of
      <code>object</code> whose key is a symbol will not be included.
    </p>
    <h4 id="napi_get_all_property_names">napi_get_all_property_names</h4>
    <!-- YAML
added:
 - v13.7.0
 - v12.17.0
 - v10.20.0
napiVersion: 6
-->
    <div class="sourceCode" id="cb144">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb144-1" title="1">napi_get_all_property_names(napi_env env,</a>
<a class="sourceLine" id="cb144-2" title="2">                            napi_value object,</a>
<a class="sourceLine" id="cb144-3" title="3">                            napi_key_collection_mode key_mode,</a>
<a class="sourceLine" id="cb144-4" title="4">                            napi_key_filter key_filter,</a>
<a class="sourceLine" id="cb144-5" title="5">                            napi_key_conversion key_conversion,</a>
<a class="sourceLine" id="cb144-6" title="6">                            napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object from which to retrieve the
        properties.
      </li>
      <li>
        <code>[in] key_mode</code>: Whether to retrieve prototype properties as
        well.
      </li>
      <li>
        <code>[in] key_filter</code>: Which properties to retrieve
        (enumerable/readable/writable).
      </li>
      <li>
        <code>[in] key_conversion</code>: Whether to convert numbered property
        keys to strings.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing an
        array of JavaScript values that represent the property names of the
        object.
        <a href="#n_api_napi_get_array_length"
          ><code>napi_get_array_length</code></a
        >
        and
        <a href="#n_api_napi_get_element"><code>napi_get_element</code></a> can
        be used to iterate over <code>result</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns an array containing the names of the available properties
      of this object.
    </p>
    <h4 id="napi_set_property">napi_set_property</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb145">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb145-1" title="1">napi_status napi_set_property(napi_env env,</a>
<a class="sourceLine" id="cb145-2" title="2">                              napi_value object,</a>
<a class="sourceLine" id="cb145-3" title="3">                              napi_value key,</a>
<a class="sourceLine" id="cb145-4" title="4">                              napi_value value);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object on which to set the property.
      </li>
      <li><code>[in] key</code>: The name of the property to set.</li>
      <li><code>[in] value</code>: The property value.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API set a property on the <code>Object</code> passed in.</p>
    <h4 id="napi_get_property">napi_get_property</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb146">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb146-1" title="1">napi_status napi_get_property(napi_env env,</a>
<a class="sourceLine" id="cb146-2" title="2">                              napi_value object,</a>
<a class="sourceLine" id="cb146-3" title="3">                              napi_value key,</a>
<a class="sourceLine" id="cb146-4" title="4">                              napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object from which to retrieve the
        property.
      </li>
      <li><code>[in] key</code>: The name of the property to retrieve.</li>
      <li><code>[out] result</code>: The value of the property.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API gets the requested property from the <code>Object</code> passed
      in.
    </p>
    <h4 id="napi_has_property">napi_has_property</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb147">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb147-1" title="1">napi_status napi_has_property(napi_env env,</a>
<a class="sourceLine" id="cb147-2" title="2">                              napi_value object,</a>
<a class="sourceLine" id="cb147-3" title="3">                              napi_value key,</a>
<a class="sourceLine" id="cb147-4" title="4">                              <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to query.</li>
      <li>
        <code>[in] key</code>: The name of the property whose existence to
        check.
      </li>
      <li>
        <code>[out] result</code>: Whether the property exists on the object or
        not.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API checks if the <code>Object</code> passed in has the named
      property.
    </p>
    <h4 id="napi_delete_property">napi_delete_property</h4>
    <!-- YAML
added: v8.2.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb148">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb148-1" title="1">napi_status napi_delete_property(napi_env env,</a>
<a class="sourceLine" id="cb148-2" title="2">                                 napi_value object,</a>
<a class="sourceLine" id="cb148-3" title="3">                                 napi_value key,</a>
<a class="sourceLine" id="cb148-4" title="4">                                 <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to query.</li>
      <li><code>[in] key</code>: The name of the property to delete.</li>
      <li>
        <code>[out] result</code>: Whether the property deletion succeeded or
        not. <code>result</code> can optionally be ignored by passing
        <code>NULL</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API attempts to delete the <code>key</code> own property from
      <code>object</code>.
    </p>
    <h4 id="napi_has_own_property">napi_has_own_property</h4>
    <!-- YAML
added: v8.2.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb149">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb149-1" title="1">napi_status napi_has_own_property(napi_env env,</a>
<a class="sourceLine" id="cb149-2" title="2">                                  napi_value object,</a>
<a class="sourceLine" id="cb149-3" title="3">                                  napi_value key,</a>
<a class="sourceLine" id="cb149-4" title="4">                                  <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to query.</li>
      <li>
        <code>[in] key</code>: The name of the own property whose existence to
        check.
      </li>
      <li>
        <code>[out] result</code>: Whether the own property exists on the object
        or not.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API checks if the <code>Object</code> passed in has the named own
      property. <code>key</code> must be a <code>string</code> or a
      <code>symbol</code>, or an error will be thrown. Node-API will not perform
      any conversion between data types.
    </p>
    <h4 id="napi_set_named_property">napi_set_named_property</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb150">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb150-1" title="1">napi_status napi_set_named_property(napi_env env,</a>
<a class="sourceLine" id="cb150-2" title="2">                                    napi_value object,</a>
<a class="sourceLine" id="cb150-3" title="3">                                    <span class="dt">const</span> <span class="dt">char</span>* utf8Name,</a>
<a class="sourceLine" id="cb150-4" title="4">                                    napi_value value);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object on which to set the property.
      </li>
      <li><code>[in] utf8Name</code>: The name of the property to set.</li>
      <li><code>[in] value</code>: The property value.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method is equivalent to calling
      <a href="#n_api_napi_set_property"><code>napi_set_property</code></a> with
      a <code>napi_value</code> created from the string passed in as
      <code>utf8Name</code>.
    </p>
    <h4 id="napi_get_named_property">napi_get_named_property</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb151">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb151-1" title="1">napi_status napi_get_named_property(napi_env env,</a>
<a class="sourceLine" id="cb151-2" title="2">                                    napi_value object,</a>
<a class="sourceLine" id="cb151-3" title="3">                                    <span class="dt">const</span> <span class="dt">char</span>* utf8Name,</a>
<a class="sourceLine" id="cb151-4" title="4">                                    napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object from which to retrieve the
        property.
      </li>
      <li><code>[in] utf8Name</code>: The name of the property to get.</li>
      <li><code>[out] result</code>: The value of the property.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method is equivalent to calling
      <a href="#n_api_napi_get_property"><code>napi_get_property</code></a> with
      a <code>napi_value</code> created from the string passed in as
      <code>utf8Name</code>.
    </p>
    <h4 id="napi_has_named_property">napi_has_named_property</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb152">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb152-1" title="1">napi_status napi_has_named_property(napi_env env,</a>
<a class="sourceLine" id="cb152-2" title="2">                                    napi_value object,</a>
<a class="sourceLine" id="cb152-3" title="3">                                    <span class="dt">const</span> <span class="dt">char</span>* utf8Name,</a>
<a class="sourceLine" id="cb152-4" title="4">                                    <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to query.</li>
      <li>
        <code>[in] utf8Name</code>: The name of the property whose existence to
        check.
      </li>
      <li>
        <code>[out] result</code>: Whether the property exists on the object or
        not.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method is equivalent to calling
      <a href="#n_api_napi_has_property"><code>napi_has_property</code></a> with
      a <code>napi_value</code> created from the string passed in as
      <code>utf8Name</code>.
    </p>
    <h4 id="napi_set_element">napi_set_element</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb153">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb153-1" title="1">napi_status napi_set_element(napi_env env,</a>
<a class="sourceLine" id="cb153-2" title="2">                             napi_value object,</a>
<a class="sourceLine" id="cb153-3" title="3">                             <span class="dt">uint32_t</span> index,</a>
<a class="sourceLine" id="cb153-4" title="4">                             napi_value value);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object from which to set the properties.
      </li>
      <li><code>[in] index</code>: The index of the property to set.</li>
      <li><code>[in] value</code>: The property value.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API sets and element on the <code>Object</code> passed in.</p>
    <h4 id="napi_get_element">napi_get_element</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb154">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb154-1" title="1">napi_status napi_get_element(napi_env env,</a>
<a class="sourceLine" id="cb154-2" title="2">                             napi_value object,</a>
<a class="sourceLine" id="cb154-3" title="3">                             <span class="dt">uint32_t</span> index,</a>
<a class="sourceLine" id="cb154-4" title="4">                             napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object from which to retrieve the
        property.
      </li>
      <li><code>[in] index</code>: The index of the property to get.</li>
      <li><code>[out] result</code>: The value of the property.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API gets the element at the requested index.</p>
    <h4 id="napi_has_element">napi_has_element</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb155">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb155-1" title="1">napi_status napi_has_element(napi_env env,</a>
<a class="sourceLine" id="cb155-2" title="2">                             napi_value object,</a>
<a class="sourceLine" id="cb155-3" title="3">                             <span class="dt">uint32_t</span> index,</a>
<a class="sourceLine" id="cb155-4" title="4">                             <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to query.</li>
      <li>
        <code>[in] index</code>: The index of the property whose existence to
        check.
      </li>
      <li>
        <code>[out] result</code>: Whether the property exists on the object or
        not.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns if the <code>Object</code> passed in has an element at
      the requested index.
    </p>
    <h4 id="napi_delete_element">napi_delete_element</h4>
    <!-- YAML
added: v8.2.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb156">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb156-1" title="1">napi_status napi_delete_element(napi_env env,</a>
<a class="sourceLine" id="cb156-2" title="2">                                napi_value object,</a>
<a class="sourceLine" id="cb156-3" title="3">                                <span class="dt">uint32_t</span> index,</a>
<a class="sourceLine" id="cb156-4" title="4">                                <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to query.</li>
      <li><code>[in] index</code>: The index of the property to delete.</li>
      <li>
        <code>[out] result</code>: Whether the element deletion succeeded or
        not. <code>result</code> can optionally be ignored by passing
        <code>NULL</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API attempts to delete the specified <code>index</code> from
      <code>object</code>.
    </p>
    <h4 id="napi_define_properties">napi_define_properties</h4>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb157">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb157-1" title="1">napi_status napi_define_properties(napi_env env,</a>
<a class="sourceLine" id="cb157-2" title="2">                                   napi_value object,</a>
<a class="sourceLine" id="cb157-3" title="3">                                   <span class="dt">size_t</span> property_count,</a>
<a class="sourceLine" id="cb157-4" title="4">                                   <span class="dt">const</span> napi_property_descriptor* properties);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li>
        <code>[in] object</code>: The object from which to retrieve the
        properties.
      </li>
      <li>
        <code>[in] property_count</code>: The number of elements in the
        <code>properties</code> array.
      </li>
      <li><code>[in] properties</code>: The array of property descriptors.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method allows the efficient definition of multiple properties on a
      given object. The properties are defined using property descriptors (see
      <a href="#n_api_napi_property_descriptor"
        ><code>napi_property_descriptor</code></a
      >). Given an array of such property descriptors, this API will set the
      properties on the object one at a time, as defined by
      <code>DefineOwnProperty()</code> (described in
      <a
        href="https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots-defineownproperty-p-desc"
        >Section 9.1.6</a
      >
      of the ECMA-262 specification).
    </p>
    <h4 id="napi_object_freeze">napi_object_freeze</h4>
    <!-- YAML
added:
  - v14.14.0
  - v12.20.0
napiVersion: 8
-->
    <div class="sourceCode" id="cb158">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb158-1" title="1">napi_status napi_object_freeze(napi_env env,</a>
<a class="sourceLine" id="cb158-2" title="2">                               napi_value object);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to freeze.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method freezes a given object. This prevents new properties from
      being added to it, existing properties from being removed, prevents
      changing the enumerability, configurability, or writability of existing
      properties, and prevents the values of existing properties from being
      changed. It also prevents the object’s prototype from being changed. This
      is described in
      <a href="https://tc39.es/ecma262/#sec-object.freeze">Section 19.1.2.6</a>
      of the ECMA-262 specification.
    </p>
    <h4 id="napi_object_seal">napi_object_seal</h4>
    <!-- YAML
added:
  - v14.14.0
  - v12.20.0
napiVersion: 8
-->
    <div class="sourceCode" id="cb159">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb159-1" title="1">napi_status napi_object_seal(napi_env env,</a>
<a class="sourceLine" id="cb159-2" title="2">                             napi_value object);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the Node-API call is invoked
        under.
      </li>
      <li><code>[in] object</code>: The object to seal.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method seals a given object. This prevents new properties from being
      added to it, as well as marking all existing properties as
      non-configurable. This is described in
      <a href="https://tc39.es/ecma262/#sec-object.seal">Section 19.1.2.20</a>
      of the ECMA-262 specification.
    </p>
    <h2 id="working-with-javascript-functions">
      Working with JavaScript functions
    </h2>
    <p>
      Node-API provides a set of APIs that allow JavaScript code to call back
      into native code. Node-APIs that support calling back into native code
      take in a callback functions represented by the
      <code>napi_callback</code> type. When the JavaScript VM calls back to
      native code, the <code>napi_callback</code> function provided is invoked.
      The APIs documented in this section allow the callback function to do the
      following:
    </p>
    <ul>
      <li>
        Get information about the context in which the callback was invoked.
      </li>
      <li>Get the arguments passed into the callback.</li>
      <li>Return a <code>napi_value</code> back from the callback.</li>
    </ul>
    <p>
      Additionally, Node-API provides a set of functions which allow calling
      JavaScript functions from native code. One can either call a function like
      a regular JavaScript function call, or as a constructor function.
    </p>
    <p>
      Any non-<code>NULL</code> data which is passed to this API via the
      <code>data</code> field of the <code>napi_property_descriptor</code> items
      can be associated with <code>object</code> and freed whenever
      <code>object</code> is garbage-collected by passing both
      <code>object</code> and the data to
      <a href="#n_api_napi_add_finalizer"><code>napi_add_finalizer</code></a
      >.
    </p>
    <h3 id="napi_call_function">napi_call_function</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb160">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb160-1" title="1">NAPI_EXTERN napi_status napi_call_function(napi_env env,</a>
<a class="sourceLine" id="cb160-2" title="2">                                           napi_value recv,</a>
<a class="sourceLine" id="cb160-3" title="3">                                           napi_value func,</a>
<a class="sourceLine" id="cb160-4" title="4">                                           <span class="dt">size_t</span> argc,</a>
<a class="sourceLine" id="cb160-5" title="5">                                           <span class="dt">const</span> napi_value* argv,</a>
<a class="sourceLine" id="cb160-6" title="6">                                           napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] recv</code>: The <code>this</code> value passed to the called
        function.
      </li>
      <li>
        <code>[in] func</code>: <code>napi_value</code> representing the
        JavaScript function to be invoked.
      </li>
      <li>
        <code>[in] argc</code>: The count of elements in the
        <code>argv</code> array.
      </li>
      <li>
        <code>[in] argv</code>: Array of <code>napi_values</code> representing
        JavaScript values passed in as arguments to the function.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        JavaScript object returned.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method allows a JavaScript function object to be called from a native
      add-on. This is the primary mechanism of calling back <em>from</em> the
      add-on’s native code <em>into</em> JavaScript. For the special case of
      calling into JavaScript after an async operation, see
      <a href="#n_api_napi_make_callback"><code>napi_make_callback</code></a
      >.
    </p>
    <p>
      A sample use case might look as follows. Consider the following JavaScript
      snippet:
    </p>
    <div class="sourceCode" id="cb161">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb161-1" title="1"><span class="kw">function</span> <span class="at">AddTwo</span>(num) <span class="op">{</span></a>
<a class="sourceLine" id="cb161-2" title="2">  <span class="cf">return</span> num <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb161-3" title="3"><span class="op">}</span></a></code></pre>
    </div>
    <p>
      Then, the above function can be invoked from a native add-on using the
      following code:
    </p>
    <div class="sourceCode" id="cb162">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb162-1" title="1"><span class="co">// Get the function named &quot;AddTwo&quot; on the global object</span></a>
<a class="sourceLine" id="cb162-2" title="2">napi_value global, add_two, arg;</a>
<a class="sourceLine" id="cb162-3" title="3">napi_status status = napi_get_global(env, &amp;global);</a>
<a class="sourceLine" id="cb162-4" title="4"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb162-5" title="5"></a>
<a class="sourceLine" id="cb162-6" title="6">status = napi_get_named_property(env, global, <span class="st">&quot;AddTwo&quot;</span>, &amp;add_two);</a>
<a class="sourceLine" id="cb162-7" title="7"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb162-8" title="8"></a>
<a class="sourceLine" id="cb162-9" title="9"><span class="co">// const arg = 1337</span></a>
<a class="sourceLine" id="cb162-10" title="10">status = napi_create_int32(env, <span class="dv">1337</span>, &amp;arg);</a>
<a class="sourceLine" id="cb162-11" title="11"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb162-12" title="12"></a>
<a class="sourceLine" id="cb162-13" title="13">napi_value* argv = &amp;arg;</a>
<a class="sourceLine" id="cb162-14" title="14"><span class="dt">size_t</span> argc = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb162-15" title="15"></a>
<a class="sourceLine" id="cb162-16" title="16"><span class="co">// AddTwo(arg);</span></a>
<a class="sourceLine" id="cb162-17" title="17">napi_value return_val;</a>
<a class="sourceLine" id="cb162-18" title="18">status = napi_call_function(env, global, add_two, argc, argv, &amp;return_val);</a>
<a class="sourceLine" id="cb162-19" title="19"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb162-20" title="20"></a>
<a class="sourceLine" id="cb162-21" title="21"><span class="co">// Convert the result back to a native type</span></a>
<a class="sourceLine" id="cb162-22" title="22"><span class="dt">int32_t</span> result;</a>
<a class="sourceLine" id="cb162-23" title="23">status = napi_get_value_int32(env, return_val, &amp;result);</a>
<a class="sourceLine" id="cb162-24" title="24"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a></code></pre>
    </div>
    <h3 id="napi_create_function">napi_create_function</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb163">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb163-1" title="1">napi_status napi_create_function(napi_env env,</a>
<a class="sourceLine" id="cb163-2" title="2">                                 <span class="dt">const</span> <span class="dt">char</span>* utf8name,</a>
<a class="sourceLine" id="cb163-3" title="3">                                 <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb163-4" title="4">                                 napi_callback cb,</a>
<a class="sourceLine" id="cb163-5" title="5">                                 <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb163-6" title="6">                                 napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] utf8Name</code>: The name of the function encoded as UTF8.
        This is visible within JavaScript as the new function object’s
        <code>name</code> property.
      </li>
      <li>
        <code>[in] length</code>: The length of the <code>utf8name</code> in
        bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.
      </li>
      <li>
        <code>[in] cb</code>: The native function which should be called when
        this function object is invoked.
        <a href="#n_api_napi_callback"><code>napi_callback</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] data</code>: User-provided data context. This will be passed
        back into the function when invoked later.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        JavaScript function object for the newly created function.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API allows an add-on author to create a function object in native
      code. This is the primary mechanism to allow calling <em>into</em> the
      add-on’s native code <em>from</em> JavaScript.
    </p>
    <p>
      The newly created function is not automatically visible from script after
      this call. Instead, a property must be explicitly set on any object that
      is visible to JavaScript, in order for the function to be accessible from
      script.
    </p>
    <p>
      In order to expose a function as part of the add-on’s module exports, set
      the newly created function on the exports object. A sample module might
      look as follows:
    </p>
    <div class="sourceCode" id="cb164">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb164-1" title="1">napi_value SayHello(napi_env env, napi_callback_info info) {</a>
<a class="sourceLine" id="cb164-2" title="2">  printf(<span class="st">&quot;Hello</span><span class="sc">\n</span><span class="st">&quot;</span>);</a>
<a class="sourceLine" id="cb164-3" title="3">  <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb164-4" title="4">}</a>
<a class="sourceLine" id="cb164-5" title="5"></a>
<a class="sourceLine" id="cb164-6" title="6">napi_value Init(napi_env env, napi_value exports) {</a>
<a class="sourceLine" id="cb164-7" title="7">  napi_status status;</a>
<a class="sourceLine" id="cb164-8" title="8"></a>
<a class="sourceLine" id="cb164-9" title="9">  napi_value fn;</a>
<a class="sourceLine" id="cb164-10" title="10">  status = napi_create_function(env, NULL, <span class="dv">0</span>, SayHello, NULL, &amp;fn);</a>
<a class="sourceLine" id="cb164-11" title="11">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb164-12" title="12"></a>
<a class="sourceLine" id="cb164-13" title="13">  status = napi_set_named_property(env, exports, <span class="st">&quot;sayHello&quot;</span>, fn);</a>
<a class="sourceLine" id="cb164-14" title="14">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb164-15" title="15"></a>
<a class="sourceLine" id="cb164-16" title="16">  <span class="cf">return</span> exports;</a>
<a class="sourceLine" id="cb164-17" title="17">}</a>
<a class="sourceLine" id="cb164-18" title="18"></a>
<a class="sourceLine" id="cb164-19" title="19">NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)</a></code></pre>
    </div>
    <p>
      Given the above code, the add-on can be used from JavaScript as follows:
    </p>
    <div class="sourceCode" id="cb165">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb165-1" title="1"><span class="kw">const</span> myaddon <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./addon&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb165-2" title="2"><span class="va">myaddon</span>.<span class="at">sayHello</span>()<span class="op">;</span></a></code></pre>
    </div>
    <p>
      The string passed to <code>require()</code> is the name of the target in
      <code>binding.gyp</code> responsible for creating the
      <code>.node</code> file.
    </p>
    <p>
      Any non-<code>NULL</code> data which is passed to this API via the
      <code>data</code> parameter can be associated with the resulting
      JavaScript function (which is returned in the
      <code>result</code> parameter) and freed whenever the function is
      garbage-collected by passing both the JavaScript function and the data to
      <a href="#n_api_napi_add_finalizer"><code>napi_add_finalizer</code></a
      >.
    </p>
    <p>
      JavaScript <code>Function</code>s are described in
      <a href="https://tc39.github.io/ecma262/#sec-function-objects"
        >Section 19.2</a
      >
      of the ECMAScript Language Specification.
    </p>
    <h3 id="napi_get_cb_info">napi_get_cb_info</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb166">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb166-1" title="1">napi_status napi_get_cb_info(napi_env env,</a>
<a class="sourceLine" id="cb166-2" title="2">                             napi_callback_info cbinfo,</a>
<a class="sourceLine" id="cb166-3" title="3">                             <span class="dt">size_t</span>* argc,</a>
<a class="sourceLine" id="cb166-4" title="4">                             napi_value* argv,</a>
<a class="sourceLine" id="cb166-5" title="5">                             napi_value* thisArg,</a>
<a class="sourceLine" id="cb166-6" title="6">                             <span class="dt">void</span>** data)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] cbinfo</code>: The callback info passed into the callback
        function.
      </li>
      <li>
        <code>[in-out] argc</code>: Specifies the length of the provided
        <code>argv</code> array and receives the actual count of arguments.
      </li>
      <li>
        <code>[out] argv</code>: Buffer to which the
        <code>napi_value</code> representing the arguments are copied. If there
        are more arguments than the provided count, only the requested number of
        arguments are copied. If there are fewer arguments provided than
        claimed, the rest of <code>argv</code> is filled with
        <code>napi_value</code> values that represent <code>undefined</code>.
      </li>
      <li>
        <code>[out] this</code>: Receives the JavaScript
        <code>this</code> argument for the call.
      </li>
      <li>
        <code>[out] data</code>: Receives the data pointer for the callback.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method is used within a callback function to retrieve details about
      the call like the arguments and the <code>this</code> pointer from a given
      callback info.
    </p>
    <h3 id="napi_get_new_target">napi_get_new_target</h3>
    <!-- YAML
added: v8.6.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb167">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb167-1" title="1">napi_status napi_get_new_target(napi_env env,</a>
<a class="sourceLine" id="cb167-2" title="2">                                napi_callback_info cbinfo,</a>
<a class="sourceLine" id="cb167-3" title="3">                                napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] cbinfo</code>: The callback info passed into the callback
        function.
      </li>
      <li>
        <code>[out] result</code>: The <code>new.target</code> of the
        constructor call.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns the <code>new.target</code> of the constructor call. If
      the current callback is not a constructor call, the result is
      <code>NULL</code>.
    </p>
    <h3 id="napi_new_instance">napi_new_instance</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb168">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb168-1" title="1">napi_status napi_new_instance(napi_env env,</a>
<a class="sourceLine" id="cb168-2" title="2">                              napi_value cons,</a>
<a class="sourceLine" id="cb168-3" title="3">                              <span class="dt">size_t</span> argc,</a>
<a class="sourceLine" id="cb168-4" title="4">                              napi_value* argv,</a>
<a class="sourceLine" id="cb168-5" title="5">                              napi_value* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] cons</code>: <code>napi_value</code> representing the
        JavaScript function to be invoked as a constructor.
      </li>
      <li>
        <code>[in] argc</code>: The count of elements in the
        <code>argv</code> array.
      </li>
      <li>
        <code>[in] argv</code>: Array of JavaScript values as
        <code>napi_value</code> representing the arguments to the constructor.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        JavaScript object returned, which in this case is the constructed
        object.
      </li>
    </ul>
    <p>
      This method is used to instantiate a new JavaScript value using a given
      <code>napi_value</code> that represents the constructor for the object.
      For example, consider the following snippet:
    </p>
    <div class="sourceCode" id="cb169">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb169-1" title="1"><span class="kw">function</span> <span class="at">MyObject</span>(param) <span class="op">{</span></a>
<a class="sourceLine" id="cb169-2" title="2">  <span class="kw">this</span>.<span class="at">param</span> <span class="op">=</span> param<span class="op">;</span></a>
<a class="sourceLine" id="cb169-3" title="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb169-4" title="4"></a>
<a class="sourceLine" id="cb169-5" title="5"><span class="kw">const</span> arg <span class="op">=</span> <span class="st">&#39;hello&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-6" title="6"><span class="kw">const</span> value <span class="op">=</span> <span class="kw">new</span> <span class="at">MyObject</span>(arg)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      The following can be approximated in Node-API using the following snippet:
    </p>
    <div class="sourceCode" id="cb170">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb170-1" title="1"><span class="co">// Get the constructor function MyObject</span></a>
<a class="sourceLine" id="cb170-2" title="2">napi_value global, constructor, arg, value;</a>
<a class="sourceLine" id="cb170-3" title="3">napi_status status = napi_get_global(env, &amp;global);</a>
<a class="sourceLine" id="cb170-4" title="4"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb170-5" title="5"></a>
<a class="sourceLine" id="cb170-6" title="6">status = napi_get_named_property(env, global, <span class="st">&quot;MyObject&quot;</span>, &amp;constructor);</a>
<a class="sourceLine" id="cb170-7" title="7"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb170-8" title="8"></a>
<a class="sourceLine" id="cb170-9" title="9"><span class="co">// const arg = &quot;hello&quot;</span></a>
<a class="sourceLine" id="cb170-10" title="10">status = napi_create_string_utf8(env, <span class="st">&quot;hello&quot;</span>, NAPI_AUTO_LENGTH, &amp;arg);</a>
<a class="sourceLine" id="cb170-11" title="11"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb170-12" title="12"></a>
<a class="sourceLine" id="cb170-13" title="13">napi_value* argv = &amp;arg;</a>
<a class="sourceLine" id="cb170-14" title="14"><span class="dt">size_t</span> argc = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb170-15" title="15"></a>
<a class="sourceLine" id="cb170-16" title="16"><span class="co">// const value = new MyObject(arg)</span></a>
<a class="sourceLine" id="cb170-17" title="17">status = napi_new_instance(env, constructor, argc, argv, &amp;value);</a></code></pre>
    </div>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <h2 id="object-wrap">Object wrap</h2>
    <p>
      Node-API offers a way to “wrap” C++ classes and instances so that the
      class constructor and methods can be called from JavaScript.
    </p>
    <ol type="1">
      <li>
        The
        <a href="#n_api_napi_define_class"><code>napi_define_class</code></a>
        API defines a JavaScript class with constructor, static properties and
        methods, and instance properties and methods that correspond to the C++
        class.
      </li>
      <li>
        When JavaScript code invokes the constructor, the constructor callback
        uses <a href="#n_api_napi_wrap"><code>napi_wrap</code></a> to wrap a new
        C++ instance in a JavaScript object, then returns the wrapper object.
      </li>
      <li>
        When JavaScript code invokes a method or property accessor on the class,
        the corresponding <code>napi_callback</code> C++ function is invoked.
        For an instance callback,
        <a href="#n_api_napi_unwrap"><code>napi_unwrap</code></a> obtains the
        C++ instance that is the target of the call.
      </li>
    </ol>
    <p>
      For wrapped objects it may be difficult to distinguish between a function
      called on a class prototype and a function called on an instance of a
      class. A common pattern used to address this problem is to save a
      persistent reference to the class constructor for later
      <code>instanceof</code> checks.
    </p>
    <div class="sourceCode" id="cb171">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb171-1" title="1">napi_value MyClass_constructor = NULL;</a>
<a class="sourceLine" id="cb171-2" title="2">status = napi_get_reference_value(env, MyClass::es_constructor, &amp;MyClass_constructor);</a>
<a class="sourceLine" id="cb171-3" title="3">assert(napi_ok == status);</a>
<a class="sourceLine" id="cb171-4" title="4"><span class="dt">bool</span> is_instance = false;</a>
<a class="sourceLine" id="cb171-5" title="5">status = napi_instanceof(env, es_this, MyClass_constructor, &amp;is_instance);</a>
<a class="sourceLine" id="cb171-6" title="6">assert(napi_ok == status);</a>
<a class="sourceLine" id="cb171-7" title="7"><span class="cf">if</span> (is_instance) {</a>
<a class="sourceLine" id="cb171-8" title="8">  <span class="co">// napi_unwrap() ...</span></a>
<a class="sourceLine" id="cb171-9" title="9">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb171-10" title="10">  <span class="co">// otherwise...</span></a>
<a class="sourceLine" id="cb171-11" title="11">}</a></code></pre>
    </div>
    <p>The reference must be freed once it is no longer needed.</p>
    <p>
      There are occasions where <code>napi_instanceof()</code> is insufficient
      for ensuring that a JavaScript object is a wrapper for a certain native
      type. This is the case especially when wrapped JavaScript objects are
      passed back into the addon via static methods rather than as the
      <code>this</code> value of prototype methods. In such cases there is a
      chance that they may be unwrapped incorrectly.
    </p>
    <div class="sourceCode" id="cb172">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb172-1" title="1"><span class="kw">const</span> myAddon <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./build/Release/my_addon.node&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb172-2" title="2"></a>
<a class="sourceLine" id="cb172-3" title="3"><span class="co">// `openDatabase()` returns a JavaScript object that wraps a native database</span></a>
<a class="sourceLine" id="cb172-4" title="4"><span class="co">// handle.</span></a>
<a class="sourceLine" id="cb172-5" title="5"><span class="kw">const</span> dbHandle <span class="op">=</span> <span class="va">myAddon</span>.<span class="at">openDatabase</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb172-6" title="6"></a>
<a class="sourceLine" id="cb172-7" title="7"><span class="co">// `query()` returns a JavaScript object that wraps a native query handle.</span></a>
<a class="sourceLine" id="cb172-8" title="8"><span class="kw">const</span> queryHandle <span class="op">=</span> <span class="va">myAddon</span>.<span class="at">query</span>(dbHandle<span class="op">,</span> <span class="st">&#39;Gimme ALL the things!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb172-9" title="9"></a>
<a class="sourceLine" id="cb172-10" title="10"><span class="co">// There is an accidental error in the line below. The first parameter to</span></a>
<a class="sourceLine" id="cb172-11" title="11"><span class="co">// `myAddon.queryHasRecords()` should be the database handle (`dbHandle`), not</span></a>
<a class="sourceLine" id="cb172-12" title="12"><span class="co">// the query handle (`query`), so the correct condition for the while-loop</span></a>
<a class="sourceLine" id="cb172-13" title="13"><span class="co">// should be</span></a>
<a class="sourceLine" id="cb172-14" title="14"><span class="co">//</span></a>
<a class="sourceLine" id="cb172-15" title="15"><span class="co">// myAddon.queryHasRecords(dbHandle, queryHandle)</span></a>
<a class="sourceLine" id="cb172-16" title="16"><span class="co">//</span></a>
<a class="sourceLine" id="cb172-17" title="17"><span class="cf">while</span> (<span class="va">myAddon</span>.<span class="at">queryHasRecords</span>(queryHandle<span class="op">,</span> dbHandle)) <span class="op">{</span></a>
<a class="sourceLine" id="cb172-18" title="18">  <span class="co">// retrieve records</span></a>
<a class="sourceLine" id="cb172-19" title="19"><span class="op">}</span></a></code></pre>
    </div>
    <p>
      In the above example <code>myAddon.queryHasRecords()</code> is a method
      that accepts two arguments. The first is a database handle and the second
      is a query handle. Internally, it unwraps the first argument and casts the
      resulting pointer to a native database handle. It then unwraps the second
      argument and casts the resulting pointer to a query handle. If the
      arguments are passed in the wrong order, the casts will work, however,
      there is a good chance that the underlying database operation will fail,
      or will even cause an invalid memory access.
    </p>
    <p>
      To ensure that the pointer retrieved from the first argument is indeed a
      pointer to a database handle and, similarly, that the pointer retrieved
      from the second argument is indeed a pointer to a query handle, the
      implementation of <code>queryHasRecords()</code> has to perform a type
      validation. Retaining the JavaScript class constructor from which the
      database handle was instantiated and the constructor from which the query
      handle was instantiated in <code>napi_ref</code>s can help, because
      <code>napi_instanceof()</code> can then be used to ensure that the
      instances passed into <code>queryHashRecords()</code> are indeed of the
      correct type.
    </p>
    <p>
      Unfortunately, <code>napi_instanceof()</code> does not protect against
      prototype manipulation. For example, the prototype of the database handle
      instance can be set to the prototype of the constructor for query handle
      instances. In this case, the database handle instance can appear as a
      query handle instance, and it will pass the
      <code>napi_instanceof()</code> test for a query handle instance, while
      still containing a pointer to a database handle.
    </p>
    <p>To this end, Node-API provides type-tagging capabilities.</p>
    <p>
      A type tag is a 128-bit integer unique to the addon. Node-API provides the
      <code>napi_type_tag</code> structure for storing a type tag. When such a
      value is passed along with a JavaScript object stored in a
      <code>napi_value</code> to <code>napi_type_tag_object()</code>, the
      JavaScript object will be “marked” with the type tag. The “mark” is
      invisible on the JavaScript side. When a JavaScript object arrives into a
      native binding, <code>napi_check_object_type_tag()</code> can be used
      along with the original type tag to determine whether the JavaScript
      object was previously “marked” with the type tag. This creates a
      type-checking capability of a higher fidelity than
      <code>napi_instanceof()</code> can provide, because such type- tagging
      survives prototype manipulation and addon unloading/reloading.
    </p>
    <p>
      Continuing the above example, the following skeleton addon implementation
      illustrates the use of <code>napi_type_tag_object()</code> and
      <code>napi_check_object_type_tag()</code>.
    </p>
    <div class="sourceCode" id="cb173">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb173-1" title="1"><span class="co">// This value is the type tag for a database handle. The command</span></a>
<a class="sourceLine" id="cb173-2" title="2"><span class="co">//</span></a>
<a class="sourceLine" id="cb173-3" title="3"><span class="co">//   uuidgen | sed -r -e &#39;s/-//g&#39; -e &#39;s/(.{16})(.*)/0x\1, 0x\2/&#39;</span></a>
<a class="sourceLine" id="cb173-4" title="4"><span class="co">//</span></a>
<a class="sourceLine" id="cb173-5" title="5"><span class="co">// can be used to obtain the two values with which to initialize the structure.</span></a>
<a class="sourceLine" id="cb173-6" title="6"><span class="dt">static</span> <span class="dt">const</span> napi_type_tag DatabaseHandleTypeTag = {</a>
<a class="sourceLine" id="cb173-7" title="7">  <span class="bn">0x1edf75a38336451d</span>, <span class="bn">0xa5ed9ce2e4c00c38</span></a>
<a class="sourceLine" id="cb173-8" title="8">};</a>
<a class="sourceLine" id="cb173-9" title="9"></a>
<a class="sourceLine" id="cb173-10" title="10"><span class="co">// This value is the type tag for a query handle.</span></a>
<a class="sourceLine" id="cb173-11" title="11"><span class="dt">static</span> <span class="dt">const</span> napi_type_tag QueryHandleTypeTag = {</a>
<a class="sourceLine" id="cb173-12" title="12">  <span class="bn">0x9c73317f9fad44a3</span>, <span class="bn">0x93c3920bf3b0ad6a</span></a>
<a class="sourceLine" id="cb173-13" title="13">};</a>
<a class="sourceLine" id="cb173-14" title="14"></a>
<a class="sourceLine" id="cb173-15" title="15"><span class="dt">static</span> napi_value</a>
<a class="sourceLine" id="cb173-16" title="16">openDatabase(napi_env env, napi_callback_info info) {</a>
<a class="sourceLine" id="cb173-17" title="17">  napi_status status;</a>
<a class="sourceLine" id="cb173-18" title="18">  napi_value result;</a>
<a class="sourceLine" id="cb173-19" title="19"></a>
<a class="sourceLine" id="cb173-20" title="20">  <span class="co">// Perform the underlying action which results in a database handle.</span></a>
<a class="sourceLine" id="cb173-21" title="21">  DatabaseHandle* dbHandle = open_database();</a>
<a class="sourceLine" id="cb173-22" title="22"></a>
<a class="sourceLine" id="cb173-23" title="23">  <span class="co">// Create a new, empty JS object.</span></a>
<a class="sourceLine" id="cb173-24" title="24">  status = napi_create_object(env, &amp;result);</a>
<a class="sourceLine" id="cb173-25" title="25">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb173-26" title="26"></a>
<a class="sourceLine" id="cb173-27" title="27">  <span class="co">// Tag the object to indicate that it holds a pointer to a `DatabaseHandle`.</span></a>
<a class="sourceLine" id="cb173-28" title="28">  status = napi_type_tag_object(env, result, &amp;DatabaseHandleTypeTag);</a>
<a class="sourceLine" id="cb173-29" title="29">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb173-30" title="30"></a>
<a class="sourceLine" id="cb173-31" title="31">  <span class="co">// Store the pointer to the `DatabaseHandle` structure inside the JS object.</span></a>
<a class="sourceLine" id="cb173-32" title="32">  status = napi_wrap(env, result, dbHandle, NULL, NULL, NULL);</a>
<a class="sourceLine" id="cb173-33" title="33">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb173-34" title="34"></a>
<a class="sourceLine" id="cb173-35" title="35">  <span class="cf">return</span> result;</a>
<a class="sourceLine" id="cb173-36" title="36">}</a>
<a class="sourceLine" id="cb173-37" title="37"></a>
<a class="sourceLine" id="cb173-38" title="38"><span class="co">// Later when we receive a JavaScript object purporting to be a database handle</span></a>
<a class="sourceLine" id="cb173-39" title="39"><span class="co">// we can use `napi_check_object_type_tag()` to ensure that it is indeed such a</span></a>
<a class="sourceLine" id="cb173-40" title="40"><span class="co">// handle.</span></a>
<a class="sourceLine" id="cb173-41" title="41"></a>
<a class="sourceLine" id="cb173-42" title="42"><span class="dt">static</span> napi_value</a>
<a class="sourceLine" id="cb173-43" title="43">query(napi_env env, napi_callback_info info) {</a>
<a class="sourceLine" id="cb173-44" title="44">  napi_status status;</a>
<a class="sourceLine" id="cb173-45" title="45">  <span class="dt">size_t</span> argc = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb173-46" title="46">  napi_value argv[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb173-47" title="47">  <span class="dt">bool</span> is_db_handle;</a>
<a class="sourceLine" id="cb173-48" title="48"></a>
<a class="sourceLine" id="cb173-49" title="49">  status = napi_get_cb_info(env, info, &amp;argc, argv, NULL, NULL);</a>
<a class="sourceLine" id="cb173-50" title="50">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb173-51" title="51"></a>
<a class="sourceLine" id="cb173-52" title="52">  <span class="co">// Check that the object passed as the first parameter has the previously</span></a>
<a class="sourceLine" id="cb173-53" title="53">  <span class="co">// applied tag.</span></a>
<a class="sourceLine" id="cb173-54" title="54">  status = napi_check_object_type_tag(env,</a>
<a class="sourceLine" id="cb173-55" title="55">                                      argv[<span class="dv">0</span>],</a>
<a class="sourceLine" id="cb173-56" title="56">                                      &amp;DatabaseHandleTypeTag,</a>
<a class="sourceLine" id="cb173-57" title="57">                                      &amp;is_db_handle);</a>
<a class="sourceLine" id="cb173-58" title="58">  <span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb173-59" title="59"></a>
<a class="sourceLine" id="cb173-60" title="60">  <span class="co">// Throw a `TypeError` if it doesn&#39;t.</span></a>
<a class="sourceLine" id="cb173-61" title="61">  <span class="cf">if</span> (!is_db_handle) {</a>
<a class="sourceLine" id="cb173-62" title="62">    <span class="co">// Throw a TypeError.</span></a>
<a class="sourceLine" id="cb173-63" title="63">    <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb173-64" title="64">  }</a>
<a class="sourceLine" id="cb173-65" title="65">}</a></code></pre>
    </div>
    <h3 id="napi_define_class">napi_define_class</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb174">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb174-1" title="1">napi_status napi_define_class(napi_env env,</a>
<a class="sourceLine" id="cb174-2" title="2">                              <span class="dt">const</span> <span class="dt">char</span>* utf8name,</a>
<a class="sourceLine" id="cb174-3" title="3">                              <span class="dt">size_t</span> length,</a>
<a class="sourceLine" id="cb174-4" title="4">                              napi_callback constructor,</a>
<a class="sourceLine" id="cb174-5" title="5">                              <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb174-6" title="6">                              <span class="dt">size_t</span> property_count,</a>
<a class="sourceLine" id="cb174-7" title="7">                              <span class="dt">const</span> napi_property_descriptor* properties,</a>
<a class="sourceLine" id="cb174-8" title="8">                              napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] utf8name</code>: Name of the JavaScript constructor function;
        When wrapping a C++ class, we recommend for clarity that this name be
        the same as that of the C++ class.
      </li>
      <li>
        <code>[in] length</code>: The length of the <code>utf8name</code> in
        bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.
      </li>
      <li>
        <code>[in] constructor</code>: Callback function that handles
        constructing instances of the class. When wrapping a C++ class, this
        method must be a static member with the
        <a href="#n_api_napi_callback"><code>napi_callback</code></a> signature.
        A C++ class constructor cannot be used.
        <a href="#n_api_napi_callback"><code>napi_callback</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] data</code>: Optional data to be passed to the constructor
        callback as the <code>data</code> property of the callback info.
      </li>
      <li>
        <code>[in] property_count</code>: Number of items in the
        <code>properties</code> array argument.
      </li>
      <li>
        <code>[in] properties</code>: Array of property descriptors describing
        static and instance data properties, accessors, and methods on the class
        See <code>napi_property_descriptor</code>.
      </li>
      <li>
        <code>[out] result</code>: A <code>napi_value</code> representing the
        constructor function for the class.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>Defines a JavaScript class, including:</p>
    <ul>
      <li>
        A JavaScript constructor function that has the class name. When wrapping
        a corresponding C++ class, the callback passed via
        <code>constructor</code> can be used to instantiate a new C++ class
        instance, which can then be placed inside the JavaScript object instance
        being constructed using
        <a href="#n_api_napi_wrap"><code>napi_wrap</code></a
        >.
      </li>
      <li>
        Properties on the constructor function whose implementation can call
        corresponding <em>static</em> data properties, accessors, and methods of
        the C++ class (defined by property descriptors with the
        <code>napi_static</code> attribute).
      </li>
      <li>
        Properties on the constructor function’s <code>prototype</code> object.
        When wrapping a C++ class, <em>non-static</em> data properties,
        accessors, and methods of the C++ class can be called from the static
        functions given in the property descriptors without the
        <code>napi_static</code> attribute after retrieving the C++ class
        instance placed inside the JavaScript object instance by using
        <a href="#n_api_napi_unwrap"><code>napi_unwrap</code></a
        >.
      </li>
    </ul>
    <p>
      When wrapping a C++ class, the C++ constructor callback passed via
      <code>constructor</code> should be a static method on the class that calls
      the actual class constructor, then wraps the new C++ instance in a
      JavaScript object, and returns the wrapper object. See
      <a href="#n_api_napi_wrap"><code>napi_wrap</code></a> for details.
    </p>
    <p>
      The JavaScript constructor function returned from
      <a href="#n_api_napi_define_class"><code>napi_define_class</code></a> is
      often saved and used later to construct new instances of the class from
      native code, and/or to check whether provided values are instances of the
      class. In that case, to prevent the function value from being
      garbage-collected, a strong persistent reference to it can be created
      using
      <a href="#n_api_napi_create_reference"
        ><code>napi_create_reference</code></a
      >, ensuring that the reference count is kept &gt;= 1.
    </p>
    <p>
      Any non-<code>NULL</code> data which is passed to this API via the
      <code>data</code> parameter or via the <code>data</code> field of the
      <code>napi_property_descriptor</code> array items can be associated with
      the resulting JavaScript constructor (which is returned in the
      <code>result</code> parameter) and freed whenever the class is
      garbage-collected by passing both the JavaScript function and the data to
      <a href="#n_api_napi_add_finalizer"><code>napi_add_finalizer</code></a
      >.
    </p>
    <h3 id="napi_wrap">napi_wrap</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb175">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb175-1" title="1">napi_status napi_wrap(napi_env env,</a>
<a class="sourceLine" id="cb175-2" title="2">                      napi_value js_object,</a>
<a class="sourceLine" id="cb175-3" title="3">                      <span class="dt">void</span>* native_object,</a>
<a class="sourceLine" id="cb175-4" title="4">                      napi_finalize finalize_cb,</a>
<a class="sourceLine" id="cb175-5" title="5">                      <span class="dt">void</span>* finalize_hint,</a>
<a class="sourceLine" id="cb175-6" title="6">                      napi_ref* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] js_object</code>: The JavaScript object that will be the
        wrapper for the native object.
      </li>
      <li>
        <code>[in] native_object</code>: The native instance that will be
        wrapped in the JavaScript object.
      </li>
      <li>
        <code>[in] finalize_cb</code>: Optional native callback that can be used
        to free the native instance when the JavaScript object is ready for
        garbage-collection.
        <a href="#n_api_napi_finalize"><code>napi_finalize</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] finalize_hint</code>: Optional contextual hint that is passed
        to the finalize callback.
      </li>
      <li>
        <code>[out] result</code>: Optional reference to the wrapped object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      Wraps a native instance in a JavaScript object. The native instance can be
      retrieved later using <code>napi_unwrap()</code>.
    </p>
    <p>
      When JavaScript code invokes a constructor for a class that was defined
      using <code>napi_define_class()</code>, the <code>napi_callback</code> for
      the constructor is invoked. After constructing an instance of the native
      class, the callback must then call <code>napi_wrap()</code> to wrap the
      newly constructed instance in the already-created JavaScript object that
      is the <code>this</code> argument to the constructor callback. (That
      <code>this</code> object was created from the constructor function’s
      <code>prototype</code>, so it already has definitions of all the instance
      properties and methods.)
    </p>
    <p>
      Typically when wrapping a class instance, a finalize callback should be
      provided that simply deletes the native instance that is received as the
      <code>data</code> argument to the finalize callback.
    </p>
    <p>
      The optional returned reference is initially a weak reference, meaning it
      has a reference count of 0. Typically this reference count would be
      incremented temporarily during async operations that require the instance
      to remain valid.
    </p>
    <p>
      <em>Caution</em>: The optional returned reference (if obtained) should be
      deleted via
      <a href="#n_api_napi_delete_reference"
        ><code>napi_delete_reference</code></a
      >
      ONLY in response to the finalize callback invocation. If it is deleted
      before then, then the finalize callback may never be invoked. Therefore,
      when obtaining a reference a finalize callback is also required in order
      to enable correct disposal of the reference.
    </p>
    <p>
      Calling <code>napi_wrap()</code> a second time on an object will return an
      error. To associate another native instance with the object, use
      <code>napi_remove_wrap()</code> first.
    </p>
    <h3 id="napi_unwrap">napi_unwrap</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb176">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb176-1" title="1">napi_status napi_unwrap(napi_env env,</a>
<a class="sourceLine" id="cb176-2" title="2">                        napi_value js_object,</a>
<a class="sourceLine" id="cb176-3" title="3">                        <span class="dt">void</span>** result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] js_object</code>: The object associated with the native
        instance.
      </li>
      <li>
        <code>[out] result</code>: Pointer to the wrapped native instance.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      Retrieves a native instance that was previously wrapped in a JavaScript
      object using <code>napi_wrap()</code>.
    </p>
    <p>
      When JavaScript code invokes a method or property accessor on the class,
      the corresponding <code>napi_callback</code> is invoked. If the callback
      is for an instance method or accessor, then the <code>this</code> argument
      to the callback is the wrapper object; the wrapped C++ instance that is
      the target of the call can be obtained then by calling
      <code>napi_unwrap()</code> on the wrapper object.
    </p>
    <h3 id="napi_remove_wrap">napi_remove_wrap</h3>
    <!-- YAML
added: v8.5.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb177">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb177-1" title="1">napi_status napi_remove_wrap(napi_env env,</a>
<a class="sourceLine" id="cb177-2" title="2">                             napi_value js_object,</a>
<a class="sourceLine" id="cb177-3" title="3">                             <span class="dt">void</span>** result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] js_object</code>: The object associated with the native
        instance.
      </li>
      <li>
        <code>[out] result</code>: Pointer to the wrapped native instance.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      Retrieves a native instance that was previously wrapped in the JavaScript
      object <code>js_object</code> using <code>napi_wrap()</code> and removes
      the wrapping. If a finalize callback was associated with the wrapping, it
      will no longer be called when the JavaScript object becomes
      garbage-collected.
    </p>
    <h3 id="napi_type_tag_object">napi_type_tag_object</h3>
    <!-- YAML
added:
  - v14.8.0
  - v12.19.0
napiVersion: 8
-->
    <div class="sourceCode" id="cb178">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb178-1" title="1">napi_status napi_type_tag_object(napi_env env,</a>
<a class="sourceLine" id="cb178-2" title="2">                                 napi_value js_object,</a>
<a class="sourceLine" id="cb178-3" title="3">                                 <span class="dt">const</span> napi_type_tag* type_tag);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] js_object</code>: The JavaScript object to be marked.</li>
      <li>
        <code>[in] type_tag</code>: The tag with which the object is to be
        marked.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      Associates the value of the <code>type_tag</code> pointer with the
      JavaScript object. <code>napi_check_object_type_tag()</code> can then be
      used to compare the tag that was attached to the object with one owned by
      the addon to ensure that the object has the right type.
    </p>
    <p>
      If the object already has an associated type tag, this API will return
      <code>napi_invalid_arg</code>.
    </p>
    <h3 id="napi_check_object_type_tag">napi_check_object_type_tag</h3>
    <!-- YAML
added:
  - v14.8.0
  - v12.19.0
napiVersion: 8
-->
    <div class="sourceCode" id="cb179">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb179-1" title="1">napi_status napi_check_object_type_tag(napi_env env,</a>
<a class="sourceLine" id="cb179-2" title="2">                                       napi_value js_object,</a>
<a class="sourceLine" id="cb179-3" title="3">                                       <span class="dt">const</span> napi_type_tag* type_tag,</a>
<a class="sourceLine" id="cb179-4" title="4">                                       <span class="dt">bool</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] js_object</code>: The JavaScript object whose type tag to
        examine.
      </li>
      <li>
        <code>[in] type_tag</code>: The tag with which to compare any tag found
        on the object.
      </li>
      <li>
        <code>[out] result</code>: Whether the type tag given matched the type
        tag on the object. <code>false</code> is also returned if no type tag
        was found on the object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      Compares the pointer given as <code>type_tag</code> with any that can be
      found on <code>js_object</code>. If no tag is found on
      <code>js_object</code> or, if a tag is found but it does not match
      <code>type_tag</code>, then <code>result</code> is set to
      <code>false</code>. If a tag is found and it matches
      <code>type_tag</code>, then <code>result</code> is set to
      <code>true</code>.
    </p>
    <h3 id="napi_add_finalizer">napi_add_finalizer</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 5
-->
    <div class="sourceCode" id="cb180">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb180-1" title="1">napi_status napi_add_finalizer(napi_env env,</a>
<a class="sourceLine" id="cb180-2" title="2">                               napi_value js_object,</a>
<a class="sourceLine" id="cb180-3" title="3">                               <span class="dt">void</span>* native_object,</a>
<a class="sourceLine" id="cb180-4" title="4">                               napi_finalize finalize_cb,</a>
<a class="sourceLine" id="cb180-5" title="5">                               <span class="dt">void</span>* finalize_hint,</a>
<a class="sourceLine" id="cb180-6" title="6">                               napi_ref* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] js_object</code>: The JavaScript object to which the native
        data will be attached.
      </li>
      <li>
        <code>[in] native_object</code>: The native data that will be attached
        to the JavaScript object.
      </li>
      <li>
        <code>[in] finalize_cb</code>: Native callback that will be used to free
        the native data when the JavaScript object is ready for
        garbage-collection.
        <a href="#n_api_napi_finalize"><code>napi_finalize</code></a> provides
        more details.
      </li>
      <li>
        <code>[in] finalize_hint</code>: Optional contextual hint that is passed
        to the finalize callback.
      </li>
      <li>
        <code>[out] result</code>: Optional reference to the JavaScript object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      Adds a <code>napi_finalize</code> callback which will be called when the
      JavaScript object in <code>js_object</code> is ready for garbage
      collection. This API is similar to <code>napi_wrap()</code> except that:
    </p>
    <ul>
      <li>
        the native data cannot be retrieved later using
        <code>napi_unwrap()</code>,
      </li>
      <li>
        nor can it be removed later using <code>napi_remove_wrap()</code>, and
      </li>
      <li>
        the API can be called multiple times with different data items in order
        to attach each of them to the JavaScript object, and
      </li>
      <li>
        the object manipulated by the API can be used with
        <code>napi_wrap()</code>.
      </li>
    </ul>
    <p>
      <em>Caution</em>: The optional returned reference (if obtained) should be
      deleted via
      <a href="#n_api_napi_delete_reference"
        ><code>napi_delete_reference</code></a
      >
      ONLY in response to the finalize callback invocation. If it is deleted
      before then, then the finalize callback may never be invoked. Therefore,
      when obtaining a reference a finalize callback is also required in order
      to enable correct disposal of the reference.
    </p>
    <h2 id="simple-asynchronous-operations">Simple asynchronous operations</h2>
    <p>
      Addon modules often need to leverage async helpers from libuv as part of
      their implementation. This allows them to schedule work to be executed
      asynchronously so that their methods can return in advance of the work
      being completed. This allows them to avoid blocking overall execution of
      the Node.js application.
    </p>
    <p>
      Node-API provides an ABI-stable interface for these supporting functions
      which covers the most common asynchronous use cases.
    </p>
    <p>
      Node-API defines the <code>napi_async_work</code> structure which is used
      to manage asynchronous workers. Instances are created/deleted with
      <a href="#n_api_napi_create_async_work"
        ><code>napi_create_async_work</code></a
      >
      and
      <a href="#n_api_napi_delete_async_work"
        ><code>napi_delete_async_work</code></a
      >.
    </p>
    <p>
      The <code>execute</code> and <code>complete</code> callbacks are functions
      that will be invoked when the executor is ready to execute and when it
      completes its task respectively.
    </p>
    <p>
      The <code>execute</code> function should avoid making any Node-API calls
      that could result in the execution of JavaScript or interaction with
      JavaScript objects. Most often, any code that needs to make Node-API calls
      should be made in <code>complete</code> callback instead. Avoid using the
      <code>napi_env</code> parameter in the execute callback as it will likely
      execute JavaScript.
    </p>
    <p>These functions implement the following interfaces:</p>
    <div class="sourceCode" id="cb181">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb181-1" title="1"><span class="kw">typedef</span> <span class="dt">void</span> (*napi_async_execute_callback)(napi_env env,</a>
<a class="sourceLine" id="cb181-2" title="2">                                            <span class="dt">void</span>* data);</a>
<a class="sourceLine" id="cb181-3" title="3"><span class="kw">typedef</span> <span class="dt">void</span> (*napi_async_complete_callback)(napi_env env,</a>
<a class="sourceLine" id="cb181-4" title="4">                                             napi_status status,</a>
<a class="sourceLine" id="cb181-5" title="5">                                             <span class="dt">void</span>* data);</a></code></pre>
    </div>
    <p>
      When these methods are invoked, the <code>data</code> parameter passed
      will be the addon-provided <code>void*</code> data that was passed into
      the <code>napi_create_async_work</code> call.
    </p>
    <p>
      Once created the async worker can be queued for execution using the
      <a href="#n_api_napi_queue_async_work"
        ><code>napi_queue_async_work</code></a
      >
      function:
    </p>
    <div class="sourceCode" id="cb182">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb182-1" title="1">napi_status napi_queue_async_work(napi_env env,</a>
<a class="sourceLine" id="cb182-2" title="2">                                  napi_async_work work);</a></code></pre>
    </div>
    <p>
      <a href="#n_api_napi_cancel_async_work"
        ><code>napi_cancel_async_work</code></a
      >
      can be used if the work needs to be cancelled before the work has started
      execution.
    </p>
    <p>
      After calling
      <a href="#n_api_napi_cancel_async_work"
        ><code>napi_cancel_async_work</code></a
      >, the <code>complete</code> callback will be invoked with a status value
      of <code>napi_cancelled</code>. The work should not be deleted before the
      <code>complete</code> callback invocation, even when it was cancelled.
    </p>
    <h3 id="napi_create_async_work">napi_create_async_work</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
changes:
  - version: v8.6.0
    pr-url: https://github.com/nodejs/node/pull/14697
    description: Added `async_resource` and `async_resource_name` parameters.
-->
    <div class="sourceCode" id="cb183">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb183-1" title="1">napi_status napi_create_async_work(napi_env env,</a>
<a class="sourceLine" id="cb183-2" title="2">                                   napi_value async_resource,</a>
<a class="sourceLine" id="cb183-3" title="3">                                   napi_value async_resource_name,</a>
<a class="sourceLine" id="cb183-4" title="4">                                   napi_async_execute_callback execute,</a>
<a class="sourceLine" id="cb183-5" title="5">                                   napi_async_complete_callback complete,</a>
<a class="sourceLine" id="cb183-6" title="6">                                   <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb183-7" title="7">                                   napi_async_work* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] async_resource</code>: An optional object associated with the
        async work that will be passed to possible <code>async_hooks</code>
        <a
          href="async_hooks.md#async_hooks_init_asyncid_type_triggerasyncid_resource"
          ><code>init</code> hooks</a
        >.
      </li>
      <li>
        <code>[in] async_resource_name</code>: Identifier for the kind of
        resource that is being provided for diagnostic information exposed by
        the <code>async_hooks</code> API.
      </li>
      <li>
        <code>[in] execute</code>: The native function which should be called to
        execute the logic asynchronously. The given function is called from a
        worker pool thread and can execute in parallel with the main event loop
        thread.
      </li>
      <li>
        <code>[in] complete</code>: The native function which will be called
        when the asynchronous logic is completed or is cancelled. The given
        function is called from the main event loop thread.
        <a href="#n_api_napi_async_complete_callback"
          ><code>napi_async_complete_callback</code></a
        >
        provides more details.
      </li>
      <li>
        <code>[in] data</code>: User-provided data context. This will be passed
        back into the execute and complete functions.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_async_work*</code> which is the
        handle to the newly created async work.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API allocates a work object that is used to execute logic
      asynchronously. It should be freed using
      <a href="#n_api_napi_delete_async_work"
        ><code>napi_delete_async_work</code></a
      >
      once the work is no longer required.
    </p>
    <p>
      <code>async_resource_name</code> should be a null-terminated,
      UTF-8-encoded string.
    </p>
    <p>
      The <code>async_resource_name</code> identifier is provided by the user
      and should be representative of the type of async work being performed. It
      is also recommended to apply namespacing to the identifier, e.g. by
      including the module name. See the
      <a href="async_hooks.md#async_hooks_type"
        ><code>async_hooks</code> documentation</a
      >
      for more information.
    </p>
    <h3 id="napi_delete_async_work">napi_delete_async_work</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb184">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb184-1" title="1">napi_status napi_delete_async_work(napi_env env,</a>
<a class="sourceLine" id="cb184-2" title="2">                                   napi_async_work work);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] work</code>: The handle returned by the call to
        <code>napi_create_async_work</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API frees a previously allocated work object.</p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h3 id="napi_queue_async_work">napi_queue_async_work</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb185">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb185-1" title="1">napi_status napi_queue_async_work(napi_env env,</a>
<a class="sourceLine" id="cb185-2" title="2">                                  napi_async_work work);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] work</code>: The handle returned by the call to
        <code>napi_create_async_work</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API requests that the previously allocated work be scheduled for
      execution. Once it returns successfully, this API must not be called again
      with the same <code>napi_async_work</code> item or the result will be
      undefined.
    </p>
    <h3 id="napi_cancel_async_work">napi_cancel_async_work</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb186">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb186-1" title="1">napi_status napi_cancel_async_work(napi_env env,</a>
<a class="sourceLine" id="cb186-2" title="2">                                   napi_async_work work);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] work</code>: The handle returned by the call to
        <code>napi_create_async_work</code>.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API cancels queued work if it has not yet been started. If it has
      already started executing, it cannot be cancelled and
      <code>napi_generic_failure</code> will be returned. If successful, the
      <code>complete</code> callback will be invoked with a status value of
      <code>napi_cancelled</code>. The work should not be deleted before the
      <code>complete</code> callback invocation, even if it has been
      successfully cancelled.
    </p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h2 id="custom-asynchronous-operations">Custom asynchronous operations</h2>
    <p>
      The simple asynchronous work APIs above may not be appropriate for every
      scenario. When using any other asynchronous mechanism, the following APIs
      are necessary to ensure an asynchronous operation is properly tracked by
      the runtime.
    </p>
    <h3 id="napi_async_init">napi_async_init</h3>
    <!-- YAML
added: v8.6.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb187">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb187-1" title="1">napi_status napi_async_init(napi_env env,</a>
<a class="sourceLine" id="cb187-2" title="2">                            napi_value async_resource,</a>
<a class="sourceLine" id="cb187-3" title="3">                            napi_value async_resource_name,</a>
<a class="sourceLine" id="cb187-4" title="4">                            napi_async_context* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] async_resource</code>: Object associated with the async work
        that will be passed to possible <code>async_hooks</code>
        <a
          href="async_hooks.md#async_hooks_init_asyncid_type_triggerasyncid_resource"
          ><code>init</code> hooks</a
        >
        and can be accessed by
        <a href="async_hooks.md#async_hooks_async_hooks_executionasyncresource"
          ><code>async_hooks.executionAsyncResource()</code></a
        >.
      </li>
      <li>
        <code>[in] async_resource_name</code>: Identifier for the kind of
        resource that is being provided for diagnostic information exposed by
        the <code>async_hooks</code> API.
      </li>
      <li><code>[out] result</code>: The initialized async context.</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      The <code>async_resource</code> object needs to be kept alive until
      <a href="#n_api_napi_async_destroy"><code>napi_async_destroy</code></a> to
      keep <code>async_hooks</code> related API acts correctly. In order to
      retain ABI compatibility with previous versions,
      <code>napi_async_context</code>s are not maintaining the strong reference
      to the <code>async_resource</code> objects to avoid introducing causing
      memory leaks. However, if the <code>async_resource</code> is garbage
      collected by JavaScript engine before the
      <code>napi_async_context</code> was destroyed by
      <code>napi_async_destroy</code>, calling
      <code>napi_async_context</code> related APIs like
      <a href="#n_api_napi_open_callback_scope"
        ><code>napi_open_callback_scope</code></a
      >
      and
      <a href="#n_api_napi_make_callback"><code>napi_make_callback</code></a>
      can cause problems like loss of async context when using the
      <code>AsyncLocalStorage</code> API.
    </p>
    <p>
      In order to retain ABI compatibility with previous versions, passing
      <code>NULL</code> for <code>async_resource</code> does not result in an
      error. However, this is not recommended as this will result poor results
      with <code>async_hooks</code>
      <a
        href="async_hooks.md#async_hooks_init_asyncid_type_triggerasyncid_resource"
        ><code>init</code> hooks</a
      >
      and <code>async_hooks.executionAsyncResource()</code> as the resource is
      now required by the underlying <code>async_hooks</code> implementation in
      order to provide the linkage between async callbacks.
    </p>
    <h3 id="napi_async_destroy">napi_async_destroy</h3>
    <!-- YAML
added: v8.6.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb188">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb188-1" title="1">napi_status napi_async_destroy(napi_env env,</a>
<a class="sourceLine" id="cb188-2" title="2">                               napi_async_context async_context);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] async_context</code>: The async context to be destroyed.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h3 id="napi_make_callback">napi_make_callback</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
changes:
  - version: v8.6.0
    pr-url: https://github.com/nodejs/node/pull/15189
    description: Added `async_context` parameter.
-->
    <div class="sourceCode" id="cb189">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb189-1" title="1">NAPI_EXTERN napi_status napi_make_callback(napi_env env,</a>
<a class="sourceLine" id="cb189-2" title="2">                                           napi_async_context async_context,</a>
<a class="sourceLine" id="cb189-3" title="3">                                           napi_value recv,</a>
<a class="sourceLine" id="cb189-4" title="4">                                           napi_value func,</a>
<a class="sourceLine" id="cb189-5" title="5">                                           <span class="dt">size_t</span> argc,</a>
<a class="sourceLine" id="cb189-6" title="6">                                           <span class="dt">const</span> napi_value* argv,</a>
<a class="sourceLine" id="cb189-7" title="7">                                           napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] async_context</code>: Context for the async operation that is
        invoking the callback. This should normally be a value previously
        obtained from
        <a href="#n_api_napi_async_init"><code>napi_async_init</code></a
        >. In order to retain ABI compatibility with previous versions, passing
        <code>NULL</code> for <code>async_context</code> does not result in an
        error. However, this results in incorrect operation of async hooks.
        Potential issues include loss of async context when using the
        <code>AsyncLocalStorage</code> API.
      </li>
      <li>
        <code>[in] recv</code>: The <code>this</code> value passed to the called
        function.
      </li>
      <li>
        <code>[in] func</code>: <code>napi_value</code> representing the
        JavaScript function to be invoked.
      </li>
      <li>
        <code>[in] argc</code>: The count of elements in the
        <code>argv</code> array.
      </li>
      <li>
        <code>[in] argv</code>: Array of JavaScript values as
        <code>napi_value</code> representing the arguments to the function.
      </li>
      <li>
        <code>[out] result</code>: <code>napi_value</code> representing the
        JavaScript object returned.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This method allows a JavaScript function object to be called from a native
      add-on. This API is similar to <code>napi_call_function</code>. However,
      it is used to call <em>from</em> native code back <em>into</em> JavaScript
      <em>after</em> returning from an async operation (when there is no other
      script on the stack). It is a fairly simple wrapper around
      <code>node::MakeCallback</code>.
    </p>
    <p>
      Note it is <em>not</em> necessary to use
      <code>napi_make_callback</code> from within a
      <code>napi_async_complete_callback</code>; in that situation the
      callback’s async context has already been set up, so a direct call to
      <code>napi_call_function</code> is sufficient and appropriate. Use of the
      <code>napi_make_callback</code> function may be required when implementing
      custom async behavior that does not use
      <code>napi_create_async_work</code>.
    </p>
    <p>
      Any <code>process.nextTick</code>s or Promises scheduled on the microtask
      queue by JavaScript during the callback are ran before returning back to
      C/C++.
    </p>
    <h3 id="napi_open_callback_scope">napi_open_callback_scope</h3>
    <!-- YAML
added: v9.6.0
napiVersion: 3
-->
    <div class="sourceCode" id="cb190">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb190-1" title="1">NAPI_EXTERN napi_status napi_open_callback_scope(napi_env env,</a>
<a class="sourceLine" id="cb190-2" title="2">                                                 napi_value resource_object,</a>
<a class="sourceLine" id="cb190-3" title="3">                                                 napi_async_context context,</a>
<a class="sourceLine" id="cb190-4" title="4">                                                 napi_callback_scope* result)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] resource_object</code>: An object associated with the async
        work that will be passed to possible <code>async_hooks</code>
        <a
          href="async_hooks.md#async_hooks_init_asyncid_type_triggerasyncid_resource"
          ><code>init</code> hooks</a
        >. This parameter has been deprecated and is ignored at runtime. Use the
        <code>async_resource</code> parameter in
        <a href="#n_api_napi_async_init"><code>napi_async_init</code></a>
        instead.
      </li>
      <li>
        <code>[in] context</code>: Context for the async operation that is
        invoking the callback. This should be a value previously obtained from
        <a href="#n_api_napi_async_init"><code>napi_async_init</code></a
        >.
      </li>
      <li><code>[out] result</code>: The newly created scope.</li>
    </ul>
    <p>
      There are cases (for example, resolving promises) where it is necessary to
      have the equivalent of the scope associated with a callback in place when
      making certain Node-API calls. If there is no other script on the stack
      the
      <a href="#n_api_napi_open_callback_scope"
        ><code>napi_open_callback_scope</code></a
      >
      and
      <a href="#n_api_napi_close_callback_scope"
        ><code>napi_close_callback_scope</code></a
      >
      functions can be used to open/close the required scope.
    </p>
    <h3 id="napi_close_callback_scope">napi_close_callback_scope</h3>
    <!-- YAML
added: v9.6.0
napiVersion: 3
-->
    <div class="sourceCode" id="cb191">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb191-1" title="1">NAPI_EXTERN napi_status napi_close_callback_scope(napi_env env,</a>
<a class="sourceLine" id="cb191-2" title="2">                                                  napi_callback_scope scope)</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] scope</code>: The scope to be closed.</li>
    </ul>
    <p>
      This API can be called even if there is a pending JavaScript exception.
    </p>
    <h2 id="version-management">Version management</h2>
    <h3 id="napi_get_node_version">napi_get_node_version</h3>
    <!-- YAML
added: v8.4.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb192">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb192-1" title="1"><span class="kw">typedef</span> <span class="kw">struct</span> {</a>
<a class="sourceLine" id="cb192-2" title="2">  <span class="dt">uint32_t</span> major;</a>
<a class="sourceLine" id="cb192-3" title="3">  <span class="dt">uint32_t</span> minor;</a>
<a class="sourceLine" id="cb192-4" title="4">  <span class="dt">uint32_t</span> patch;</a>
<a class="sourceLine" id="cb192-5" title="5">  <span class="dt">const</span> <span class="dt">char</span>* release;</a>
<a class="sourceLine" id="cb192-6" title="6">} napi_node_version;</a>
<a class="sourceLine" id="cb192-7" title="7"></a>
<a class="sourceLine" id="cb192-8" title="8">napi_status napi_get_node_version(napi_env env,</a>
<a class="sourceLine" id="cb192-9" title="9">                                  <span class="dt">const</span> napi_node_version** version);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] version</code>: A pointer to version information for Node.js
        itself.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This function fills the <code>version</code> struct with the major, minor,
      and patch version of Node.js that is currently running, and the
      <code>release</code> field with the value of
      <a href="process.md#process_process_release"
        ><code>process.release.name</code></a
      >.
    </p>
    <p>
      The returned buffer is statically allocated and does not need to be freed.
    </p>
    <h3 id="napi_get_version">napi_get_version</h3>
    <!-- YAML
added: v8.0.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb193">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb193-1" title="1">napi_status napi_get_version(napi_env env,</a>
<a class="sourceLine" id="cb193-2" title="2">                             <span class="dt">uint32_t</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: The highest version of Node-API supported.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This API returns the highest Node-API version supported by the Node.js
      runtime. Node-API is planned to be additive such that newer releases of
      Node.js may support additional API functions. In order to allow an addon
      to use a newer function when running with versions of Node.js that support
      it, while providing fallback behavior when running with Node.js versions
      that don’t support it:
    </p>
    <ul>
      <li>
        Call <code>napi_get_version()</code> to determine if the API is
        available.
      </li>
      <li>
        If available, dynamically load a pointer to the function using
        <code>uv_dlsym()</code>.
      </li>
      <li>Use the dynamically loaded pointer to invoke the function.</li>
      <li>
        If the function is not available, provide an alternate implementation
        that does not use the function.
      </li>
    </ul>
    <h2 id="memory-management">Memory management</h2>
    <h3 id="napi_adjust_external_memory">napi_adjust_external_memory</h3>
    <!-- YAML
added: v8.5.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb194">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb194-1" title="1">NAPI_EXTERN napi_status napi_adjust_external_memory(napi_env env,</a>
<a class="sourceLine" id="cb194-2" title="2">                                                    <span class="dt">int64_t</span> change_in_bytes,</a>
<a class="sourceLine" id="cb194-3" title="3">                                                    <span class="dt">int64_t</span>* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] change_in_bytes</code>: The change in externally allocated
        memory that is kept alive by JavaScript objects.
      </li>
      <li><code>[out] result</code>: The adjusted value</li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>
      This function gives V8 an indication of the amount of externally allocated
      memory that is kept alive by JavaScript objects (i.e. a JavaScript object
      that points to its own memory allocated by a native module). Registering
      externally allocated memory will trigger global garbage collections more
      often than it would otherwise.
    </p>
    <h2 id="promises">Promises</h2>
    <p>
      Node-API provides facilities for creating <code>Promise</code> objects as
      described in
      <a href="https://tc39.github.io/ecma262/#sec-promise-objects"
        >Section 25.4</a
      >
      of the ECMA specification. It implements promises as a pair of objects.
      When a promise is created by <code>napi_create_promise()</code>, a
      “deferred” object is created and returned alongside the
      <code>Promise</code>. The deferred object is bound to the created
      <code>Promise</code> and is the only means to resolve or reject the
      <code>Promise</code> using <code>napi_resolve_deferred()</code> or
      <code>napi_reject_deferred()</code>. The deferred object that is created
      by <code>napi_create_promise()</code> is freed by
      <code>napi_resolve_deferred()</code> or
      <code>napi_reject_deferred()</code>. The <code>Promise</code> object may
      be returned to JavaScript where it can be used in the usual fashion.
    </p>
    <p>
      For example, to create a promise and pass it to an asynchronous worker:
    </p>
    <div class="sourceCode" id="cb195">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb195-1" title="1">napi_deferred deferred;</a>
<a class="sourceLine" id="cb195-2" title="2">napi_value promise;</a>
<a class="sourceLine" id="cb195-3" title="3">napi_status status;</a>
<a class="sourceLine" id="cb195-4" title="4"></a>
<a class="sourceLine" id="cb195-5" title="5"><span class="co">// Create the promise.</span></a>
<a class="sourceLine" id="cb195-6" title="6">status = napi_create_promise(env, &amp;deferred, &amp;promise);</a>
<a class="sourceLine" id="cb195-7" title="7"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb195-8" title="8"></a>
<a class="sourceLine" id="cb195-9" title="9"><span class="co">// Pass the deferred to a function that performs an asynchronous action.</span></a>
<a class="sourceLine" id="cb195-10" title="10">do_something_asynchronous(deferred);</a>
<a class="sourceLine" id="cb195-11" title="11"></a>
<a class="sourceLine" id="cb195-12" title="12"><span class="co">// Return the promise to JS</span></a>
<a class="sourceLine" id="cb195-13" title="13"><span class="cf">return</span> promise;</a></code></pre>
    </div>
    <p>
      The above function <code>do_something_asynchronous()</code> would perform
      its asynchronous action and then it would resolve or reject the deferred,
      thereby concluding the promise and freeing the deferred:
    </p>
    <div class="sourceCode" id="cb196">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb196-1" title="1">napi_deferred deferred;</a>
<a class="sourceLine" id="cb196-2" title="2">napi_value undefined;</a>
<a class="sourceLine" id="cb196-3" title="3">napi_status status;</a>
<a class="sourceLine" id="cb196-4" title="4"></a>
<a class="sourceLine" id="cb196-5" title="5"><span class="co">// Create a value with which to conclude the deferred.</span></a>
<a class="sourceLine" id="cb196-6" title="6">status = napi_get_undefined(env, &amp;undefined);</a>
<a class="sourceLine" id="cb196-7" title="7"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb196-8" title="8"></a>
<a class="sourceLine" id="cb196-9" title="9"><span class="co">// Resolve or reject the promise associated with the deferred depending on</span></a>
<a class="sourceLine" id="cb196-10" title="10"><span class="co">// whether the asynchronous action succeeded.</span></a>
<a class="sourceLine" id="cb196-11" title="11"><span class="cf">if</span> (asynchronous_action_succeeded) {</a>
<a class="sourceLine" id="cb196-12" title="12">  status = napi_resolve_deferred(env, deferred, undefined);</a>
<a class="sourceLine" id="cb196-13" title="13">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb196-14" title="14">  status = napi_reject_deferred(env, deferred, undefined);</a>
<a class="sourceLine" id="cb196-15" title="15">}</a>
<a class="sourceLine" id="cb196-16" title="16"><span class="cf">if</span> (status != napi_ok) <span class="cf">return</span> NULL;</a>
<a class="sourceLine" id="cb196-17" title="17"></a>
<a class="sourceLine" id="cb196-18" title="18"><span class="co">// At this point the deferred has been freed, so we should assign NULL to it.</span></a>
<a class="sourceLine" id="cb196-19" title="19">deferred = NULL;</a></code></pre>
    </div>
    <h3 id="napi_create_promise">napi_create_promise</h3>
    <!-- YAML
added: v8.5.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb197">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb197-1" title="1">napi_status napi_create_promise(napi_env env,</a>
<a class="sourceLine" id="cb197-2" title="2">                                napi_deferred* deferred,</a>
<a class="sourceLine" id="cb197-3" title="3">                                napi_value* promise);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] deferred</code>: A newly created deferred object which can
        later be passed to <code>napi_resolve_deferred()</code> or
        <code>napi_reject_deferred()</code> to resolve resp. reject the
        associated promise.
      </li>
      <li>
        <code>[out] promise</code>: The JavaScript promise associated with the
        deferred object.
      </li>
    </ul>
    <p>Returns <code>napi_ok</code> if the API succeeded.</p>
    <p>This API creates a deferred object and a JavaScript promise.</p>
    <h3 id="napi_resolve_deferred">napi_resolve_deferred</h3>
    <!-- YAML
added: v8.5.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb198">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb198-1" title="1">napi_status napi_resolve_deferred(napi_env env,</a>
<a class="sourceLine" id="cb198-2" title="2">                                  napi_deferred deferred,</a>
<a class="sourceLine" id="cb198-3" title="3">                                  napi_value resolution);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] deferred</code>: The deferred object whose associated promise
        to resolve.
      </li>
      <li>
        <code>[in] resolution</code>: The value with which to resolve the
        promise.
      </li>
    </ul>
    <p>
      This API resolves a JavaScript promise by way of the deferred object with
      which it is associated. Thus, it can only be used to resolve JavaScript
      promises for which the corresponding deferred object is available. This
      effectively means that the promise must have been created using
      <code>napi_create_promise()</code> and the deferred object returned from
      that call must have been retained in order to be passed to this API.
    </p>
    <p>The deferred object is freed upon successful completion.</p>
    <h3 id="napi_reject_deferred">napi_reject_deferred</h3>
    <!-- YAML
added: v8.5.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb199">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb199-1" title="1">napi_status napi_reject_deferred(napi_env env,</a>
<a class="sourceLine" id="cb199-2" title="2">                                 napi_deferred deferred,</a>
<a class="sourceLine" id="cb199-3" title="3">                                 napi_value rejection);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] deferred</code>: The deferred object whose associated promise
        to resolve.
      </li>
      <li>
        <code>[in] rejection</code>: The value with which to reject the promise.
      </li>
    </ul>
    <p>
      This API rejects a JavaScript promise by way of the deferred object with
      which it is associated. Thus, it can only be used to reject JavaScript
      promises for which the corresponding deferred object is available. This
      effectively means that the promise must have been created using
      <code>napi_create_promise()</code> and the deferred object returned from
      that call must have been retained in order to be passed to this API.
    </p>
    <p>The deferred object is freed upon successful completion.</p>
    <h3 id="napi_is_promise">napi_is_promise</h3>
    <!-- YAML
added: v8.5.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb200">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb200-1" title="1">napi_status napi_is_promise(napi_env env,</a>
<a class="sourceLine" id="cb200-2" title="2">                            napi_value value,</a>
<a class="sourceLine" id="cb200-3" title="3">                            <span class="dt">bool</span>* is_promise);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] value</code>: The value to examine</li>
      <li>
        <code>[out] is_promise</code>: Flag indicating whether
        <code>promise</code> is a native promise object (that is, a promise
        object created by the underlying engine).
      </li>
    </ul>
    <h2 id="script-execution">Script execution</h2>
    <p>
      Node-API provides an API for executing a string containing JavaScript
      using the underlying JavaScript engine.
    </p>
    <h3 id="napi_run_script">napi_run_script</h3>
    <!-- YAML
added: v8.5.0
napiVersion: 1
-->
    <div class="sourceCode" id="cb201">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb201-1" title="1">NAPI_EXTERN napi_status napi_run_script(napi_env env,</a>
<a class="sourceLine" id="cb201-2" title="2">                                        napi_value script,</a>
<a class="sourceLine" id="cb201-3" title="3">                                        napi_value* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] script</code>: A JavaScript string containing the script to
        execute.
      </li>
      <li>
        <code>[out] result</code>: The value resulting from having executed the
        script.
      </li>
    </ul>
    <p>
      This function executes a string of JavaScript code and returns its result
      with the following caveats:
    </p>
    <ul>
      <li>
        Unlike <code>eval</code>, this function does not allow the script to
        access the current lexical scope, and therefore also does not allow to
        access the
        <a href="modules.md#modules_the_module_scope">module scope</a>, meaning
        that pseudo-globals such as <code>require</code> will not be available.
      </li>
      <li>
        The script can access the <a href="globals.md">global scope</a>.
        Function and <code>var</code> declarations in the script will be added
        to the
        <a href="globals.md#globals_global"><code>global</code></a> object.
        Variable declarations made using <code>let</code> and
        <code>const</code> will be visible globally, but will not be added to
        the <a href="globals.md#globals_global"><code>global</code></a> object.
      </li>
      <li>
        The value of <code>this</code> is
        <a href="globals.md#globals_global"><code>global</code></a> within the
        script.
      </li>
    </ul>
    <h2 id="libuv-event-loop">libuv event loop</h2>
    <p>
      Node-API provides a function for getting the current event loop associated
      with a specific <code>napi_env</code>.
    </p>
    <h3 id="napi_get_uv_event_loop">napi_get_uv_event_loop</h3>
    <!-- YAML
added:
  - v9.3.0
  - v8.10.0
napiVersion: 2
-->
    <div class="sourceCode" id="cb202">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb202-1" title="1">NAPI_EXTERN napi_status napi_get_uv_event_loop(napi_env env,</a>
<a class="sourceLine" id="cb202-2" title="2">                                               <span class="kw">struct</span> uv_loop_s** loop);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[out] loop</code>: The current libuv loop instance.</li>
    </ul>
    <h2 id="asynchronous-thread-safe-function-calls">
      Asynchronous thread-safe function calls
    </h2>
    <p>
      JavaScript functions can normally only be called from a native addon’s
      main thread. If an addon creates additional threads, then Node-API
      functions that require a <code>napi_env</code>, <code>napi_value</code>,
      or <code>napi_ref</code> must not be called from those threads.
    </p>
    <p>
      When an addon has additional threads and JavaScript functions need to be
      invoked based on the processing completed by those threads, those threads
      must communicate with the addon’s main thread so that the main thread can
      invoke the JavaScript function on their behalf. The thread-safe function
      APIs provide an easy way to do this.
    </p>
    <p>
      These APIs provide the type <code>napi_threadsafe_function</code> as well
      as APIs to create, destroy, and call objects of this type.
      <code>napi_create_threadsafe_function()</code> creates a persistent
      reference to a <code>napi_value</code> that holds a JavaScript function
      which can be called from multiple threads. The calls happen
      asynchronously. This means that values with which the JavaScript callback
      is to be called will be placed in a queue, and, for each value in the
      queue, a call will eventually be made to the JavaScript function.
    </p>
    <p>
      Upon creation of a <code>napi_threadsafe_function</code> a
      <code>napi_finalize</code> callback can be provided. This callback will be
      invoked on the main thread when the thread-safe function is about to be
      destroyed. It receives the context and the finalize data given during
      construction, and provides an opportunity for cleaning up after the
      threads e.g. by calling <code>uv_thread_join()</code>.
      <strong
        >Aside from the main loop thread, no threads should be using the
        thread-safe function after the finalize callback completes.</strong
      >
    </p>
    <p>
      The <code>context</code> given during the call to
      <code>napi_create_threadsafe_function()</code> can be retrieved from any
      thread with a call to <code>napi_get_threadsafe_function_context()</code>.
    </p>
    <h3 id="calling-a-thread-safe-function">Calling a thread-safe function</h3>
    <p>
      <code>napi_call_threadsafe_function()</code> can be used for initiating a
      call into JavaScript. <code>napi_call_threadsafe_function()</code> accepts
      a parameter which controls whether the API behaves blockingly. If set to
      <code>napi_tsfn_nonblocking</code>, the API behaves non-blockingly,
      returning <code>napi_queue_full</code> if the queue was full, preventing
      data from being successfully added to the queue. If set to
      <code>napi_tsfn_blocking</code>, the API blocks until space becomes
      available in the queue. <code>napi_call_threadsafe_function()</code> never
      blocks if the thread-safe function was created with a maximum queue size
      of 0.
    </p>
    <p>
      <code>napi_call_threadsafe_function()</code> should not be called with
      <code>napi_tsfn_blocking</code> from a JavaScript thread, because, if the
      queue is full, it may cause the JavaScript thread to deadlock.
    </p>
    <p>
      The actual call into JavaScript is controlled by the callback given via
      the <code>call_js_cb</code> parameter. <code>call_js_cb</code> is invoked
      on the main thread once for each value that was placed into the queue by a
      successful call to <code>napi_call_threadsafe_function()</code>. If such a
      callback is not given, a default callback will be used, and the resulting
      JavaScript call will have no arguments. The
      <code>call_js_cb</code> callback receives the JavaScript function to call
      as a <code>napi_value</code> in its parameters, as well as the
      <code>void*</code> context pointer used when creating the
      <code>napi_threadsafe_function</code>, and the next data pointer that was
      created by one of the secondary threads. The callback can then use an API
      such as <code>napi_call_function()</code> to call into JavaScript.
    </p>
    <p>
      The callback may also be invoked with <code>env</code> and
      <code>call_js_cb</code> both set to <code>NULL</code> to indicate that
      calls into JavaScript are no longer possible, while items remain in the
      queue that may need to be freed. This normally occurs when the Node.js
      process exits while there is a thread-safe function still active.
    </p>
    <p>
      It is not necessary to call into JavaScript via
      <code>napi_make_callback()</code> because Node-API runs
      <code>call_js_cb</code> in a context appropriate for callbacks.
    </p>
    <h3 id="reference-counting-of-thread-safe-functions">
      Reference counting of thread-safe functions
    </h3>
    <p>
      Threads can be added to and removed from a
      <code>napi_threadsafe_function</code> object during its existence. Thus,
      in addition to specifying an initial number of threads upon creation,
      <code>napi_acquire_threadsafe_function</code> can be called to indicate
      that a new thread will start making use of the thread-safe function.
      Similarly, <code>napi_release_threadsafe_function</code> can be called to
      indicate that an existing thread will stop making use of the thread-safe
      function.
    </p>
    <p>
      <code>napi_threadsafe_function</code> objects are destroyed when every
      thread which uses the object has called
      <code>napi_release_threadsafe_function()</code> or has received a return
      status of <code>napi_closing</code> in response to a call to
      <code>napi_call_threadsafe_function</code>. The queue is emptied before
      the <code>napi_threadsafe_function</code> is destroyed.
      <code>napi_release_threadsafe_function()</code> should be the last API
      call made in conjunction with a given
      <code>napi_threadsafe_function</code>, because after the call completes,
      there is no guarantee that the <code>napi_threadsafe_function</code> is
      still allocated. For the same reason, do not use a thread-safe function
      after receiving a return value of <code>napi_closing</code> in response to
      a call to <code>napi_call_threadsafe_function</code>. Data associated with
      the <code>napi_threadsafe_function</code> can be freed in its
      <code>napi_finalize</code> callback which was passed to
      <code>napi_create_threadsafe_function()</code>. The parameter
      <code>initial_thread_count</code> of
      <code>napi_create_threadsafe_function</code> marks the initial number of
      acquisitions of the thread-safe functions, instead of calling
      <code>napi_acquire_threadsafe_function</code> multiple times at creation.
    </p>
    <p>
      Once the number of threads making use of a
      <code>napi_threadsafe_function</code> reaches zero, no further threads can
      start making use of it by calling
      <code>napi_acquire_threadsafe_function()</code>. In fact, all subsequent
      API calls associated with it, except
      <code>napi_release_threadsafe_function()</code>, will return an error
      value of <code>napi_closing</code>.
    </p>
    <p>
      The thread-safe function can be “aborted” by giving a value of
      <code>napi_tsfn_abort</code> to
      <code>napi_release_threadsafe_function()</code>. This will cause all
      subsequent APIs associated with the thread-safe function except
      <code>napi_release_threadsafe_function()</code> to return
      <code>napi_closing</code> even before its reference count reaches zero. In
      particular, <code>napi_call_threadsafe_function()</code> will return
      <code>napi_closing</code>, thus informing the threads that it is no longer
      possible to make asynchronous calls to the thread-safe function. This can
      be used as a criterion for terminating the thread.
      <strong
        >Upon receiving a return value of <code>napi_closing</code> from
        <code>napi_call_threadsafe_function()</code> a thread must not use the
        thread-safe function anymore because it is no longer guaranteed to be
        allocated.</strong
      >
    </p>
    <h3 id="deciding-whether-to-keep-the-process-running">
      Deciding whether to keep the process running
    </h3>
    <p>
      Similarly to libuv handles, thread-safe functions can be “referenced” and
      “unreferenced”. A “referenced” thread-safe function will cause the event
      loop on the thread on which it is created to remain alive until the
      thread-safe function is destroyed. In contrast, an “unreferenced”
      thread-safe function will not prevent the event loop from exiting. The
      APIs <code>napi_ref_threadsafe_function</code> and
      <code>napi_unref_threadsafe_function</code> exist for this purpose.
    </p>
    <p>
      Neither does <code>napi_unref_threadsafe_function</code> mark the
      thread-safe functions as able to be destroyed nor does
      <code>napi_ref_threadsafe_function</code> prevent it from being destroyed.
    </p>
    <h3 id="napi_create_threadsafe_function">
      napi_create_threadsafe_function
    </h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
changes:
  - version:
     - v12.6.0
     - v10.17.0
    pr-url: https://github.com/nodejs/node/pull/27791
    description: Made `func` parameter optional with custom `call_js_cb`.
-->
    <div class="sourceCode" id="cb203">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb203-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb203-2" title="2">napi_create_threadsafe_function(napi_env env,</a>
<a class="sourceLine" id="cb203-3" title="3">                                napi_value func,</a>
<a class="sourceLine" id="cb203-4" title="4">                                napi_value async_resource,</a>
<a class="sourceLine" id="cb203-5" title="5">                                napi_value async_resource_name,</a>
<a class="sourceLine" id="cb203-6" title="6">                                <span class="dt">size_t</span> max_queue_size,</a>
<a class="sourceLine" id="cb203-7" title="7">                                <span class="dt">size_t</span> initial_thread_count,</a>
<a class="sourceLine" id="cb203-8" title="8">                                <span class="dt">void</span>* thread_finalize_data,</a>
<a class="sourceLine" id="cb203-9" title="9">                                napi_finalize thread_finalize_cb,</a>
<a class="sourceLine" id="cb203-10" title="10">                                <span class="dt">void</span>* context,</a>
<a class="sourceLine" id="cb203-11" title="11">                                napi_threadsafe_function_call_js call_js_cb,</a>
<a class="sourceLine" id="cb203-12" title="12">                                napi_threadsafe_function* result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[in] func</code>: An optional JavaScript function to call from
        another thread. It must be provided if <code>NULL</code> is passed to
        <code>call_js_cb</code>.
      </li>
      <li>
        <code>[in] async_resource</code>: An optional object associated with the
        async work that will be passed to possible <code>async_hooks</code>
        <a
          href="async_hooks.md#async_hooks_init_asyncid_type_triggerasyncid_resource"
          ><code>init</code> hooks</a
        >.
      </li>
      <li>
        <code>[in] async_resource_name</code>: A JavaScript string to provide an
        identifier for the kind of resource that is being provided for
        diagnostic information exposed by the <code>async_hooks</code> API.
      </li>
      <li>
        <code>[in] max_queue_size</code>: Maximum size of the queue.
        <code>0</code> for no limit.
      </li>
      <li>
        <code>[in] initial_thread_count</code>: The initial number of
        acquisitions, i.e. the initial number of threads, including the main
        thread, which will be making use of this function.
      </li>
      <li>
        <code>[in] thread_finalize_data</code>: Optional data to be passed to
        <code>thread_finalize_cb</code>.
      </li>
      <li>
        <code>[in] thread_finalize_cb</code>: Optional function to call when the
        <code>napi_threadsafe_function</code> is being destroyed.
      </li>
      <li>
        <code>[in] context</code>: Optional data to attach to the resulting
        <code>napi_threadsafe_function</code>.
      </li>
      <li>
        <code>[in] call_js_cb</code>: Optional callback which calls the
        JavaScript function in response to a call on a different thread. This
        callback will be called on the main thread. If not given, the JavaScript
        function will be called with no parameters and with
        <code>undefined</code> as its <code>this</code> value.
        <a href="#n_api_napi_threadsafe_function_call_js"
          ><code>napi_threadsafe_function_call_js</code></a
        >
        provides more details.
      </li>
      <li>
        <code>[out] result</code>: The asynchronous thread-safe JavaScript
        function.
      </li>
    </ul>
    <h3 id="napi_get_threadsafe_function_context">
      napi_get_threadsafe_function_context
    </h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <div class="sourceCode" id="cb204">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb204-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb204-2" title="2">napi_get_threadsafe_function_context(napi_threadsafe_function func,</a>
<a class="sourceLine" id="cb204-3" title="3">                                     <span class="dt">void</span>** result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] func</code>: The thread-safe function for which to retrieve
        the context.
      </li>
      <li>
        <code>[out] result</code>: The location where to store the context.
      </li>
    </ul>
    <p>
      This API may be called from any thread which makes use of
      <code>func</code>.
    </p>
    <h3 id="napi_call_threadsafe_function">napi_call_threadsafe_function</h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
changes:
  - version: v14.5.0
    pr-url: https://github.com/nodejs/node/pull/33453
    description: Support for `napi_would_deadlock` has been reverted.
  - version: v14.1.0
    pr-url: https://github.com/nodejs/node/pull/32689
    description: Return `napi_would_deadlock` when called with
                 `napi_tsfn_blocking` from the main thread or a worker thread
                 and the queue is full.
-->
    <div class="sourceCode" id="cb205">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb205-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb205-2" title="2">napi_call_threadsafe_function(napi_threadsafe_function func,</a>
<a class="sourceLine" id="cb205-3" title="3">                              <span class="dt">void</span>* data,</a>
<a class="sourceLine" id="cb205-4" title="4">                              napi_threadsafe_function_call_mode is_blocking);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] func</code>: The asynchronous thread-safe JavaScript function
        to invoke.
      </li>
      <li>
        <code>[in] data</code>: Data to send into JavaScript via the callback
        <code>call_js_cb</code> provided during the creation of the thread-safe
        JavaScript function.
      </li>
      <li>
        <code>[in] is_blocking</code>: Flag whose value can be either
        <code>napi_tsfn_blocking</code> to indicate that the call should block
        if the queue is full or <code>napi_tsfn_nonblocking</code> to indicate
        that the call should return immediately with a status of
        <code>napi_queue_full</code> whenever the queue is full.
      </li>
    </ul>
    <p>
      This API should not be called with <code>napi_tsfn_blocking</code> from a
      JavaScript thread, because, if the queue is full, it may cause the
      JavaScript thread to deadlock.
    </p>
    <p>
      This API will return <code>napi_closing</code> if
      <code>napi_release_threadsafe_function()</code> was called with
      <code>abort</code> set to <code>napi_tsfn_abort</code> from any thread.
      The value is only added to the queue if the API returns
      <code>napi_ok</code>.
    </p>
    <p>
      This API may be called from any thread which makes use of
      <code>func</code>.
    </p>
    <h3 id="napi_acquire_threadsafe_function">
      napi_acquire_threadsafe_function
    </h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <div class="sourceCode" id="cb206">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb206-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb206-2" title="2">napi_acquire_threadsafe_function(napi_threadsafe_function func);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] func</code>: The asynchronous thread-safe JavaScript function
        to start making use of.
      </li>
    </ul>
    <p>
      A thread should call this API before passing <code>func</code> to any
      other thread-safe function APIs to indicate that it will be making use of
      <code>func</code>. This prevents <code>func</code> from being destroyed
      when all other threads have stopped making use of it.
    </p>
    <p>
      This API may be called from any thread which will start making use of
      <code>func</code>.
    </p>
    <h3 id="napi_release_threadsafe_function">
      napi_release_threadsafe_function
    </h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <div class="sourceCode" id="cb207">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb207-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb207-2" title="2">napi_release_threadsafe_function(napi_threadsafe_function func,</a>
<a class="sourceLine" id="cb207-3" title="3">                                 napi_threadsafe_function_release_mode mode);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] func</code>: The asynchronous thread-safe JavaScript function
        whose reference count to decrement.
      </li>
      <li>
        <code>[in] mode</code>: Flag whose value can be either
        <code>napi_tsfn_release</code> to indicate that the current thread will
        make no further calls to the thread-safe function, or
        <code>napi_tsfn_abort</code> to indicate that in addition to the current
        thread, no other thread should make any further calls to the thread-safe
        function. If set to <code>napi_tsfn_abort</code>, further calls to
        <code>napi_call_threadsafe_function()</code> will return
        <code>napi_closing</code>, and no further values will be placed in the
        queue.
      </li>
    </ul>
    <p>
      A thread should call this API when it stops making use of
      <code>func</code>. Passing <code>func</code> to any thread-safe APIs after
      having called this API has undefined results, as <code>func</code> may
      have been destroyed.
    </p>
    <p>
      This API may be called from any thread which will stop making use of
      <code>func</code>.
    </p>
    <h3 id="napi_ref_threadsafe_function">napi_ref_threadsafe_function</h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <div class="sourceCode" id="cb208">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb208-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb208-2" title="2">napi_ref_threadsafe_function(napi_env env, napi_threadsafe_function func);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] func</code>: The thread-safe function to reference.</li>
    </ul>
    <p>
      This API is used to indicate that the event loop running on the main
      thread should not exit until <code>func</code> has been destroyed. Similar
      to
      <a href="https://docs.libuv.org/en/v1.x/handle.html#c.uv_ref"
        ><code>uv_ref</code></a
      >
      it is also idempotent.
    </p>
    <p>
      Neither does <code>napi_unref_threadsafe_function</code> mark the
      thread-safe functions as able to be destroyed nor does
      <code>napi_ref_threadsafe_function</code> prevent it from being destroyed.
      <code>napi_acquire_threadsafe_function</code> and
      <code>napi_release_threadsafe_function</code> are available for that
      purpose.
    </p>
    <p>This API may only be called from the main thread.</p>
    <h3 id="napi_unref_threadsafe_function">napi_unref_threadsafe_function</h3>
    <!-- YAML
added: v10.6.0
napiVersion: 4
-->
    <div class="sourceCode" id="cb209">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb209-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb209-2" title="2">napi_unref_threadsafe_function(napi_env env, napi_threadsafe_function func);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li><code>[in] func</code>: The thread-safe function to unreference.</li>
    </ul>
    <p>
      This API is used to indicate that the event loop running on the main
      thread may exit before <code>func</code> is destroyed. Similar to
      <a href="https://docs.libuv.org/en/v1.x/handle.html#c.uv_unref"
        ><code>uv_unref</code></a
      >
      it is also idempotent.
    </p>
    <p>This API may only be called from the main thread.</p>
    <h2 id="miscellaneous-utilities">Miscellaneous utilities</h2>
    <h2 id="node_api_get_module_file_name">node_api_get_module_file_name</h2>
    <!-- YAML
added:
  - v15.9.0
  - v12.22.0
-->
    <blockquote>
      <p>Stability: 1 - Experimental</p>
    </blockquote>
    <div class="sourceCode" id="cb210">
      <pre
        class="sourceCode c"
      ><code class="sourceCode c"><a class="sourceLine" id="cb210-1" title="1">NAPI_EXTERN napi_status</a>
<a class="sourceLine" id="cb210-2" title="2">node_api_get_module_file_name(napi_env env, <span class="dt">const</span> <span class="dt">char</span>** result);</a></code></pre>
    </div>
    <ul>
      <li>
        <code>[in] env</code>: The environment that the API is invoked under.
      </li>
      <li>
        <code>[out] result</code>: A URL containing the absolute path of the
        location from which the add-on was loaded. For a file on the local file
        system it will start with <code>file://</code>. The string is
        null-terminated and owned by <code>env</code> and must thus not be
        modified or freed.
      </li>
    </ul>
    <p>
      <code>result</code> may be an empty string if the add-on loading process
      fails to establish the add-on’s file name during loading.
    </p>
  </body>
</html>
