<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>Troubleshooting the CodeQL workflow</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Troubleshooting the CodeQL workflow</h1>
    </header>
    <!--See /content/code-security/secure-coding for the latest version of this article -->
    <p>
      {% data reusables.code-scanning.beta %} {% data
      reusables.code-scanning.not-available %}
    </p>
    <h2 id="producing-detailed-logs-for-debugging">
      Producing detailed logs for debugging
    </h2>
    <p>
      To produce more detailed logging output, you can enable step debug
      logging. For more information, see “<a
        href="/actions/managing-workflow-runs/enabling-debug-logging#enabling-step-debug-logging"
        >Enabling debug logging</a
      >.”
    </p>
    <h2 id="automatic-build-for-a-compiled-language-fails">
      Automatic build for a compiled language fails
    </h2>
    <p>
      If an automatic build of code for a compiled language within your project
      fails, try the following troubleshooting steps.
    </p>
    <ul>
      <li>
        <p>
          Remove the <code>autobuild</code> step from your {% data
          variables.product.prodname_code_scanning %} workflow and add specific
          build steps. For information about editing the workflow, see “<a
            href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-code-scanning#editing-a-code-scanning-workflow"
            >Configuring {% data variables.product.prodname_code_scanning %}</a
          >.” For more information about replacing the
          <code>autobuild</code> step, see “<a
            href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-the-codeql-workflow-for-compiled-languages#adding-build-steps-for-a-compiled-language"
            >Configuring the {% data variables.product.prodname_codeql %}
            workflow for compiled languages</a
          >.”
        </p>
      </li>
      <li>
        <p>
          If your workflow doesn’t explicitly specify the languages to analyze,
          {% data variables.product.prodname_codeql %} implicitly detects the
          supported languages in your code base. In this configuration, out of
          the compiled languages C/C++, C#, and Java, {% data
          variables.product.prodname_codeql %} only analyzes the language with
          the most source files. Edit the workflow and add a build matrix
          specifying the languages you want to analyze. The default CodeQL
          analysis workflow uses such a matrix.
        </p>
        <p>
          The following extracts from a workflow show how you can use a matrix
          within the job strategy to specify languages, and then reference each
          language within the “Initialize {% data
          variables.product.prodname_codeql %}” step:
        </p>
        <div class="sourceCode" id="cb1">
          <pre
            class="sourceCode yaml"
          ><code class="sourceCode yaml"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="fu">analyze:</span></a>
<a class="sourceLine" id="cb1-3" title="3">    ...</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="fu">strategy:</span></a>
<a class="sourceLine" id="cb1-5" title="5">      <span class="fu">fail-fast:</span><span class="at"> </span><span class="ch">false</span></a>
<a class="sourceLine" id="cb1-6" title="6">      <span class="fu">matrix:</span></a>
<a class="sourceLine" id="cb1-7" title="7">        <span class="fu">language:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;csharp&#39;</span><span class="kw">,</span> <span class="st">&#39;cpp&#39;</span><span class="kw">,</span> <span class="st">&#39;javascript&#39;</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9">    ...</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Initialize {% data variables.product.prodname_codeql %}</span></a>
<a class="sourceLine" id="cb1-12" title="12">      <span class="fu">uses:</span><span class="at"> github/codeql-action/init@v1</span></a>
<a class="sourceLine" id="cb1-13" title="13">      <span class="fu">with:</span></a>
<a class="sourceLine" id="cb1-14" title="14">        <span class="fu">languages:</span><span class="at"> </span><span class="kw">{</span>% raw %<span class="kw">}</span><span class="at">${{ matrix.language }}{% endraw %}</span></a></code></pre>
        </div>
        <p>
          For more information about editing the workflow, see “<a
            href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-code-scanning"
            >Configuring code scanning</a
          >.”
        </p>
      </li>
    </ul>
    <h2 id="no-code-found-during-the-build">No code found during the build</h2>
    <p>
      If your workflow fails with an error
      <code>No source code was seen during the build</code> or
      <code
        >The process
        '/opt/hostedtoolcache/CodeQL/0.0.0-20200630/x64/codeql/codeql' failed
        with exit code 32</code
      >, this indicates that {% data variables.product.prodname_codeql %} was
      unable to monitor your code. Several reasons can explain such a failure:
    </p>
    <ol type="1">
      <li>
        Automatic language detection identified a supported language, but there
        is no analyzable code of that language in the repository. A typical
        example is when our language detection service finds a file associated
        with a particular programming language like a <code>.h</code>, or
        <code>.gyp</code> file, but no corresponding executable code is present
        in the repository. To solve the problem, you can manually define the
        languages you want to analyze by updating the list of languages in the
        <code>language</code> matrix. For example, the following configuration
        will analyze only Go, and JavaScript.
      </li>
    </ol>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode yaml"
      ><code class="sourceCode yaml"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">strategy:</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="fu">fail-fast:</span><span class="at"> </span><span class="ch">false</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="fu">matrix:</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="co"># Override automatic language detection by changing the list below</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="co"># Supported options are:</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="co"># [&#39;csharp&#39;, &#39;cpp&#39;, &#39;go&#39;, &#39;java&#39;, &#39;javascript&#39;, &#39;python&#39;]</span></a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="fu">language:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;go&#39;</span><span class="kw">,</span> <span class="st">&#39;javascript&#39;</span><span class="kw">]</span></a></code></pre>
    </div>
    <p>
      For more information, see the workflow extract in “<a
        href="#automatic-build-for-a-compiled-language-fails"
        >Automatic build for a compiled language fails</a
      >” above. 1. Your {% data variables.product.prodname_code_scanning %}
      workflow is analyzing a compiled language (C, C++, C#, or Java), but the
      code was not compiled. By default, the {% data
      variables.product.prodname_codeql %} analysis workflow contains an
      <code>autobuild</code> step, however, this step represents a best effort
      process, and may not succeed in building your code, depending on your
      specific build environment. Compilation may also fail if you have removed
      the <code>autobuild</code> step and did not include build steps manually.
      For more information about specifying build steps, see “<a
        href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-the-codeql-workflow-for-compiled-languages#adding-build-steps-for-a-compiled-language"
        >Configuring the {% data variables.product.prodname_codeql %} workflow
        for compiled languages</a
      >.” 1. Your workflow is analyzing a compiled language (C, C++, C#, or
      Java), but portions of your build are cached to improve performance (most
      likely to occur with build systems like Gradle or Bazel). Since {% data
      variables.product.prodname_codeql %} observes the activity of the compiler
      to understand the data flows in a repository, {% data
      variables.product.prodname_codeql %} requires a complete build to take
      place in order to perform analysis. 1. Your workflow is analyzing a
      compiled language (C, C++, C#, or Java), but compilation does not occur
      between the <code>init</code> and <code>analyze</code> steps in the
      workflow. {% data variables.product.prodname_codeql %} requires that your
      build happens in between these two steps in order to observe the activity
      of the compiler and perform analysis. 1. Your compiled code (in C, C++,
      C#, or Java) was compiled successfully, but {% data
      variables.product.prodname_codeql %} was unable to detect the compiler
      invocations. The most common causes are:
    </p>
    <ul>
      <li>
        Running your build process in a separate container to {% data
        variables.product.prodname_codeql %}. For more information, see “<a
          href="/github/finding-security-vulnerabilities-and-errors-in-your-code/running-codeql-code-scanning-in-a-container"
          >Running CodeQL code scanning in a container</a
        >.”
      </li>
      <li>
        Building using a distributed build system external to GitHub Actions,
        using a daemon process.
      </li>
      <li>
        {% data variables.product.prodname_codeql %} isn’t aware of the specific
        compiler you are using.
      </li>
    </ul>
    <p>
      For .NET Framework projects, and for C# projects using either
      <code>dotnet build</code> or <code>msbuild</code> that target .NET Core 2,
      you should specify <code>/p:UseSharedCompilation=false</code> in your
      workflow’s <code>run</code> step, when you build your code. The
      <code>UseSharedCompilation</code> flag isn’t necessary for .NET Core 3.0
      and later.
    </p>
    <p>
      For example, the following configuration for C# will pass the flag during
      the first build step.
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode yaml"
      ><code class="sourceCode yaml"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">- </span><span class="fu">run:</span><span class="at"> </span><span class="st">|</span></a>
<a class="sourceLine" id="cb3-2" title="2">    dotnet build /p:UseSharedCompilation=false </a></code></pre>
    </div>
    <p>
      If you encounter another problem with your specific compiler or
      configuration, contact {% data variables.contact.contact_support %}.
    </p>
    <p>
      For more information about specifying build steps, see “<a
        href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-the-codeql-workflow-for-compiled-languages#adding-build-steps-for-a-compiled-language"
        >Configuring the {% data variables.product.prodname_codeql %} workflow
        for compiled languages</a
      >.”
    </p>
    <h2 id="portions-of-my-repository-were-not-analyzed-using-autobuild">
      Portions of my repository were not analyzed using <code>autobuild</code>
    </h2>
    <p>
      The {% data variables.product.prodname_codeql %}
      <code>autobuild</code> feature uses heuristics to build the code in a
      repository, however, sometimes this approach results in incomplete
      analysis of a repository. For example, when multiple
      <code>build.sh</code> commands exist in a single repository, the analysis
      may not complete since the <code>autobuild</code> step will only execute
      one of the commands. The solution is to replace the
      <code>autobuild</code> step with build steps which build all of the source
      code which you wish to analyze. For more information, see “<a
        href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-the-codeql-workflow-for-compiled-languages#adding-build-steps-for-a-compiled-language"
        >Configuring the {% data variables.product.prodname_codeql %} workflow
        for compiled languages</a
      >.”
    </p>
    <h2 id="the-build-takes-too-long">The build takes too long</h2>
    <p>
      If your build with {% data variables.product.prodname_codeql %} analysis
      takes too long to run, there are several approaches you can try to reduce
      the build time.
    </p>
    <h3 id="increase-the-memory-or-cores">Increase the memory or cores</h3>
    <p>
      If you use self-hosted runners to run {% data
      variables.product.prodname_codeql %} analysis, you can increase the memory
      or the number of cores on those runners.
    </p>
    <h3 id="use-matrix-builds-to-parallelize-the-analysis">
      Use matrix builds to parallelize the analysis
    </h3>
    <p>
      The default {% data variables.product.prodname_codeql_workflow %} uses a
      build matrix of languages, which causes the analysis of each language to
      run in parallel. If you have specified the languages you want to analyze
      directly in the “Initialize CodeQL” step, analysis of each language will
      happen sequentially. To speed up analysis of multiple languages, modify
      your workflow to use a matrix. For more information, see the workflow
      extract in “<a href="#automatic-build-for-a-compiled-language-fails"
        >Automatic build for a compiled language fails</a
      >” above.
    </p>
    <h3 id="reduce-the-amount-of-code-being-analyzed-in-a-single-workflow">
      Reduce the amount of code being analyzed in a single workflow
    </h3>
    <p>
      Analysis time is typically proportional to the amount of code being
      analyzed. You can reduce the analysis time by reducing the amount of code
      being analyzed at once, for example, by excluding test code, or breaking
      analysis into multiple workflows that analyze only a subset of your code
      at a time.
    </p>
    <p>
      For compiled languages like Java, C, C++, and C#, {% data
      variables.product.prodname_codeql %} analyzes all of the code which was
      built during the workflow run. To limit the amount of code being analyzed,
      build only the code which you wish to analyze by specifying your own build
      steps in a <code>run</code> block. You can combine specifying your own
      build steps with using the <code>paths</code> or
      <code>paths-ignore</code> filters on the <code>pull_request</code> and
      <code>push</code> events to ensure that your workflow only runs when
      specific code is changed. For more information, see “<a
        href="/actions/reference/workflow-syntax-for-github-actions#onpushpull_requestpaths"
        >Workflow syntax for {% data variables.product.prodname_actions %}</a
      >.”
    </p>
    <p>
      For interpreted languages like Go, JavaScript, Python, and TypeScript,
      that {% data variables.product.prodname_codeql %} analyzes without a
      specific build, you can specify additional configuration options to limit
      the amount of code to analyze. For more information, see “<a
        href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-code-scanning#specifying-directories-to-scan"
        >Specifying directories to scan</a
      >.”
    </p>
    <p>
      If you split your analysis into multiple workflows as described above, we
      still recommend that you have at least one workflow which runs on a
      <code>schedule</code> which analyzes all of the code in your repository.
      Because {% data variables.product.prodname_codeql %} analyzes data flows
      between components, some complex security behaviors may only be detected
      on a complete build.
    </p>
    <h3 id="run-only-during-a-schedule-event">
      Run only during a <code>schedule</code> event
    </h3>
    <p>
      If your analysis is still too slow to be run during <code>push</code> or
      <code>pull_request</code> events, then you may want to only trigger
      analysis on the <code>schedule</code> event. For more information, see “<a
        href="/actions/learn-github-actions/introduction-to-github-actions#events"
        >Events</a
      >.”
    </p>
    <h2 id="error-server-error">Error: “Server error”</h2>
    <p>
      If the run of a workflow for {% data
      variables.product.prodname_code_scanning %} fails due to a server error,
      try running the workflow again. If the problem persists, contact {% data
      variables.contact.contact_support %}.
    </p>
    <h2 id="error-out-of-disk-or-out-of-memory">
      Error: “Out of disk” or “Out of memory”
    </h2>
    <p>
      On very large projects, {% data variables.product.prodname_codeql %} may
      run out of disk or memory on the runner. If you encounter this issue, try
      increasing the memory on the runner.
    </p>
    <h2 id="warning-git-checkout-head2-is-no-longer-necessary">
      Warning: “git checkout HEAD^2 is no longer necessary”
    </h2>
    <p>
      If you’re using an old {% data variables.product.prodname_codeql %}
      workflow you may get the following warning in the output from the
      “Initialize {% data variables.product.prodname_codeql %}” action:
    </p>
    <pre><code>Warning: 1 issue was detected with this workflow: git checkout HEAD^2 is no longer 
necessary. Please remove this step as Code Scanning recommends analyzing the merge 
commit for best results.</code></pre>
    <p>
      Fix this by removing the following lines from the {% data
      variables.product.prodname_codeql %} workflow. These lines were included
      in the <code>steps</code> section of the <code>Analyze</code> job in
      initial versions of the {% data variables.product.prodname_codeql %}
      workflow.
    </p>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode yaml"
      ><code class="sourceCode yaml"><a class="sourceLine" id="cb5-1" title="1">        <span class="fu">with:</span></a>
<a class="sourceLine" id="cb5-2" title="2">          <span class="co"># We must fetch at least the immediate parents so that if this is</span></a>
<a class="sourceLine" id="cb5-3" title="3">          <span class="co"># a pull request then we can checkout the head.</span></a>
<a class="sourceLine" id="cb5-4" title="4">          <span class="fu">fetch-depth:</span><span class="at"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">      <span class="co"># If this run was triggered by a pull request event, then checkout</span></a>
<a class="sourceLine" id="cb5-7" title="7">      <span class="co"># the head of the pull request instead of the merge commit.</span></a>
<a class="sourceLine" id="cb5-8" title="8">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> git checkout HEAD^2</span></a>
<a class="sourceLine" id="cb5-9" title="9">        <span class="fu">if:</span><span class="at"> </span><span class="kw">{</span>% raw %<span class="kw">}</span><span class="at">${{ github.event_name == &#39;pull_request&#39; }}{% endraw %}</span></a></code></pre>
    </div>
    <p>
      The revised <code>steps</code> section of the workflow will look like
      this:
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode yaml"
      ><code class="sourceCode yaml"><a class="sourceLine" id="cb6-1" title="1">    <span class="fu">steps:</span></a>
<a class="sourceLine" id="cb6-2" title="2">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Checkout repository</span></a>
<a class="sourceLine" id="cb6-3" title="3">        <span class="fu">uses:</span><span class="at"> actions/checkout@v2</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5">      <span class="co"># Initializes the {% data variables.product.prodname_codeql %} tools for scanning.</span></a>
<a class="sourceLine" id="cb6-6" title="6">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Initialize {% data variables.product.prodname_codeql %}</span></a>
<a class="sourceLine" id="cb6-7" title="7">        <span class="fu">uses:</span><span class="at"> github/codeql-action/init@v1</span></a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9">      ...</a></code></pre>
    </div>
    <p>
      For more information about editing the {% data
      variables.product.prodname_codeql %} workflow file, see “<a
        href="/github/finding-security-vulnerabilities-and-errors-in-your-code/configuring-code-scanning#editing-a-code-scanning-workflow"
        >Configuring {% data variables.product.prodname_code_scanning %}</a
      >.”
    </p>
  </body>
</html>
