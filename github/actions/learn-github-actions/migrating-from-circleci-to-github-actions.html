<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>Migrating from CircleCI to GitHub Actions</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Migrating from CircleCI to GitHub Actions</h1>
    </header>
    <p>
      {% data reusables.actions.enterprise-beta %} {% data
      reusables.actions.enterprise-github-hosted-runners %} {% data
      reusables.actions.ae-beta %}
    </p>
    <h2 id="introduction">Introduction</h2>
    <p>
      CircleCI and {% data variables.product.prodname_actions %} both allow you
      to create workflows that automatically build, test, publish, release, and
      deploy code. CircleCI and {% data variables.product.prodname_actions %}
      share some similarities in workflow configuration:
    </p>
    <ul>
      <li>
        Workflow configuration files are written in YAML and stored in the
        repository.
      </li>
      <li>Workflows include one or more jobs.</li>
      <li>Jobs include one or more steps or individual commands.</li>
      <li>Steps or tasks can be reused and shared with the community.</li>
    </ul>
    <p>
      For more information, see “<a
        href="/actions/getting-started-with-github-actions/core-concepts-for-github-actions"
        >Core concepts for {% data variables.product.prodname_actions %}</a
      >.”
    </p>
    <h2 id="key-differences">Key differences</h2>
    <p>When migrating from CircleCI, consider the following differences:</p>
    <ul>
      <li>
        CircleCI’s automatic test parallelism automatically groups tests
        according to user-specified rules or historical timing information. This
        functionality is not built into {% data
        variables.product.prodname_actions %}.
      </li>
      <li>
        Actions that execute in Docker containers are sensitive to permissions
        problems since containers have a different mapping of users. You can
        avoid many of these problems by not using the
        <code>USER</code> instruction in your <em>Dockerfile</em>. {% ifversion
        ghae %}For instructions on how to make sure your {% data
        variables.actions.hosted_runner %} has the required software installed,
        see “<a
          href="/actions/using-github-hosted-runners/creating-custom-images"
          >Creating custom images</a
        >.”. {% else %}For more information about the Docker filesystem on {%
        data variables.product.product_name %}-hosted runners, see “<a
          href="/actions/reference/virtual-environments-for-github-hosted-runners#docker-container-filesystem"
          >Virtual environments for {% data variables.product.product_name
          %}-hosted runners</a
        >.” {% endif %}
      </li>
    </ul>
    <h2 id="migrating-workflows-and-jobs">Migrating workflows and jobs</h2>
    <p>
      CircleCI defines <code>workflows</code> in the <em>config.yml</em> file,
      which allows you to configure more than one workflow. {% data
      variables.product.product_name %} requires one workflow file per workflow,
      and as a consequence, does not require you to declare
      <code>workflows</code>. You’ll need to create a new workflow file for each
      workflow configured in <em>config.yml</em>.
    </p>
    <p>
      Both CircleCI and {% data variables.product.prodname_actions %} configure
      <code>jobs</code> in the configuration file using similar syntax. If you
      configure any dependencies between jobs using <code>requires</code> in
      your CircleCI workflow, you can use the equivalent {% data
      variables.product.prodname_actions %} <code>needs</code> syntax. For more
      information, see “<a
        href="/actions/reference/workflow-syntax-for-github-actions#jobsjob_idneeds"
        >Workflow syntax for {% data variables.product.prodname_actions %}</a
      >.”
    </p>
    <h2 id="migrating-orbs-to-actions">Migrating orbs to actions</h2>
    <p>
      Both CircleCI and {% data variables.product.prodname_actions %} provide a
      mechanism to reuse and share tasks in a workflow. CircleCI uses a concept
      called orbs, written in YAML, to provide tasks that people can reuse in a
      workflow. {% data variables.product.prodname_actions %} has powerful and
      flexible reusable components called actions, which you build with either
      JavaScript files or Docker images. You can create actions by writing
      custom code that interacts with your repository in any way you’d like,
      including integrating with {% data variables.product.product_name %}’s
      APIs and any publicly available third-party API. For example, an action
      can publish npm modules, send SMS alerts when urgent issues are created,
      or deploy production-ready code. For more information, see “<a
        href="/actions/creating-actions"
        >Creating actions</a
      >.”
    </p>
    <p>
      CircleCI can reuse pieces of workflows with YAML anchors and aliases. {%
      data variables.product.prodname_actions %} supports the most common need
      for reusability using build matrixes. For more information about build
      matrixes, see “<a
        href="/actions/learn-github-actions/managing-complex-workflows/#using-a-build-matrix"
        >Managing complex workflows</a
      >.”
    </p>
    <h2 id="using-docker-images">Using Docker images</h2>
    <p>
      Both CircleCI and {% data variables.product.prodname_actions %} support
      running steps inside of a Docker image.
    </p>
    <p>
      CircleCI provides a set of pre-built images with common dependencies.
      These images have the <code>USER</code> set to <code>circleci</code>,
      which causes permissions to conflict with {% data
      variables.product.prodname_actions %}.
    </p>
    <p>
      We recommend that you move away from CircleCI’s pre-built images when you
      migrate to {% data variables.product.prodname_actions %}. In many cases,
      you can use actions to install the additional dependencies you need.
    </p>
    <p>
      {% ifversion ghae %} For more information about the Docker filesystem, see
      “<a
        href="/actions/using-github-hosted-runners/about-ae-hosted-runners#docker-container-filesystem"
        >Docker container filesystem</a
      >.”
    </p>
    <p>
      For instructions on how to make sure your {% data
      variables.actions.hosted_runner %} has the required software installed,
      see “<a href="/actions/using-github-hosted-runners/creating-custom-images"
        >Creating custom images</a
      >.” {% else %} For more information about the Docker filesystem, see “<a
        href="/actions/reference/virtual-environments-for-github-hosted-runners#docker-container-filesystem"
        >Virtual environments for {% data variables.product.product_name
        %}-hosted runners</a
      >.”
    </p>
    <p>
      For more information about the tools and packages available on {% data
      variables.product.prodname_dotcom %}-hosted virtual environments, see “<a
        href="/actions/reference/specifications-for-github-hosted-runners/#supported-software"
        >Specifications for {% data variables.product.prodname_dotcom %}-hosted
        runners</a
      >”. {% endif %}
    </p>
    <h2 id="using-variables-and-secrets">Using variables and secrets</h2>
    <p>
      CircleCI and {% data variables.product.prodname_actions %} support setting
      environment variables in the configuration file and creating secrets using
      the CircleCI or {% data variables.product.product_name %} UI.
    </p>
    <p>
      For more information, see “<a
        href="/actions/configuring-and-managing-workflows/using-environment-variables"
        >Using environment variables</a
      >” and “<a
        href="/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets"
        >Creating and using encrypted secrets</a
      >.”
    </p>
    <h2 id="caching">Caching</h2>
    <p>
      CircleCI and {% data variables.product.prodname_actions %} provide a
      method to manually cache files in the configuration file.
    </p>
    <p>Below is an example of the syntax for each system.</p>
    <table class="d-block">
      <tr>
        <th>CircleCI</th>
        <th>GitHub Actions</th>
      </tr>
      <tr>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb1">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">-</span> <span class="fu">restore_cache:</span></a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="fu">keys:</span></a>
<a class="sourceLine" id="cb1-3" title="3">      <span class="kw">-</span> v1-npm-deps-<span class="kw">{</span>{ checksum <span class="st">&quot;package-lock.json&quot;</span> <span class="kw">}</span>}</a>
<a class="sourceLine" id="cb1-4" title="4">      <span class="kw">-</span> v1-npm-deps-</a></code></pre>
          </div>
          {% endraw %}
        </td>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb2">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">-</span> <span class="fu">name:</span><span class="at"> Cache node modules</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="fu">uses:</span><span class="at"> actions/cache@v2</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="fu">with:</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="fu">path:</span><span class="at"> ~/.npm</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="fu">key:</span><span class="at"> v1-npm-deps-${{ hashFiles(&#39;**/package-lock.json&#39;) }}</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="fu">restore-keys:</span><span class="at"> v1-npm-deps-</span></a></code></pre>
          </div>
          {% endraw %}
        </td>
      </tr>
    </table>
    <p>
      {% data variables.product.prodname_actions %} caching is only applicable
      for repositories hosted on {% data
      variables.product.prodname_dotcom_the_website %}. For more information,
      see “<a
        href="/actions/guides/caching-dependencies-to-speed-up-workflows"
        class="dotcom-only"
        >Caching dependencies to speed up workflows</a
      >.”
    </p>
    <p>
      {% data variables.product.prodname_actions %} does not have an equivalent
      of CircleCI’s Docker Layer Caching (or DLC).
    </p>
    <h2 id="persisting-data-between-jobs">Persisting data between jobs</h2>
    <p>
      Both CircleCI and {% data variables.product.prodname_actions %} provide
      mechanisms to persist data between jobs.
    </p>
    <p>
      Below is an example in CircleCI and {% data
      variables.product.prodname_actions %} configuration syntax.
    </p>
    <table>
      <tr>
        <th>CircleCI</th>
        <th>GitHub Actions</th>
      </tr>
      <tr>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb3">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">-</span> <span class="fu">persist_to_workspace:</span></a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="fu">root:</span><span class="at"> workspace</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="fu">paths:</span></a>
<a class="sourceLine" id="cb3-4" title="4">      <span class="kw">-</span> math-homework.txt</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">...</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">- attach_workspace:</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">    at: /tmp/workspace</span></a></code></pre>
          </div>
          {% endraw %}
        </td>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb4">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">-</span> <span class="fu">name:</span><span class="at"> Upload math result for job 1</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="fu">uses:</span><span class="at"> actions/upload-artifact@v2</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="fu">with:</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="fu">name:</span><span class="at"> homework</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="fu">path:</span><span class="at"> math-homework.txt</span></a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">...</span></a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">- name: Download math result for job 1</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">  uses: actions/download-artifact@v2</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">  with:</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">    name: homework</span></a></code></pre>
          </div>
          {% endraw %}
        </td>
      </tr>
    </table>
    <p>
      For more information, see “<a
        href="/actions/configuring-and-managing-workflows/persisting-workflow-data-using-artifacts"
        >Persisting workflow data using artifacts</a
      >.”
    </p>
    <h2 id="using-databases-and-service-containers">
      Using databases and service containers
    </h2>
    <p>
      Both systems enable you to include additional containers for databases,
      caching, or other dependencies.
    </p>
    <p>
      In CircleCI, the first image listed in the <em>config.yaml</em> is the
      primary image used to run commands. {% data
      variables.product.prodname_actions %} uses explicit sections: use
      <code>container</code> for the primary container, and list additional
      containers in <code>services</code>.
    </p>
    <p>
      Below is an example in CircleCI and {% data
      variables.product.prodname_actions %} configuration syntax.
    </p>
    <table class="d-block">
      <tr>
        <th>CircleCI</th>
        <th>GitHub Actions</th>
      </tr>
      <tr>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb5">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb5-1" title="1"><span class="ot">---</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="fu">version:</span><span class="at"> </span><span class="fl">2.1</span></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="fu">ruby-26:</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="fu">docker:</span></a>
<a class="sourceLine" id="cb5-8" title="8">      <span class="kw">-</span> <span class="fu">image:</span><span class="at"> circleci/ruby:2.6.3-node-browsers-legacy</span></a>
<a class="sourceLine" id="cb5-9" title="9">        <span class="fu">environment:</span></a>
<a class="sourceLine" id="cb5-10" title="10">          <span class="fu">PGHOST:</span><span class="at"> localhost</span></a>
<a class="sourceLine" id="cb5-11" title="11">          <span class="fu">PGUSER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb5-12" title="12">          <span class="fu">RAILS_ENV:</span><span class="at"> test</span></a>
<a class="sourceLine" id="cb5-13" title="13">      <span class="kw">-</span> <span class="fu">image:</span><span class="at"> postgres:10.1-alpine</span></a>
<a class="sourceLine" id="cb5-14" title="14">        <span class="fu">environment:</span></a>
<a class="sourceLine" id="cb5-15" title="15">          <span class="fu">POSTGRES_USER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb5-16" title="16">          <span class="fu">POSTGRES_DB:</span><span class="at"> ruby26</span></a>
<a class="sourceLine" id="cb5-17" title="17">          <span class="fu">POSTGRES_PASSWORD:</span><span class="at"> </span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb5-18" title="18"></a>
<a class="sourceLine" id="cb5-19" title="19">    <span class="fu">working_directory:</span><span class="at"> ~/administrate</span></a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21">    <span class="fu">steps:</span></a>
<a class="sourceLine" id="cb5-22" title="22">      <span class="kw">-</span> checkout</a>
<a class="sourceLine" id="cb5-23" title="23"></a>
<a class="sourceLine" id="cb5-24" title="24">      <span class="co"># Bundle install dependencies</span></a>
<a class="sourceLine" id="cb5-25" title="25">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle install --path vendor/bundle</span></a>
<a class="sourceLine" id="cb5-26" title="26"></a>
<a class="sourceLine" id="cb5-27" title="27">      <span class="co"># Wait for DB</span></a>
<a class="sourceLine" id="cb5-28" title="28">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> dockerize -wait tcp://localhost:5432 -timeout 1m</span></a>
<a class="sourceLine" id="cb5-29" title="29"></a>
<a class="sourceLine" id="cb5-30" title="30">      <span class="co"># Setup the environment</span></a>
<a class="sourceLine" id="cb5-31" title="31">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> cp .sample.env .env</span></a>
<a class="sourceLine" id="cb5-32" title="32"></a>
<a class="sourceLine" id="cb5-33" title="33">      <span class="co"># Setup the database</span></a>
<a class="sourceLine" id="cb5-34" title="34">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle exec rake db:setup</span></a>
<a class="sourceLine" id="cb5-35" title="35"></a>
<a class="sourceLine" id="cb5-36" title="36">      <span class="co"># Run the tests</span></a>
<a class="sourceLine" id="cb5-37" title="37">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle exec rake</span></a>
<a class="sourceLine" id="cb5-38" title="38"></a>
<a class="sourceLine" id="cb5-39" title="39"></a>
<a class="sourceLine" id="cb5-40" title="40"><span class="fu">workflows:</span></a>
<a class="sourceLine" id="cb5-41" title="41">  <span class="fu">version:</span><span class="at"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-42" title="42">  <span class="fu">build:</span></a>
<a class="sourceLine" id="cb5-43" title="43">    <span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb5-44" title="44">      <span class="kw">-</span> ruby-26</a>
<a class="sourceLine" id="cb5-45" title="45"><span class="co">...</span></a>
<a class="sourceLine" id="cb5-46" title="46"></a>
<a class="sourceLine" id="cb5-47" title="47"><span class="co">- attach_workspace:</span></a>
<a class="sourceLine" id="cb5-48" title="48"><span class="co">    at: /tmp/workspace</span></a></code></pre>
          </div>
          {% endraw %}
        </td>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb6">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">name:</span><span class="at"> Containers</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="fu">on:</span><span class="at"> </span><span class="kw">[</span>push<span class="kw">]</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="fu">build:</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="fu">runs-on:</span><span class="at"> ubuntu-latest</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="fu">container:</span><span class="at"> circleci/ruby:2.6.3-node-browsers-legacy</span></a>
<a class="sourceLine" id="cb6-10" title="10"></a>
<a class="sourceLine" id="cb6-11" title="11">    <span class="fu">env:</span></a>
<a class="sourceLine" id="cb6-12" title="12">      <span class="fu">PGHOST:</span><span class="at"> postgres</span></a>
<a class="sourceLine" id="cb6-13" title="13">      <span class="fu">PGUSER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb6-14" title="14">      <span class="fu">RAILS_ENV:</span><span class="at"> test</span></a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="fu">services:</span></a>
<a class="sourceLine" id="cb6-17" title="17">      <span class="fu">postgres:</span></a>
<a class="sourceLine" id="cb6-18" title="18">        <span class="fu">image:</span><span class="at"> postgres:10.1-alpine</span></a>
<a class="sourceLine" id="cb6-19" title="19">        <span class="fu">env:</span></a>
<a class="sourceLine" id="cb6-20" title="20">          <span class="fu">POSTGRES_USER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb6-21" title="21">          <span class="fu">POSTGRES_DB:</span><span class="at"> ruby25</span></a>
<a class="sourceLine" id="cb6-22" title="22">          <span class="fu">POSTGRES_PASSWORD:</span><span class="at"> </span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb6-23" title="23">        <span class="fu">ports:</span></a>
<a class="sourceLine" id="cb6-24" title="24">          <span class="kw">-</span> 5432:5432</a>
<a class="sourceLine" id="cb6-25" title="25">        <span class="co"># Add a health check</span></a>
<a class="sourceLine" id="cb6-26" title="26">        <span class="fu">options:</span><span class="at"> --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5</span></a>
<a class="sourceLine" id="cb6-27" title="27"></a>
<a class="sourceLine" id="cb6-28" title="28">    <span class="fu">steps:</span></a>
<a class="sourceLine" id="cb6-29" title="29">      <span class="co"># This Docker file changes sets USER to circleci instead of using the default user, so we need to update file permissions for this image to work on GH Actions.</span></a>
<a class="sourceLine" id="cb6-30" title="30">      <span class="co"># See https://docs.github.com/actions/reference/virtual-environments-for-github-hosted-runners#docker-container-filesystem</span></a>
<a class="sourceLine" id="cb6-31" title="31">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Setup file system permissions</span></a>
<a class="sourceLine" id="cb6-32" title="32">        <span class="fu">run:</span><span class="at"> sudo chmod -R 777 $GITHUB_WORKSPACE /github /__w/_temp</span></a>
<a class="sourceLine" id="cb6-33" title="33">      <span class="kw">-</span> <span class="fu">uses:</span><span class="at"> actions/checkout@v2</span></a>
<a class="sourceLine" id="cb6-34" title="34">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Install dependencies</span></a>
<a class="sourceLine" id="cb6-35" title="35">        <span class="fu">run:</span><span class="at"> bundle install --path vendor/bundle</span></a>
<a class="sourceLine" id="cb6-36" title="36">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Setup environment configuration</span></a>
<a class="sourceLine" id="cb6-37" title="37">        <span class="fu">run:</span><span class="at"> cp .sample.env .env</span></a>
<a class="sourceLine" id="cb6-38" title="38">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Setup database</span></a>
<a class="sourceLine" id="cb6-39" title="39">        <span class="fu">run:</span><span class="at"> bundle exec rake db:setup</span></a>
<a class="sourceLine" id="cb6-40" title="40">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Run tests</span></a>
<a class="sourceLine" id="cb6-41" title="41">        <span class="fu">run:</span><span class="at"> bundle exec rake</span></a></code></pre>
          </div>
          {% endraw %}
        </td>
      </tr>
    </table>
    <p>
      For more information, see “<a
        href="/actions/configuring-and-managing-workflows/about-service-containers"
        >About service containers</a
      >.”
    </p>
    <h2 id="complete-example">Complete Example</h2>
    <p>
      Below is a real-world example. The left shows the actual CircleCI
      <em>config.yml</em> for the
      <a href="https://github.com/thoughtbot/administrate"
        >thoughtbot/administrator</a
      >
      repository. The right shows the {% data variables.product.prodname_actions
      %} equivalent.
    </p>
    <table class="d-block">
      <tr>
        <th>CircleCI</th>
        <th>GitHub Actions</th>
      </tr>
      <tr>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb7">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb7-1" title="1"><span class="ot">---</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="fu">version:</span><span class="at"> </span><span class="fl">2.1</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="fu">commands:</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="fu">shared_steps:</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="fu">steps:</span></a>
<a class="sourceLine" id="cb7-7" title="7">      <span class="kw">-</span> checkout</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9">      <span class="co"># Restore Cached Dependencies</span></a>
<a class="sourceLine" id="cb7-10" title="10">      <span class="kw">-</span> <span class="fu">restore_cache:</span></a>
<a class="sourceLine" id="cb7-11" title="11">          <span class="fu">name:</span><span class="at"> Restore bundle cache</span></a>
<a class="sourceLine" id="cb7-12" title="12">          <span class="fu">key:</span><span class="at"> administrate-{{ checksum &quot;Gemfile.lock&quot; }}</span></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">      <span class="co"># Bundle install dependencies</span></a>
<a class="sourceLine" id="cb7-15" title="15">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle install --path vendor/bundle</span></a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">      <span class="co"># Cache Dependencies</span></a>
<a class="sourceLine" id="cb7-18" title="18">      <span class="kw">-</span> <span class="fu">save_cache:</span></a>
<a class="sourceLine" id="cb7-19" title="19">          <span class="fu">name:</span><span class="at"> Store bundle cache</span></a>
<a class="sourceLine" id="cb7-20" title="20">          <span class="fu">key:</span><span class="at"> administrate-{{ checksum &quot;Gemfile.lock&quot; }}</span></a>
<a class="sourceLine" id="cb7-21" title="21">          <span class="fu">paths:</span></a>
<a class="sourceLine" id="cb7-22" title="22">            <span class="kw">-</span> vendor/bundle</a>
<a class="sourceLine" id="cb7-23" title="23"></a>
<a class="sourceLine" id="cb7-24" title="24">      <span class="co"># Wait for DB</span></a>
<a class="sourceLine" id="cb7-25" title="25">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> dockerize -wait tcp://localhost:5432 -timeout 1m</span></a>
<a class="sourceLine" id="cb7-26" title="26"></a>
<a class="sourceLine" id="cb7-27" title="27">      <span class="co"># Setup the environment</span></a>
<a class="sourceLine" id="cb7-28" title="28">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> cp .sample.env .env</span></a>
<a class="sourceLine" id="cb7-29" title="29"></a>
<a class="sourceLine" id="cb7-30" title="30">      <span class="co"># Setup the database</span></a>
<a class="sourceLine" id="cb7-31" title="31">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle exec rake db:setup</span></a>
<a class="sourceLine" id="cb7-32" title="32"></a>
<a class="sourceLine" id="cb7-33" title="33">      <span class="co"># Run the tests</span></a>
<a class="sourceLine" id="cb7-34" title="34">      <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle exec rake</span></a>
<a class="sourceLine" id="cb7-35" title="35"></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="fu">default_job:</span><span class="at"> </span><span class="dt">&amp;default_job</span></a>
<a class="sourceLine" id="cb7-37" title="37">  <span class="fu">working_directory:</span><span class="at"> ~/administrate</span></a>
<a class="sourceLine" id="cb7-38" title="38">  <span class="fu">steps:</span></a>
<a class="sourceLine" id="cb7-39" title="39">    <span class="kw">-</span> shared_steps</a>
<a class="sourceLine" id="cb7-40" title="40">    <span class="co"># Run the tests against multiple versions of Rails</span></a>
<a class="sourceLine" id="cb7-41" title="41">    <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle exec appraisal install</span></a>
<a class="sourceLine" id="cb7-42" title="42">    <span class="kw">-</span> <span class="fu">run:</span><span class="at"> bundle exec appraisal rake</span></a>
<a class="sourceLine" id="cb7-43" title="43"></a>
<a class="sourceLine" id="cb7-44" title="44"><span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb7-45" title="45">  <span class="fu">ruby-25:</span></a>
<a class="sourceLine" id="cb7-46" title="46">    <span class="fu">&lt;&lt;:</span><span class="at"> </span><span class="dt">*default_job</span></a>
<a class="sourceLine" id="cb7-47" title="47">    <span class="fu">docker:</span></a>
<a class="sourceLine" id="cb7-48" title="48">      <span class="kw">-</span> <span class="fu">image:</span><span class="at"> circleci/ruby:2.5.0-node-browsers</span></a>
<a class="sourceLine" id="cb7-49" title="49">        <span class="fu">environment:</span></a>
<a class="sourceLine" id="cb7-50" title="50">          <span class="fu">PGHOST:</span><span class="at"> localhost</span></a>
<a class="sourceLine" id="cb7-51" title="51">          <span class="fu">PGUSER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb7-52" title="52">          <span class="fu">RAILS_ENV:</span><span class="at"> test</span></a>
<a class="sourceLine" id="cb7-53" title="53">      <span class="kw">-</span> <span class="fu">image:</span><span class="at"> postgres:10.1-alpine</span></a>
<a class="sourceLine" id="cb7-54" title="54">        <span class="fu">environment:</span></a>
<a class="sourceLine" id="cb7-55" title="55">          <span class="fu">POSTGRES_USER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb7-56" title="56">          <span class="fu">POSTGRES_DB:</span><span class="at"> ruby25</span></a>
<a class="sourceLine" id="cb7-57" title="57">          <span class="fu">POSTGRES_PASSWORD:</span><span class="at"> </span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb7-58" title="58"></a>
<a class="sourceLine" id="cb7-59" title="59">  <span class="fu">ruby-26:</span></a>
<a class="sourceLine" id="cb7-60" title="60">    <span class="fu">&lt;&lt;:</span><span class="at"> </span><span class="dt">*default_job</span></a>
<a class="sourceLine" id="cb7-61" title="61">    <span class="fu">docker:</span></a>
<a class="sourceLine" id="cb7-62" title="62">      <span class="kw">-</span> <span class="fu">image:</span><span class="at"> circleci/ruby:2.6.3-node-browsers-legacy</span></a>
<a class="sourceLine" id="cb7-63" title="63">        <span class="fu">environment:</span></a>
<a class="sourceLine" id="cb7-64" title="64">          <span class="fu">PGHOST:</span><span class="at"> localhost</span></a>
<a class="sourceLine" id="cb7-65" title="65">          <span class="fu">PGUSER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb7-66" title="66">          <span class="fu">RAILS_ENV:</span><span class="at"> test</span></a>
<a class="sourceLine" id="cb7-67" title="67">      <span class="kw">-</span> <span class="fu">image:</span><span class="at"> postgres:10.1-alpine</span></a>
<a class="sourceLine" id="cb7-68" title="68">        <span class="fu">environment:</span></a>
<a class="sourceLine" id="cb7-69" title="69">          <span class="fu">POSTGRES_USER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb7-70" title="70">          <span class="fu">POSTGRES_DB:</span><span class="at"> ruby26</span></a>
<a class="sourceLine" id="cb7-71" title="71">          <span class="fu">POSTGRES_PASSWORD:</span><span class="at"> </span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb7-72" title="72"></a>
<a class="sourceLine" id="cb7-73" title="73"></a>
<a class="sourceLine" id="cb7-74" title="74"><span class="fu">workflows:</span></a>
<a class="sourceLine" id="cb7-75" title="75">  <span class="fu">version:</span><span class="at"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb7-76" title="76">  <span class="fu">multiple-rubies:</span></a>
<a class="sourceLine" id="cb7-77" title="77">    <span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb7-78" title="78">      <span class="kw">-</span> ruby-26</a>
<a class="sourceLine" id="cb7-79" title="79">      <span class="kw">-</span> ruby-25</a></code></pre>
          </div>
          {% endraw %}
        </td>
        <td class="d-table-cell v-align-top">
          <p>{% raw %}</p>
          <div class="sourceCode" id="cb8">
            <pre
              class="sourceCode yaml"
            ><code class="sourceCode yaml"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">{</span>% endraw %<span class="kw">}{</span>% data reusables.actions.actions-not-certified-by-github-comment %<span class="kw">}{</span>% raw %<span class="kw">}</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="fu">name:</span><span class="at"> Containers</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="fu">on:</span><span class="at"> </span><span class="kw">[</span>push<span class="kw">]</span></a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="fu">build:</span></a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10">    <span class="fu">strategy:</span></a>
<a class="sourceLine" id="cb8-11" title="11">      <span class="fu">matrix:</span></a>
<a class="sourceLine" id="cb8-12" title="12">        <span class="fu">ruby:</span><span class="at"> </span><span class="kw">[</span><span class="fl">2.5</span><span class="kw">,</span> <span class="fl">2.6.3</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb8-13" title="13"></a>
<a class="sourceLine" id="cb8-14" title="14">    <span class="fu">runs-on:</span><span class="at"> ubuntu-latest</span></a>
<a class="sourceLine" id="cb8-15" title="15"></a>
<a class="sourceLine" id="cb8-16" title="16">    <span class="fu">env:</span></a>
<a class="sourceLine" id="cb8-17" title="17">      <span class="fu">PGHOST:</span><span class="at"> localhost</span></a>
<a class="sourceLine" id="cb8-18" title="18">      <span class="fu">PGUSER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb8-19" title="19">      <span class="fu">RAILS_ENV:</span><span class="at"> test</span></a>
<a class="sourceLine" id="cb8-20" title="20"></a>
<a class="sourceLine" id="cb8-21" title="21">    <span class="fu">services:</span></a>
<a class="sourceLine" id="cb8-22" title="22">      <span class="fu">postgres:</span></a>
<a class="sourceLine" id="cb8-23" title="23">        <span class="fu">image:</span><span class="at"> postgres:10.1-alpine</span></a>
<a class="sourceLine" id="cb8-24" title="24">        <span class="fu">env:</span></a>
<a class="sourceLine" id="cb8-25" title="25">          <span class="fu">POSTGRES_USER:</span><span class="at"> administrate</span></a>
<a class="sourceLine" id="cb8-26" title="26">          <span class="fu">POSTGRES_DB:</span><span class="at"> ruby25</span></a>
<a class="sourceLine" id="cb8-27" title="27">          <span class="fu">POSTGRES_PASSWORD:</span><span class="at"> </span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb8-28" title="28">        <span class="fu">ports:</span></a>
<a class="sourceLine" id="cb8-29" title="29">          <span class="kw">-</span> 5432:5432</a>
<a class="sourceLine" id="cb8-30" title="30">        <span class="co"># Add a health check</span></a>
<a class="sourceLine" id="cb8-31" title="31">        <span class="fu">options:</span><span class="at"> --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5</span></a>
<a class="sourceLine" id="cb8-32" title="32"></a>
<a class="sourceLine" id="cb8-33" title="33">    <span class="fu">steps:</span></a>
<a class="sourceLine" id="cb8-34" title="34">      <span class="kw">-</span> <span class="fu">uses:</span><span class="at"> actions/checkout@v2</span></a>
<a class="sourceLine" id="cb8-35" title="35">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Setup Ruby</span></a>
<a class="sourceLine" id="cb8-36" title="36">        <span class="fu">uses:</span><span class="at"> eregon/use-ruby-action@477b21f02be01bcb8030d50f37cfec92bfa615b6</span></a>
<a class="sourceLine" id="cb8-37" title="37">        <span class="fu">with:</span></a>
<a class="sourceLine" id="cb8-38" title="38">          <span class="fu">ruby-version:</span><span class="at"> ${{ matrix.ruby }}</span></a>
<a class="sourceLine" id="cb8-39" title="39">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Cache dependencies</span></a>
<a class="sourceLine" id="cb8-40" title="40">        <span class="fu">uses:</span><span class="at"> actions/cache@v2</span></a>
<a class="sourceLine" id="cb8-41" title="41">        <span class="fu">with:</span></a>
<a class="sourceLine" id="cb8-42" title="42">          <span class="fu">path:</span><span class="at"> vendor/bundle</span></a>
<a class="sourceLine" id="cb8-43" title="43">          <span class="fu">key:</span><span class="at"> administrate-${{ matrix.image }}-${{ hashFiles(&#39;Gemfile.lock&#39;) }}</span></a>
<a class="sourceLine" id="cb8-44" title="44">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Install postgres headers</span></a>
<a class="sourceLine" id="cb8-45" title="45"><span class="fu">        run:</span> <span class="st">|</span></a>
<a class="sourceLine" id="cb8-46" title="46">          sudo apt-get update</a>
<a class="sourceLine" id="cb8-47" title="47">          sudo apt-get install libpq-dev</a>
<a class="sourceLine" id="cb8-48" title="48">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Install dependencies</span></a>
<a class="sourceLine" id="cb8-49" title="49">        <span class="fu">run:</span><span class="at"> bundle install --path vendor/bundle</span></a>
<a class="sourceLine" id="cb8-50" title="50">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Setup environment configuration</span></a>
<a class="sourceLine" id="cb8-51" title="51">        <span class="fu">run:</span><span class="at"> cp .sample.env .env</span></a>
<a class="sourceLine" id="cb8-52" title="52">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Setup database</span></a>
<a class="sourceLine" id="cb8-53" title="53">        <span class="fu">run:</span><span class="at"> bundle exec rake db:setup</span></a>
<a class="sourceLine" id="cb8-54" title="54">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Run tests</span></a>
<a class="sourceLine" id="cb8-55" title="55">        <span class="fu">run:</span><span class="at"> bundle exec rake</span></a>
<a class="sourceLine" id="cb8-56" title="56">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Install appraisal</span></a>
<a class="sourceLine" id="cb8-57" title="57">        <span class="fu">run:</span><span class="at"> bundle exec appraisal install</span></a>
<a class="sourceLine" id="cb8-58" title="58">      <span class="kw">-</span> <span class="fu">name:</span><span class="at"> Run appraisal</span></a>
<a class="sourceLine" id="cb8-59" title="59">        <span class="fu">run:</span><span class="at"> bundle exec appraisal rake</span></a></code></pre>
          </div>
          {% endraw %}
        </td>
      </tr>
    </table>
  </body>
</html>
