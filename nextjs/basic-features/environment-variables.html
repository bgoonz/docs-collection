<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>environment-variables</title>
    <link
      rel="stylesheet"
      href="https://raw.githubusercontent.com/bgoonz/docs-collection/master/nextjs.css"
    />
  </head>
  <body>
    <h1 id="environment-variables">Environment Variables</h1>
    <blockquote>
      <p>
        This document is for Next.js versions 9.4 and up. If you’re using an
        older version of Next.js, upgrade or refer to
        <a href="/docs/api-reference/next.config.js/environment-variables.md"
          >Environment Variables in next.config.js</a
        >.
      </p>
    </blockquote>
    <details open>
      <summary><b>Examples</b></summary>
      <ul>
        <li>
          <a
            href="https://github.com/vercel/next.js/tree/canary/examples/environment-variables"
            >Environment Variables</a
          >
        </li>
      </ul>
    </details>
    <p>
      Next.js comes with built-in support for environment variables, which
      allows you to do the following:
    </p>
    <ul>
      <li>
        <a href="#loading-environment-variables"
          >Use <code>.env.local</code> to load environment variables</a
        >
      </li>
      <li>
        <a href="#exposing-environment-variables-to-the-browser"
          >Expose environment variables to the browser</a
        >
      </li>
    </ul>
    <h2 id="loading-environment-variables">Loading Environment Variables</h2>
    <p>
      Next.js has built-in support for loading environment variables from
      <code>.env.local</code> into <code>process.env</code>.
    </p>
    <p>An example <code>.env.local</code>:</p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode bash"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="va">DB_HOST=</span>localhost</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">DB_USER=</span>myuser</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="va">DB_PASS=</span>mypassword</a></code></pre>
    </div>
    <p>
      This loads <code>process.env.DB_HOST</code>,
      <code>process.env.DB_USER</code>, and
      <code>process.env.DB_PASS</code> into the Node.js environment
      automatically allowing you to use them in
      <a href="/docs/basic-features/data-fetching.md"
        >Next.js data fetching methods</a
      >
      and <a href="/docs/api-routes/introduction.md">API routes</a>.
    </p>
    <p>
      For example, using
      <a
        href="/docs/basic-features/data-fetching.md#getstaticprops-static-generation"
        ><code>getStaticProps</code></a
      >:
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="co">// pages/index.js</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="at">getStaticProps</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">const</span> db <span class="op">=</span> <span class="cf">await</span> <span class="va">myDB</span>.<span class="at">connect</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="dt">host</span><span class="op">:</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">DB_HOST</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="dt">username</span><span class="op">:</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">DB_USER</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="dt">password</span><span class="op">:</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">DB_PASS</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="op">}</span></a></code></pre>
    </div>
    <blockquote>
      <p>
        <strong>Note</strong>: In order to keep server-only secrets safe,
        Next.js replaces <code>process.env.*</code> with the correct values at
        build time. This means that <code>process.env</code> is not a standard
        JavaScript object, so you’re not able to use
        <a
          href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"
          >object destructuring</a
        >. Environment variables must be referenced as
        e.g. <code>process.env.NEXT_PUBLIC_PUBLISHABLE_KEY</code>, <em>not</em>
        <code>const { NEXT_PUBLIC_PUBLISHABLE_KEY } = process.env</code>.
      </p>
    </blockquote>
    <blockquote>
      <p>
        <strong>Note</strong>: Next.js will automatically expand variables
        (<code>$VAR</code>) inside of your <code>.env*</code> files. This allows
        you to reference other secrets, like so:
      </p>
      <div class="sourceCode" id="cb3">
        <pre
          class="sourceCode bash"
        ><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># .env</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="va">HOSTNAME=</span>localhost</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="va">PORT=</span>8080</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">HOST=</span>http://<span class="va">$HOSTNAME</span>:<span class="va">$PORT</span></a></code></pre>
      </div>
      <p>
        If you are trying to use a variable with a <code>$</code> in the actual
        value, it needs to be escaped like so: <code>\$</code>.
      </p>
      <p>For example:</p>
      <div class="sourceCode" id="cb4">
        <pre
          class="sourceCode bash"
        ><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># .env</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="va">A=</span>abc</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># becomes &quot;preabc&quot;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="va">WRONG=</span>pre<span class="va">$A</span></a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"># becomes &quot;pre$A&quot;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="va">CORRECT=</span>pre<span class="dt">\$</span>A</a></code></pre>
      </div>
    </blockquote>
    <h2 id="exposing-environment-variables-to-the-browser">
      Exposing Environment Variables to the Browser
    </h2>
    <p>
      By default all environment variables loaded through
      <code>.env.local</code> are only available in the Node.js environment,
      meaning they won’t be exposed to the browser.
    </p>
    <p>
      In order to expose a variable to the browser you have to prefix the
      variable with <code>NEXT_PUBLIC_</code>. For example:
    </p>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode bash"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="va">NEXT_PUBLIC_ANALYTICS_ID=</span>abcdefghijk</a></code></pre>
    </div>
    <p>
      This loads <code>process.env.NEXT_PUBLIC_ANALYTICS_ID</code> into the
      Node.js environment automatically, allowing you to use it anywhere in your
      code. The value will be inlined into JavaScript sent to the browser
      because of the <code>NEXT_PUBLIC_</code> prefix. This inlining occurs at
      build time, so your various <code>NEXT_PUBLIC_</code> envs need to be set
      when the project is built.
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// pages/index.js</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="im">import</span> setupAnalyticsService <span class="im">from</span> <span class="st">&quot;../lib/my-analytics-service&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">// NEXT_PUBLIC_ANALYTICS_ID can be used here as it&#39;s prefixed by NEXT_PUBLIC_</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="at">setupAnalyticsService</span>(<span class="va">process</span>.<span class="va">env</span>.<span class="at">NEXT_PUBLIC_ANALYTICS_ID</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">function</span> <span class="at">HomePage</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="cf">return</span> <span class="op">&lt;</span>h1<span class="op">&gt;</span>Hello World&lt;/h1<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb6-10" title="10"></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="im">export</span> <span class="im">default</span> HomePage<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="default-environment-variables">Default Environment Variables</h2>
    <p>
      In general only one <code>.env.local</code> file is needed. However,
      sometimes you might want to add some defaults for the
      <code>development</code> (<code>next dev</code>) or
      <code>production</code> (<code>next start</code>) environment.
    </p>
    <p>
      Next.js allows you to set defaults in <code>.env</code> (all
      environments), <code>.env.development</code> (development environment),
      and <code>.env.production</code> (production environment).
    </p>
    <p><code>.env.local</code> always overrides the defaults set.</p>
    <blockquote>
      <p>
        <strong>Note</strong>: <code>.env</code>, <code>.env.development</code>,
        and <code>.env.production</code> files should be included in your
        repository as they define defaults.
        <strong
          ><code>.env*.local</code> should be added to
          <code>.gitignore</code></strong
        >, as those files are intended to be ignored. <code>.env.local</code> is
        where secrets can be stored.
      </p>
    </blockquote>
    <h2 id="environment-variables-on-vercel">
      Environment Variables on Vercel
    </h2>
    <p>
      When deploying your Next.js application to
      <a href="https://vercel.com">Vercel</a>, Environment Variables can be
      configured
      <a href="https://vercel.com/docs/environment-variables"
        >in the Project Settings</a
      >.
    </p>
    <p>
      All types of Environment Variables should be configured there. Even
      Environment Variables used in Development – which can be
      <a
        href="https://vercel.com/docs/environment-variables#development-environment-variables"
        >downloaded onto your local device</a
      >
      afterwards.
    </p>
    <p>
      If you’ve configured
      <a
        href="https://vercel.com/docs/environment-variables#development-environment-variables"
        >Development Environment Variables</a
      >
      you can pull them into a <code>.env.local</code> for usage on your local
      machine using the following command:
    </p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode bash"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="ex">vercel</span> env pull .env.local</a></code></pre>
    </div>
    <p>
      When using the Vercel CLI to deploy make sure you add a
      <a
        href="https://vercel.com/guides/prevent-uploading-sourcepaths-with-vercelignore?query=vercelignore#allowlist"
        ><code>.vercelignore</code></a
      >
      that includes files that should not be uploaded, generally these are the
      same files included in <code>.gitignore</code>.
    </p>
    <h2 id="test-environment-variables">Test Environment Variables</h2>
    <p>
      Apart from <code>development</code> and
      <code>production</code> environments, there is a 3rd option available:
      <code>test</code>. In the same way you can set defaults for development or
      production environments, you can do the same with
      <code>.env.test</code> file for testing environment (though this one is
      not so common as the previous two).
    </p>
    <p>
      This one is useful when running tests with tools like <code>jest</code> or
      <code>cypress</code> where you need to set specific environment vars only
      for testing purposes. Test default values will be loaded if
      <code>NODE_ENV</code> is set to <code>test</code>, though you usually
      don’t need to do this manually as testing tools will address it for you.
    </p>
    <p>
      There is a small difference between <code>test</code> environment, and
      both <code>development</code> and <code>production</code> that you need to
      bear in mind: <code>.env.local</code> won’t be loaded, as you expect tests
      to produce the same results for everyone. This way every test execution
      will use same env defaults across different executions by ignoring your
      <code>.env.local</code> (which is intended to override the default set).
    </p>
    <blockquote>
      <p>
        <strong>Note</strong>: similar to Default Environment Variables,
        <code>.env.test</code> file should be included in your repository, but
        <code>.env.test.local</code> shouldn’t, as <code>.env*.local</code> are
        intended to be ignored through <code>.gitignore</code>.
      </p>
    </blockquote>
    <p>
      While running unit tests you can make sure to load your environment
      variables the same way Next.js does by leveraging the
      <code>loadEnvConfig</code> function from the
      <code>@next/env</code> package.
    </p>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// The below can be used in a Jest global setup file or similar for your testing set-up</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="im">import</span> <span class="op">{</span> loadEnvConfig <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;@next/env&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="im">export</span> <span class="im">default</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="kw">const</span> projectDir <span class="op">=</span> <span class="va">process</span>.<span class="at">cwd</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="at">loadEnvConfig</span>(projectDir)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="op">};</span></a></code></pre>
    </div>
  </body>
</html>
