http-equiv="content-type" content="text/html;charset=UTF-8"

<a href="#main" class="skipToContent_1oUP">Skip to main content</a>

Menu

<a href="../../index.html" class="navbar__brand"><img src="../../../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo" /><img src="../../../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo" /><strong>Redux</strong></a>

<a href="../../introduction/getting-started.html" class="navbar__item navbar__link">Getting Started</a><a href="part-1-overview-concepts.html" class="navbar__item navbar__link">Tutorial</a><a href="../../api/api-reference.html" class="navbar__item navbar__link">API</a><a href="../../faq.html" class="navbar__item navbar__link">FAQ</a><a href="../../style-guide/style-guide.html" class="navbar__item navbar__link">Best Practices</a><a href="../../../github.com/reduxjs/redux.html" class="navbar__item navbar__link">GitHub</a><a href="../../introduction/getting-started.html#help-and-discussion" class="navbar__item navbar__link">Need help?</a>

<span class="toggle_71bT">ðŸŒœ</span>

<span class="toggle_71bT">ðŸŒž</span>

<span class="DocSearch-Button-Placeholder">Search</span>

<a href="../../index.html" class="navbar__brand"><img src="../../../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo" /><img src="../../../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo" /><strong>Redux</strong></a>

-   <a href="../../introduction/getting-started.html" class="menu__link">Getting Started</a>
-   <a href="part-1-overview-concepts.html" class="menu__link">Tutorial</a>
-   <a href="../../api/api-reference.html" class="menu__link">API</a>
-   <a href="../../faq.html" class="menu__link">FAQ</a>
-   <a href="../../style-guide/style-guide.html" class="menu__link">Best Practices</a>
-   <a href="../../../github.com/reduxjs/redux.html" class="menu__link">GitHub</a>
-   <a href="../../introduction/getting-started.html#help-and-discussion" class="menu__link">Need help?</a>

Menu

-   <a href="#!" class="menu__link menu__link--sublist">Introduction</a>
    -   <a href="../../introduction/getting-started.html" class="menu__link">Getting Started with Redux</a>
    -   <a href="../../introduction/installation.html" class="menu__link">Installation</a>
    -   <a href="../../introduction/core-concepts.html" class="menu__link">Core Concepts</a>
    -   <a href="../../introduction/learning-resources.html" class="menu__link">Learning Resources</a>
    -   <a href="../../introduction/ecosystem.html" class="menu__link">Ecosystem</a>
    -   <a href="../../introduction/examples.html" class="menu__link">Examples</a>
-   <a href="#!" class="menu__link menu__link--sublist menu__link--active">Tutorials</a>
    -   <a href="../index.html" class="menu__link">Tutorials Index</a>
    -   <a href="../quick-start.html" class="menu__link">Quick Start</a>
    -   <a href="../typescript-quick-start.html" class="menu__link">TypeScript Quick Start</a>
    -   <a href="#!" class="menu__link menu__link--sublist menu__link--active">Redux Essentials</a>
        -   <a href="part-1-overview-concepts.html" class="menu__link">Redux Overview and Concepts</a>
        -   <a href="part-2-app-structure.html" class="menu__link">Redux App Structure</a>
        -   <a href="part-3-data-flow.html" class="menu__link">Basic Redux Data Flow</a>
        -   <a href="part-4-using-data.html" class="menu__link">Using Redux Data</a>
        -   <a href="part-5-async-logic.html" class="menu__link menu__link--active active">Async Logic and Data Fetching</a>
        -   <a href="part-6-performance-normalization.html" class="menu__link">Performance and Normalizing Data</a>
    -   <a href="#!" class="menu__link menu__link--sublist">Redux Fundamentals</a>
        -   <a href="../fundamentals/part-1-overview.html" class="menu__link">Redux Overview</a>
        -   <a href="../fundamentals/part-2-concepts-data-flow.html" class="menu__link">Redux Concepts and Data Flow</a>
        -   <a href="../fundamentals/part-3-state-actions-reducers.html" class="menu__link">State, Actions, and Reducers</a>
        -   <a href="../fundamentals/part-4-store.html" class="menu__link">Store</a>
        -   <a href="../fundamentals/part-5-ui-react.html" class="menu__link">UI and React</a>
        -   <a href="../fundamentals/part-6-async-logic.html" class="menu__link">Async Logic and Data Fetching</a>
        -   <a href="../fundamentals/part-7-standard-patterns.html" class="menu__link">Standard Redux Patterns</a>
        -   <a href="../fundamentals/part-8-modern-redux.html" class="menu__link">Modern Redux with Redux Toolkit</a>
-   <a href="#!" class="menu__link menu__link--sublist">Recipes</a>
    -   <a href="../../recipes/recipe-index.html" class="menu__link">Recipes: Index</a>
    -   <a href="../../recipes/configuring-your-store.html" class="menu__link">Configuring Your Store</a>
    -   <a href="../../recipes/usage-with-typescript.html" class="menu__link">Usage With TypeScript</a>
    -   <a href="../../recipes/migrating-to-redux.html" class="menu__link">Migrating to Redux</a>
    -   <a href="../../recipes/using-object-spread-operator.html" class="menu__link">Using Object Spread Operator</a>
    -   <a href="../../recipes/reducing-boilerplate.html" class="menu__link">Reducing Boilerplate</a>
    -   <a href="../../recipes/server-rendering.html" class="menu__link">Server Rendering</a>
    -   <a href="../../recipes/writing-tests.html" class="menu__link">Writing Tests</a>
    -   <a href="../../recipes/computing-derived-data.html" class="menu__link">Computing Derived Data</a>
    -   <a href="../../recipes/implementing-undo-history.html" class="menu__link">Implementing Undo History</a>
    -   <a href="../../recipes/isolating-redux-sub-apps.html" class="menu__link">Isolating Redux Sub-Apps</a>
    -   <a href="../../recipes/code-splitting.html" class="menu__link">Code Splitting</a>
    -   <a href="../../recipes/troubleshooting.html" class="menu__link">Troubleshooting</a>
    -   <a href="#!" class="menu__link menu__link--sublist">Structuring Reducers</a>
        -   <a href="../../recipes/structuring-reducers/structuring-reducers.html" class="menu__link">Structuring Reducers</a>
        -   <a href="../../recipes/structuring-reducers/prerequisite-concepts.html" class="menu__link">Prerequisite Concepts</a>
        -   <a href="../../recipes/structuring-reducers/basic-reducer-structure.html" class="menu__link">Basic Reducer Structure</a>
        -   <a href="../../recipes/structuring-reducers/splitting-reducer-logic.html" class="menu__link">Splitting Reducer Logic</a>
        -   <a href="../../recipes/structuring-reducers/refactoring-reducer-example.html" class="menu__link">Refactoring Reducers Example</a>
        -   <a href="../../recipes/structuring-reducers/using-combinereducers.html" class="menu__link">Using combineReducers</a>
        -   <a href="../../recipes/structuring-reducers/beyond-combinereducers.html" class="menu__link">Beyond combineReducers</a>
        -   <a href="../../recipes/structuring-reducers/normalizing-state-shape.html" class="menu__link">Normalizing State Shape</a>
        -   <a href="../../recipes/structuring-reducers/updating-normalized-data.html" class="menu__link">Updating Normalized Data</a>
        -   <a href="../../recipes/structuring-reducers/reusing-reducer-logic.html" class="menu__link">Reusing Reducer Logic</a>
        -   <a href="../../recipes/structuring-reducers/immutable-update-patterns.html" class="menu__link">Immutable Update Patterns</a>
        -   <a href="../../recipes/structuring-reducers/initializing-state.html" class="menu__link">Initializing State</a>
-   <a href="#!" class="menu__link menu__link--sublist">Understanding Redux</a>
    -   <a href="#!" class="menu__link menu__link--sublist">Thinking in Redux</a>
        -   <a href="../../understanding/thinking-in-redux/motivation.html" class="menu__link">Motivation</a>
        -   <a href="../../understanding/thinking-in-redux/three-principles.html" class="menu__link">Three Principles</a>
        -   <a href="../../understanding/thinking-in-redux/glossary.html" class="menu__link">Glossary</a>
    -   <a href="#!" class="menu__link menu__link--sublist">History and Design</a>
        -   <a href="../../understanding/history-and-design/prior-art.html" class="menu__link">Prior Art</a>
        -   <a href="../../understanding/history-and-design/middleware.html" class="menu__link">Middleware</a>
-   <a href="#!" class="menu__link menu__link--sublist">FAQ</a>
    -   <a href="../../faq.html" class="menu__link">FAQ Index</a>
    -   <a href="../../faq/general.html" class="menu__link">General</a>
    -   <a href="../../faq/reducers.html" class="menu__link">Reducers</a>
    -   <a href="../../faq/organizing-state.html" class="menu__link">Organizing State</a>
    -   <a href="../../faq/store-setup.html" class="menu__link">Store Setup</a>
    -   <a href="../../faq/actions.html" class="menu__link">Actions</a>
    -   <a href="../../faq/immutable-data.html" class="menu__link">Immutable Data</a>
    -   <a href="../../faq/code-structure.html" class="menu__link">Code Structure</a>
    -   <a href="../../faq/performance.html" class="menu__link">Performance</a>
    -   <a href="../../faq/design-decisions.html" class="menu__link">Design Decisions</a>
    -   <a href="../../faq/react-redux.html" class="menu__link">React Redux</a>
    -   <a href="../../faq/miscellaneous.html" class="menu__link">Miscellaneous</a>
-   <a href="#!" class="menu__link menu__link--sublist">Style Guide</a>
    -   <a href="../../style-guide/style-guide.html" class="menu__link">Style Guide: Best Practices</a>
-   <a href="#!" class="menu__link menu__link--sublist">API Reference</a>
    -   <a href="../../api/api-reference.html" class="menu__link">API Reference</a>
    -   <a href="../../api/createstore.html" class="menu__link">createStore</a>
    -   <a href="../../api/store.html" class="menu__link">Store</a>
    -   <a href="../../api/combinereducers.html" class="menu__link">combineReducers</a>
    -   <a href="../../api/applymiddleware.html" class="menu__link">applyMiddleware</a>
    -   <a href="../../api/bindactioncreators.html" class="menu__link">bindActionCreators</a>
    -   <a href="../../api/compose.html" class="menu__link">compose</a>
-   <a href="#!" class="menu__link menu__link--sublist">Redux Toolkit</a>
    -   <a href="../../redux-toolkit/overview.html" class="menu__link">Redux Toolkit: Overview</a>

<span id="redux-essentials-part-5-async-logic-and-data-fetching" class="anchor enhancedAnchor_2LWZ"></span>Redux Essentials, Part 5: Async Logic and Data Fetching<a href="#redux-essentials-part-5-async-logic-and-data-fetching" class="hash-link" title="Direct link to heading">#</a>
=========================================================================================================================================================================================================================================================================================

##### <span class="admonition-icon"> </span>What You'll Learn

-   How to use the Redux "thunk" middleware for async logic
-   Patterns for handling async request state
-   How to use the Redux Toolkit `createAsyncThunk` API to simplify async calls

##### <span class="admonition-icon"> </span>Prerequisites

-   Familiarity with using AJAX requests to fetch and update data from a server

<span id="introduction" class="anchor enhancedAnchor_2LWZ"></span>Introduction<a href="#introduction" class="hash-link" title="Direct link to heading">#</a>
------------------------------------------------------------------------------------------------------------------------------------------------------------

In [Part 4: Using Redux Data](part-4-using-data.html), we saw how to use multiple pieces of data from the Redux store inside of React components, customize the contents of action objects before they're dispatched, and handle more complex update logic in our reducers.

So far, all the data we've worked with has been directly inside of our React client application. However, most real applications need to work with data from a server, by making HTTP API calls to fetch and save items.

In this section, we'll convert our social media app to fetch the posts and users data from an API, and add new posts by saving them to the API.

### <span id="example-rest-api-and-client" class="anchor enhancedAnchor_2LWZ"></span>Example REST API and Client<a href="#example-rest-api-and-client" class="hash-link" title="Direct link to heading">#</a>

To keep the example project isolated but realistic, the initial project setup already included a fake in-memory REST API for our data (configured using [the Mirage.js mock API tool](../../../miragejs.com/index.html)). The API uses `/fakeApi` as the base URL for the endpoints, and supports the typical `GET/POST/PUT/DELETE` HTTP methods for `/fakeApi/posts`, `/fakeApi/users`, and `fakeApi/notifications`. It's defined in `src/api/server.js`.

The project also includes a small HTTP API client object that exposes `client.get()` and `client.post()` methods, similar to popular HTTP libraries like `axios`. It's defined in `src/api/client.js`.

We'll use the `client` object to make HTTP calls to our in-memory fake REST API for this section.

Also, the mock server has been set up to reuse the same random seed each time the page is loaded, so that it will generate the same list of fake users and fake posts. If you want to reset that, delete the `'randomTimestampSeed'` value in your browser's Local Storage and reload the page, or you can turn that off by editing `src/api/server.js` and setting `useSeededRNG` to `false`.

##### <span class="admonition-icon"> </span>info

As a reminder, the code examples focus on the key concepts and changes for each section. See the CodeSandbox projects and the [`tutorial-steps` branch in the project repo](../../../github.com/reduxjs/redux-essentials-example-app/tree/tutorial-steps.html) for the complete changes in the application.

<span id="thunks-and-async-logic" class="anchor enhancedAnchor_2LWZ"></span>Thunks and Async Logic<a href="#thunks-and-async-logic" class="hash-link" title="Direct link to heading">#</a>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### <span id="using-middleware-to-enable-async-logic" class="anchor enhancedAnchor_2LWZ"></span>Using Middleware to Enable Async Logic<a href="#using-middleware-to-enable-async-logic" class="hash-link" title="Direct link to heading">#</a>

By itself, a Redux store doesn't know anything about async logic. It only knows how to synchronously dispatch actions, update the state by calling the root reducer function, and notify the UI that something has changed. Any asynchronicity has to happen outside the store.

But, what if you want to have async logic interact with the store by dispatching or checking the current store state? That's where [Redux middleware](../fundamentals/part-4-store.html#middleware) come in. They extend the store, and allow you to:

-   Execute extra logic when any action is dispatched (such as logging the action and state)
-   Pause, modify, delay, replace, or halt dispatched actions
-   Write extra code that has access to `dispatch` and `getState`
-   Teach `dispatch` how to accept other values besides plain action objects, such as functions and promises, by intercepting them and dispatching real action objects instead

[The most common reason to use middleware is to allow different kinds of async logic to interact with the store](../../faq/actions.html#how-can-i-represent-side-effects-such-as-ajax-calls-why-do-we-need-things-like-action-creators-thunks-and-middleware-to-do-async-behavior). This allows you to write code that can dispatch actions and check the store state, while keeping that logic separate from your UI.

There are many kinds of async middleware for Redux, and each lets you write your logic using different syntax. The most common async middleware is [`redux-thunk`](../../../github.com/reduxjs/redux-thunk.html), which lets you write plain functions that may contain async logic directly. Redux Toolkit's `configureStore` function [automatically sets up the thunk middleware by default](../../../redux-toolkit.js.org/api/getDefaultMiddleware.html#included-default-middleware), and [we recommend using thunks as the standard approach for writing async logic with Redux](../../style-guide/style-guide.html#use-thunks-for-async-logic).

Earlier, we saw [what the synchronous data flow for Redux looks like](part-1-overview-concepts.html#redux-application-data-flow). When we introduce asynchronous logic, we add an extra step where middleware can run logic like AJAX requests, then dispatch actions. That makes the async data flow look like this:

![Redux async data flow diagram](../../../d33wubrfki0l68.cloudfront.net/08d01ed85246d3ece01963408572f3f6dfb49d41/4bc12/assets/images/reduxasyncdataflowdiagram-d97ff38a0f4da0f327163170ccc)

### <span id="thunk-functions" class="anchor enhancedAnchor_2LWZ"></span>Thunk Functions<a href="#thunk-functions" class="hash-link" title="Direct link to heading">#</a>

Once the thunk middleware has been added to the Redux store, it allows you to pass *thunk functions* directly to `store.dispatch`. A thunk function will always be called with `(dispatch, getState)` as its arguments, and you can use them inside the thunk as needed.

Thunks typically dispatch plain actions using action creators, like `dispatch(increment())`:

<span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">configureStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> reducer</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> counterReducer </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">exampleThunkFunction</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> stateBefore </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token template-string string" style="color: #a6e22e">Counter before: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">${</span><span class="token template-string interpolation">stateBefore</span><span class="token template-string interpolation punctuation" style="color: #f8f8f2">.</span><span class="token template-string interpolation">counter</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">}</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">increment</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> stateAfter </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token template-string string" style="color: #a6e22e">Counter after: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">${</span><span class="token template-string interpolation">stateAfter</span><span class="token template-string interpolation punctuation" style="color: #f8f8f2">.</span><span class="token template-string interpolation">counter</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">}</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">exampleThunkFunction</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

For consistency with dispatching normal action objects, we typically write these as *thunk action creators*, which return the thunk function. These action creators can take arguments that can be used inside the thunk.

<span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">logAndAdd</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">amount</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> stateBefore </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token template-string string" style="color: #a6e22e">Counter before: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">${</span><span class="token template-string interpolation">stateBefore</span><span class="token template-string interpolation punctuation" style="color: #f8f8f2">.</span><span class="token template-string interpolation">counter</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">}</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">incrementByAmount</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">amount</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> stateAfter </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token template-string string" style="color: #a6e22e">Counter after: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">${</span><span class="token template-string interpolation">stateAfter</span><span class="token template-string interpolation punctuation" style="color: #f8f8f2">.</span><span class="token template-string interpolation">counter</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">}</span><span class="token template-string template-punctuation string" style="color: #a6e22e">\`</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">logAndAdd</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token number" style="color: #ae81ff">5</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

Thunks are typically written in "slice" files. `createSlice` itself does not have any special support for defining thunks, so you should write them as separate functions in the same slice file. That way, they have access to the plain action creators for that slice, and it's easy to find where the thunk lives.

### <span id="writing-async-thunks" class="anchor enhancedAnchor_2LWZ"></span>Writing Async Thunks<a href="#writing-async-thunks" class="hash-link" title="Direct link to heading">#</a>

Thunks may have async logic inside of them, such as `setTimeout`, `Promise`s, and `async/await`. This makes them a good place to put AJAX calls to a server API.

Data fetching logic for Redux typically follows a predictable pattern:

-   A "start" action is dispatched before the request, to indicate that the request is in progress. This may be used to track loading state to allow skipping duplicate requests or show loading indicators in the UI.
-   The async request is made
-   Depending on the request result, the async logic dispatches either a "success" action containing the result data, or a "failure" action containing error details. The reducer logic clears the loading state in both cases, and either processes the result data from the success case, or stores the error value for potential display.

These steps are not *required*, but are commonly used. (If all you care about is a successful result, you can just dispatch a single "success" action when the request finishes, and skip the "start" and "failure" actions.)

Redux Toolkit provides a `createAsyncThunk` API to implement the creation and dispatching of these actions, and we'll look at how to use it shortly.

#### Detailed Explanation: Dispatching Request Status Actions in Thunks

If we were to write out the code for a typical async thunk by hand, it might look like this:

<span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">getRepoDetailsStarted</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'repoDetails/fetchStarted'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">getRepoDetailsSuccess</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">repoDetails</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'repoDetails/fetchSucceeded'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> repoDetails</span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">getRepoDetailsFailed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">error</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'repoDetails/fetchFailed'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> error</span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">fetchIssuesCount</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">org</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> repo</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">getRepoDetailsStarted</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> repoDetails </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getRepoDetails</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">org</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">getRepoDetailsSuccess</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">repoDetails</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">err</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">getRepoDetailsFailed</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">err</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">toString</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

However, writing code using this approach is tedious. Each separate type of request needs repeated similar implementation:

-   Unique action types need to be defined for the three different cases
-   Each of those action types usually has a corresponding action creator function
-   A thunk has to be written that dispatches the correct actions in the right sequence

`createAsyncThunk` abstracts this pattern by generating the action types and action creators, and generating a thunk that dispatches those actions automatically. You provide a callback function that makes the async call and returns a Promise with the result.

<span id="loading-posts" class="anchor enhancedAnchor_2LWZ"></span>Loading Posts<a href="#loading-posts" class="hash-link" title="Direct link to heading">#</a>
---------------------------------------------------------------------------------------------------------------------------------------------------------------

So far, our `postsSlice` has used some hardcoded sample data as its initial state. We're going to switch that to start with an empty array of posts instead, and then fetch a list of posts from the server.

In order to do that, we're going to have to change the structure of the state in our `postsSlice`, so that we can keep track of the current state of the API request.

### <span id="extracting-posts-selectors" class="anchor enhancedAnchor_2LWZ"></span>Extracting Posts Selectors<a href="#extracting-posts-selectors" class="hash-link" title="Direct link to heading">#</a>

Right now, the `postsSlice` state is a single array of `posts`. We need to change that to be an object that has the `posts` array, plus the loading state fields.

Meanwhile, the UI components like `<PostsList>` are trying to read posts from `state.posts` in their `useSelector` hooks, assuming that that field is an array. We need to change those locations also to match the new data.

It would be nice if we didn't have to keep rewriting our components every time we made a change to the data format in our reducers. One way to avoid this is to define reusable selector functions in the slice files, and have the components use those selectors to extract the data they need instead of repeating the selector logic in each component. That way, if we do change our state structure again, we only need to update the code in the slice file.

The `<PostsList>` component needs to read a list of all the posts, and the `<SinglePostPage>` and `<EditPostForm>` components need to look up a single post by its ID. Let's export two small selector functions from `postsSlice.js` to cover those cases:

features/posts/postsSlice.js

<span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token comment" style="color: #c6cad2">/\* omit slice code\*/</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> postAdded</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> postUpdated</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> reactionAdded </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> postsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> postsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectAllPosts</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectPostById</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

Note that the `state` parameter for these selector functions is the root Redux state object, as it was for the inlined anonymous selectors we wrote directly inside of `useSelector`.

We can then use them in the components:

features/posts/PostsList.js

<span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> selectAllPosts </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'./postsSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">PostsList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> posts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit component contents</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

features/posts/SinglePostPage.js

<span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> selectPostById </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'./postsSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">SinglePostPage</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> match </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> postId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> match</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">params</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> post </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectPostById</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit component logic</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

features/posts/EditPostForm.js

<span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> postUpdated</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> selectPostById </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'./postsSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">EditPostForm</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> match </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> postId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> match</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">params</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> post </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectPostById</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit component logic</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

It's often a good idea to encapsulate data lookups by writing reusable selectors. You can also create "memoized" selectors that can help improve performance, which we'll look at in a later part of this tutorial.

But, like any abstraction, it's not something you should do *all* the time, everywhere. Writing selectors means more code to understand and maintain. **Don't feel like you need to write selectors for every single field of your state**. Try starting without any selectors, and add some later when you find yourself looking up the same values in many parts of your application code.

### <span id="loading-state-for-requests" class="anchor enhancedAnchor_2LWZ"></span>Loading State for Requests<a href="#loading-state-for-requests" class="hash-link" title="Direct link to heading">#</a>

When we make an API call, we can view its progress as a small state machine that can be in one of four possible states:

-   The request hasn't started yet
-   The request is in progress
-   The request succeeded, and we now have the data we need
-   The request failed, and there's probably an error message

We *could* track that information using some booleans, like `isLoading: true`, but it's better to track these states as a single enum value. A good pattern for this is to have a state section that looks like:

<span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">|</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'loading'</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">|</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'succeeded'</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">|</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'failed'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> error</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color: #a6e22e">string</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">|</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">null</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

These fields would exist alongside whatever actual data is being stored. These specific string state names aren't required - feel free to use other names if you want, like `'pending'` instead of `'loading'`, or `'complete'` instead of `'succeeded'`.

We can use this information to decide what to show in our UI as the request progresses, and also add logic in our reducers to prevent cases like loading data twice.

Let's update our `postsSlice` to use this pattern to track loading state for a "fetch posts" request. We'll switch our state from being an array of posts by itself, to look like `{posts, status, error}`. We'll also remove the old sample post entries from our initial state. As part of this change, we also need to change any uses of `state` as an array to be `state.posts` instead, because the array is now one level deeper:

features/posts/postsSlice.js

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> nanoid </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'@reduxjs/toolkit'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> posts</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> error</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color: #f92672">null</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'posts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> postAdded</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">reducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">push</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">prepare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">title</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> content</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit prepare logic</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">reactionAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> reaction </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> existingPost </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">existingPost</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> existingPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reactions</span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">reaction</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">++</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">postUpdated</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> title</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> content </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> existingPost </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> id</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">existingPost</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> existingPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">title</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> title</span>

<span class="token plain"> existingPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">content</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> content</span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> postAdded</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> postUpdated</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> reactionAdded </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> postsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> postsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectAllPosts</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectPostById</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

Yes, this *does* mean that we now have a nested object path that looks like `state.posts.posts`, which is somewhat repetitive and silly :) We *could* change the nested array name to be `items` or `data` or something if we wanted to avoid that, but we'll leave it as-is for now.

### <span id="fetching-data-with-createasyncthunk" class="anchor enhancedAnchor_2LWZ"></span>Fetching Data with `createAsyncThunk`<a href="#fetching-data-with-createasyncthunk" class="hash-link" title="Direct link to heading">#</a>

Redux Toolkit's `createAsyncThunk` API generates thunks that automatically dispatch those "start/success/failure" actions for you.

Let's start by adding a thunk that will make an AJAX call to retrieve a list of posts. We'll import the `client` utility from the `src/api` folder, and use that to make a request to `'/fakeApi/posts'`.

features/posts/postsSlice

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> nanoid</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> createAsyncThunk </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'@reduxjs/toolkit'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> client </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'../../api/client'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> posts</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> error</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color: #f92672">null</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchPosts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'posts/fetchPosts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'/fakeApi/posts'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

`createAsyncThunk` accepts two arguments:

-   A string that will be used as the prefix for the generated action types
-   A "payload creator" callback function that should return a `Promise` containing some data, or a rejected `Promise` with an error

The payload creator will usually make an AJAX call of some kind, and can either return the `Promise` from the AJAX call directly, or extract some data from the API response and return that. We typically write this using the JS `async/await` syntax, which lets us write functions that use `Promise`s while using standard `try/catch` logic instead of `somePromise.then()` chains.

In this case, we pass in `'posts/fetchPosts'` as the action type prefix. Our payload creation callback waits for the API call to return a response. The response object looks like `{posts: []}`, and we want our dispatched Redux action to have a payload that is *just* the array of posts. So, we extract `response.posts`, and return that from the callback.

If we try calling `dispatch(fetchPosts())`, the `fetchPosts` thunk will first dispatch an action type of `'posts/fetchPosts/pending'`:

![\`createAsyncThunk\`: posts pending action](../../../d33wubrfki0l68.cloudfront.net/0c7cfc06e17693d26ffa5d8a5372f2a6067dfad8/c6ca3/assets/images/devtools-posts-pending-8885d18adbd31d8269b31caffe463c)

We can listen for this action in our reducer and mark the request status as `'loading'`.

Once the `Promise` resolves, the `fetchPosts` thunk takes the `response.posts` array we returned from the callback, and dispatches a `'posts/fetchPosts/fulfilled'` action containing the posts array as `action.payload`:

![\`createAsyncThunk\`: posts pending action](../../../d33wubrfki0l68.cloudfront.net/ead03b77087d5d1786df2fcdd0f93e71178c3b7c/65a32/assets/images/devtools-posts-fulfilled-99e7e96d6687e5eab5b31649d93c)

#### <span id="dispatching-thunks-from-components" class="anchor enhancedAnchor_2LWZ"></span>Dispatching Thunks from Components<a href="#dispatching-thunks-from-components" class="hash-link" title="Direct link to heading">#</a>

So, let's update our `<PostsList>` component to actually fetch this data automatically for us.

We'll import the `fetchPosts` thunk into the component. Like all of our other action creators, we have to dispatch it, so we'll also need to add the `useDispatch` hook. Since we want to fetch this data when `<PostsList>` mounts, we need to import the React `useEffect` hook:

features/posts/PostsList.js

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> useEffect </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'react'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> useSelector</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> useDispatch </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'react-redux'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit other imports</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> selectAllPosts</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> fetchPosts </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'./postsSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">PostsList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> posts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postStatus </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">useEffect</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">fetchPosts</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">postStatus</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> dispatch</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit rendering logic</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

It's important that we only try to fetch the list of posts once. If we do it every time the `<PostsList>` component renders, or is re-created because we've switched between views, we might end up fetching the posts several times. We can use the `posts.status` enum to help decide if we need to actually start fetching, by selecting that into the component and only starting the fetch if the status is `'idle'`.

### <span id="reducers-and-loading-actions" class="anchor enhancedAnchor_2LWZ"></span>Reducers and Loading Actions<a href="#reducers-and-loading-actions" class="hash-link" title="Direct link to heading">#</a>

Next up, we need to handle both these actions in our reducers. This requires a bit deeper look at the `createSlice` API we've been using.

We've already seen that `createSlice` will generate an action creator for every reducer function we define in the `reducers` field, and that the generated action types include the name of the slice, like:

<span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">postUpdated</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> id</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'123'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> title</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'First Post'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> content</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'Some text here'</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token comment" style="color: #c6cad2">/\*</span>

<span class="token comment" style="color: #c6cad2">{</span>

<span class="token comment" style="color: #c6cad2"> type: 'posts/postUpdated',</span>

<span class="token comment" style="color: #c6cad2"> payload: {</span>

<span class="token comment" style="color: #c6cad2"> id: '123',</span>

<span class="token comment" style="color: #c6cad2"> title: 'First Post',</span>

<span class="token comment" style="color: #c6cad2"> content: 'Some text here'</span>

<span class="token comment" style="color: #c6cad2"> }</span>

<span class="token comment" style="color: #c6cad2">}</span>

<span class="token comment" style="color: #c6cad2">\*/</span>

Copy

However, there are times when a slice reducer needs to respond to *other* actions that weren't defined as part of this slice's `reducers` field. We can do that using the slice `extraReducers` field instead.

#### Detailed Explanation: Adding Extra Reducers to Slices

The keys in the `extraReducers` object should be Redux action type strings, like `'counter/increment'`. We *could* write those by hand ourselves, although we'd have to quote the keys if they contain any characters like '/':

<span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'posts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// slice-specific reducers here</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token string" style="color: #a6e22e">'counter/increment'</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// normal reducer logic to update the posts slice</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

However, action creators generated by Redux Toolkit automatically return their action type string if you call `actionCreator.toString()`. This means we can pass them as ES6 object literal computed properties, and the action types will become the keys of the object:

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> increment </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'../features/counter/counterSlice'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> object </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">increment</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">object</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token comment" style="color: #c6cad2">// { "counter/increment": Function}</span>

Copy

This works for the `extraReducers` field:

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> increment </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'../features/counter/counterSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'posts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// slice-specific reducers here</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">increment</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// normal reducer logic to update the posts slice</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

We can also add extra reducers by using the "builder callback" syntax for `extraReducers`. If we pass a function for `extraReducers` instead of an object, we can use the `builder` parameter to add individual cases. The `builder.addCase()` function takes either a plain string action type to listen for, or a Redux Toolkit action creator:

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> increment </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'../features/counter/counterSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'posts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// slice-specific reducers here</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token parameter">builder</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> builder</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'counter/decrement'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> builder</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">increment</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

If you're using TypeScript, you should use the builder callback form of `extraReducers`.

In this case, we need to listen for the "pending" and "fulfilled" action types dispatched by our `fetchPosts` thunk. Those action creators are attached to our actual `fetchPost` function, and we can pass those to `extraReducers` to listen for those actions:

<span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchPosts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'posts/fetchPosts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'/fakeApi/posts'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'posts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit existing reducers here</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">fetchPosts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">pending</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'loading'</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">fetchPosts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'succeeded'</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Add any fetched posts to the array</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">concat</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">fetchPosts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">rejected</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'failed'</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">error</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">message</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

We'll handle all three action types that could be dispatched by the thunk, based on the `Promise` we returned:

-   When the request starts, we'll set the `status` enum to `'loading'`
-   If the request succeeds, we mark the `status` as `'succeeded'`, and add the fetched posts to `state.posts`
-   If the request fails, we'll mark the `status` as `'failed'`, and save any error message into the state so we can display it

### <span id="displaying-loading-state" class="anchor enhancedAnchor_2LWZ"></span>Displaying Loading State<a href="#displaying-loading-state" class="hash-link" title="Direct link to heading">#</a>

Our `<PostsList>` component is already checking for any updates to the posts that are stored in Redux, and rerendering itself any time that list changes. So, if we refresh the page, we should see a random set of posts from our fake API show up on screen:

The fake API we're using returns data immediately. However, a real API call will probably take some time to return a response. It's usually a good idea to show some kind of "loading..." indicator in the UI so the user knows we're waiting for data.

We can update our `<PostsList>` to show a different bit of UI based on the `state.posts.status` enum: a spinner if we're loading, an error message if it failed, or the actual posts list if we have the data. The result might look like this:

features/posts/PostsList.js

<span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">PostsList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> posts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postStatus </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> error </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">error</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">useEffect</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">fetchPosts</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">postStatus</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> dispatch</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> content</span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'loading'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> content </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">"loader"</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token maybe-class-name">Loading</span><span class="token spread operator" style="color: #f8f8f2">...</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'succeeded'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Sort posts in reverse chronological order by datetime string</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> orderedPosts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> posts</span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">slice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">sort</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> b</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">localeCompare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> content </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> orderedPosts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">PostExcerpt</span><span class="token plain"> key</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> post</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">post</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'failed'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> content </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">error</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">section className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">"posts-list"</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">h2</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token maybe-class-name">Posts</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">h2</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">content</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">section</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

But, the fake API call is still returning almost immediately, so we can barely see the loading spinner right now. If you want to force the fake API call to take longer, you can open up `api/server.js`, and uncomment this line:

api/server.js

<span class="token comment" style="color: #c6cad2">//this.timing = 2000</span>

Copy

Uncommenting that line will force the fake API to wait 2 seconds before responding. Feel free to turn that on and off as we go if you want to see how the UI shows our loading spinner.

<span id="loading-users" class="anchor enhancedAnchor_2LWZ"></span>Loading Users<a href="#loading-users" class="hash-link" title="Direct link to heading">#</a>
---------------------------------------------------------------------------------------------------------------------------------------------------------------

We're now fetching and displaying our list of posts. But, if we look at the posts, there's a problem: they all now say "Unknown author" as the authors:

![Unknown post authors](../../../d33wubrfki0l68.cloudfront.net/401fcd331dee7942e5a93502114e616006daeb32/0328a/assets/images/posts-unknownauthor-32e58104f76e564adca25dcb95b66d20)

This is because the post entries are being randomly generated by the fake API server, which also randomly generates a set of fake users every time we reload the page. We need to update our users slice to fetch those users when the application starts.

Like last time, we'll create another async thunk to get the users from the API and return them, then handle the `fulfilled` action in the `extraReducers` slice field. We'll skip worrying about loading state for now:

features/users/usersSlice.js

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> createAsyncThunk </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'@reduxjs/toolkit'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> client </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'../../api/client'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchUsers </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'users/fetchUsers'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'/fakeApi/users'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">users</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> usersSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'users'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">fetchUsers</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> usersSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span>

Copy

We only need to fetch the list of users once, and we want to do it right when the application starts. We can do that in our `index.js` file, and directly dispatch the `fetchUsers` thunk because we have the `store` right there:

index.js

<span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> fetchUsers </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'./features/users/usersSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'./api/server'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">fetchUsers</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">render</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">StrictMode</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Provider</span><span class="token plain"> store</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token maybe-class-name">Provider</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">StrictMode</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token dom variable" style="color: #f8f8f2">document</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">getElementById</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'root'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

Now, each of the posts should be showing a username again, and we should also have that same list of users shown in the "Author" dropdown in our `<AddPostForm>`.

<span id="adding-new-posts" class="anchor enhancedAnchor_2LWZ"></span>Adding New Posts<a href="#adding-new-posts" class="hash-link" title="Direct link to heading">#</a>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------

We have one more step for this section. When we add a new post from the `<AddPostForm>`, that post is only getting added to the Redux store inside our app. We need to actually make an API call that will create the new post entry in our fake API server instead, so that it's "saved". (Since this is a fake API, the new post won't persist if we reload the page, but if we had a real backend server it would be available next time we reload.)

### <span id="sending-data-with-thunks" class="anchor enhancedAnchor_2LWZ"></span>Sending Data with Thunks<a href="#sending-data-with-thunks" class="hash-link" title="Direct link to heading">#</a>

We can use `createAsyncThunk` to help with sending data, not just fetching it. We'll create a thunk that accepts the values from our `<AddPostForm>` as an argument, and makes an HTTP POST call to the fake API to save the data.

In the process, we're going to change how we work with the new post object in our reducers. Currently, our `postsSlice` is creating a new post object in the `prepare` callback for `postAdded`, and generating a new unique ID for that post. In most apps that save data to a server, the server will take care of generating unique IDs and filling out any extra fields, and will usually return the completed data in its response. So, we can send a request body like `{ title, content, user: userId }` to the server, and then take the complete post object it sends back and add it to our `postsSlice` state.

features/posts/postsSlice.js

<span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> addNewPost </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token string" style="color: #a6e22e">'posts/addNewPost'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// The payload creator receives the partial \`{title, content, user}\` object</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token parameter">initialPost</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// We send the initial data to the fake API server</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">post</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'/fakeApi/posts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> post</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> initialPost </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// The response includes the complete post object, including unique ID</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">post</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'posts'</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// The existing \`postAdded\` reducer and prepare callback were deleted</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">reactionAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit logic</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">postUpdated</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit logic</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span>

<span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit posts loading reducers</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">addNewPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// We can directly add the new post object to our posts array</span><span class="token plain"></span>

<span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">push</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>

Copy

### <span id="checking-thunk-results-in-components" class="anchor enhancedAnchor_2LWZ"></span>Checking Thunk Results in Components<a href="#checking-thunk-results-in-components" class="hash-link" title="Direct link to heading">#</a>

Finally, we'll update `<AddPostForm>` to dispatch the `addNewPost` thunk instead of the old `postAdded` action. Since this is another API call to the server, it will take some time and *could* fail. The `addNewPost()` thunk will automatically dispatch its `pending/fulfilled/rejected` actions to the Redux store, which we're already handling. We *could* track the request status in `postsSlice` using a second loading enum if we wanted to, but for this example let's keep the loading state tracking limited to the component.

It would be good if we can at least disable the "Save Post" button while we're waiting for the request, so the user can't accidentally try to save a post twice. If the request fails, we might also want to show an error message here in the form, or perhaps just log it to the console.

We can have our component logic wait for the async thunk to finish, and check the result when it's done:

features/posts/AddPostForm.js

<span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> useState </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'react'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> useDispatch</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span class="token imports"> useSelector </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'react-redux'</span><span class="token plain"></span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> unwrapResult </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'@reduxjs/toolkit'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> addNewPost </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'./postsSlice'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">AddPostForm</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">title</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> setTitle</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">''</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">content</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> setContent</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">''</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">userId</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> setUserId</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">''</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">addRequestStatus</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> setAddRequestStatus</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit useSelectors and change handlers</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> canSave </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">\[</span><span class="token plain">title</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> content</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">\]</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">every</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token known-class-name class-name">Boolean</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&&</span><span class="token plain"> addRequestStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">onSavePostClicked</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">canSave</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">setAddRequestStatus</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'pending'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> resultAction </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">addNewPost</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> title</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> content</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> user</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> userId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">unwrapResult</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">resultAction</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">setTitle</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">''</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">setContent</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">''</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">setUserId</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">''</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">err</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">error</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'Failed to save the post: '</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">finally</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token function" style="color: #e6d874">setAddRequestStatus</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">'idle'</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span>

<span class="token plain" style="display: inline-block"> </span>

<span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit rendering logic</span><span class="token plain"></span>

<span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>

Copy

We can add a loading status enum field as a React `useState` hook, similar to how we're tracking loading state in `postsSlice` for fetching posts. In this case, we just want to know if the request is in progress or not.

When we call `dispatch(addNewPost())`, the async thunk returns a `Promise` from `dispatch`. We can `await` that promise here to know when the thunk has finished its request. But, we don't yet know if that request succeeded or failed.

`createAsyncThunk` handles any errors internally, so that we don't see any messages about "rejected Promises" in our logs. It then returns the final action it dispatched: either the `fulfilled` action if it succeeded, or the `rejected` action if it failed. Redux Toolkit has a utility function called `unwrapResult` that will return either the actual `action.payload` value from a `fulfilled` action, or throw an error if it's the `rejected` action. This lets us handle success and failure in the component using normal `try/catch` logic. So, we'll clear out the input fields to reset the form if the post was successfully created, and log the error to the console if it failed.

If you want to see what happens when the `addNewPost` API call fails, try creating a new post where the "Content" field only has the word "error" (without quotes). The server will see that and send back a failed response, so you should see a message logged to the console.

<span id="what-youve-learned" class="anchor enhancedAnchor_2LWZ"></span>What You've Learned<a href="#what-youve-learned" class="hash-link" title="Direct link to heading">#</a>
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Async logic and data fetching are always a complex topic. As you've seen, Redux Toolkit includes some tools to automate the typical Redux data fetching patterns.

Here's what our app looks like now that we're fetching data from that fake API:

As a reminder, here's what we covered in this section:

##### <span class="admonition-icon"> </span>Summary

-   **You can write reusable "selector" functions to encapsulate reading values from the Redux state**
    -   Selectors are functions that get the Redux `state` as an argument, and return some data
-   **Redux uses plugins called "middleware" to enable async logic**
    -   The standard async middleware is called `redux-thunk`, which is included in Redux Toolkit
    -   Thunk functions receive `dispatch` and `getState` as arguments, and can use those as part of async logic
-   **You can dispatch additional actions to help track the loading status of an API call**
    -   The typical pattern is dispatching a "pending" action before the call, then either a "success" containing the data or a "failure" action containing the error
    -   Loading state should usually be stored as an enum, like `'idle' | 'loading' |                                       'succeeded' |                                       'failed'`
-   **Redux Toolkit has a `createAsyncThunk` API that dispatches these actions for you**
    -   `createAsyncThunk` accepts a "payload creator" callback that should return a `Promise`, and generates `pending/fulfilled/rejected` action types automatically
    -   Generated action creators like `fetchPosts` dispatch those actions based on the `Promise` you return
    -   You can listen for these action types in `createSlice` using the `extraReducers` field, and update the state in reducers based on those actions.
    -   Action creators can be used to automatically fill in the keys of the `extraReducers` object so the slice knows what actions to listen for.

<span id="whats-next" class="anchor enhancedAnchor_2LWZ"></span>What's Next?<a href="#whats-next" class="hash-link" title="Direct link to heading">#</a>
--------------------------------------------------------------------------------------------------------------------------------------------------------

We've got one more set of topics to cover for this tutorial. In [Part 6: Performance and Normalizing Data](part-6-performance-normalization.html), we'll look at how Redux usage affects React performance, and some ways we can optimize our application for improved performance.

<a href="part-4-using-data.html" class="pagination-nav__link"></a>

Previous

Â« Redux Essentials, Part 4: Using Redux Data

<a href="part-6-performance-normalization.html" class="pagination-nav__link"></a>

Next

Redux Essentials, Part 6: Performance and Normalizing Data Â»

-   <a href="#introduction" class="table-of-contents__link">Introduction</a>
    -   <a href="#example-rest-api-and-client" class="table-of-contents__link">Example REST API and Client</a>
-   <a href="#thunks-and-async-logic" class="table-of-contents__link">Thunks and Async Logic</a>
    -   <a href="#using-middleware-to-enable-async-logic" class="table-of-contents__link">Using Middleware to Enable Async Logic</a>
    -   <a href="#thunk-functions" class="table-of-contents__link">Thunk Functions</a>
    -   <a href="#writing-async-thunks" class="table-of-contents__link">Writing Async Thunks</a>
-   <a href="#loading-posts" class="table-of-contents__link">Loading Posts</a>
    -   <a href="#extracting-posts-selectors" class="table-of-contents__link">Extracting Posts Selectors</a>
    -   <a href="#loading-state-for-requests" class="table-of-contents__link">Loading State for Requests</a>
    -   <a href="#fetching-data-with-createasyncthunk" class="table-of-contents__link">Fetching Data with <code>createAsyncThunk</code></a>
    -   <a href="#reducers-and-loading-actions" class="table-of-contents__link">Reducers and Loading Actions</a>
    -   <a href="#displaying-loading-state" class="table-of-contents__link">Displaying Loading State</a>
-   <a href="#loading-users" class="table-of-contents__link">Loading Users</a>
-   <a href="#adding-new-posts" class="table-of-contents__link">Adding New Posts</a>
    -   <a href="#sending-data-with-thunks" class="table-of-contents__link">Sending Data with Thunks</a>
    -   <a href="#checking-thunk-results-in-components" class="table-of-contents__link">Checking Thunk Results in Components</a>
-   <a href="#what-youve-learned" class="table-of-contents__link">What You've Learned</a>
-   <a href="#whats-next" class="table-of-contents__link">What's Next?</a>

#### Docs

-   <a href="../../introduction/getting-started.html" class="footer__link-item">Getting Started</a>
-   <a href="part-1-overview-concepts.html" class="footer__link-item">Tutorial</a>
-   <a href="../../faq.html" class="footer__link-item">FAQ</a>
-   <a href="../../api/api-reference.html" class="footer__link-item">API Reference</a>

#### Community

-   <a href="../../../discord.com/invite/0ZcbPKXt5bZ6au5t.html" class="footer__link-item">Reactiflux Discord</a>
-   <a href="../../../stackoverflow.com/questions/tagged/redux.html" class="footer__link-item">Stack Overflow</a>
-   <a href="../../introduction/getting-started.html#help-and-discussion" class="footer__link-item">Feedback</a>

#### More

-   <a href="../../../github.com/reduxjs/redux.html" class="footer__link-item">GitHub</a>
-   [![Deploys by Netlify](../../../www.netlify.com/img/global/badges/netlify-color-accent.svg)](../../../www.netlify.com/index.html)

<a href="../../index.html" class="footerLogoLink_MyFc"><img src="../../../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo" /><img src="../../../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo" /></a>
